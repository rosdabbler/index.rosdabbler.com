<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">spatio_temporal_voxel_layer</li>
        <!--<li class="active">spatio_temporal_voxel_layer</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-primary" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class=" older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class=" older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/openvdb_vendor">openvdb_vendor</a>
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">humble</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/openvdb_vendor">openvdb_vendor</a></td>
                    <td>2.3.4</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>2.3.4</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer">Spatio-Temporal Voxel Layer</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://journals.sagepub.com/doi/10.1177/1729881420910530">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<p>Note: We supply two PCL filters within STVL to massage the data to lower compute overhead. STVL has an approximate voxel filter to make the data more sparse if very dense. It also has a passthrough filter to limit processing data within the valid minimum to maximum height bounds. The voxel filter is recommended if it lowers CPU overhead, otherwise, passthrough filter. No filter is also available if you pre-process your data or are not interested in performance optimizations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    filter: "voxel"              #default passthrough, apply "voxel", "passthrough", or no filter to sensor data, recommended to have at one filter on
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

<p><strong>NOTE:</strong> If used on Ubuntu 20.04 (<code class="language-plaintext highlighter-rouge">Foxy</code> or <code class="language-plaintext highlighter-rouge">Noetic</code>), you must set your <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> path to include <code class="language-plaintext highlighter-rouge">jemalloc</code> due to a known compiler flag issue in the 20.04 binaries of OpenVDB (e.x. <code class="language-plaintext highlighter-rouge">export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.2</code>). If you see the error: <code class="language-plaintext highlighter-rouge">Could not load library LoadLibrary error: /usr/lib/x86_64-linux-gnu/libjemalloc.so.2: cannot allocate memory in static TLS block</code>, this is your issue.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/openvdb_vendor">openvdb_vendor</a>
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">jazzy</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/openvdb_vendor">openvdb_vendor</a></td>
                    <td>2.5.5</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>2.5.5</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer">Spatio-Temporal Voxel Layer</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://journals.sagepub.com/doi/10.1177/1729881420910530">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<p>Note: We supply two PCL filters within STVL to massage the data to lower compute overhead. STVL has an approximate voxel filter to make the data more sparse if very dense. It also has a passthrough filter to limit processing data within the valid minimum to maximum height bounds. The voxel filter is recommended if it lowers CPU overhead, otherwise, passthrough filter. No filter is also available if you pre-process your data or are not interested in performance optimizations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    filter: "voxel"              #default passthrough, apply "voxel", "passthrough", or no filter to sensor data, recommended to have at one filter on
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

<p><strong>NOTE:</strong> If used on Ubuntu 20.04 (<code class="language-plaintext highlighter-rouge">Foxy</code> or <code class="language-plaintext highlighter-rouge">Noetic</code>), you must set your <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> path to include <code class="language-plaintext highlighter-rouge">jemalloc</code> due to a known compiler flag issue in the 20.04 binaries of OpenVDB (e.x. <code class="language-plaintext highlighter-rouge">export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.2</code>). If you see the error: <code class="language-plaintext highlighter-rouge">Could not load library LoadLibrary error: /usr/lib/x86_64-linux-gnu/libjemalloc.so.2: cannot allocate memory in static TLS block</code>, this is your issue.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">noetic-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2023-08-14
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#noetic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#noetic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#noetic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>1.4.5</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer-">Spatio-Temporal Voxel Layer <a href="http://build.ros.org/view/Kbin_uX64/job/Mdev__spatio_temporal_voxel_layer__ubuntu_bionic_amd64/"><img src="http://build.ros.org/buildStatus/icon?job=Mdev__spatio_temporal_voxel_layer__ubuntu_bionic_amd64" alt="Build Status"></a>
</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<p>Note: We supply two PCL filters within STVL to massage the data to lower compute overhead. STVL has an approximate voxel filter to make the data more sparse if very dense. It also has a passthrough filter to limit processing data within the valid minimum to maximum height bounds. The voxel filter is recommended if it lowers CPU overhead, otherwise, passthrough filter. No filter is also available if you pre-process your data or are not interested in performance optimizations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  unknown_threshold:     15     #voxel height
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    filter: "voxel"              #default passthrough, apply "voxel", "passthrough", or no filter to sensor data, recommended to have at one filter on
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">galactic</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2021-12-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#galactic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#galactic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#galactic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>2.2.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer">Spatio-Temporal Voxel Layer</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://journals.sagepub.com/doi/10.1177/1729881420910530">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<p>Note: We supply two PCL filters within STVL to massage the data to lower compute overhead. STVL has an approximate voxel filter to make the data more sparse if very dense. It also has a passthrough filter to limit processing data within the valid minimum to maximum height bounds. The voxel filter is recommended if it lowers CPU overhead, otherwise, passthrough filter. No filter is also available if you pre-process your data or are not interested in performance optimizations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  unknown_threshold:     15     #voxel height
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    filter: "voxel"              #default passthrough, apply "voxel", "passthrough", or no filter to sensor data, recommended to have at one filter on
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

<p><strong>NOTE:</strong> If used on Ubuntu 20.04 (<code class="language-plaintext highlighter-rouge">Foxy</code> or <code class="language-plaintext highlighter-rouge">Noetic</code>), you must set your <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> path to include <code class="language-plaintext highlighter-rouge">jemalloc</code> due to a known compiler flag issue in the 20.04 binaries of OpenVDB (e.x. <code class="language-plaintext highlighter-rouge">export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.2</code>). If you see the error: <code class="language-plaintext highlighter-rouge">Could not load library LoadLibrary error: /usr/lib/x86_64-linux-gnu/libjemalloc.so.2: cannot allocate memory in static TLS block</code>, this is your issue.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/openvdb_vendor">openvdb_vendor</a>
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">iron</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-14
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/openvdb_vendor">openvdb_vendor</a></td>
                    <td>2.4.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>2.4.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer">Spatio-Temporal Voxel Layer</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://journals.sagepub.com/doi/10.1177/1729881420910530">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<p>Note: We supply two PCL filters within STVL to massage the data to lower compute overhead. STVL has an approximate voxel filter to make the data more sparse if very dense. It also has a passthrough filter to limit processing data within the valid minimum to maximum height bounds. The voxel filter is recommended if it lowers CPU overhead, otherwise, passthrough filter. No filter is also available if you pre-process your data or are not interested in performance optimizations.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    filter: "voxel"              #default passthrough, apply "voxel", "passthrough", or no filter to sensor data, recommended to have at one filter on
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

<p><strong>NOTE:</strong> If used on Ubuntu 20.04 (<code class="language-plaintext highlighter-rouge">Foxy</code> or <code class="language-plaintext highlighter-rouge">Noetic</code>), you must set your <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> path to include <code class="language-plaintext highlighter-rouge">jemalloc</code> due to a known compiler flag issue in the 20.04 binaries of OpenVDB (e.x. <code class="language-plaintext highlighter-rouge">export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.2</code>). If you see the error: <code class="language-plaintext highlighter-rouge">Could not load library LoadLibrary error: /usr/lib/x86_64-linux-gnu/libjemalloc.so.2: cannot allocate memory in static TLS block</code>, this is your issue.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a> <small>repository</small></h3>
        <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
        <a class="label label-primary pkg-label" href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-spatio_temporal_voxel_layer
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-spatio_temporal_voxel_layer" role="menuitem" tabindex="-1" href="/r/spatio_temporal_voxel_layer/github-SteveMacenski-spatio_temporal_voxel_layer" data="github-SteveMacenski-spatio_temporal_voxel_layer">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-spatio_temporal_voxel_layer
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">A new voxel layer leveraging modern 3D graphics tools to modernize navigation environmental representations</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git">https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">melodic-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2023-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">robot</span> <span class="label label-default">navigation</span> <span class="label label-default">voxel</span> <span class="label label-default">ros</span> <span class="label label-default">tbb</span> <span class="label label-default">openvdb</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#melodic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#melodic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/spatio_temporal_voxel_layer/#melodic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/spatio_temporal_voxel_layer">spatio_temporal_voxel_layer</a></td>
                    <td>1.3.5</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="spatio-temporal-voxel-layer-">Spatio-Temporal Voxel Layer <a href="http://build.ros.org/view/Kbin_uX64/job/Mdev__spatio_temporal_voxel_layer__ubuntu_bionic_amd64/"><img src="http://build.ros.org/buildStatus/icon?job=Mdev__spatio_temporal_voxel_layer__ubuntu_bionic_amd64" alt="Build Status"></a>
</h1>

<p>This is a drop in replacement for the voxel_grid voxel representation of the environment. This package does a number of things to improve on the voxel grid package and extend the capabilities offered to the users, under a LGPL v2.1 license. Developed and maintained by <a href="https://www.linkedin.com/in/steven-macenski-41a985101/">Steven Macenski</a> at <a href="http://www.simberobotics.com/">Simbe Robotics</a>.</p>

<p>This package sits on top of <a href="http://www.openvdb.org/">OpenVDB</a>, an open-source C++ library built by Dreamworks “comprising a novel hierarchical data structure and a suite of tools for the efficient storage and manipulation of sparse volumetric data discretized on three-dimensional grids. It is developed and maintained by DreamWorks Animation for use in volumetric applications typically encountered in feature film production.”</p>

<p>Leveraging OpenVDB, we have the ability to efficiently maintain a 3 dimensional voxel-representative world space. We wrap this with ROS tools and interfaces to the <a href="http://wiki.ros.org/navigation">navigation stack</a> to allow for use of this layer in standard ROS configurations. It is certainly possible to utilize this package without ROS/Navigation and I invite other competing methodologies to develop here and create interfaces.</p>

<p>Sample videos are shown below of a robot using <strong>7 depth cameras</strong> with less than 50% of a core, and another robot using a <strong>VLP-16</strong>.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">7 Depth Cameras</th>
      <th style="text-align: center">VLP-16 LIDAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><img src="https://user-images.githubusercontent.com/14944147/37010885-b18fe1f8-20bb-11e8-8c28-5b31e65f2844.gif" alt="ezgif com-video-to-gif"></td>
      <td style="text-align: center"><img src="https://github.com/nickovaras/gifs/blob/master/follow.gif?raw=true" alt="vlp16"></td>
    </tr>
  </tbody>
</table>

<p>We found in experimental trials with <strong>6</strong> 7hz dense stereo RGBD cameras we ran the major move_base process at <strong>20-50%</strong> nominal from <strong>80-110%</strong> on a 5th gen i7 CPU in the global costmap updating using the existing <code class="language-plaintext highlighter-rouge">voxel_layer</code>.</p>

<p>We’ve received feedback from users and have robots operating in the following environments with STVL:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Factories</li>
  <li>Libraries</li>
  <li>Hospitals</li>
  <li>Hospitality</li>
  <li>RoboCup@Home</li>
  <li>Oil and Gas</li>
</ul>

<p>Steve spoke at ROSCon 2018 about STVL and his presentation is <a href="https://vimeo.com/292699571">linked here</a> (or click on image).</p>

<p><a href="https://vimeo.com/292699571"><img src="https://user-images.githubusercontent.com/14944147/46768837-987c9280-cc9e-11e8-99ea-788d3d590dd8.png" alt="IMAGE ALT TEXT"></a></p>

<h3 id="cite-this-work">Cite This Work</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@article{doi:10.1177/1729881420910530,
    author = {Steve Macenski and David Tsai and Max Feinberg},
    title ={Spatio-temporal voxel layer: A view on robot perception for the dynamic world},
    journal = {International Journal of Advanced Robotic Systems},
    volume = {17},
    number = {2},
    year = {2020},
    doi = {10.1177/1729881420910530},
    URL = {https://doi.org/10.1177/1729881420910530}
}

</code></pre></div></div>

<h2 id="spatio-">
<strong>Spatio</strong>-</h2>
<p>The Spatio in this package is the representation of the environment in a configurable <code class="language-plaintext highlighter-rouge">voxel_size</code> voxel grid stored and searched by OpenVDB.</p>

<p>In addition, buffered measurement readings have the option to run an approximate voxel grid filter, parameterizable at runtime in the configuration yamls. It is incredibly useful to reduce spikes in <code class="language-plaintext highlighter-rouge">move_base</code> cpu due to dense measurement readings when getting close to objects (i.e. more points), but does increase the overhead very slightly (1-2%) for nominal operations. It’s a trade off but I recommend using it.</p>

<p>Below is an example a size of map that is <strong>trivial</strong> for the Spatio-Temportal Voxel Grid to maintain and render. This accounts for a 60,000 sq.ft. retail store with 710,765 voxels at a 0.05m resolution, with a size in memory of a mere 6.45MB.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37013097-11e4f782-20c6-11e8-8212-6fca6e54331c.png" alt="full_sore"></p>

<h2 id="-temporal">-<strong>Temporal</strong>
</h2>
<p>The Temporal in this package is the novel concept of <code class="language-plaintext highlighter-rouge">voxel_decay</code> whereas we have configurable functions that expire voxels and their occupation over time. Infrasture was created to store times in each voxel after which the voxel will disappear from the map. This is combined with checking inclusion of voxels in current measurement frustums to accelerate the decay of those voxels that do not have measurements but should if still in the scene and remain marked. This is done rather than simply clearing them naively or via costly raytracing. The time it takes to clear depends on the configured functions and acceleration factors.</p>

<p>Voxel acceleration uses given FOV to compute the frustum geometry. Depth cameras (e.g. Intel Realsense) are modeled with traditional 6-planed cubical frustums. 3D lidars (e.g. Velodyne VLP 16) are modeled with their hourglass-shaped FOV. Although many 3D lidars have 360 degree horizontal FOV, it is possible to use a narrower angle for the clearing frustum by setting the hFOV parameter accordingly.</p>

<p>Future extensions will also to query a static map and determine which connected components belong to the map, not in the map, or moving. Each of these three classes of blobs will have configurable models to control the time they persist, and if these things are reported to the user.</p>

<p>Below is an example of instantaneous decay, where readings in frustum are accelerated and decayed at each iteration. The models provided can be tuned to do this, or persist through linear or exponental equations. The second example has the acclerated frustum with tuned decay times and acceleration factors in navigation mode.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37063574-d0923d24-2167-11e8-850c-18b6aed61634.gif" alt="ezgif com-video-to-gif 1"></p>

<p><img src="https://user-images.githubusercontent.com/14944147/37127014-cacc1d1c-2241-11e8-8c2e-6ff7341333c9.gif" alt="ezgif com-video-to-gif 3"></p>

<h2 id="local-costmap">Local Costmap</h2>
<p>This package utilizes all of the information coming in from the robot before the decay time for the local costmap. Rather than having a defined, discrete spatial barrier for the local planner to operate in, it instead relies on the user configuration of the layer to have a short decay time of voxels (1-30 seconds) so that you only plan in relavent space. This was a conscious design requirement since frequently the local planner should operate with more information than other times when the speed is greater or slower. This natively implements dynamic costmap scaling for speed.</p>

<p>It is the user’s responsibility to chose a decay time that makes sense for your robot’s local planner. 5-15 seconds I have found to be nominally good for most open-sourced local planner plugins. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="global-costmap">Global Costmap</h2>
<p>Similar to the local costmap, the amount of information you want to store due to entropy in your scenes depend on your use-case. It is certainly possible to <strong>not</strong> decay the voxels in the global map at all. However, in practical application, I find a time 15-45 seconds to be a good balance due to things moving in the scene (i.e. store, warehouse, construction zone, office, etc). Permanent voxels set decay to -1. I do not recommend using this for planar lidars, 2D raytracing for professional grade lidars is sufficiently efficient and effective.</p>

<h2 id="mapping">Mapping</h2>

<p>As the images above suggest, you can use this to map an environment in 3D in realtime if you choose. If you enable mapping mode, then it will maintain the entire voxel grid and you can save the map using the services provided. At the moment, I support mapping but there is no probabilistic (yet!) marking framework, so what the sensor sees is what the map gets. This is likely to change in the near to middle term future as 3D localization becomes more interesting to the enterprise robotics community.</p>

<p>You can run multiple instances of the layer one to map and other to navigate if you want to navigate while mapping the environment. Mapping will also save incremental maps in the launch directory. Maps may be visualized using <code class="language-plaintext highlighter-rouge">vdb_viewer</code>. The costmap and occupancy point clouds will not generate in this mode from this layer. Utility functions are provided so you don’t need to learn anything about vdb files to convert to a pcl pointcloud in <code class="language-plaintext highlighter-rouge">vdb2pc.hpp</code>.</p>

<p>If you would like to be involved in this work, I would gladly take contributors and coauthors.</p>

<h2 id="installation">Installation</h2>

<p>As of July 8 it is available via <code class="language-plaintext highlighter-rouge">apt-get</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install ros-kinetic-spatio-temporal-voxel-layer

</code></pre></div></div>

<h3 id="install-from-source">Install from source</h3>
<p>Required dependencies ROS Kinetic, navigation, OpenVDB, TBB.</p>

<p><code class="language-plaintext highlighter-rouge">sudo rosdep init &amp;&amp; rosdep update &amp;&amp; rosdep install --from-paths src --ignore-src -r -y</code></p>

<h2 id="configuration-and-running">Configuration and Running</h2>

<h3 id="costmap_common_paramsyaml">costmap_common_params.yaml</h3>

<p>An example fully-described configuration is shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rgbd_obstacle_layer:
  enabled:               true
  voxel_decay:           20     #seconds if linear, e^n if exponential
  decay_model:           0      #0=linear, 1=exponential, -1=persistent
  voxel_size:            0.05   #meters
  track_unknown_space:   true   #default space is unknown
  observation_persistence: 0.0  #seconds
  max_obstacle_height:   2.0    #meters
  unknown_threshold:     15     #voxel height
  mark_threshold:        0      #voxel height
  update_footprint_enabled: true
  combination_method:    1      #1=max, 0=override
  obstacle_range:        3.0    #meters
  origin_z:              0.0    #meters
  publish_voxel_map:     true   # default off
  transform_tolerance:   0.2    # seconds
  mapping_mode:          false  # default off, saves map not for navigation
  map_save_duration:     60     #default 60s, how often to autosave
  observation_sources:   rgbd1_clear rgbd1_mark
  rgbd1_mark:
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: true
    clearing: false
    min_obstacle_height: 0.3     #default 0, meters
    max_obstacle_height: 2.0     #defaule 3, meters
    expected_update_rate: 0.0    #default 0, if not updating at this rate at least, remove from buffer
    observation_persistence: 0.0 #default 0, use all measurements taken during now-value, 0=latest 
    inf_is_valid: false          #default false, for laser scans
    clear_after_reading: true    #default false, clear the buffer after the layer gets readings from it
    voxel_filter: true           #default off, apply voxel filter to sensor, recommend on 
    voxel_min_points: 0          #default 0, minimum points per voxel for voxel filter
  rgbd1_clear:
    enabled: true                #default true, can be toggled on/off with associated service call
    data_type: PointCloud2
    topic: camera1/depth/points
    marking: false
    clearing: true
    min_z: 0.1                   #default 0, meters
    max_z: 7.0                   #default 10, meters
    vertical_fov_angle: 0.7      #default 0.7, radians
    horizontal_fov_angle: 1.04   #default 1.04, radians
    decay_acceleration: 1.       #default 0, 1/s^2. If laser scanner MUST be 0
    model_type: 0                #default 0 (depth camera). Use 1 for 3D Lidar

</code></pre></div></div>
<p>More configuration samples are included in the example folder, including a 3D lidar one.</p>

<h3 id="localglobal_costmap_paramsyaml">local/global_costmap_params.yaml</h3>

<p>Add this plugin to your costmap params file.</p>

<p><code class="language-plaintext highlighter-rouge">- {name: rgbd_obstacle_layer,     type: "spatio_temporal_voxel_layer/SpatioTemporalVoxelLayer"}</code></p>

<h3 id="running">Running</h3>

<p><code class="language-plaintext highlighter-rouge">roslaunch [navigation_pkg] move_base.launch</code></p>

<h3 id="enabingdisabling-observation_sources-real-time">Enabing/disabling observation_sources real-time</h3>

<p>To enable/disable observation sources use a ros service for each source:</p>

<p>~rgbd_obstacle_layer/$(source_name)/toggle_enabled (std_srvs/SetBool)</p>
<ul>
  <li>request.data = true   // Enable observation source</li>
  <li>request.data = false  // Disable observation source</li>
</ul>

<p>Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> rosservice call /move_base/global_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: true"
 rosservice call /move_base/local_costmap/rgbd_obstacle_layer/rgbd_back/toggle_enabled "data: false"
 
</code></pre></div></div>

<h3 id="debug-and-model-fitting">Debug and Model Fitting</h3>

<p>I have made the frustum transformations available for visualization and debugging. You may enable them by the <code class="language-plaintext highlighter-rouge">VISUALIZE_FRUSTUM</code> macro, though be aware it takes a substantial decrease on performance since we’re creating and destroying a ros publisher at a non-trivial rate.</p>

<p>This can also be used for situations where you do not know your camera’s proper frustum FOVs. It is possible to enable it and tweek the FOVs until you get the appropriate coverage of the space your sensor carves out in the global space. You should only do this with one sensor at a time or else your frustum in rviz might jitter around. ;-)</p>

<h3 id="interesting-side-note">Interesting side note</h3>

<p>We are able to iterate over very large grids for voxel decay, however there is clearly for every frequency (running at 1, 5, 10, 100hz) an upper limit. In the image below, we don’t actually hit the limit of the data structure, but iterating at 2hz, we hit the limit of ROS’ ability to publish a sufficiently large point cloud in that  time period, we are still running but you can see the robot at the end of an aisle without occupancy points, but still costmap marking from the underlying grid.</p>

<p>To counter this I include a service to save the grid in the .vdb format for later visualization, and for this reason I do not recommend visualizing the grid during nominal operations unless your decay time is relatively low (0-15 seconds) or else the layer may not meet its frequency requirements due to publishing this massive pointcloud.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/37010656-8ce4ff4c-20ba-11e8-9c35-1ce3e3039f77.png" alt="openvdb2"></p>

</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/SteveMacenski/spatio_temporal_voxel_layer.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
