<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/metavision_driver/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">metavision_driver</li>
        <!--<li class="active">metavision_driver</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/metavision_driver">metavision_driver</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">driver for event based cameras using the MetaVision SDK (Prophesee and CenturyArk)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ros-event-camera/metavision_driver.git">https://github.com/ros-event-camera/metavision_driver.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">release</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/metavision_driver/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/metavision_driver">metavision_driver</a></td>
                    <td>2.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="metavision_driver">metavision_driver</h1>

<p>A combined ROS/ROS2 driver for event based cameras using Prophesee’s Metavision SDK.
This driver is not written or supported by Prophesee.</p>

<p><img src="https://raw.githubusercontent.com/ros-event-camera/metavision_driver/release/images/silkyev_cam.png" alt="banner image"></p>

<p>If you are looking for more speed and features than the <a href="https://github.com/prophesee-ai/prophesee_ros_wrapper">official
Prophesee ROS
driver</a> you
have found the right repository. This driver can cope with the large amount of
data produced by Prophesee’s Gen3 and later sensors because it does
little more than getting the RAW (currently EVT3 format) events from
the camera and publishing them in ROS
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
format.</p>

<p>The events can be decoded and displayed using the following ROS/ROS2 packages:</p>

<ul>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_codecs">event_camera_codecs</a>
has C++ routines to decode event_camera_msgs.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_py">event_camera_py</a>
module for fast event decoding in python.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a>
a node / nodelet that renders and publishes ROS image messages.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_tools">event_camera_tools</a>
a set of tools to echo, monitor performance and convert
<code class="language-plaintext highlighter-rouge">event_camera_msgs</code> to legacy formats and into “RAW” format.</li>
</ul>

<h2 id="supported-platforms">Supported platforms</h2>

<p>Tested on the following platforms:</p>

<ul>
  <li>ROS Noetic (legacy, please transition to ROS2)</li>
  <li>ROS2 Humble and Rolling (also compiles on other versions, see CI)</li>
  <li>Ubuntu 22.04, 24.04 LTS</li>
  <li>Metavision SDK (OpenEB) 4.2.0, 4.6.2, 5.0.0</li>
</ul>

<p>Tested on the following hardware:</p>

<ul>
  <li><a href="https://centuryarks.com/en/silkyevcam-vga/">SilkyEVCam VGA (Gen 3.1 sensor)</a></li>
  <li><a href="https://centuryarks.com/en/silkyevcam-hd/">SilkyEVCam HD (Gen 4 sensor)</a></li>
  <li><a href="https://www.prophesee.ai/event-camera-evk4/">Prophesee EVK4 (Gen 4 sensor)</a></li>
</ul>

<p>Explicitly not supported: any data in the old EVT2 format. The sensor
must produce data in the EVT3 format. The new EVT4 format is not yet supported.</p>

<h2 id="installation-from-binaries">Installation from binaries</h2>

<p>On ROS2 you can install via</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="k">${</span><span class="nv">ROS_DISTRO</span><span class="k">}</span><span class="nt">-metavision-driver</span>

</code></pre></div></div>
<p>This will also install a version of OpenEB under <code class="language-plaintext highlighter-rouge">/opt/ros/${ROS_DISTRO}</code>.
Unless you separately install OpenEB you will still have to install the required udev
rules from the source tree directory <code class="language-plaintext highlighter-rouge">udev/rules.d/</code>, and restart udev,
see <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>.
For the SilkyEV cameras make sure that the plugin version matches the version
of the <a href="https://github.com/ros-event-camera/openeb_vendor/">ROS OpenEB vendor package</a>
that is installed (check the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file), or the camera
will not be recognized! If the driver does not find the camera,
try building from source (see below).</p>

<h2 id="how-to-build-from-source">How to build from source</h2>

<p>Prerequisites:</p>

<ul>
  <li>install <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>
</li>
  <li>install <code class="language-plaintext highlighter-rouge">vcs</code> (ubuntu package <code class="language-plaintext highlighter-rouge">python3-vcstool</code>).</li>
</ul>

<p>Make sure you have your ROS1 or ROS2 environment sourced such that ROS_VERSION is set.
For example for ROS1 noetic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/ros/noetic/setup.bash

</code></pre></div></div>

<p>Create a workspace (<code class="language-plaintext highlighter-rouge">metavision_driver_ws</code>), clone this repo, and use <code class="language-plaintext highlighter-rouge">vcs</code>
to pull in the remaining dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkg=metavision_driver
mkdir -p ~/${pkg}_ws/src
cd ~/${pkg}_ws
git clone https://github.com/ros-event-camera/metavision_driver.git src/${pkg}
cd src
vcs import &lt; ${pkg}/${pkg}.repos
cd ..

</code></pre></div></div>

<p>Optional (ROS1): to use the efficient recording nodelet clone the
<a href="https://github.com/berndpfrommer/nodelet_rosbag">nodelet_rosbag</a> repository into our src tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b open_bag_later git@github.com:berndpfrommer/nodelet_rosbag.git src/nodelet_rosbag

</code></pre></div></div>

<p>Now configure and build:</p>

<p>ROS1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin config -DCMAKE_BUILD_TYPE=RelWithDebInfo  # (optionally add -DCMAKE_EXPORT_COMPILE_COMMANDS=1)
catkin build
. devel/setup.bash

</code></pre></div></div>

<p>ROS2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
. install/setup.bash

</code></pre></div></div>

<h2 id="driver-features">Driver Features</h2>

<p>This driver differs from the Prophesee ROS driver in the following ways:</p>

<ul>
  <li>publishes
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
that store more densely and are faster to access than the older
message formats.</li>
  <li>less CPU consumption by avoiding unnecessary memory copies.</li>
  <li>implemented as nodelet such that it can be run in the same address space as
e.g. a rosbag record nodelet without worrying about message loss in transmission.</li>
  <li>prints out message rate statistics so you know when the sensor
saturates bandwidth.</li>
  <li>supports these additional features:
    <ul>
      <li>dynamic reconfiguration for bias parameters</li>
      <li>ROI specification</li>
      <li>camera synchronization (stereo)</li>
      <li>external trigger events</li>
      <li>event rate control</li>
    </ul>
  </li>
</ul>

<p>Parameters:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_file</code>: path to file with camera biases. See example in the
<code class="language-plaintext highlighter-rouge">biases</code> directory.</li>
  <li>
<code class="language-plaintext highlighter-rouge">from_file</code>: path to Metavision raw file. Instead of opening
camera, driver plays back data from this file. This will not be in
real time, usually faster.</li>
  <li>
<code class="language-plaintext highlighter-rouge">serial</code>: specifies serial number of camera to open (useful for
stereo). To learn serial number format first start driver without
specifying serial number and look at the log files.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_time_threshold</code>: (in seconds) minimum time span of
events to be aggregated in one ROS event message before message is sent. Defaults to 1ms.
In its default setting however the SDK provides packets only every 4ms. To increase SDK
callback frequency, tune <code class="language-plaintext highlighter-rouge">mipi_frame_period</code> if available for your sensor.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_size_threshold</code>: (in bytes) minimum size of events
(in bytes) to be aggregated in one ROS event message before message is sent. Defaults to 1MB.</li>
  <li>
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>: time in seconds between statistics printouts.</li>
  <li>
<code class="language-plaintext highlighter-rouge">send_queue_size</code>: outgoing ROS message send queue size (defaults
to 1000 messages).</li>
  <li>
<code class="language-plaintext highlighter-rouge">use_multithreading</code>: decouples the SDK callback from the
processing to ensure the SDK does not drop messages (defaults to
false). The SDK already queues up messages but there is no documentation on
the queue size and no way to determine if messages are dropped. Use multithreading to
minimize the risk of dropping messages. However, be aware that this incurs an
extra memory copy and threading overhead, raising the maximum CPU
load by about 50% of a CPU.</li>
  <li>
<code class="language-plaintext highlighter-rouge">frame_id</code>: the frame id to use in the ROS message header</li>
  <li>
<code class="language-plaintext highlighter-rouge">roi</code>: sets hardware region of interest (ROI). You can set
multiple ROI rectangles with this parameter by concatenation:
<code class="language-plaintext highlighter-rouge">[top_left_x_1, top_left_y_1, width_1, height_1, top_left_x_2, top_left_y_2, width_2...]</code>.
The length of the <code class="language-plaintext highlighter-rouge">roi</code> parameter vector must therefore be a multiple
of 4. Beware that when using multiple ROIs, per Metavision SDK  documentation:
<a href="https://docs.prophesee.ai/stable/api/cpp/driver/features.html#_CPPv4N10Metavision3RoiE">“Any line or column enabled by a single ROI is also enabled for all the other”</a>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_mode</code>: event rate control mode (Gen4 sensor): <code class="language-plaintext highlighter-rouge">na</code>,
<code class="language-plaintext highlighter-rouge">disabled</code>, <code class="language-plaintext highlighter-rouge">enabled</code>. Default: <code class="language-plaintext highlighter-rouge">na</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_rate</code>: event rate control rate (Gen4 sensor) events/sec. Default: 100000000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">mipi_frame_period</code>:: mipi frame period in usec. Only available on some sensors.
  Tune this to get faster callback rates from the SDK to the ROS driver. For instance 1008 will give a callback every millisecond. Risk of data corruption when set too low! Default: -1 (not set).</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter</code>: enable/disable event trail filter. Default: False.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_type</code>: type of trail filter. Allowed values: <code class="language-plaintext highlighter-rouge">trail</code>, <code class="language-plaintext highlighter-rouge">stc_cut_trail</code>, <code class="language-plaintext highlighter-rouge">stc_keep_trail</code>.
Default: <code class="language-plaintext highlighter-rouge">trail</code>. See Metavision SDK documentation.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_threshold</code>: Filter threshold, see MetavisionSDK documentation. Default: 5000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">sync_mode</code>: Used to synchronize the time stamps across multiple
cameras (tested for only 2). The cameras must be connected via a
sync cable, and two separate ROS driver nodes are started, see
example launch files. The <code class="language-plaintext highlighter-rouge">primary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> topic must be
remapped so it receives the <code class="language-plaintext highlighter-rouge">secondary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> messages.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">standalone</code> (default): freerunning camera, no sync.</li>
      <li>
<code class="language-plaintext highlighter-rouge">primary</code>: camera that drives the sync clock. Will not start
publishing data until it receives a <code class="language-plaintext highlighter-rouge">ready</code> message from the secondary.</li>
      <li>
<code class="language-plaintext highlighter-rouge">secondary</code>: camera receiving the sync clock. Will send
<code class="language-plaintext highlighter-rouge">ready</code> messages until it receives a sync signal from the primary.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code>: Controls the mode of the trigger input hardware.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">external</code>: Enables the external hardware pin to route to the trigger input hardware.
This will be the pin on the camera’s connector.</li>
      <li>
<code class="language-plaintext highlighter-rouge">loopback</code>: Connects the trigger out pin to the trigger input hardware. Only available
on Gen3 sensors (SilkyEVCam VGA).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code>: Controls the mode of the trigger output
hardware. NOTE: 4-th gen sensors no longer support trigger out!
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">enabled</code>: Enables the external hardware pin to route to the trigger in hardware.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>: Controls the period in microseconds of the trigger out pulse.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>: Controls the duty cycle of the trigger
out pulse. This is the period ratio.</li>
</ul>

<p>Services:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">save_biases</code>: write out current bias settings to bias file. For
this to work the <code class="language-plaintext highlighter-rouge">bias_file</code> parameter must be set to a non-empty value.</li>
</ul>

<p>Dynamic reconfiguration parameters
(see <a href="https://docs.prophesee.ai/stable/hw/manuals/biases.html">MetaVision documentation here</a>):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_diff</code> (read only)</li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_off</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_on</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_fo</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_hpf</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_pr</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_refr</code></li>
</ul>

<h2 id="how-to-use-ros1">How to use (ROS1):</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver driver_node.launch   # (run as node)
roslaunch metavision_driver driver_nodelet.launch   # (run as nodelet)

</code></pre></div></div>

<p>The driver should print out message rate statistics like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1663845360.494651335]: /event_camera: bw in: 106.08359 MB/s, msgs/s in:   51930, out:       0

</code></pre></div></div>
<p>Prints out the incoming (from the SDK) bandwidth and incoming and
published message rate. In multithreaded mode there will also be shown
the maximum queue size observed during
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>.</p>

<p>To use the combined driver/recording facility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver recording_driver.launch bag:=`pwd`/test.bag

</code></pre></div></div>
<p>Then start/stop recording like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun metavision_driver start_recording.py
rosrun metavision_driver stop_recording.py

</code></pre></div></div>

<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch event_camera_renderer renderer.launch

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h2 id="how-to-use-ros2">How to use (ROS2):</h2>

<h3 id="running-the-driver">Running the driver</h3>

<p>You can just start up a ROS2 node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_node.launch.py        <span class="c"># (run as node)</span>

</code></pre></div></div>

<p>but if you want to efficiently record the events (see below), you
should launch instead as a composable node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py <span class="c"># (run as composable node)</span>

</code></pre></div></div>
<p>Either way, the printout should be similar to the one for ROS1.</p>

<h3 id="visualizing-the-events">Visualizing the events</h3>
<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch event_camera_renderer renderer.launch.py

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h3 id="recording-on-ros2-versions-older-than-jazzy">Recording on ROS2 versions older than Jazzy</h3>

<p>You will need to install the <a href="https://github.com/berndpfrommer/rosbag2_composable_recorder">composable recorder</a>
into your workspace as well (see below), and launch the combined driver and recorder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver recording_driver.launch.py
ros2 run rosbag2_composable_recorder start_recording.py

</code></pre></div></div>
<p>To stop the recording, Ctrl-C the <code class="language-plaintext highlighter-rouge">recording_driver.launch.py</code> script.</p>

<h3 id="recording-on-ros2-jazzy-or-later">Recording on ROS2 Jazzy or later</h3>
<p>Launch the composable driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py

</code></pre></div></div>
<p>and start the recording like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver start_recording.launch.py

</code></pre></div></div>

<p>Then stop it like so:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run metavision_driver stop_recording_ros2.py

</code></pre></div></div>

<p>Note that the start/stop scripts and launch files need to be adjusted to fit your choice of
node names and topics, but if you leave everything default it should work out of the box.</p>

<h2 id="cpu-load">CPU load</h2>

<p>Here are some approximate performance numbers on a 16 thread (8-core) AMD
Ryzen 7480h laptop with max clock speed of 2.9GHz. All numbers were obtained
by producing maximum event rates about (48Mevs) with a SilkyEVCam:</p>

<h3 id="ros1">ROS1</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>37%</td>
      <td>61%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>70%</td>
      <td>96%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record nodelet</td>
      <td>52%</td>
      <td>74%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h3 id="ros2">ROS2</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.
Middleware used was cyclonedds.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>35%</td>
      <td>44%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>80%</td>
      <td>90%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record composable</td>
      <td>58%</td>
      <td>80%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h2 id="about-ros-time-stamps">About ROS time stamps</h2>

<p>The SDK provides hardware event time stamps directly from the
camera. For efficiency reasons the packets are not decoded and so the
sensor time stamps are not available to the driver. Therefore the ROS driver
simply puts the host wall clock arrival time of the <em>first</em> SDK packet
into the ROS packet’s header stamp field.</p>

<h2 id="external-triggering">External triggering</h2>

<p>External triggers on prophesee cameras allows for a signal to be injected
into the event stream. This is useful for synchronizing external
devices. The event stream contained in the packages will now contain
trigger events that can be recovered with the decoder.</p>

<p>Prophesee provides documentation on the trigger functions at a high
level
<a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html">here</a>.</p>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-out">Trigger out</a>
functionality is exposed through <code class="language-plaintext highlighter-rouge">trigger_out_mode</code>,
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>, and <code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>. These
variables follow the same meaning as laid out in the internal
documentation.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code> can be <code class="language-plaintext highlighter-rouge">enabled</code> or <code class="language-plaintext highlighter-rouge">disabled</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code> can be from 2us to 1h (units are us)</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code> is the pulse width ratio
(<code class="language-plaintext highlighter-rouge">trigger_out_period * trigger_out_duty_cycle</code> must be at least 1us)</li>
</ul>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-in">Trigger in</a>
functionality is abstracted away from pins to just <code class="language-plaintext highlighter-rouge">loopback</code> or
<code class="language-plaintext highlighter-rouge">external</code> as the pin mappings are constant for a given camera
configuration.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code> allows the user to specify for each camera
<code class="language-plaintext highlighter-rouge">loopback</code> or <code class="language-plaintext highlighter-rouge">external</code> and lookup which pins are associated
with that camera.</li>
</ul>

<p><strong>WARNING</strong> Running synchronization and triggers at the same time is
possible, but requires understanding of your camera’s underlying
hardware (as most share trigger out and sync out pins).</p>

<h3 id="hardware-configuration">Hardware configuration</h3>

<p>The hardware configuration file is <code class="language-plaintext highlighter-rouge">config/trigger_pins.yaml</code>. The
mappings for <code class="language-plaintext highlighter-rouge">hal_plugin_gen*</code> come from
<a href="https://docs.prophesee.ai/3.1.2/metavision_sdk/modules/hal/samples/hal_viewer.html#configuring-trigger-in-and-trigger-out">Prophesee
documentation</a>.
The mapping for <code class="language-plaintext highlighter-rouge">evc3a_plugin_gen31</code> has been validated on the
SilkyEvCam (March 2022). The mapping goes from the HAL Software Info
to pin numbers.</p>

<p>If your camera is not yet supported, the software info is printed out
on driver startup. Look for a line that contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plugin Software Name:

</code></pre></div></div>

<p>This will be the key to place under <code class="language-plaintext highlighter-rouge">prophesee_pin_config</code> which can
then be populated based on your camera’s documentation.</p>

<p><strong>WARNING</strong> If this file is not loaded (or your camera is not yet
supported), the default pin loaded will be 0. This may work in some
cases, but not all.</p>

<h3 id="silkyevcam">SilkyEvCam</h3>

<p>Documentation on the SilkyEvCam pinout can be found
<a href="https://www.centuryarks.com/images/product/sensor/silkyevcam/SilkyEvCam-USB_Spec_Rev102.pdf">here on page 6</a>.
This system uses 3.3V logic for both trigger in as well as trigger out.</p>

<p>While the loopback configuration is internal to the chip, the trigger
out line will still pulse externally. This is useful if using an event
camera to trigger an external system as you will maintain the timing
relative to the internal clock (after association between the trigger
event and the external system).</p>

<h3 id="other-cameras">Other cameras</h3>

<p>External triggering works on SilkyEVCam HD, i.e. you can trigger the
SilkyEVCam HD externally the same way as the SilkyEVCam VGA.</p>

<h2 id="license">License</h2>

<p>This software is issued under the Apache License Version 2.0.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>

<p>Contributors must sign-off each commit by adding a <code class="language-plaintext highlighter-rouge">Signed-off-by: ...</code>
line to commit messages to certify that they have the right to submit
the code they are contributing to the project according to the
<a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>.</p>
</div>
              <hr id="humble-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="humble-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#humble-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#humble-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#humble-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="humble-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="humble-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="humble-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/metavision_driver">metavision_driver</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">driver for event based cameras using the MetaVision SDK (Prophesee and CenturyArk)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ros-event-camera/metavision_driver.git">https://github.com/ros-event-camera/metavision_driver.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">release</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/metavision_driver/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/metavision_driver">metavision_driver</a></td>
                    <td>2.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="metavision_driver">metavision_driver</h1>

<p>A combined ROS/ROS2 driver for event based cameras using Prophesee’s Metavision SDK.
This driver is not written or supported by Prophesee.</p>

<p><img src="https://raw.githubusercontent.com/ros-event-camera/metavision_driver/release/images/silkyev_cam.png" alt="banner image"></p>

<p>If you are looking for more speed and features than the <a href="https://github.com/prophesee-ai/prophesee_ros_wrapper">official
Prophesee ROS
driver</a> you
have found the right repository. This driver can cope with the large amount of
data produced by Prophesee’s Gen3 and later sensors because it does
little more than getting the RAW (currently EVT3 format) events from
the camera and publishing them in ROS
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
format.</p>

<p>The events can be decoded and displayed using the following ROS/ROS2 packages:</p>

<ul>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_codecs">event_camera_codecs</a>
has C++ routines to decode event_camera_msgs.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_py">event_camera_py</a>
module for fast event decoding in python.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a>
a node / nodelet that renders and publishes ROS image messages.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_tools">event_camera_tools</a>
a set of tools to echo, monitor performance and convert
<code class="language-plaintext highlighter-rouge">event_camera_msgs</code> to legacy formats and into “RAW” format.</li>
</ul>

<h2 id="supported-platforms">Supported platforms</h2>

<p>Tested on the following platforms:</p>

<ul>
  <li>ROS Noetic (legacy, please transition to ROS2)</li>
  <li>ROS2 Humble and Rolling (also compiles on other versions, see CI)</li>
  <li>Ubuntu 22.04, 24.04 LTS</li>
  <li>Metavision SDK (OpenEB) 4.2.0, 4.6.2, 5.0.0</li>
</ul>

<p>Tested on the following hardware:</p>

<ul>
  <li><a href="https://centuryarks.com/en/silkyevcam-vga/">SilkyEVCam VGA (Gen 3.1 sensor)</a></li>
  <li><a href="https://centuryarks.com/en/silkyevcam-hd/">SilkyEVCam HD (Gen 4 sensor)</a></li>
  <li><a href="https://www.prophesee.ai/event-camera-evk4/">Prophesee EVK4 (Gen 4 sensor)</a></li>
</ul>

<p>Explicitly not supported: any data in the old EVT2 format. The sensor
must produce data in the EVT3 format. The new EVT4 format is not yet supported.</p>

<h2 id="installation-from-binaries">Installation from binaries</h2>

<p>On ROS2 you can install via</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="k">${</span><span class="nv">ROS_DISTRO</span><span class="k">}</span><span class="nt">-metavision-driver</span>

</code></pre></div></div>
<p>This will also install a version of OpenEB under <code class="language-plaintext highlighter-rouge">/opt/ros/${ROS_DISTRO}</code>.
Unless you separately install OpenEB you will still have to install the required udev
rules from the source tree directory <code class="language-plaintext highlighter-rouge">udev/rules.d/</code>, and restart udev,
see <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>.
For the SilkyEV cameras make sure that the plugin version matches the version
of the <a href="https://github.com/ros-event-camera/openeb_vendor/">ROS OpenEB vendor package</a>
that is installed (check the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file), or the camera
will not be recognized! If the driver does not find the camera,
try building from source (see below).</p>

<h2 id="how-to-build-from-source">How to build from source</h2>

<p>Prerequisites:</p>

<ul>
  <li>install <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>
</li>
  <li>install <code class="language-plaintext highlighter-rouge">vcs</code> (ubuntu package <code class="language-plaintext highlighter-rouge">python3-vcstool</code>).</li>
</ul>

<p>Make sure you have your ROS1 or ROS2 environment sourced such that ROS_VERSION is set.
For example for ROS1 noetic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/ros/noetic/setup.bash

</code></pre></div></div>

<p>Create a workspace (<code class="language-plaintext highlighter-rouge">metavision_driver_ws</code>), clone this repo, and use <code class="language-plaintext highlighter-rouge">vcs</code>
to pull in the remaining dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkg=metavision_driver
mkdir -p ~/${pkg}_ws/src
cd ~/${pkg}_ws
git clone https://github.com/ros-event-camera/metavision_driver.git src/${pkg}
cd src
vcs import &lt; ${pkg}/${pkg}.repos
cd ..

</code></pre></div></div>

<p>Optional (ROS1): to use the efficient recording nodelet clone the
<a href="https://github.com/berndpfrommer/nodelet_rosbag">nodelet_rosbag</a> repository into our src tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b open_bag_later git@github.com:berndpfrommer/nodelet_rosbag.git src/nodelet_rosbag

</code></pre></div></div>

<p>Now configure and build:</p>

<p>ROS1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin config -DCMAKE_BUILD_TYPE=RelWithDebInfo  # (optionally add -DCMAKE_EXPORT_COMPILE_COMMANDS=1)
catkin build
. devel/setup.bash

</code></pre></div></div>

<p>ROS2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
. install/setup.bash

</code></pre></div></div>

<h2 id="driver-features">Driver Features</h2>

<p>This driver differs from the Prophesee ROS driver in the following ways:</p>

<ul>
  <li>publishes
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
that store more densely and are faster to access than the older
message formats.</li>
  <li>less CPU consumption by avoiding unnecessary memory copies.</li>
  <li>implemented as nodelet such that it can be run in the same address space as
e.g. a rosbag record nodelet without worrying about message loss in transmission.</li>
  <li>prints out message rate statistics so you know when the sensor
saturates bandwidth.</li>
  <li>supports these additional features:
    <ul>
      <li>dynamic reconfiguration for bias parameters</li>
      <li>ROI specification</li>
      <li>camera synchronization (stereo)</li>
      <li>external trigger events</li>
      <li>event rate control</li>
    </ul>
  </li>
</ul>

<p>Parameters:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_file</code>: path to file with camera biases. See example in the
<code class="language-plaintext highlighter-rouge">biases</code> directory.</li>
  <li>
<code class="language-plaintext highlighter-rouge">from_file</code>: path to Metavision raw file. Instead of opening
camera, driver plays back data from this file. This will not be in
real time, usually faster.</li>
  <li>
<code class="language-plaintext highlighter-rouge">serial</code>: specifies serial number of camera to open (useful for
stereo). To learn serial number format first start driver without
specifying serial number and look at the log files.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_time_threshold</code>: (in seconds) minimum time span of
events to be aggregated in one ROS event message before message is sent. Defaults to 1ms.
In its default setting however the SDK provides packets only every 4ms. To increase SDK
callback frequency, tune <code class="language-plaintext highlighter-rouge">mipi_frame_period</code> if available for your sensor.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_size_threshold</code>: (in bytes) minimum size of events
(in bytes) to be aggregated in one ROS event message before message is sent. Defaults to 1MB.</li>
  <li>
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>: time in seconds between statistics printouts.</li>
  <li>
<code class="language-plaintext highlighter-rouge">send_queue_size</code>: outgoing ROS message send queue size (defaults
to 1000 messages).</li>
  <li>
<code class="language-plaintext highlighter-rouge">use_multithreading</code>: decouples the SDK callback from the
processing to ensure the SDK does not drop messages (defaults to
false). The SDK already queues up messages but there is no documentation on
the queue size and no way to determine if messages are dropped. Use multithreading to
minimize the risk of dropping messages. However, be aware that this incurs an
extra memory copy and threading overhead, raising the maximum CPU
load by about 50% of a CPU.</li>
  <li>
<code class="language-plaintext highlighter-rouge">frame_id</code>: the frame id to use in the ROS message header</li>
  <li>
<code class="language-plaintext highlighter-rouge">roi</code>: sets hardware region of interest (ROI). You can set
multiple ROI rectangles with this parameter by concatenation:
<code class="language-plaintext highlighter-rouge">[top_left_x_1, top_left_y_1, width_1, height_1, top_left_x_2, top_left_y_2, width_2...]</code>.
The length of the <code class="language-plaintext highlighter-rouge">roi</code> parameter vector must therefore be a multiple
of 4. Beware that when using multiple ROIs, per Metavision SDK  documentation:
<a href="https://docs.prophesee.ai/stable/api/cpp/driver/features.html#_CPPv4N10Metavision3RoiE">“Any line or column enabled by a single ROI is also enabled for all the other”</a>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_mode</code>: event rate control mode (Gen4 sensor): <code class="language-plaintext highlighter-rouge">na</code>,
<code class="language-plaintext highlighter-rouge">disabled</code>, <code class="language-plaintext highlighter-rouge">enabled</code>. Default: <code class="language-plaintext highlighter-rouge">na</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_rate</code>: event rate control rate (Gen4 sensor) events/sec. Default: 100000000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">mipi_frame_period</code>:: mipi frame period in usec. Only available on some sensors.
  Tune this to get faster callback rates from the SDK to the ROS driver. For instance 1008 will give a callback every millisecond. Risk of data corruption when set too low! Default: -1 (not set).</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter</code>: enable/disable event trail filter. Default: False.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_type</code>: type of trail filter. Allowed values: <code class="language-plaintext highlighter-rouge">trail</code>, <code class="language-plaintext highlighter-rouge">stc_cut_trail</code>, <code class="language-plaintext highlighter-rouge">stc_keep_trail</code>.
Default: <code class="language-plaintext highlighter-rouge">trail</code>. See Metavision SDK documentation.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_threshold</code>: Filter threshold, see MetavisionSDK documentation. Default: 5000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">sync_mode</code>: Used to synchronize the time stamps across multiple
cameras (tested for only 2). The cameras must be connected via a
sync cable, and two separate ROS driver nodes are started, see
example launch files. The <code class="language-plaintext highlighter-rouge">primary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> topic must be
remapped so it receives the <code class="language-plaintext highlighter-rouge">secondary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> messages.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">standalone</code> (default): freerunning camera, no sync.</li>
      <li>
<code class="language-plaintext highlighter-rouge">primary</code>: camera that drives the sync clock. Will not start
publishing data until it receives a <code class="language-plaintext highlighter-rouge">ready</code> message from the secondary.</li>
      <li>
<code class="language-plaintext highlighter-rouge">secondary</code>: camera receiving the sync clock. Will send
<code class="language-plaintext highlighter-rouge">ready</code> messages until it receives a sync signal from the primary.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code>: Controls the mode of the trigger input hardware.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">external</code>: Enables the external hardware pin to route to the trigger input hardware.
This will be the pin on the camera’s connector.</li>
      <li>
<code class="language-plaintext highlighter-rouge">loopback</code>: Connects the trigger out pin to the trigger input hardware. Only available
on Gen3 sensors (SilkyEVCam VGA).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code>: Controls the mode of the trigger output
hardware. NOTE: 4-th gen sensors no longer support trigger out!
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">enabled</code>: Enables the external hardware pin to route to the trigger in hardware.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>: Controls the period in microseconds of the trigger out pulse.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>: Controls the duty cycle of the trigger
out pulse. This is the period ratio.</li>
</ul>

<p>Services:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">save_biases</code>: write out current bias settings to bias file. For
this to work the <code class="language-plaintext highlighter-rouge">bias_file</code> parameter must be set to a non-empty value.</li>
</ul>

<p>Dynamic reconfiguration parameters
(see <a href="https://docs.prophesee.ai/stable/hw/manuals/biases.html">MetaVision documentation here</a>):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_diff</code> (read only)</li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_off</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_on</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_fo</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_hpf</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_pr</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_refr</code></li>
</ul>

<h2 id="how-to-use-ros1">How to use (ROS1):</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver driver_node.launch   # (run as node)
roslaunch metavision_driver driver_nodelet.launch   # (run as nodelet)

</code></pre></div></div>

<p>The driver should print out message rate statistics like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1663845360.494651335]: /event_camera: bw in: 106.08359 MB/s, msgs/s in:   51930, out:       0

</code></pre></div></div>
<p>Prints out the incoming (from the SDK) bandwidth and incoming and
published message rate. In multithreaded mode there will also be shown
the maximum queue size observed during
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>.</p>

<p>To use the combined driver/recording facility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver recording_driver.launch bag:=`pwd`/test.bag

</code></pre></div></div>
<p>Then start/stop recording like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun metavision_driver start_recording.py
rosrun metavision_driver stop_recording.py

</code></pre></div></div>

<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch event_camera_renderer renderer.launch

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h2 id="how-to-use-ros2">How to use (ROS2):</h2>

<h3 id="running-the-driver">Running the driver</h3>

<p>You can just start up a ROS2 node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_node.launch.py        <span class="c"># (run as node)</span>

</code></pre></div></div>

<p>but if you want to efficiently record the events (see below), you
should launch instead as a composable node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py <span class="c"># (run as composable node)</span>

</code></pre></div></div>
<p>Either way, the printout should be similar to the one for ROS1.</p>

<h3 id="visualizing-the-events">Visualizing the events</h3>
<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch event_camera_renderer renderer.launch.py

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h3 id="recording-on-ros2-versions-older-than-jazzy">Recording on ROS2 versions older than Jazzy</h3>

<p>You will need to install the <a href="https://github.com/berndpfrommer/rosbag2_composable_recorder">composable recorder</a>
into your workspace as well (see below), and launch the combined driver and recorder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver recording_driver.launch.py
ros2 run rosbag2_composable_recorder start_recording.py

</code></pre></div></div>
<p>To stop the recording, Ctrl-C the <code class="language-plaintext highlighter-rouge">recording_driver.launch.py</code> script.</p>

<h3 id="recording-on-ros2-jazzy-or-later">Recording on ROS2 Jazzy or later</h3>
<p>Launch the composable driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py

</code></pre></div></div>
<p>and start the recording like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver start_recording.launch.py

</code></pre></div></div>

<p>Then stop it like so:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run metavision_driver stop_recording_ros2.py

</code></pre></div></div>

<p>Note that the start/stop scripts and launch files need to be adjusted to fit your choice of
node names and topics, but if you leave everything default it should work out of the box.</p>

<h2 id="cpu-load">CPU load</h2>

<p>Here are some approximate performance numbers on a 16 thread (8-core) AMD
Ryzen 7480h laptop with max clock speed of 2.9GHz. All numbers were obtained
by producing maximum event rates about (48Mevs) with a SilkyEVCam:</p>

<h3 id="ros1">ROS1</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>37%</td>
      <td>61%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>70%</td>
      <td>96%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record nodelet</td>
      <td>52%</td>
      <td>74%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h3 id="ros2">ROS2</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.
Middleware used was cyclonedds.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>35%</td>
      <td>44%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>80%</td>
      <td>90%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record composable</td>
      <td>58%</td>
      <td>80%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h2 id="about-ros-time-stamps">About ROS time stamps</h2>

<p>The SDK provides hardware event time stamps directly from the
camera. For efficiency reasons the packets are not decoded and so the
sensor time stamps are not available to the driver. Therefore the ROS driver
simply puts the host wall clock arrival time of the <em>first</em> SDK packet
into the ROS packet’s header stamp field.</p>

<h2 id="external-triggering">External triggering</h2>

<p>External triggers on prophesee cameras allows for a signal to be injected
into the event stream. This is useful for synchronizing external
devices. The event stream contained in the packages will now contain
trigger events that can be recovered with the decoder.</p>

<p>Prophesee provides documentation on the trigger functions at a high
level
<a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html">here</a>.</p>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-out">Trigger out</a>
functionality is exposed through <code class="language-plaintext highlighter-rouge">trigger_out_mode</code>,
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>, and <code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>. These
variables follow the same meaning as laid out in the internal
documentation.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code> can be <code class="language-plaintext highlighter-rouge">enabled</code> or <code class="language-plaintext highlighter-rouge">disabled</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code> can be from 2us to 1h (units are us)</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code> is the pulse width ratio
(<code class="language-plaintext highlighter-rouge">trigger_out_period * trigger_out_duty_cycle</code> must be at least 1us)</li>
</ul>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-in">Trigger in</a>
functionality is abstracted away from pins to just <code class="language-plaintext highlighter-rouge">loopback</code> or
<code class="language-plaintext highlighter-rouge">external</code> as the pin mappings are constant for a given camera
configuration.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code> allows the user to specify for each camera
<code class="language-plaintext highlighter-rouge">loopback</code> or <code class="language-plaintext highlighter-rouge">external</code> and lookup which pins are associated
with that camera.</li>
</ul>

<p><strong>WARNING</strong> Running synchronization and triggers at the same time is
possible, but requires understanding of your camera’s underlying
hardware (as most share trigger out and sync out pins).</p>

<h3 id="hardware-configuration">Hardware configuration</h3>

<p>The hardware configuration file is <code class="language-plaintext highlighter-rouge">config/trigger_pins.yaml</code>. The
mappings for <code class="language-plaintext highlighter-rouge">hal_plugin_gen*</code> come from
<a href="https://docs.prophesee.ai/3.1.2/metavision_sdk/modules/hal/samples/hal_viewer.html#configuring-trigger-in-and-trigger-out">Prophesee
documentation</a>.
The mapping for <code class="language-plaintext highlighter-rouge">evc3a_plugin_gen31</code> has been validated on the
SilkyEvCam (March 2022). The mapping goes from the HAL Software Info
to pin numbers.</p>

<p>If your camera is not yet supported, the software info is printed out
on driver startup. Look for a line that contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plugin Software Name:

</code></pre></div></div>

<p>This will be the key to place under <code class="language-plaintext highlighter-rouge">prophesee_pin_config</code> which can
then be populated based on your camera’s documentation.</p>

<p><strong>WARNING</strong> If this file is not loaded (or your camera is not yet
supported), the default pin loaded will be 0. This may work in some
cases, but not all.</p>

<h3 id="silkyevcam">SilkyEvCam</h3>

<p>Documentation on the SilkyEvCam pinout can be found
<a href="https://www.centuryarks.com/images/product/sensor/silkyevcam/SilkyEvCam-USB_Spec_Rev102.pdf">here on page 6</a>.
This system uses 3.3V logic for both trigger in as well as trigger out.</p>

<p>While the loopback configuration is internal to the chip, the trigger
out line will still pulse externally. This is useful if using an event
camera to trigger an external system as you will maintain the timing
relative to the internal clock (after association between the trigger
event and the external system).</p>

<h3 id="other-cameras">Other cameras</h3>

<p>External triggering works on SilkyEVCam HD, i.e. you can trigger the
SilkyEVCam HD externally the same way as the SilkyEVCam VGA.</p>

<h2 id="license">License</h2>

<p>This software is issued under the Apache License Version 2.0.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>

<p>Contributors must sign-off each commit by adding a <code class="language-plaintext highlighter-rouge">Signed-off-by: ...</code>
line to commit messages to certify that they have the right to submit
the code they are contributing to the project according to the
<a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>.</p>
</div>
              <hr id="jazzy-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="jazzy-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#jazzy-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#jazzy-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#jazzy-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="jazzy-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="jazzy-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="jazzy-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/metavision_driver">metavision_driver</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">driver for event based cameras using the MetaVision SDK (Prophesee and CenturyArk)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ros-event-camera/metavision_driver.git">https://github.com/ros-event-camera/metavision_driver.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">release</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/metavision_driver/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/metavision_driver">metavision_driver</a></td>
                    <td>2.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="metavision_driver">metavision_driver</h1>

<p>A combined ROS/ROS2 driver for event based cameras using Prophesee’s Metavision SDK.
This driver is not written or supported by Prophesee.</p>

<p><img src="https://raw.githubusercontent.com/ros-event-camera/metavision_driver/release/images/silkyev_cam.png" alt="banner image"></p>

<p>If you are looking for more speed and features than the <a href="https://github.com/prophesee-ai/prophesee_ros_wrapper">official
Prophesee ROS
driver</a> you
have found the right repository. This driver can cope with the large amount of
data produced by Prophesee’s Gen3 and later sensors because it does
little more than getting the RAW (currently EVT3 format) events from
the camera and publishing them in ROS
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
format.</p>

<p>The events can be decoded and displayed using the following ROS/ROS2 packages:</p>

<ul>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_codecs">event_camera_codecs</a>
has C++ routines to decode event_camera_msgs.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_py">event_camera_py</a>
module for fast event decoding in python.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a>
a node / nodelet that renders and publishes ROS image messages.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_tools">event_camera_tools</a>
a set of tools to echo, monitor performance and convert
<code class="language-plaintext highlighter-rouge">event_camera_msgs</code> to legacy formats and into “RAW” format.</li>
</ul>

<h2 id="supported-platforms">Supported platforms</h2>

<p>Tested on the following platforms:</p>

<ul>
  <li>ROS Noetic (legacy, please transition to ROS2)</li>
  <li>ROS2 Humble and Rolling (also compiles on other versions, see CI)</li>
  <li>Ubuntu 22.04, 24.04 LTS</li>
  <li>Metavision SDK (OpenEB) 4.2.0, 4.6.2, 5.0.0</li>
</ul>

<p>Tested on the following hardware:</p>

<ul>
  <li><a href="https://centuryarks.com/en/silkyevcam-vga/">SilkyEVCam VGA (Gen 3.1 sensor)</a></li>
  <li><a href="https://centuryarks.com/en/silkyevcam-hd/">SilkyEVCam HD (Gen 4 sensor)</a></li>
  <li><a href="https://www.prophesee.ai/event-camera-evk4/">Prophesee EVK4 (Gen 4 sensor)</a></li>
</ul>

<p>Explicitly not supported: any data in the old EVT2 format. The sensor
must produce data in the EVT3 format. The new EVT4 format is not yet supported.</p>

<h2 id="installation-from-binaries">Installation from binaries</h2>

<p>On ROS2 you can install via</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="k">${</span><span class="nv">ROS_DISTRO</span><span class="k">}</span><span class="nt">-metavision-driver</span>

</code></pre></div></div>
<p>This will also install a version of OpenEB under <code class="language-plaintext highlighter-rouge">/opt/ros/${ROS_DISTRO}</code>.
Unless you separately install OpenEB you will still have to install the required udev
rules from the source tree directory <code class="language-plaintext highlighter-rouge">udev/rules.d/</code>, and restart udev,
see <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>.
For the SilkyEV cameras make sure that the plugin version matches the version
of the <a href="https://github.com/ros-event-camera/openeb_vendor/">ROS OpenEB vendor package</a>
that is installed (check the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file), or the camera
will not be recognized! If the driver does not find the camera,
try building from source (see below).</p>

<h2 id="how-to-build-from-source">How to build from source</h2>

<p>Prerequisites:</p>

<ul>
  <li>install <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>
</li>
  <li>install <code class="language-plaintext highlighter-rouge">vcs</code> (ubuntu package <code class="language-plaintext highlighter-rouge">python3-vcstool</code>).</li>
</ul>

<p>Make sure you have your ROS1 or ROS2 environment sourced such that ROS_VERSION is set.
For example for ROS1 noetic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/ros/noetic/setup.bash

</code></pre></div></div>

<p>Create a workspace (<code class="language-plaintext highlighter-rouge">metavision_driver_ws</code>), clone this repo, and use <code class="language-plaintext highlighter-rouge">vcs</code>
to pull in the remaining dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkg=metavision_driver
mkdir -p ~/${pkg}_ws/src
cd ~/${pkg}_ws
git clone https://github.com/ros-event-camera/metavision_driver.git src/${pkg}
cd src
vcs import &lt; ${pkg}/${pkg}.repos
cd ..

</code></pre></div></div>

<p>Optional (ROS1): to use the efficient recording nodelet clone the
<a href="https://github.com/berndpfrommer/nodelet_rosbag">nodelet_rosbag</a> repository into our src tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b open_bag_later git@github.com:berndpfrommer/nodelet_rosbag.git src/nodelet_rosbag

</code></pre></div></div>

<p>Now configure and build:</p>

<p>ROS1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin config -DCMAKE_BUILD_TYPE=RelWithDebInfo  # (optionally add -DCMAKE_EXPORT_COMPILE_COMMANDS=1)
catkin build
. devel/setup.bash

</code></pre></div></div>

<p>ROS2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
. install/setup.bash

</code></pre></div></div>

<h2 id="driver-features">Driver Features</h2>

<p>This driver differs from the Prophesee ROS driver in the following ways:</p>

<ul>
  <li>publishes
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
that store more densely and are faster to access than the older
message formats.</li>
  <li>less CPU consumption by avoiding unnecessary memory copies.</li>
  <li>implemented as nodelet such that it can be run in the same address space as
e.g. a rosbag record nodelet without worrying about message loss in transmission.</li>
  <li>prints out message rate statistics so you know when the sensor
saturates bandwidth.</li>
  <li>supports these additional features:
    <ul>
      <li>dynamic reconfiguration for bias parameters</li>
      <li>ROI specification</li>
      <li>camera synchronization (stereo)</li>
      <li>external trigger events</li>
      <li>event rate control</li>
    </ul>
  </li>
</ul>

<p>Parameters:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_file</code>: path to file with camera biases. See example in the
<code class="language-plaintext highlighter-rouge">biases</code> directory.</li>
  <li>
<code class="language-plaintext highlighter-rouge">from_file</code>: path to Metavision raw file. Instead of opening
camera, driver plays back data from this file. This will not be in
real time, usually faster.</li>
  <li>
<code class="language-plaintext highlighter-rouge">serial</code>: specifies serial number of camera to open (useful for
stereo). To learn serial number format first start driver without
specifying serial number and look at the log files.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_time_threshold</code>: (in seconds) minimum time span of
events to be aggregated in one ROS event message before message is sent. Defaults to 1ms.
In its default setting however the SDK provides packets only every 4ms. To increase SDK
callback frequency, tune <code class="language-plaintext highlighter-rouge">mipi_frame_period</code> if available for your sensor.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_size_threshold</code>: (in bytes) minimum size of events
(in bytes) to be aggregated in one ROS event message before message is sent. Defaults to 1MB.</li>
  <li>
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>: time in seconds between statistics printouts.</li>
  <li>
<code class="language-plaintext highlighter-rouge">send_queue_size</code>: outgoing ROS message send queue size (defaults
to 1000 messages).</li>
  <li>
<code class="language-plaintext highlighter-rouge">use_multithreading</code>: decouples the SDK callback from the
processing to ensure the SDK does not drop messages (defaults to
false). The SDK already queues up messages but there is no documentation on
the queue size and no way to determine if messages are dropped. Use multithreading to
minimize the risk of dropping messages. However, be aware that this incurs an
extra memory copy and threading overhead, raising the maximum CPU
load by about 50% of a CPU.</li>
  <li>
<code class="language-plaintext highlighter-rouge">frame_id</code>: the frame id to use in the ROS message header</li>
  <li>
<code class="language-plaintext highlighter-rouge">roi</code>: sets hardware region of interest (ROI). You can set
multiple ROI rectangles with this parameter by concatenation:
<code class="language-plaintext highlighter-rouge">[top_left_x_1, top_left_y_1, width_1, height_1, top_left_x_2, top_left_y_2, width_2...]</code>.
The length of the <code class="language-plaintext highlighter-rouge">roi</code> parameter vector must therefore be a multiple
of 4. Beware that when using multiple ROIs, per Metavision SDK  documentation:
<a href="https://docs.prophesee.ai/stable/api/cpp/driver/features.html#_CPPv4N10Metavision3RoiE">“Any line or column enabled by a single ROI is also enabled for all the other”</a>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_mode</code>: event rate control mode (Gen4 sensor): <code class="language-plaintext highlighter-rouge">na</code>,
<code class="language-plaintext highlighter-rouge">disabled</code>, <code class="language-plaintext highlighter-rouge">enabled</code>. Default: <code class="language-plaintext highlighter-rouge">na</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_rate</code>: event rate control rate (Gen4 sensor) events/sec. Default: 100000000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">mipi_frame_period</code>:: mipi frame period in usec. Only available on some sensors.
  Tune this to get faster callback rates from the SDK to the ROS driver. For instance 1008 will give a callback every millisecond. Risk of data corruption when set too low! Default: -1 (not set).</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter</code>: enable/disable event trail filter. Default: False.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_type</code>: type of trail filter. Allowed values: <code class="language-plaintext highlighter-rouge">trail</code>, <code class="language-plaintext highlighter-rouge">stc_cut_trail</code>, <code class="language-plaintext highlighter-rouge">stc_keep_trail</code>.
Default: <code class="language-plaintext highlighter-rouge">trail</code>. See Metavision SDK documentation.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_threshold</code>: Filter threshold, see MetavisionSDK documentation. Default: 5000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">sync_mode</code>: Used to synchronize the time stamps across multiple
cameras (tested for only 2). The cameras must be connected via a
sync cable, and two separate ROS driver nodes are started, see
example launch files. The <code class="language-plaintext highlighter-rouge">primary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> topic must be
remapped so it receives the <code class="language-plaintext highlighter-rouge">secondary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> messages.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">standalone</code> (default): freerunning camera, no sync.</li>
      <li>
<code class="language-plaintext highlighter-rouge">primary</code>: camera that drives the sync clock. Will not start
publishing data until it receives a <code class="language-plaintext highlighter-rouge">ready</code> message from the secondary.</li>
      <li>
<code class="language-plaintext highlighter-rouge">secondary</code>: camera receiving the sync clock. Will send
<code class="language-plaintext highlighter-rouge">ready</code> messages until it receives a sync signal from the primary.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code>: Controls the mode of the trigger input hardware.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">external</code>: Enables the external hardware pin to route to the trigger input hardware.
This will be the pin on the camera’s connector.</li>
      <li>
<code class="language-plaintext highlighter-rouge">loopback</code>: Connects the trigger out pin to the trigger input hardware. Only available
on Gen3 sensors (SilkyEVCam VGA).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code>: Controls the mode of the trigger output
hardware. NOTE: 4-th gen sensors no longer support trigger out!
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">enabled</code>: Enables the external hardware pin to route to the trigger in hardware.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>: Controls the period in microseconds of the trigger out pulse.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>: Controls the duty cycle of the trigger
out pulse. This is the period ratio.</li>
</ul>

<p>Services:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">save_biases</code>: write out current bias settings to bias file. For
this to work the <code class="language-plaintext highlighter-rouge">bias_file</code> parameter must be set to a non-empty value.</li>
</ul>

<p>Dynamic reconfiguration parameters
(see <a href="https://docs.prophesee.ai/stable/hw/manuals/biases.html">MetaVision documentation here</a>):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_diff</code> (read only)</li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_off</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_on</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_fo</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_hpf</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_pr</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_refr</code></li>
</ul>

<h2 id="how-to-use-ros1">How to use (ROS1):</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver driver_node.launch   # (run as node)
roslaunch metavision_driver driver_nodelet.launch   # (run as nodelet)

</code></pre></div></div>

<p>The driver should print out message rate statistics like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1663845360.494651335]: /event_camera: bw in: 106.08359 MB/s, msgs/s in:   51930, out:       0

</code></pre></div></div>
<p>Prints out the incoming (from the SDK) bandwidth and incoming and
published message rate. In multithreaded mode there will also be shown
the maximum queue size observed during
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>.</p>

<p>To use the combined driver/recording facility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver recording_driver.launch bag:=`pwd`/test.bag

</code></pre></div></div>
<p>Then start/stop recording like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun metavision_driver start_recording.py
rosrun metavision_driver stop_recording.py

</code></pre></div></div>

<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch event_camera_renderer renderer.launch

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h2 id="how-to-use-ros2">How to use (ROS2):</h2>

<h3 id="running-the-driver">Running the driver</h3>

<p>You can just start up a ROS2 node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_node.launch.py        <span class="c"># (run as node)</span>

</code></pre></div></div>

<p>but if you want to efficiently record the events (see below), you
should launch instead as a composable node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py <span class="c"># (run as composable node)</span>

</code></pre></div></div>
<p>Either way, the printout should be similar to the one for ROS1.</p>

<h3 id="visualizing-the-events">Visualizing the events</h3>
<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch event_camera_renderer renderer.launch.py

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h3 id="recording-on-ros2-versions-older-than-jazzy">Recording on ROS2 versions older than Jazzy</h3>

<p>You will need to install the <a href="https://github.com/berndpfrommer/rosbag2_composable_recorder">composable recorder</a>
into your workspace as well (see below), and launch the combined driver and recorder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver recording_driver.launch.py
ros2 run rosbag2_composable_recorder start_recording.py

</code></pre></div></div>
<p>To stop the recording, Ctrl-C the <code class="language-plaintext highlighter-rouge">recording_driver.launch.py</code> script.</p>

<h3 id="recording-on-ros2-jazzy-or-later">Recording on ROS2 Jazzy or later</h3>
<p>Launch the composable driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py

</code></pre></div></div>
<p>and start the recording like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver start_recording.launch.py

</code></pre></div></div>

<p>Then stop it like so:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run metavision_driver stop_recording_ros2.py

</code></pre></div></div>

<p>Note that the start/stop scripts and launch files need to be adjusted to fit your choice of
node names and topics, but if you leave everything default it should work out of the box.</p>

<h2 id="cpu-load">CPU load</h2>

<p>Here are some approximate performance numbers on a 16 thread (8-core) AMD
Ryzen 7480h laptop with max clock speed of 2.9GHz. All numbers were obtained
by producing maximum event rates about (48Mevs) with a SilkyEVCam:</p>

<h3 id="ros1">ROS1</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>37%</td>
      <td>61%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>70%</td>
      <td>96%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record nodelet</td>
      <td>52%</td>
      <td>74%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h3 id="ros2">ROS2</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.
Middleware used was cyclonedds.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>35%</td>
      <td>44%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>80%</td>
      <td>90%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record composable</td>
      <td>58%</td>
      <td>80%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h2 id="about-ros-time-stamps">About ROS time stamps</h2>

<p>The SDK provides hardware event time stamps directly from the
camera. For efficiency reasons the packets are not decoded and so the
sensor time stamps are not available to the driver. Therefore the ROS driver
simply puts the host wall clock arrival time of the <em>first</em> SDK packet
into the ROS packet’s header stamp field.</p>

<h2 id="external-triggering">External triggering</h2>

<p>External triggers on prophesee cameras allows for a signal to be injected
into the event stream. This is useful for synchronizing external
devices. The event stream contained in the packages will now contain
trigger events that can be recovered with the decoder.</p>

<p>Prophesee provides documentation on the trigger functions at a high
level
<a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html">here</a>.</p>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-out">Trigger out</a>
functionality is exposed through <code class="language-plaintext highlighter-rouge">trigger_out_mode</code>,
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>, and <code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>. These
variables follow the same meaning as laid out in the internal
documentation.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code> can be <code class="language-plaintext highlighter-rouge">enabled</code> or <code class="language-plaintext highlighter-rouge">disabled</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code> can be from 2us to 1h (units are us)</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code> is the pulse width ratio
(<code class="language-plaintext highlighter-rouge">trigger_out_period * trigger_out_duty_cycle</code> must be at least 1us)</li>
</ul>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-in">Trigger in</a>
functionality is abstracted away from pins to just <code class="language-plaintext highlighter-rouge">loopback</code> or
<code class="language-plaintext highlighter-rouge">external</code> as the pin mappings are constant for a given camera
configuration.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code> allows the user to specify for each camera
<code class="language-plaintext highlighter-rouge">loopback</code> or <code class="language-plaintext highlighter-rouge">external</code> and lookup which pins are associated
with that camera.</li>
</ul>

<p><strong>WARNING</strong> Running synchronization and triggers at the same time is
possible, but requires understanding of your camera’s underlying
hardware (as most share trigger out and sync out pins).</p>

<h3 id="hardware-configuration">Hardware configuration</h3>

<p>The hardware configuration file is <code class="language-plaintext highlighter-rouge">config/trigger_pins.yaml</code>. The
mappings for <code class="language-plaintext highlighter-rouge">hal_plugin_gen*</code> come from
<a href="https://docs.prophesee.ai/3.1.2/metavision_sdk/modules/hal/samples/hal_viewer.html#configuring-trigger-in-and-trigger-out">Prophesee
documentation</a>.
The mapping for <code class="language-plaintext highlighter-rouge">evc3a_plugin_gen31</code> has been validated on the
SilkyEvCam (March 2022). The mapping goes from the HAL Software Info
to pin numbers.</p>

<p>If your camera is not yet supported, the software info is printed out
on driver startup. Look for a line that contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plugin Software Name:

</code></pre></div></div>

<p>This will be the key to place under <code class="language-plaintext highlighter-rouge">prophesee_pin_config</code> which can
then be populated based on your camera’s documentation.</p>

<p><strong>WARNING</strong> If this file is not loaded (or your camera is not yet
supported), the default pin loaded will be 0. This may work in some
cases, but not all.</p>

<h3 id="silkyevcam">SilkyEvCam</h3>

<p>Documentation on the SilkyEvCam pinout can be found
<a href="https://www.centuryarks.com/images/product/sensor/silkyevcam/SilkyEvCam-USB_Spec_Rev102.pdf">here on page 6</a>.
This system uses 3.3V logic for both trigger in as well as trigger out.</p>

<p>While the loopback configuration is internal to the chip, the trigger
out line will still pulse externally. This is useful if using an event
camera to trigger an external system as you will maintain the timing
relative to the internal clock (after association between the trigger
event and the external system).</p>

<h3 id="other-cameras">Other cameras</h3>

<p>External triggering works on SilkyEVCam HD, i.e. you can trigger the
SilkyEVCam HD externally the same way as the SilkyEVCam VGA.</p>

<h2 id="license">License</h2>

<p>This software is issued under the Apache License Version 2.0.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>

<p>Contributors must sign-off each commit by adding a <code class="language-plaintext highlighter-rouge">Signed-off-by: ...</code>
line to commit messages to certify that they have the right to submit
the code they are contributing to the project according to the
<a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>.</p>
</div>
              <hr id="kilted-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="kilted-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#kilted-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#kilted-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#kilted-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="kilted-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="kilted-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="kilted-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/metavision_driver">metavision_driver</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">driver for event based cameras using the MetaVision SDK (Prophesee and CenturyArk)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ros-event-camera/metavision_driver.git">https://github.com/ros-event-camera/metavision_driver.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">release</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/metavision_driver/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/metavision_driver">metavision_driver</a></td>
                    <td>2.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="metavision_driver">metavision_driver</h1>

<p>A combined ROS/ROS2 driver for event based cameras using Prophesee’s Metavision SDK.
This driver is not written or supported by Prophesee.</p>

<p><img src="https://raw.githubusercontent.com/ros-event-camera/metavision_driver/release/images/silkyev_cam.png" alt="banner image"></p>

<p>If you are looking for more speed and features than the <a href="https://github.com/prophesee-ai/prophesee_ros_wrapper">official
Prophesee ROS
driver</a> you
have found the right repository. This driver can cope with the large amount of
data produced by Prophesee’s Gen3 and later sensors because it does
little more than getting the RAW (currently EVT3 format) events from
the camera and publishing them in ROS
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
format.</p>

<p>The events can be decoded and displayed using the following ROS/ROS2 packages:</p>

<ul>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_codecs">event_camera_codecs</a>
has C++ routines to decode event_camera_msgs.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_py">event_camera_py</a>
module for fast event decoding in python.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a>
a node / nodelet that renders and publishes ROS image messages.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_tools">event_camera_tools</a>
a set of tools to echo, monitor performance and convert
<code class="language-plaintext highlighter-rouge">event_camera_msgs</code> to legacy formats and into “RAW” format.</li>
</ul>

<h2 id="supported-platforms">Supported platforms</h2>

<p>Tested on the following platforms:</p>

<ul>
  <li>ROS Noetic (legacy, please transition to ROS2)</li>
  <li>ROS2 Humble and Rolling (also compiles on other versions, see CI)</li>
  <li>Ubuntu 22.04, 24.04 LTS</li>
  <li>Metavision SDK (OpenEB) 4.2.0, 4.6.2, 5.0.0</li>
</ul>

<p>Tested on the following hardware:</p>

<ul>
  <li><a href="https://centuryarks.com/en/silkyevcam-vga/">SilkyEVCam VGA (Gen 3.1 sensor)</a></li>
  <li><a href="https://centuryarks.com/en/silkyevcam-hd/">SilkyEVCam HD (Gen 4 sensor)</a></li>
  <li><a href="https://www.prophesee.ai/event-camera-evk4/">Prophesee EVK4 (Gen 4 sensor)</a></li>
</ul>

<p>Explicitly not supported: any data in the old EVT2 format. The sensor
must produce data in the EVT3 format. The new EVT4 format is not yet supported.</p>

<h2 id="installation-from-binaries">Installation from binaries</h2>

<p>On ROS2 you can install via</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="k">${</span><span class="nv">ROS_DISTRO</span><span class="k">}</span><span class="nt">-metavision-driver</span>

</code></pre></div></div>
<p>This will also install a version of OpenEB under <code class="language-plaintext highlighter-rouge">/opt/ros/${ROS_DISTRO}</code>.
Unless you separately install OpenEB you will still have to install the required udev
rules from the source tree directory <code class="language-plaintext highlighter-rouge">udev/rules.d/</code>, and restart udev,
see <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>.
For the SilkyEV cameras make sure that the plugin version matches the version
of the <a href="https://github.com/ros-event-camera/openeb_vendor/">ROS OpenEB vendor package</a>
that is installed (check the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file), or the camera
will not be recognized! If the driver does not find the camera,
try building from source (see below).</p>

<h2 id="how-to-build-from-source">How to build from source</h2>

<p>Prerequisites:</p>

<ul>
  <li>install <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>
</li>
  <li>install <code class="language-plaintext highlighter-rouge">vcs</code> (ubuntu package <code class="language-plaintext highlighter-rouge">python3-vcstool</code>).</li>
</ul>

<p>Make sure you have your ROS1 or ROS2 environment sourced such that ROS_VERSION is set.
For example for ROS1 noetic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/ros/noetic/setup.bash

</code></pre></div></div>

<p>Create a workspace (<code class="language-plaintext highlighter-rouge">metavision_driver_ws</code>), clone this repo, and use <code class="language-plaintext highlighter-rouge">vcs</code>
to pull in the remaining dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkg=metavision_driver
mkdir -p ~/${pkg}_ws/src
cd ~/${pkg}_ws
git clone https://github.com/ros-event-camera/metavision_driver.git src/${pkg}
cd src
vcs import &lt; ${pkg}/${pkg}.repos
cd ..

</code></pre></div></div>

<p>Optional (ROS1): to use the efficient recording nodelet clone the
<a href="https://github.com/berndpfrommer/nodelet_rosbag">nodelet_rosbag</a> repository into our src tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b open_bag_later git@github.com:berndpfrommer/nodelet_rosbag.git src/nodelet_rosbag

</code></pre></div></div>

<p>Now configure and build:</p>

<p>ROS1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin config -DCMAKE_BUILD_TYPE=RelWithDebInfo  # (optionally add -DCMAKE_EXPORT_COMPILE_COMMANDS=1)
catkin build
. devel/setup.bash

</code></pre></div></div>

<p>ROS2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
. install/setup.bash

</code></pre></div></div>

<h2 id="driver-features">Driver Features</h2>

<p>This driver differs from the Prophesee ROS driver in the following ways:</p>

<ul>
  <li>publishes
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
that store more densely and are faster to access than the older
message formats.</li>
  <li>less CPU consumption by avoiding unnecessary memory copies.</li>
  <li>implemented as nodelet such that it can be run in the same address space as
e.g. a rosbag record nodelet without worrying about message loss in transmission.</li>
  <li>prints out message rate statistics so you know when the sensor
saturates bandwidth.</li>
  <li>supports these additional features:
    <ul>
      <li>dynamic reconfiguration for bias parameters</li>
      <li>ROI specification</li>
      <li>camera synchronization (stereo)</li>
      <li>external trigger events</li>
      <li>event rate control</li>
    </ul>
  </li>
</ul>

<p>Parameters:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_file</code>: path to file with camera biases. See example in the
<code class="language-plaintext highlighter-rouge">biases</code> directory.</li>
  <li>
<code class="language-plaintext highlighter-rouge">from_file</code>: path to Metavision raw file. Instead of opening
camera, driver plays back data from this file. This will not be in
real time, usually faster.</li>
  <li>
<code class="language-plaintext highlighter-rouge">serial</code>: specifies serial number of camera to open (useful for
stereo). To learn serial number format first start driver without
specifying serial number and look at the log files.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_time_threshold</code>: (in seconds) minimum time span of
events to be aggregated in one ROS event message before message is sent. Defaults to 1ms.
In its default setting however the SDK provides packets only every 4ms. To increase SDK
callback frequency, tune <code class="language-plaintext highlighter-rouge">mipi_frame_period</code> if available for your sensor.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_size_threshold</code>: (in bytes) minimum size of events
(in bytes) to be aggregated in one ROS event message before message is sent. Defaults to 1MB.</li>
  <li>
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>: time in seconds between statistics printouts.</li>
  <li>
<code class="language-plaintext highlighter-rouge">send_queue_size</code>: outgoing ROS message send queue size (defaults
to 1000 messages).</li>
  <li>
<code class="language-plaintext highlighter-rouge">use_multithreading</code>: decouples the SDK callback from the
processing to ensure the SDK does not drop messages (defaults to
false). The SDK already queues up messages but there is no documentation on
the queue size and no way to determine if messages are dropped. Use multithreading to
minimize the risk of dropping messages. However, be aware that this incurs an
extra memory copy and threading overhead, raising the maximum CPU
load by about 50% of a CPU.</li>
  <li>
<code class="language-plaintext highlighter-rouge">frame_id</code>: the frame id to use in the ROS message header</li>
  <li>
<code class="language-plaintext highlighter-rouge">roi</code>: sets hardware region of interest (ROI). You can set
multiple ROI rectangles with this parameter by concatenation:
<code class="language-plaintext highlighter-rouge">[top_left_x_1, top_left_y_1, width_1, height_1, top_left_x_2, top_left_y_2, width_2...]</code>.
The length of the <code class="language-plaintext highlighter-rouge">roi</code> parameter vector must therefore be a multiple
of 4. Beware that when using multiple ROIs, per Metavision SDK  documentation:
<a href="https://docs.prophesee.ai/stable/api/cpp/driver/features.html#_CPPv4N10Metavision3RoiE">“Any line or column enabled by a single ROI is also enabled for all the other”</a>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_mode</code>: event rate control mode (Gen4 sensor): <code class="language-plaintext highlighter-rouge">na</code>,
<code class="language-plaintext highlighter-rouge">disabled</code>, <code class="language-plaintext highlighter-rouge">enabled</code>. Default: <code class="language-plaintext highlighter-rouge">na</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_rate</code>: event rate control rate (Gen4 sensor) events/sec. Default: 100000000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">mipi_frame_period</code>:: mipi frame period in usec. Only available on some sensors.
  Tune this to get faster callback rates from the SDK to the ROS driver. For instance 1008 will give a callback every millisecond. Risk of data corruption when set too low! Default: -1 (not set).</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter</code>: enable/disable event trail filter. Default: False.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_type</code>: type of trail filter. Allowed values: <code class="language-plaintext highlighter-rouge">trail</code>, <code class="language-plaintext highlighter-rouge">stc_cut_trail</code>, <code class="language-plaintext highlighter-rouge">stc_keep_trail</code>.
Default: <code class="language-plaintext highlighter-rouge">trail</code>. See Metavision SDK documentation.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_threshold</code>: Filter threshold, see MetavisionSDK documentation. Default: 5000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">sync_mode</code>: Used to synchronize the time stamps across multiple
cameras (tested for only 2). The cameras must be connected via a
sync cable, and two separate ROS driver nodes are started, see
example launch files. The <code class="language-plaintext highlighter-rouge">primary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> topic must be
remapped so it receives the <code class="language-plaintext highlighter-rouge">secondary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> messages.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">standalone</code> (default): freerunning camera, no sync.</li>
      <li>
<code class="language-plaintext highlighter-rouge">primary</code>: camera that drives the sync clock. Will not start
publishing data until it receives a <code class="language-plaintext highlighter-rouge">ready</code> message from the secondary.</li>
      <li>
<code class="language-plaintext highlighter-rouge">secondary</code>: camera receiving the sync clock. Will send
<code class="language-plaintext highlighter-rouge">ready</code> messages until it receives a sync signal from the primary.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code>: Controls the mode of the trigger input hardware.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">external</code>: Enables the external hardware pin to route to the trigger input hardware.
This will be the pin on the camera’s connector.</li>
      <li>
<code class="language-plaintext highlighter-rouge">loopback</code>: Connects the trigger out pin to the trigger input hardware. Only available
on Gen3 sensors (SilkyEVCam VGA).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code>: Controls the mode of the trigger output
hardware. NOTE: 4-th gen sensors no longer support trigger out!
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">enabled</code>: Enables the external hardware pin to route to the trigger in hardware.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>: Controls the period in microseconds of the trigger out pulse.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>: Controls the duty cycle of the trigger
out pulse. This is the period ratio.</li>
</ul>

<p>Services:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">save_biases</code>: write out current bias settings to bias file. For
this to work the <code class="language-plaintext highlighter-rouge">bias_file</code> parameter must be set to a non-empty value.</li>
</ul>

<p>Dynamic reconfiguration parameters
(see <a href="https://docs.prophesee.ai/stable/hw/manuals/biases.html">MetaVision documentation here</a>):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_diff</code> (read only)</li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_off</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_on</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_fo</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_hpf</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_pr</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_refr</code></li>
</ul>

<h2 id="how-to-use-ros1">How to use (ROS1):</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver driver_node.launch   # (run as node)
roslaunch metavision_driver driver_nodelet.launch   # (run as nodelet)

</code></pre></div></div>

<p>The driver should print out message rate statistics like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1663845360.494651335]: /event_camera: bw in: 106.08359 MB/s, msgs/s in:   51930, out:       0

</code></pre></div></div>
<p>Prints out the incoming (from the SDK) bandwidth and incoming and
published message rate. In multithreaded mode there will also be shown
the maximum queue size observed during
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>.</p>

<p>To use the combined driver/recording facility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver recording_driver.launch bag:=`pwd`/test.bag

</code></pre></div></div>
<p>Then start/stop recording like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun metavision_driver start_recording.py
rosrun metavision_driver stop_recording.py

</code></pre></div></div>

<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch event_camera_renderer renderer.launch

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h2 id="how-to-use-ros2">How to use (ROS2):</h2>

<h3 id="running-the-driver">Running the driver</h3>

<p>You can just start up a ROS2 node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_node.launch.py        <span class="c"># (run as node)</span>

</code></pre></div></div>

<p>but if you want to efficiently record the events (see below), you
should launch instead as a composable node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py <span class="c"># (run as composable node)</span>

</code></pre></div></div>
<p>Either way, the printout should be similar to the one for ROS1.</p>

<h3 id="visualizing-the-events">Visualizing the events</h3>
<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch event_camera_renderer renderer.launch.py

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h3 id="recording-on-ros2-versions-older-than-jazzy">Recording on ROS2 versions older than Jazzy</h3>

<p>You will need to install the <a href="https://github.com/berndpfrommer/rosbag2_composable_recorder">composable recorder</a>
into your workspace as well (see below), and launch the combined driver and recorder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver recording_driver.launch.py
ros2 run rosbag2_composable_recorder start_recording.py

</code></pre></div></div>
<p>To stop the recording, Ctrl-C the <code class="language-plaintext highlighter-rouge">recording_driver.launch.py</code> script.</p>

<h3 id="recording-on-ros2-jazzy-or-later">Recording on ROS2 Jazzy or later</h3>
<p>Launch the composable driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py

</code></pre></div></div>
<p>and start the recording like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver start_recording.launch.py

</code></pre></div></div>

<p>Then stop it like so:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run metavision_driver stop_recording_ros2.py

</code></pre></div></div>

<p>Note that the start/stop scripts and launch files need to be adjusted to fit your choice of
node names and topics, but if you leave everything default it should work out of the box.</p>

<h2 id="cpu-load">CPU load</h2>

<p>Here are some approximate performance numbers on a 16 thread (8-core) AMD
Ryzen 7480h laptop with max clock speed of 2.9GHz. All numbers were obtained
by producing maximum event rates about (48Mevs) with a SilkyEVCam:</p>

<h3 id="ros1">ROS1</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>37%</td>
      <td>61%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>70%</td>
      <td>96%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record nodelet</td>
      <td>52%</td>
      <td>74%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h3 id="ros2">ROS2</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.
Middleware used was cyclonedds.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>35%</td>
      <td>44%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>80%</td>
      <td>90%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record composable</td>
      <td>58%</td>
      <td>80%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h2 id="about-ros-time-stamps">About ROS time stamps</h2>

<p>The SDK provides hardware event time stamps directly from the
camera. For efficiency reasons the packets are not decoded and so the
sensor time stamps are not available to the driver. Therefore the ROS driver
simply puts the host wall clock arrival time of the <em>first</em> SDK packet
into the ROS packet’s header stamp field.</p>

<h2 id="external-triggering">External triggering</h2>

<p>External triggers on prophesee cameras allows for a signal to be injected
into the event stream. This is useful for synchronizing external
devices. The event stream contained in the packages will now contain
trigger events that can be recovered with the decoder.</p>

<p>Prophesee provides documentation on the trigger functions at a high
level
<a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html">here</a>.</p>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-out">Trigger out</a>
functionality is exposed through <code class="language-plaintext highlighter-rouge">trigger_out_mode</code>,
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>, and <code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>. These
variables follow the same meaning as laid out in the internal
documentation.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code> can be <code class="language-plaintext highlighter-rouge">enabled</code> or <code class="language-plaintext highlighter-rouge">disabled</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code> can be from 2us to 1h (units are us)</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code> is the pulse width ratio
(<code class="language-plaintext highlighter-rouge">trigger_out_period * trigger_out_duty_cycle</code> must be at least 1us)</li>
</ul>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-in">Trigger in</a>
functionality is abstracted away from pins to just <code class="language-plaintext highlighter-rouge">loopback</code> or
<code class="language-plaintext highlighter-rouge">external</code> as the pin mappings are constant for a given camera
configuration.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code> allows the user to specify for each camera
<code class="language-plaintext highlighter-rouge">loopback</code> or <code class="language-plaintext highlighter-rouge">external</code> and lookup which pins are associated
with that camera.</li>
</ul>

<p><strong>WARNING</strong> Running synchronization and triggers at the same time is
possible, but requires understanding of your camera’s underlying
hardware (as most share trigger out and sync out pins).</p>

<h3 id="hardware-configuration">Hardware configuration</h3>

<p>The hardware configuration file is <code class="language-plaintext highlighter-rouge">config/trigger_pins.yaml</code>. The
mappings for <code class="language-plaintext highlighter-rouge">hal_plugin_gen*</code> come from
<a href="https://docs.prophesee.ai/3.1.2/metavision_sdk/modules/hal/samples/hal_viewer.html#configuring-trigger-in-and-trigger-out">Prophesee
documentation</a>.
The mapping for <code class="language-plaintext highlighter-rouge">evc3a_plugin_gen31</code> has been validated on the
SilkyEvCam (March 2022). The mapping goes from the HAL Software Info
to pin numbers.</p>

<p>If your camera is not yet supported, the software info is printed out
on driver startup. Look for a line that contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plugin Software Name:

</code></pre></div></div>

<p>This will be the key to place under <code class="language-plaintext highlighter-rouge">prophesee_pin_config</code> which can
then be populated based on your camera’s documentation.</p>

<p><strong>WARNING</strong> If this file is not loaded (or your camera is not yet
supported), the default pin loaded will be 0. This may work in some
cases, but not all.</p>

<h3 id="silkyevcam">SilkyEvCam</h3>

<p>Documentation on the SilkyEvCam pinout can be found
<a href="https://www.centuryarks.com/images/product/sensor/silkyevcam/SilkyEvCam-USB_Spec_Rev102.pdf">here on page 6</a>.
This system uses 3.3V logic for both trigger in as well as trigger out.</p>

<p>While the loopback configuration is internal to the chip, the trigger
out line will still pulse externally. This is useful if using an event
camera to trigger an external system as you will maintain the timing
relative to the internal clock (after association between the trigger
event and the external system).</p>

<h3 id="other-cameras">Other cameras</h3>

<p>External triggering works on SilkyEVCam HD, i.e. you can trigger the
SilkyEVCam HD externally the same way as the SilkyEVCam VGA.</p>

<h2 id="license">License</h2>

<p>This software is issued under the Apache License Version 2.0.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>

<p>Contributors must sign-off each commit by adding a <code class="language-plaintext highlighter-rouge">Signed-off-by: ...</code>
line to commit messages to certify that they have the right to submit
the code they are contributing to the project according to the
<a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>.</p>
</div>
              <hr id="rolling-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="rolling-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#rolling-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#rolling-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#rolling-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="rolling-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="rolling-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="rolling-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/metavision_driver">metavision_driver</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">driver for event based cameras using the MetaVision SDK (Prophesee and CenturyArk)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ros-event-camera/metavision_driver.git">https://github.com/ros-event-camera/metavision_driver.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">release</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/metavision_driver/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/metavision_driver/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/metavision_driver">metavision_driver</a></td>
                    <td>2.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="metavision_driver">metavision_driver</h1>

<p>A combined ROS/ROS2 driver for event based cameras using Prophesee’s Metavision SDK.
This driver is not written or supported by Prophesee.</p>

<p><img src="https://raw.githubusercontent.com/ros-event-camera/metavision_driver/release/images/silkyev_cam.png" alt="banner image"></p>

<p>If you are looking for more speed and features than the <a href="https://github.com/prophesee-ai/prophesee_ros_wrapper">official
Prophesee ROS
driver</a> you
have found the right repository. This driver can cope with the large amount of
data produced by Prophesee’s Gen3 and later sensors because it does
little more than getting the RAW (currently EVT3 format) events from
the camera and publishing them in ROS
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
format.</p>

<p>The events can be decoded and displayed using the following ROS/ROS2 packages:</p>

<ul>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_codecs">event_camera_codecs</a>
has C++ routines to decode event_camera_msgs.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_py">event_camera_py</a>
module for fast event decoding in python.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a>
a node / nodelet that renders and publishes ROS image messages.</li>
  <li>
<a href="https://github.com/ros-event-camera/event_camera_tools">event_camera_tools</a>
a set of tools to echo, monitor performance and convert
<code class="language-plaintext highlighter-rouge">event_camera_msgs</code> to legacy formats and into “RAW” format.</li>
</ul>

<h2 id="supported-platforms">Supported platforms</h2>

<p>Tested on the following platforms:</p>

<ul>
  <li>ROS Noetic (legacy, please transition to ROS2)</li>
  <li>ROS2 Humble and Rolling (also compiles on other versions, see CI)</li>
  <li>Ubuntu 22.04, 24.04 LTS</li>
  <li>Metavision SDK (OpenEB) 4.2.0, 4.6.2, 5.0.0</li>
</ul>

<p>Tested on the following hardware:</p>

<ul>
  <li><a href="https://centuryarks.com/en/silkyevcam-vga/">SilkyEVCam VGA (Gen 3.1 sensor)</a></li>
  <li><a href="https://centuryarks.com/en/silkyevcam-hd/">SilkyEVCam HD (Gen 4 sensor)</a></li>
  <li><a href="https://www.prophesee.ai/event-camera-evk4/">Prophesee EVK4 (Gen 4 sensor)</a></li>
</ul>

<p>Explicitly not supported: any data in the old EVT2 format. The sensor
must produce data in the EVT3 format. The new EVT4 format is not yet supported.</p>

<h2 id="installation-from-binaries">Installation from binaries</h2>

<p>On ROS2 you can install via</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="k">${</span><span class="nv">ROS_DISTRO</span><span class="k">}</span><span class="nt">-metavision-driver</span>

</code></pre></div></div>
<p>This will also install a version of OpenEB under <code class="language-plaintext highlighter-rouge">/opt/ros/${ROS_DISTRO}</code>.
Unless you separately install OpenEB you will still have to install the required udev
rules from the source tree directory <code class="language-plaintext highlighter-rouge">udev/rules.d/</code>, and restart udev,
see <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>.
For the SilkyEV cameras make sure that the plugin version matches the version
of the <a href="https://github.com/ros-event-camera/openeb_vendor/">ROS OpenEB vendor package</a>
that is installed (check the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file), or the camera
will not be recognized! If the driver does not find the camera,
try building from source (see below).</p>

<h2 id="how-to-build-from-source">How to build from source</h2>

<p>Prerequisites:</p>

<ul>
  <li>install <a href="https://github.com/prophesee-ai/openeb">OpenEB</a>
</li>
  <li>install <code class="language-plaintext highlighter-rouge">vcs</code> (ubuntu package <code class="language-plaintext highlighter-rouge">python3-vcstool</code>).</li>
</ul>

<p>Make sure you have your ROS1 or ROS2 environment sourced such that ROS_VERSION is set.
For example for ROS1 noetic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /opt/ros/noetic/setup.bash

</code></pre></div></div>

<p>Create a workspace (<code class="language-plaintext highlighter-rouge">metavision_driver_ws</code>), clone this repo, and use <code class="language-plaintext highlighter-rouge">vcs</code>
to pull in the remaining dependencies:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkg=metavision_driver
mkdir -p ~/${pkg}_ws/src
cd ~/${pkg}_ws
git clone https://github.com/ros-event-camera/metavision_driver.git src/${pkg}
cd src
vcs import &lt; ${pkg}/${pkg}.repos
cd ..

</code></pre></div></div>

<p>Optional (ROS1): to use the efficient recording nodelet clone the
<a href="https://github.com/berndpfrommer/nodelet_rosbag">nodelet_rosbag</a> repository into our src tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b open_bag_later git@github.com:berndpfrommer/nodelet_rosbag.git src/nodelet_rosbag

</code></pre></div></div>

<p>Now configure and build:</p>

<p>ROS1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin config -DCMAKE_BUILD_TYPE=RelWithDebInfo  # (optionally add -DCMAKE_EXPORT_COMPILE_COMMANDS=1)
catkin build
. devel/setup.bash

</code></pre></div></div>

<p>ROS2:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build --symlink-install --cmake-args -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
. install/setup.bash

</code></pre></div></div>

<h2 id="driver-features">Driver Features</h2>

<p>This driver differs from the Prophesee ROS driver in the following ways:</p>

<ul>
  <li>publishes
<a href="https://github.com/ros-event-camera/event_camera_msgs">event_camera_msgs</a>
that store more densely and are faster to access than the older
message formats.</li>
  <li>less CPU consumption by avoiding unnecessary memory copies.</li>
  <li>implemented as nodelet such that it can be run in the same address space as
e.g. a rosbag record nodelet without worrying about message loss in transmission.</li>
  <li>prints out message rate statistics so you know when the sensor
saturates bandwidth.</li>
  <li>supports these additional features:
    <ul>
      <li>dynamic reconfiguration for bias parameters</li>
      <li>ROI specification</li>
      <li>camera synchronization (stereo)</li>
      <li>external trigger events</li>
      <li>event rate control</li>
    </ul>
  </li>
</ul>

<p>Parameters:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_file</code>: path to file with camera biases. See example in the
<code class="language-plaintext highlighter-rouge">biases</code> directory.</li>
  <li>
<code class="language-plaintext highlighter-rouge">from_file</code>: path to Metavision raw file. Instead of opening
camera, driver plays back data from this file. This will not be in
real time, usually faster.</li>
  <li>
<code class="language-plaintext highlighter-rouge">serial</code>: specifies serial number of camera to open (useful for
stereo). To learn serial number format first start driver without
specifying serial number and look at the log files.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_time_threshold</code>: (in seconds) minimum time span of
events to be aggregated in one ROS event message before message is sent. Defaults to 1ms.
In its default setting however the SDK provides packets only every 4ms. To increase SDK
callback frequency, tune <code class="language-plaintext highlighter-rouge">mipi_frame_period</code> if available for your sensor.</li>
  <li>
<code class="language-plaintext highlighter-rouge">event_message_size_threshold</code>: (in bytes) minimum size of events
(in bytes) to be aggregated in one ROS event message before message is sent. Defaults to 1MB.</li>
  <li>
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>: time in seconds between statistics printouts.</li>
  <li>
<code class="language-plaintext highlighter-rouge">send_queue_size</code>: outgoing ROS message send queue size (defaults
to 1000 messages).</li>
  <li>
<code class="language-plaintext highlighter-rouge">use_multithreading</code>: decouples the SDK callback from the
processing to ensure the SDK does not drop messages (defaults to
false). The SDK already queues up messages but there is no documentation on
the queue size and no way to determine if messages are dropped. Use multithreading to
minimize the risk of dropping messages. However, be aware that this incurs an
extra memory copy and threading overhead, raising the maximum CPU
load by about 50% of a CPU.</li>
  <li>
<code class="language-plaintext highlighter-rouge">frame_id</code>: the frame id to use in the ROS message header</li>
  <li>
<code class="language-plaintext highlighter-rouge">roi</code>: sets hardware region of interest (ROI). You can set
multiple ROI rectangles with this parameter by concatenation:
<code class="language-plaintext highlighter-rouge">[top_left_x_1, top_left_y_1, width_1, height_1, top_left_x_2, top_left_y_2, width_2...]</code>.
The length of the <code class="language-plaintext highlighter-rouge">roi</code> parameter vector must therefore be a multiple
of 4. Beware that when using multiple ROIs, per Metavision SDK  documentation:
<a href="https://docs.prophesee.ai/stable/api/cpp/driver/features.html#_CPPv4N10Metavision3RoiE">“Any line or column enabled by a single ROI is also enabled for all the other”</a>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_mode</code>: event rate control mode (Gen4 sensor): <code class="language-plaintext highlighter-rouge">na</code>,
<code class="language-plaintext highlighter-rouge">disabled</code>, <code class="language-plaintext highlighter-rouge">enabled</code>. Default: <code class="language-plaintext highlighter-rouge">na</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">erc_rate</code>: event rate control rate (Gen4 sensor) events/sec. Default: 100000000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">mipi_frame_period</code>:: mipi frame period in usec. Only available on some sensors.
  Tune this to get faster callback rates from the SDK to the ROS driver. For instance 1008 will give a callback every millisecond. Risk of data corruption when set too low! Default: -1 (not set).</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter</code>: enable/disable event trail filter. Default: False.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_type</code>: type of trail filter. Allowed values: <code class="language-plaintext highlighter-rouge">trail</code>, <code class="language-plaintext highlighter-rouge">stc_cut_trail</code>, <code class="language-plaintext highlighter-rouge">stc_keep_trail</code>.
Default: <code class="language-plaintext highlighter-rouge">trail</code>. See Metavision SDK documentation.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trail_filter_threshold</code>: Filter threshold, see MetavisionSDK documentation. Default: 5000.</li>
  <li>
<code class="language-plaintext highlighter-rouge">sync_mode</code>: Used to synchronize the time stamps across multiple
cameras (tested for only 2). The cameras must be connected via a
sync cable, and two separate ROS driver nodes are started, see
example launch files. The <code class="language-plaintext highlighter-rouge">primary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> topic must be
remapped so it receives the <code class="language-plaintext highlighter-rouge">secondary</code> node’s <code class="language-plaintext highlighter-rouge">ready</code> messages.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">standalone</code> (default): freerunning camera, no sync.</li>
      <li>
<code class="language-plaintext highlighter-rouge">primary</code>: camera that drives the sync clock. Will not start
publishing data until it receives a <code class="language-plaintext highlighter-rouge">ready</code> message from the secondary.</li>
      <li>
<code class="language-plaintext highlighter-rouge">secondary</code>: camera receiving the sync clock. Will send
<code class="language-plaintext highlighter-rouge">ready</code> messages until it receives a sync signal from the primary.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code>: Controls the mode of the trigger input hardware.
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">external</code>: Enables the external hardware pin to route to the trigger input hardware.
This will be the pin on the camera’s connector.</li>
      <li>
<code class="language-plaintext highlighter-rouge">loopback</code>: Connects the trigger out pin to the trigger input hardware. Only available
on Gen3 sensors (SilkyEVCam VGA).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code>: Controls the mode of the trigger output
hardware. NOTE: 4-th gen sensors no longer support trigger out!
Allowed values:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">disabled</code> (default): Does not enable this functionality within the hardware</li>
      <li>
<code class="language-plaintext highlighter-rouge">enabled</code>: Enables the external hardware pin to route to the trigger in hardware.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>: Controls the period in microseconds of the trigger out pulse.</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>: Controls the duty cycle of the trigger
out pulse. This is the period ratio.</li>
</ul>

<p>Services:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">save_biases</code>: write out current bias settings to bias file. For
this to work the <code class="language-plaintext highlighter-rouge">bias_file</code> parameter must be set to a non-empty value.</li>
</ul>

<p>Dynamic reconfiguration parameters
(see <a href="https://docs.prophesee.ai/stable/hw/manuals/biases.html">MetaVision documentation here</a>):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">bias_diff</code> (read only)</li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_off</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_diff_on</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_fo</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_hpf</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_pr</code></li>
  <li><code class="language-plaintext highlighter-rouge">bias_refr</code></li>
</ul>

<h2 id="how-to-use-ros1">How to use (ROS1):</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver driver_node.launch   # (run as node)
roslaunch metavision_driver driver_nodelet.launch   # (run as nodelet)

</code></pre></div></div>

<p>The driver should print out message rate statistics like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ INFO] [1663845360.494651335]: /event_camera: bw in: 106.08359 MB/s, msgs/s in:   51930, out:       0

</code></pre></div></div>
<p>Prints out the incoming (from the SDK) bandwidth and incoming and
published message rate. In multithreaded mode there will also be shown
the maximum queue size observed during
<code class="language-plaintext highlighter-rouge">statistics_print_interval</code>.</p>

<p>To use the combined driver/recording facility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch metavision_driver recording_driver.launch bag:=`pwd`/test.bag

</code></pre></div></div>
<p>Then start/stop recording like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun metavision_driver start_recording.py
rosrun metavision_driver stop_recording.py

</code></pre></div></div>

<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch event_camera_renderer renderer.launch

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h2 id="how-to-use-ros2">How to use (ROS2):</h2>

<h3 id="running-the-driver">Running the driver</h3>

<p>You can just start up a ROS2 node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_node.launch.py        <span class="c"># (run as node)</span>

</code></pre></div></div>

<p>but if you want to efficiently record the events (see below), you
should launch instead as a composable node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py <span class="c"># (run as composable node)</span>

</code></pre></div></div>
<p>Either way, the printout should be similar to the one for ROS1.</p>

<h3 id="visualizing-the-events">Visualizing the events</h3>
<p>To visualize the events, run a <code class="language-plaintext highlighter-rouge">renderer</code> node from the
<a href="https://github.com/ros-event-camera/event_camera_renderer">event_camera_renderer</a> package:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch event_camera_renderer renderer.launch.py

</code></pre></div></div>
<p>The renderer node publishes an image that can be visualized with e.g. <code class="language-plaintext highlighter-rouge">rqt_image_view</code></p>

<h3 id="recording-on-ros2-versions-older-than-jazzy">Recording on ROS2 versions older than Jazzy</h3>

<p>You will need to install the <a href="https://github.com/berndpfrommer/rosbag2_composable_recorder">composable recorder</a>
into your workspace as well (see below), and launch the combined driver and recorder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver recording_driver.launch.py
ros2 run rosbag2_composable_recorder start_recording.py

</code></pre></div></div>
<p>To stop the recording, Ctrl-C the <code class="language-plaintext highlighter-rouge">recording_driver.launch.py</code> script.</p>

<h3 id="recording-on-ros2-jazzy-or-later">Recording on ROS2 Jazzy or later</h3>
<p>Launch the composable driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver driver_composition.launch.py

</code></pre></div></div>
<p>and start the recording like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch metavision_driver start_recording.launch.py

</code></pre></div></div>

<p>Then stop it like so:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run metavision_driver stop_recording_ros2.py

</code></pre></div></div>

<p>Note that the start/stop scripts and launch files need to be adjusted to fit your choice of
node names and topics, but if you leave everything default it should work out of the box.</p>

<h2 id="cpu-load">CPU load</h2>

<p>Here are some approximate performance numbers on a 16 thread (8-core) AMD
Ryzen 7480h laptop with max clock speed of 2.9GHz. All numbers were obtained
by producing maximum event rates about (48Mevs) with a SilkyEVCam:</p>

<h3 id="ros1">ROS1</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>37%</td>
      <td>61%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>70%</td>
      <td>96%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record nodelet</td>
      <td>52%</td>
      <td>74%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h3 id="ros2">ROS2</h3>

<p>All CPU loads below are with sensor saturating at close to 50Mevs.
Middleware used was cyclonedds.</p>

<table>
  <thead>
    <tr>
      <th>settings</th>
      <th>single threaded</th>
      <th>multi threaded</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>driver no subscriber</td>
      <td>22%</td>
      <td>59%</td>
      <td>no pub, extra copy for multithreaded</td>
    </tr>
    <tr>
      <td>driver with subscriber</td>
      <td>35%</td>
      <td>44%</td>
      <td>does interprocess communication</td>
    </tr>
    <tr>
      <td>driver + rosbag record node</td>
      <td>80%</td>
      <td>90%</td>
      <td>combined driver + record cpu load</td>
    </tr>
    <tr>
      <td>driver + rosbag record composable</td>
      <td>58%</td>
      <td>80%</td>
      <td>single process no ipc but disk/io</td>
    </tr>
  </tbody>
</table>

<h2 id="about-ros-time-stamps">About ROS time stamps</h2>

<p>The SDK provides hardware event time stamps directly from the
camera. For efficiency reasons the packets are not decoded and so the
sensor time stamps are not available to the driver. Therefore the ROS driver
simply puts the host wall clock arrival time of the <em>first</em> SDK packet
into the ROS packet’s header stamp field.</p>

<h2 id="external-triggering">External triggering</h2>

<p>External triggers on prophesee cameras allows for a signal to be injected
into the event stream. This is useful for synchronizing external
devices. The event stream contained in the packages will now contain
trigger events that can be recovered with the decoder.</p>

<p>Prophesee provides documentation on the trigger functions at a high
level
<a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html">here</a>.</p>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-out">Trigger out</a>
functionality is exposed through <code class="language-plaintext highlighter-rouge">trigger_out_mode</code>,
<code class="language-plaintext highlighter-rouge">trigger_out_period</code>, and <code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code>. These
variables follow the same meaning as laid out in the internal
documentation.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_mode</code> can be <code class="language-plaintext highlighter-rouge">enabled</code> or <code class="language-plaintext highlighter-rouge">disabled</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_period</code> can be from 2us to 1h (units are us)</li>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_out_duty_cycle</code> is the pulse width ratio
(<code class="language-plaintext highlighter-rouge">trigger_out_period * trigger_out_duty_cycle</code> must be at least 1us)</li>
</ul>

<p><a href="https://docs.prophesee.ai/stable/hw/manuals/timing_interfaces.html#trigger-in">Trigger in</a>
functionality is abstracted away from pins to just <code class="language-plaintext highlighter-rouge">loopback</code> or
<code class="language-plaintext highlighter-rouge">external</code> as the pin mappings are constant for a given camera
configuration.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">trigger_in_mode</code> allows the user to specify for each camera
<code class="language-plaintext highlighter-rouge">loopback</code> or <code class="language-plaintext highlighter-rouge">external</code> and lookup which pins are associated
with that camera.</li>
</ul>

<p><strong>WARNING</strong> Running synchronization and triggers at the same time is
possible, but requires understanding of your camera’s underlying
hardware (as most share trigger out and sync out pins).</p>

<h3 id="hardware-configuration">Hardware configuration</h3>

<p>The hardware configuration file is <code class="language-plaintext highlighter-rouge">config/trigger_pins.yaml</code>. The
mappings for <code class="language-plaintext highlighter-rouge">hal_plugin_gen*</code> come from
<a href="https://docs.prophesee.ai/3.1.2/metavision_sdk/modules/hal/samples/hal_viewer.html#configuring-trigger-in-and-trigger-out">Prophesee
documentation</a>.
The mapping for <code class="language-plaintext highlighter-rouge">evc3a_plugin_gen31</code> has been validated on the
SilkyEvCam (March 2022). The mapping goes from the HAL Software Info
to pin numbers.</p>

<p>If your camera is not yet supported, the software info is printed out
on driver startup. Look for a line that contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Plugin Software Name:

</code></pre></div></div>

<p>This will be the key to place under <code class="language-plaintext highlighter-rouge">prophesee_pin_config</code> which can
then be populated based on your camera’s documentation.</p>

<p><strong>WARNING</strong> If this file is not loaded (or your camera is not yet
supported), the default pin loaded will be 0. This may work in some
cases, but not all.</p>

<h3 id="silkyevcam">SilkyEvCam</h3>

<p>Documentation on the SilkyEvCam pinout can be found
<a href="https://www.centuryarks.com/images/product/sensor/silkyevcam/SilkyEvCam-USB_Spec_Rev102.pdf">here on page 6</a>.
This system uses 3.3V logic for both trigger in as well as trigger out.</p>

<p>While the loopback configuration is internal to the chip, the trigger
out line will still pulse externally. This is useful if using an event
camera to trigger an external system as you will maintain the timing
relative to the internal clock (after association between the trigger
event and the external system).</p>

<h3 id="other-cameras">Other cameras</h3>

<p>External triggering works on SilkyEVCam HD, i.e. you can trigger the
SilkyEVCam HD externally the same way as the SilkyEVCam VGA.</p>

<h2 id="license">License</h2>

<p>This software is issued under the Apache License Version 2.0.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>

<p>Contributors must sign-off each commit by adding a <code class="language-plaintext highlighter-rouge">Signed-off-by: ...</code>
line to commit messages to certify that they have the right to submit
the code they are contributing to the project according to the
<a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>.</p>
</div>
              <hr id="iron-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="iron-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#iron-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#iron-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#iron-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="iron-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="iron-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="iron-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/metavision_driver">metavision_driver</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ros-event-camera-metavision_driver
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ros-event-camera-metavision_driver" role="menuitem" tabindex="-1" href="/r/metavision_driver/github-ros-event-camera-metavision_driver" data="github-ros-event-camera-metavision_driver">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ros-event-camera-metavision_driver
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/ros-event-camera/metavision_driver.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
