<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/hpp-fcl/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">hpp-fcl</li>
        <!--<li class="active">hpp-fcl</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-primary" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class=" older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class=" older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#noetic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#noetic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#noetic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#galactic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#galactic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#galactic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/hpp-fcl">hpp-fcl</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/coal">coal</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-humanoid-path-planner-hpp-fcl
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-humanoid-path-planner-hpp-fcl" role="menuitem" tabindex="-1" href="/r/hpp-fcl/github-humanoid-path-planner-hpp-fcl" data="github-humanoid-path-planner-hpp-fcl">
                    <span class="glyphicon glyphicon-star"></span>
                    github-humanoid-path-planner-hpp-fcl
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">An extension of the Flexible Collision Library</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/humanoid-path-planner/hpp-fcl.git">https://github.com/humanoid-path-planner/hpp-fcl.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/hpp-fcl/#melodic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#melodic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/hpp-fcl/#melodic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/coal">coal</a></td>
                    <td>3.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="coal--an-extension-of-the-flexible-collision-library">Coal — An extension of the Flexible Collision Library</h1>

<p align="center">
  <a href="https://gitlab.laas.fr/coal-library/coal/commits/devel/"><img src="https://gitlab.laas.fr/coal-library/coal/badges/devel/pipeline.svg" alt="Pipeline status"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/doxygen-html/"><img src="https://img.shields.io/badge/docs-online-brightgreen" alt="Documentation"></a>
  <a href="https://gepettoweb.laas.fr/doc/coal-library/coal/devel/coverage/"><img src="https://gepgitlab.laas.fr/coal-library/badges/devel/coverage.svg?job=doc-coverage" alt="Coverage report"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/dn/conda-forge/coal.svg" alt="Conda Downloads"></a>
  <a href="https://anaconda.org/conda-forge/coal"><img src="https://img.shields.io/conda/vn/conda-forge/coal.svg" alt="Conda Version"></a>
  <a href="https://badge.fury.io/py/coal"><img src="https://badge.fury.io/py/coal.svg" alt="PyPI version"></a>
  <a href="https://github.com/psf/black"><img alt="black" src="https://img.shields.io/badge/code%20style-black-000000.svg"></a>
  <a href="https://github.com/astral-sh/ruff"><img alt="ruff" src="https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/astral-sh/ruff/main/assets/badge/v2.json"></a>
</p>

<p><a href="https://github.com/flexible-collision-library/fcl">FCL</a> was forked in 2015, creating a new project called HPP-FCL.
Since then, a large part of the code has been rewritten or removed (unused and untested code), and new features have been introduced (see below).
Due to these major changes, it was decided in 2024 to rename the HPP-FCL project to <strong>Coal</strong>.</p>

<p>If you use <strong>Coal</strong> in your projects and research papers, we would appreciate it if you would <a href="https://raw.githubusercontent.com/coal-library/coal/devel/CITATION.bib">cite it</a>.</p>

<h2 id="new-features">New features</h2>

<p>Compared to the original <a href="https://github.com/flexible-collision-library/fcl">FCL</a> library, the main new features are:</p>
<ul>
  <li>dedicated and efficient implementations of the GJK and the EPA algorithms (we do not rely on <a href="https://github.com/danfis/libccd">libccd</a>)</li>
  <li>the support of safety margins for collision detection</li>
  <li>an accelerated version of collision detection <em>à la Nesterov</em>, which leads to increased performance (up to a factor of 2). More details are available in this <a href="https://hal.archives-ouvertes.fr/hal-03662157/">paper</a>
</li>
  <li>the computation of a lower bound of the distance between two objects when collision checking is performed, and no collision is found</li>
  <li>the implementation of Python bindings for easy code prototyping</li>
  <li>the support of new geometries such as height fields, capsules, ellipsoids, etc.</li>
  <li>enhance reliability with the fix of a myriad of bugs</li>
  <li>efficient computation of <strong>contact points</strong> and <strong>contact patches</strong> between objects</li>
  <li>full support of object serialization via Boost.Serialization</li>
</ul>

<p>Note: the broad phase was reintroduced by <a href="https://github.com/jcarpent">Justin Carpentier</a> in 2022, based on the FCL version 0.7.0.</p>

<p>This project is now used in several robotics frameworks such as <a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a>, an open-source library which implements efficient and versatile rigid-body dynamics algorithms, the <a href="https://humanoid-path-planner.github.io/hpp-doc">Humanoid Path Planner</a>, an open-source library for Motion and Manipulation Planning. <strong>Coal</strong> has recently also been used to develop <a href="https://github.com/Simple-Robotics/Simple">Simple</a>, a new (differentiable) and efficient simulator for robotics and beyond.</p>

<h2 id="a-high-performance-library">A high-performance library</h2>

<p>Unlike the original FCL library, Coal implements the well-established <a href="https://en.wikipedia.org/wiki/Gilbert%E2%80%93Johnson%E2%80%93Keerthi_distance_algorithm">GJK algorithm</a> and <a href="https://hal.archives-ouvertes.fr/hal-03662157/">its variants</a> for collision detection and distance computation. These implementations lead to state-of-the-art performance, as shown in the figures below.</p>

<p>On the one hand, we have benchmarked Coal against major state-of-the-art software alternatives:</p>

<ol>
  <li>the <a href="https://github.com/bulletphysics/bullet3">Bullet simulator</a>,</li>
  <li>the original <a href="https://github.com/flexible-collision-library/fcl">FCL library</a> (used in the <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/">Drake framework</a>),</li>
  <li>the <a href="https://github.com/danfis/libccd">libccd library</a> (used in <a href="http://mujoco.org/">MuJoCo</a>).</li>
</ol>

<p>The results are depicted in the following figure, which notably shows that the accelerated variants of GJK largely outperform by a large margin (from 5x up to 15x times faster).
Please notice that the y-axis is in log scale.</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-vs-the-rest-of-the-world.png" width="600" alt="Coal vs the rest of the world" align="center">
</p>

<p>On the other hand, why do we care about dedicated collision detection solvers like GJK for the narrow phase? Why can’t we simply formulate the collision detection problem as a quadratic problem and call an off-the-shelf optimization solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>)? Here is why:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/humanoid-path-planner/hpp-fcl/devel/./doc/images/coal-performances.jpg" width="600" alt="Coal vs generic QP solvers" align="center">
</p>

<p>One can observe that GJK-based approaches largely outperform solutions based on classic optimization solvers (e.g., QP solver like <a href="https://github.com/Simple-Robotics/proxsuite">ProxQP</a>), notably for large geometries composed of tens or hundreds of vertices.</p>

<h2 id="open-source-projects-relying-on-coal">Open-source projects relying on Coal</h2>

<ul>
  <li>
<a href="https://github.com/stack-of-tasks/pinocchio">Pinocchio</a> A fast and flexible implementation of Rigid Body Dynamics algorithms and their analytical derivatives.</li>
  <li>
<a href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a> Open source IFC library and geometry engine.</li>
  <li>
<a href="https://github.com/loco-3d/crocoddyl">Crocoddyl</a> A software to realize model predictive control for complex robotics platforms.</li>
  <li>
<a href="https://github.com/stack-of-tasks/tsid/">TSID</a> A software that implements a Task Space Inverse Dynamics QP.</li>
  <li>
<a href="https://humanoid-path-planner.github.io/hpp-doc/">HPP</a> A SDK that implements motion planners for humanoids and other robots.</li>
  <li>
<a href="https://github.com/duburcqa/jiminy">Jiminy</a> A simulator based on Pinocchio.</li>
  <li>
<a href="https://github.com/leggedrobotics/ocs2">ocs2</a> A toolbox for Optimal Control for Switched Systems (OCS2)</li>
</ul>

<h2 id="installation">Installation</h2>

<h3 id="conda">Conda</h3>

<p>Coal can be installed from the <a href="https://anaconda.org/conda-forge/coal">conda-forge channel</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda <span class="nb">install </span>coal <span class="nt">-c</span> conda-forge

</code></pre></div></div>

<h2 id="build">Build</h2>

<p>You can find build instruction <a href="https://github.com/humanoid-path-planner/hpp-fcl/tree/devel/./development/build.md">here</a>.</p>

<h2 id="c-example">C++ example</h2>
<p>Both the C++ library and the python bindings can be installed as simply as <code class="language-plaintext highlighter-rouge">conda -c conda-forge install coal</code>.
The <code class="language-plaintext highlighter-rouge">.so</code> library, include files and python bindings will then be installed under <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib</code>, <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/include</code> and <code class="language-plaintext highlighter-rouge">$CONDA_PREFIX/lib/python3.XX/site-packages</code>.</p>

<p>Here is an example of using Coal in C++:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"coal/math/transform.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/mesh_loader/loader.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/BVH/BVH_model.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision.h"</span><span class="cp">
#include</span> <span class="cpf">"coal/collision_data.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span>
<span class="c1">// Function to load a convex mesh from a `.obj`, `.stl` or `.dae` file.</span>
<span class="c1">//</span>
<span class="c1">// This function imports the object inside the file as a BVHModel, i.e. a point cloud</span>
<span class="c1">// which is hierarchically transformed into a tree of bounding volumes.</span>
<span class="c1">// The leaves of this tree are the individual points of the point cloud</span>
<span class="c1">// stored in the `.obj` file.</span>
<span class="c1">// This BVH can then be used for collision detection.</span>
<span class="c1">//</span>
<span class="c1">// For better computational efficiency, we sometimes prefer to work with</span>
<span class="c1">// the convex hull of the point cloud. This insures that the underlying object</span>
<span class="c1">// is convex and thus very fast collision detection algorithms such as</span>
<span class="c1">// GJK or EPA can be called with this object.</span>
<span class="c1">// Consequently, after creating the BVH structure from the point cloud, this function</span>
<span class="c1">// also computes its convex hull.</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">file_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">NODE_TYPE</span> <span class="n">bv_type</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">BV_AABB</span><span class="p">;</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">MeshLoader</span> <span class="n">loader</span><span class="p">(</span><span class="n">bv_type</span><span class="p">);</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">BVHModelPtr_t</span> <span class="n">bvh</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">);</span>
  <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">buildConvexHull</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="s">"Qt"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">bvh</span><span class="o">-&gt;</span><span class="n">convex</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Create the coal shapes.</span>
  <span class="c1">// Coal supports many primitive shapes: boxes, spheres, capsules, cylinders, ellipsoids, cones, planes,</span>
  <span class="c1">// halfspace and convex meshes (i.e. convex hulls of clouds of points).</span>
  <span class="c1">// It also supports BVHs (bounding volumes hierarchies), height-fields and octrees.</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span> <span class="n">shape1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">Ellipsoid</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">coal</span><span class="o">::</span><span class="n">ConvexBase</span><span class="o">&gt;</span> <span class="n">shape2</span> <span class="o">=</span> <span class="n">loadConvexMesh</span><span class="p">(</span><span class="s">"../path/to/mesh/file.obj"</span><span class="p">);</span>

  <span class="c1">// Define the shapes' placement in 3D space</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T1</span><span class="p">;</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T1</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="o">::</span><span class="n">Transform3s</span><span class="o">::</span><span class="n">Identity</span><span class="p">();</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setQuatRotation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Quaternion3f</span><span class="o">::</span><span class="n">UnitRandom</span><span class="p">());</span>
  <span class="n">T2</span><span class="p">.</span><span class="n">setTranslation</span><span class="p">(</span><span class="n">coal</span><span class="o">::</span><span class="n">Vec3s</span><span class="o">::</span><span class="n">Random</span><span class="p">());</span>

  <span class="c1">// Define collision requests and results.</span>
  <span class="c1">//</span>
  <span class="c1">// The collision request allows to set parameters for the collision pair.</span>
  <span class="c1">// For example, we can set a positive or negative security margin.</span>
  <span class="c1">// If the distance between the shapes is less than the security margin, the shapes</span>
  <span class="c1">// will be considered in collision.</span>
  <span class="c1">// Setting a positive security margin can be usefull in motion planning,</span>
  <span class="c1">// i.e to prevent shapes from getting too close to one another.</span>
  <span class="c1">// In physics simulation, allowing a negative security margin may be usefull to stabilize the simulation.</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionRequest</span> <span class="n">col_req</span><span class="p">;</span>
  <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">=</span> <span class="mf">1e-1</span><span class="p">;</span>
  <span class="c1">// A collision result stores the result of the collision test (signed distance between the shapes,</span>
  <span class="c1">// witness points location, normal etc.)</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">CollisionResult</span> <span class="n">col_res</span><span class="p">;</span>

  <span class="c1">// Collision call</span>
  <span class="n">coal</span><span class="o">::</span><span class="n">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">);</span>

  <span class="c1">// We can access the collision result once it has been populated</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Collision? "</span> <span class="o">&lt;&lt;</span> <span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">col_res</span><span class="p">.</span><span class="n">isCollision</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">coal</span><span class="o">::</span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="n">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// The penetration depth does **not** take into account the security margin.</span>
    <span class="c1">// Consequently, the penetration depth is the true signed distance which separates the shapes.</span>
    <span class="c1">// To have the distance which takes into account the security margin, we can simply add the two together.</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Penetration depth: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Distance between the shapes including the security margin: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape1: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Witness point on shape2: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">nearest_points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Normal: "</span> <span class="o">&lt;&lt;</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Before calling another collision test, it is important to clear the previous results stored in the collision result.</span>
  <span class="n">col_res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="python-example">Python example</h2>
<p>Here is the C++ example from above translated in python using the python bindings of Coal:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">coal</span>
<span class="c1"># Optional:
# The Pinocchio library is a rigid body algorithms library and has a handy SE3 module.
# It can be installed as simply as `conda -c conda-forge install pinocchio`.
# Installing pinocchio also installs coal.
</span><span class="kn">import</span> <span class="n">pinocchio</span> <span class="k">as</span> <span class="n">pin</span>

<span class="k">def</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">MeshLoader</span><span class="p">()</span>
    <span class="n">bvh</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">BVHModelBase</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">bvh</span><span class="p">.</span><span class="nf">buildConvexHull</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">Qt</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bvh</span><span class="p">.</span><span class="n">convex</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># Create coal shapes
</span>    <span class="n">shape1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Ellipsoid</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">shape2</span> <span class="o">=</span> <span class="nf">loadConvexMesh</span><span class="p">(</span><span class="sh">"</span><span class="s">../path/to/mesh/file.obj</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Define the shapes' placement in 3D space
</span>    <span class="n">T1</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">()</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">translation</span><span class="p">)</span>
    <span class="n">T1</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">T2</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">Transform3s</span><span class="p">();</span>
    <span class="c1"># Using np arrays also works
</span>    <span class="n">T1</span><span class="p">.</span><span class="nf">setTranslation</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T2</span><span class="p">.</span><span class="nf">setRotation</span><span class="p">(</span><span class="n">pin</span><span class="p">.</span><span class="n">SE3</span><span class="p">.</span><span class="nc">Random</span><span class="p">().</span><span class="n">rotation</span><span class="p">)</span>

    <span class="c1"># Define collision requests and results
</span>    <span class="n">col_req</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionRequest</span><span class="p">()</span>
    <span class="n">col_res</span> <span class="o">=</span> <span class="n">coal</span><span class="p">.</span><span class="nc">CollisionResult</span><span class="p">()</span>

    <span class="c1"># Collision call
</span>    <span class="n">coal</span><span class="p">.</span><span class="nf">collide</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">T2</span><span class="p">,</span> <span class="n">col_req</span><span class="p">,</span> <span class="n">col_res</span><span class="p">)</span>

    <span class="c1"># Accessing the collision result once it has been populated
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Is collision? </span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">()})</span>
    <span class="k">if</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">isCollision</span><span class="p">():</span>
        <span class="n">contact</span><span class="p">:</span> <span class="n">coal</span><span class="p">.</span><span class="n">Contact</span> <span class="o">=</span> <span class="n">col_res</span><span class="p">.</span><span class="nf">getContact</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Penetration depth: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Distance between the shapes including the security margin: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">penetration_depth</span> <span class="o">+</span> <span class="n">col_req</span><span class="p">.</span><span class="n">security_margin</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape1: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint1</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Witness point shape2: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="nf">getNearestPoint2</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Normal: </span><span class="sh">"</span><span class="p">,</span> <span class="n">contact</span><span class="p">.</span><span class="n">normal</span><span class="p">)</span>

    <span class="c1"># Before running another collision call, it is important to clear the old one
</span>    <span class="n">col_res</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="acknowledgments">Acknowledgments</h2>

<p>The development of <strong>Coal</strong> is actively supported by the <a href="http://projects.laas.fr/gepetto/">Gepetto team</a> <a href="http://www.laas.fr">@LAAS-CNRS</a>, the <a href="https://www.di.ens.fr/willow/">Willow team</a> <a href="http://www.inria.fr">@INRIA</a> and, to some extent, <a href="https://eurekarobotics.com/">Eureka Robotics</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/humanoid-path-planner/hpp-fcl.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
