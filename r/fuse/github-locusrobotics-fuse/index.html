<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/fuse/github-locusrobotics-fuse/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">fuse</li>
        <!--<li class="active">fuse</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-primary" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class=" older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">jazzy</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-31
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>1.1.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p><strong>NOTE</strong>: The <code class="language-plaintext highlighter-rouge">rolling</code> branch is a <a href="https://github.com/locusrobotics/fuse/issues/276">work in progress</a> port of the fuse stack to ROS 2, it is <strong>not</strong> expected to work until said work is done!</p>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/jazzy/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::msg::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::msg::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/jazzy/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/jazzy/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/jazzy/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">rolling</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-26
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p><strong>NOTE</strong>: The <code class="language-plaintext highlighter-rouge">rolling</code> branch is a <a href="https://github.com/locusrobotics/fuse/issues/276">work in progress</a> port of the fuse stack to ROS 2, it is <strong>not</strong> expected to work until said work is done!</p>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::msg::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::msg::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">rolling</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-26
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>1.2.2</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p><strong>NOTE</strong>: The <code class="language-plaintext highlighter-rouge">rolling</code> branch is a <a href="https://github.com/locusrobotics/fuse/issues/276">work in progress</a> port of the fuse stack to ROS 2, it is <strong>not</strong> expected to work until said work is done!</p>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::msg::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::msg::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/rolling/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/rolling/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-22
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#noetic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#noetic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#noetic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/devel/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/devel/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/devel/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">iron</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-31
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>1.0.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p><strong>NOTE</strong>: The <code class="language-plaintext highlighter-rouge">rolling</code> branch is a <a href="https://github.com/locusrobotics/fuse/issues/276">work in progress</a> port of the fuse stack to ROS 2, it is <strong>not</strong> expected to work until said work is done!</p>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/iron/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::msg::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::msg::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/iron/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/iron/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/iron/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/fuse">fuse</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/fuse">fuse</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_constraints">fuse_constraints</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_core">fuse_core</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_doc">fuse_doc</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_graphs">fuse_graphs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_loss">fuse_loss</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_models">fuse_models</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_msgs">fuse_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_optimizers">fuse_optimizers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_publishers">fuse_publishers</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_tutorials">fuse_tutorials</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_variables">fuse_variables</a>
        
        <a class="label label-primary pkg-label" href="/p/fuse_viz">fuse_viz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-locusrobotics-fuse
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-locusrobotics-fuse" role="menuitem" tabindex="-1" href="/r/fuse/github-locusrobotics-fuse" data="github-locusrobotics-fuse">
                    <span class="glyphicon glyphicon-star"></span>
                    github-locusrobotics-fuse
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications include state estimation, localization, mapping, and calibration.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/locusrobotics/fuse.git">https://github.com/locusrobotics/fuse.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-22
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/fuse/#melodic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#melodic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/fuse/#melodic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/fuse">fuse</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_constraints">fuse_constraints</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_core">fuse_core</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_doc">fuse_doc</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_graphs">fuse_graphs</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_loss">fuse_loss</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_models">fuse_models</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_msgs">fuse_msgs</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_optimizers">fuse_optimizers</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_publishers">fuse_publishers</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_tutorials">fuse_tutorials</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_variables">fuse_variables</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/fuse_viz">fuse_viz</a></td>
                    <td>0.11.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="fuse">fuse</h1>

<p>The fuse stack provides a general architecture for performing sensor fusion live on a robot. Some possible applications
include state estimation, localization, mapping, and calibration.</p>

<h2 id="overview">Overview</h2>

<p>fuse is a ROS framework for performing sensor fusion using nonlinear least squares optimization techniques. In
particular, fuse provides:</p>

<ul>
  <li>a plugin-based system for modeling sensor measurements</li>
  <li>a similar plugin-based system for motion models</li>
  <li>a plugin-based system for publishing optimized state values</li>
  <li>an extensible state variable definition</li>
  <li>a “contract” on how an optimizer will interact with the above components</li>
  <li>and some common implementations to get everyone started</li>
</ul>

<p>(unpresented) ROSCon 2018 Lightning Talk <a href="https://github.com/locusrobotics/fuse/tree/devel/doc/fuse_lightning_talk.pdf">slides</a></p>

<p>Data flows through the system approximately like this:</p>

<ul>
  <li>A sensor model receives raw sensor data. The sensor model generates a constraint and sends it to the optimizer.</li>
  <li>The optimizer receives the new sensor constraint. A request is sent to each configured motion model to generate
a constraint between the previous state and the new state involved in the sensor constraint.</li>
  <li>The motion model receives the request and generates the required constraints to connect the new state to the
previously generated motion model chain. The motion model constraints are sent to the optimizer.</li>
  <li>The optimizer adds the new sensor model and motion model constraints and variables to the graph and
computes the optimal values for each state variable.</li>
  <li>The optimal state values are sent to each configured publisher (as well as the sensor models and motion models).</li>
  <li>The publishers receive the optimized state values and publish any derived quantities on ROS topics.</li>
  <li>Repeat</li>
</ul>

<p>It is important to note that much of this flow happens asynchronously in practice. Sensors are expected to operate
independently from each other, so each sensor will be sending constraints to the optimizer at its own frequency. The
optimizer will cache the constraints and process them in small batches on some schedule. The publishers may
require considerable processing time, introducing a delay between the completion of the optimization cycle and the
publishing of data to the ROS topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_sequence_diagram.png" alt="fuse sequence diagram"></p>

<h2 id="example">Example</h2>

<p>Let’s consider a simple robotics example to illustrate this. Assume we have a typical indoor differential-drive robot.
This robot has wheel encoders and a horizontal laser.</p>

<p>The first thing we must do is define our state variables. At a minimum, we want the robot pose at each timestamp.
We model the pose using a 2D position and an orientation. Each 2D pose <em>at a specific time</em> gets a unique variable
name. For ease of notation, let’s call the pose variables <code class="language-plaintext highlighter-rouge">X1</code>, <code class="language-plaintext highlighter-rouge">X2</code>, <code class="language-plaintext highlighter-rouge">X3</code>, etc. (In reality, each variable gets
a UUID, but those are much harder to write down.) Each 2D pose is instantiated as a <code class="language-plaintext highlighter-rouge">example_robot::Pose2D</code> which is
derived from the <code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> base class. (<code class="language-plaintext highlighter-rouge">fuse</code> ships with several basic variables, such as 2D and 3D
versions of position, orientation, and velocity variables, but you can derive your own variable types as you need them.)</p>

<p>Next we need to decide how to model our sensors. We can model the wheel encoders as providing an incremental
pose measurement. Given a starting pose, <code class="language-plaintext highlighter-rouge">X1</code>, and a wheel encoder delta, <code class="language-plaintext highlighter-rouge">z</code>, we predict the pose <code class="language-plaintext highlighter-rouge">X2'</code> using some
measurement function <code class="language-plaintext highlighter-rouge">f</code>.</p>

<p><code class="language-plaintext highlighter-rouge">X2' = f(X1, z)</code></p>

<p>The error term for our constraint is the difference between the predicted pose <code class="language-plaintext highlighter-rouge">X2'</code> and the actual pose <code class="language-plaintext highlighter-rouge">X2</code></p>

<p><code class="language-plaintext highlighter-rouge">error = X2'^-1 * X2</code></p>

<p>where <code class="language-plaintext highlighter-rouge">X2'^-1</code> is the inverse of the pose <code class="language-plaintext highlighter-rouge">X2'</code></p>

<p>We derive a <code class="language-plaintext highlighter-rouge">fuse_core::Constraint</code> that implements that error function. Similarly, we perform scan-to-scan matching
using out laser data and create an incremental pose constraint between consecutive scans.</p>

<p>In the simplest example, the sensors are synchronized, i.e. the laser and the wheel encoders are sampled at the same
time. This is enough to construct our first <code class="language-plaintext highlighter-rouge">fuse</code> system. Below is the constraint graph generated from this first
system. The large circles represent state variables at a given time, while the small squares represent measurements.
The graph connectivity indicates which variables are involved in what measurements.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_1.png" alt="fuse graph"></p>

<p>The two sensor models are configured as plugins to an optimizer implementation. The optimizer performs the required
computation to generate the optimal state variable values based on the provided sensor constraints. We will never be
able to exactly satisfy both the wheel encoder constraints and the laserscan constraints. Instead we minimize the error
of all the constraints using nonlinear least squares optimization.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_1.png" alt="fuse optimizer"></p>

<p>While our <code class="language-plaintext highlighter-rouge">fuse</code> system is optimizing constraints from two different sensors, it is not yet publishing any data back
out to ROS. In order to publish data to ROS, we derive a <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class and add it to the
optimizer. Derived publishers have access to the optimized values of all state variables. The specific publisher
implementation determines what type of messages are published and at what frequency. For our example system,
we would like visualize the current pose of the robot in RViz, so we create a <code class="language-plaintext highlighter-rouge">fuse</code> publisher that finds the most
recent pose and converts it into a <code class="language-plaintext highlighter-rouge">geometry_msgs::PoseStamped</code> message, then publishes the message to a topic.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_2.png" alt="fuse optimizer"></p>

<p>We finally have something that is starting to be useful.</p>

<h3 id="adaptation-1-asynchronous-sensors">Adaptation #1: Asynchronous sensors</h3>

<p>Typically the laser measurements and the wheel encoder measurements are not synchronized. The encoder measurements are
sampled faster than the laser, and are sampled at different times using a different clock. If we do not do anything
different in this situation, the constraint graph becomes disconnected.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_2.png" alt="fuse graph"></p>

<p>This is where motion models come into play. A motion model differs from a sensor model in that constraints can be
generated between any two requested timestamps. Motion model constraints are generated upon request, not due to their
own internal clock. We use the motion model to connect the states introduced by the other sensor measurements. We
derive a class from the <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> base class and implement a differential drive kinematic
constraint for our robot.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_3.png" alt="fuse optimizer"></p>

<p>The motion models are also configured as plugins to the optimizer. The optimizer requests motion models constraints
from the configured plugins whenever new states are created by the sensor models.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_3.png" alt="fuse graph"></p>

<h3 id="adaptation-2-full-path-publishing">Adaptation #2: Full path publishing</h3>

<p>Nothing about the <code class="language-plaintext highlighter-rouge">fuse</code> framework limits you to having a single publisher. What if you want to visualize the entire
robot trajectory, instead of just the most recent pose? Well, we can create a new derived <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> class
that publishes all of the robot poses using a <code class="language-plaintext highlighter-rouge">nav_msgs::Path</code> message.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_4.png" alt="fuse optimizer"></p>

<h3 id="adaptation-3-changing-kinematics">Adaptation #3: Changing kinematics</h3>

<p>In your spare time, you also build <a href="http://www.powerracingseries.org/">autonomous power wheels racers</a>. But race cars
don’t use differential drive; you need a different motion model. Easy enough. We simply derive a new
<code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> class that implements an Ackermann steering model. Everything else can be reused.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_5.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_4.png" alt="fuse graph"></p>

<h3 id="adaptation-4-online-calibration">Adaptation #4: Online calibration</h3>

<p>Over time you notice that the accuracy of the odometry measurements is decreasing. After some investigation you realize
that the soft rubber racing tires are wearing, decreasing the diameter of the wheels over time. It sure would be nice
if the odometry system could compensate for that automatically. To do that, we derive a new variable type from
<code class="language-plaintext highlighter-rouge">fuse_core::Variable</code> that holds a single scalar value representing a wheel diameter at a specific point in time. For
ease of notation, we refer to this new variable as <code class="language-plaintext highlighter-rouge">D1, D2, ...</code>, etc. We also need to derive a new wheel encoder sensor
model from the <code class="language-plaintext highlighter-rouge">fuse_core::SensorModel</code> base class. This new sensor model involves the previous pose and next pose as
before, but it also involves the previous wheel diameter. Finally, we need a <code class="language-plaintext highlighter-rouge">fuse_core::MotionModel</code> that describes
how the wheel diameter is expected to change over time. Maybe some sort of exponential decay? And for good measure, we
derive a new publisher plugin from <code class="language-plaintext highlighter-rouge">fuse_core::Publisher</code> that publishes the current wheel diameter. This allows us to
plot how the wheel diameter changes over the length of the race.</p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_optimizer_6.png" alt="fuse optimizer"></p>

<p><img src="https://raw.githubusercontent.com/locusrobotics/fuse/devel/doc/fuse_graph_5.png" alt="fuse graph"></p>

<p>Now our system estimates the wheel diameters at each time step as well as the robot’s pose.</p>

<h2 id="the-math">The Math</h2>

<p>Internally <code class="language-plaintext highlighter-rouge">fuse</code> uses Google’s <a href="http://ceres-solver.org">Ceres Solver</a> to perform the nonlinear least squares
optimization, which produces the optimal state variable values. I direct any interested parties to the Ceres Solver
<a href="http://ceres-solver.org/nnls_tutorial.html">“Non-linear Least Squares”</a> tutorial for an excellent primer on the core
concepts and involved math.</p>

<h2 id="summary">Summary</h2>

<p>The purpose of <code class="language-plaintext highlighter-rouge">fuse</code> is to provide a framework for performing sensor fusion tasks, allowing common components to be
reused between systems, while also allowing components to be customized for different use cases. The goal is to allow
end users to concentrate on modeling the robot, sensor, system, etc. and spend less time wiring the different
sensor models together into runable code. And since all of the models are implemented as plugins, separate plugin
libraries can be shared or kept private at the discretion of their authors.</p>

<h2 id="api-concepts">API Concepts</h2>

<ul>
  <li><a href="https://github.com/locusrobotics/fuse/tree/devel/doc/Variables.md">Variables</a></li>
  <li><a href="https://github.com/locusrobotics/fuse/tree/devel/doc/Constraints.md">Constraints</a></li>
  <li>Sensor Models – coming soon</li>
  <li>Motion Models – coming soon</li>
  <li>Publishers – coming soon</li>
  <li>Optimizers – coming soon</li>
</ul>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/locusrobotics/fuse.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
