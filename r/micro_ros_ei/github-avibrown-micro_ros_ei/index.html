<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/micro_ros_ei/github-avibrown-micro_ros_ei/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">micro_ros_ei</li>
        <!--<li class="active">micro_ros_ei</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-default" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-primary" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jazzy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/ei_interfaces">ei_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default"></span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/avibrown/micro_ros_ei.git">https://github.com/avibrown/micro_ros_ei.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2023-01-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNKNOWN
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/micro_ros_ei/#github-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/micro_ros_ei/#github-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/micro_ros_ei/#github-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/ei_interfaces">ei_interfaces</a></td>
                    <td>0.0.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>For a full tutorial writeup: https://docs.edgeimpulse.com/experts/ros2-part2-microros</p>

<p><strong>Click image for YouTube tutorial video:</strong></p>

<p><a href="https://youtu.be/_M7Wv-3yFLA"><img src="https://i.imgur.com/MMp14iJ.png" alt=""></a></p>

<hr>

<h2 id="equipment-and-software">Equipment and software</h2>

<ul>
  <li>Arduino Portenta H7 + vision shield (more boards coming soon!)</li>
  <li>Linux computer running ROS2</li>
</ul>

<h3 id="getting-started">Getting started</h3>

<p>You’ll need to install a few things in order to follow along with this tutorial:</p>

<hr>

<h4 id="micro-ros-arduino-library">micro-ROS Arduino library</h4>

<p>Clone the library from <a href="https://github.com/micro-ROS/micro_ros_arduino">this</a> repository and add the .ZIP folder to your Arduino IDE. This library comes precompiled, but we’ll need to rebuild it after we add the custom Edge Impulse ROS2 message types (to be discussed).</p>

<hr>

<h4 id="custom-edge-impulse-message-types">Custom Edge Impulse message types</h4>

<p>To ease the process of interfacing Edge Impulse with micro-ROS two custom message types were created:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">EIClassification</code>: Contains a label and value, like <code class="language-plaintext highlighter-rouge">{'label': 'cat', 'value': 0.75}</code>. One classification contains one class name and the probability given to that class by the neural network.</li>
  <li>
<code class="language-plaintext highlighter-rouge">EIResult</code>: Contains multiple classifications - as many as your neural network needs. A full result looks like this: <code class="language-plaintext highlighter-rouge">[{'label': 'cat', 'value': 0.75}, {'label': 'dog', 'value': 0.25}]</code>.</li>
</ul>

<p>In order to use these message types they need to be added to both your ROS2 and micro-ROS environments. Clone the micro-ROS + Edge Impulse repository <a href="https://github.com/avielbr/micro_ros_ei">here</a> and copy the <code class="language-plaintext highlighter-rouge">ei_interfaces</code> directory. This folder contains everything you need to build the custom message types.</p>

<p><strong>To add it to your ROS2 system, navigate to:</strong></p>

<p><code class="language-plaintext highlighter-rouge">ros2_ws/src</code></p>

<p>and paste the <code class="language-plaintext highlighter-rouge">ei_interfaces</code> directory inside. <code class="language-plaintext highlighter-rouge">cd</code> back to your main <code class="language-plaintext highlighter-rouge">ros2_ws</code> directory and from the terminal run <code class="language-plaintext highlighter-rouge">colcon build</code>.</p>

<p>You can confirm the message types were added by running the following from the terminal:</p>

<p><code class="language-plaintext highlighter-rouge">ros2 interface list | grep EI</code></p>

<p>You should see:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 interface list | grep EI
    ei_interfaces/msg/EIClassification
    ei_interfaces/msg/EIResult

</code></pre></div></div>

<p><strong>To add it to your MicroROS environment,</strong> navigate to the micro-ROS Arduino library (that you cloned added to the Arduino IDE). You need to paste the same <code class="language-plaintext highlighter-rouge">ei_interfaces</code> directory inside the special <code class="language-plaintext highlighter-rouge">extra_packages</code> directory in the Arduino library. For me the path is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/Arduino/libraries/micro_ros_arduino-2.0.5-humble/extras/library_generation/extra_packages

</code></pre></div></div>

<p>Paste the directory there, <strong>return to the main</strong> <code class="language-plaintext highlighter-rouge">micro_ros_arduino-2.0.5-humble</code> <strong>directory,</strong> and use the docker commands from <a href="https://github.com/avibrown/micro_ros_ei/tree/main/micro_ros_arduino-2.0.5-humble">this part</a> of the MicroROS Arduino readme:</p>

<blockquote>
  <p>Note: You may need to make the <code class="language-plaintext highlighter-rouge">library_generation.sh</code> (in <code class="language-plaintext highlighter-rouge">/extras/library_generation</code>) able to run as an executable (right click and change permissions) in order for the library builder to work!</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull microros/micro_ros_static_library_builder:humble

docker run -it --rm -v $(pwd):/project --env MICROROS_LIBRARY_FOLDER=extras microros/micro_ros_static_library_builder:humble -p portenta-m7

</code></pre></div></div>

<p>Note the <code class="language-plaintext highlighter-rouge">-p</code> flag at the end - it significantly reduces the build time if you specify your target. You can also run the command without this flag to build for all available targets, but it’ll take a while.</p>

<hr>

<h3 id="arduino-code">Arduino code</h3>

<p>Now it’s time to export your Edge Impulse vision project as an Arduino library, and be sure to add the .ZIP folder to the Arduino IDE.</p>

<p>As for the example code for this project, find it <a href="https://github.com/avielbr/micro_ros_ei/tree/main/examples/arduino/ei_micro_ros_portenta">here</a>. Compile and upload the <code class="language-plaintext highlighter-rouge">.ino</code> file to your Arduino Portenta, and make sure the <code class="language-plaintext highlighter-rouge">.h</code> header file is in the same directory. I won’t be writing a line-by-line explanation of the code here - but here is some info on key points that make this all work.</p>

<p><strong>Make sure to change the name of the included Edge Impulse library to the name of your own project:</strong></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Replace this with &lt;name_of_your_ei_library_inferencing.h&gt;</span>
<span class="cp">#include</span> <span class="cpf">&lt;micro_ros_ei_inferencing.h&gt;</span><span class="cp">
</span>
</code></pre></div></div>

<h4 id="microros-publisher">MicroROS publisher</h4>

<p>Inside the <code class="language-plaintext highlighter-rouge">ei_result_publisher</code> file, note that we include the two message types we added before:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;ei_interfaces/msg/ei_result.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ei_interfaces/msg/ei_classification.h&gt;</span><span class="cp">
</span>
</code></pre></div></div>

<p>The reason we need to add both is because <code class="language-plaintext highlighter-rouge">EIResult</code> is a sequence (array) of <code class="language-plaintext highlighter-rouge">EIClassification</code> messages, and in MicroROS you need to allocate memory for your message when setting everything up. Even if your neural network has more labels than than the 2 that I have for this project (human, background), the code will still work fine as it will automatically allocate enough memory for however many labels (and hence classifications) your <code class="language-plaintext highlighter-rouge">EIResult</code> message needs to support. You can see the section where the memory is allocated here:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">LABEL_COUNT</span><span class="p">;</span>
<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ei_interfaces__msg__EIClassification</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="nf">sizeof</span><span class="p">(</span><span class="n">ei_interfaces__msg__EIClassification</span><span class="p">));</span>
<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Allocate memory to message</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int32_t</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">LABEL_COUNT</span><span class="p">;</span> <span class="n">ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// If 20 characters isn't enough - increase this value</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">].</span><span class="n">label</span><span class="p">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">].</span><span class="n">label</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">].</span><span class="n">label</span><span class="p">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">ix</span><span class="p">].</span><span class="n">label</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">.</span><span class="n">size</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Note that our <code class="language-plaintext highlighter-rouge">msg </code> is initialized as type:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ei_interfaces__msg__EIResult</span> <span class="n">msg</span><span class="p">;</span>

</code></pre></div></div>

<p>You can see the names of the node and publisher:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RCCHECK</span><span class="p">(</span><span class="n">rclc_node_init_default</span><span class="p">(</span><span class="o">&amp;</span><span class="n">node</span><span class="p">,</span> <span class="s">"ei_micro_ros_node"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">support</span><span class="p">));</span>
<span class="p">...</span>
<span class="n">RCCHECK</span><span class="p">(</span><span class="n">rclc_publisher_init_default</span><span class="p">(</span>
	<span class="o">&amp;</span><span class="n">publisher</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">node</span><span class="p">,</span>
	<span class="n">ROSIDL_GET_MSG_TYPE_SUPPORT</span><span class="p">(</span><span class="n">ei_interfaces</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">EIResult</span><span class="p">),</span>
	<span class="s">"/ei_micro_ros_publisher"</span><span class="p">));</span>

</code></pre></div></div>

<p>These names are what will appear on your ROS2 system once the microo-ROS agent detects your micro-ROS publisher.</p>

<h4 id="main-portenta-code">Main Portenta code</h4>

<p>In the <code class="language-plaintext highlighter-rouge">.ino</code> file, you’ll see that a lot of the code is taken directly from the Edge Impulse <code class="language-plaintext highlighter-rouge">ei_camera</code> example code <a href="https://github.com/edgeimpulse/firmware-arduino-portenta-h7/blob/main/src/sensors/ei_camera.cpp">here</a>. Let’s focus on the moment that the <code class="language-plaintext highlighter-rouge">ei_impulse_result_t</code> object is transferred to the MicroROS publisher:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Run the classifier</span>
<span class="n">ei_impulse_result_t</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span> <span class="c1">// Initialize result</span>

<span class="n">EI_IMPULSE_ERROR</span> <span class="n">err</span> <span class="o">=</span> <span class="n">run_classifier</span><span class="p">(</span><span class="o">&amp;</span><span class="n">signal</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="n">debug_nn</span><span class="p">);</span> <span class="c1">// Run classifier</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">EI_IMPULSE_OK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">fill_result_msg</span><span class="p">(</span><span class="n">result</span><span class="p">);</span> <span class="c1">// Store result data in MicroROS message</span>
<span class="n">publish_msg</span><span class="p">();</span> <span class="c1">// Publish message</span>

</code></pre></div></div>

<hr>

<h3 id="putting-everything-together">Putting everything together</h3>

<h4 id="microros-agent">MicroROS agent</h4>

<p>OK, now it’s time to run the MicroROS agent and see if our node is publishing as expected. The agent runs on your main ROS2 computer and serves as a middle man to allow your micro-ROS device to communicate with your main ROS2 system. It’s recommended to use the docker command for the agent. When you run this command be sure and use paste in your board port - in my case the Portenta H7 connects to <code class="language-plaintext highlighter-rouge">/dev/ttyACM0</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it --rm -v /dev:/dev --privileged --net=host microros/micro-ros-agent:humble serial --dev [YOUR BOARD PORT] -v6

</code></pre></div></div>

<blockquote>
  <p>Since you’ll probably be using this command a bunch, you might find it convenient to make an alias for it :)</p>
</blockquote>

<p>After starting the agent, you may have to reset your Arduino (with the reset button, or just unplug and reconnect).</p>

<p>In a separate terminal, check if the topic is listed. You should see the name of your topic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list
    /ei_micro_ros_publisher 
    ...


</code></pre></div></div>

<p>To see the result messages, echo the topic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic echo /ei_micro_ros_publisher

</code></pre></div></div>

<p>And if everything worked you should see the result messages:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
.
.
result:
- label: background
  value: 0.75390625
- label: human
  value: 0.24609375
---
result:
- label: background
  value: 0.69140625
- label: human
  value: 0.30859375
---
result:
- label: background
  value: 0.71875
- label: human
  value: 0.28125
---
.
.
.

</code></pre></div></div>

<p>Now you can subscribe to this topic as you would any other ROS2 topic! You can access the labels and values like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Remember that the result is an array of classifications
</span><span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">label</span> <span class="c1"># 'dog'
</span><span class="n">msg</span><span class="p">.</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span> <span class="c1"># 0.75
</span>
</code></pre></div></div>

</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/micro_ros_ei">micro_ros_ei</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-avibrown-micro_ros_ei
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-avibrown-micro_ros_ei" role="menuitem" tabindex="-1" href="/r/micro_ros_ei/github-avibrown-micro_ros_ei" data="github-avibrown-micro_ros_ei">
                    <span class="glyphicon glyphicon-star"></span>
                    github-avibrown-micro_ros_ei
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/avibrown/micro_ros_ei.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
