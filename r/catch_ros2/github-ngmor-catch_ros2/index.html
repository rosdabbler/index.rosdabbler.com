<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/catch_ros2/github-ngmor-catch_ros2/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">catch_ros2</li>
        <!--<li class="active">catch_ros2</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/catch_ros2">catch_ros2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Catch2 testing framework for ROS 2 unit and integration tests.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ngmor/catch_ros2.git">https://github.com/ngmor/catch_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">humble</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/catch_ros2/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/catch_ros2">catch_ros2</a></td>
                    <td>0.2.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="catch_ros2">catch_ros2</h1>
<p>A lightweight wrapper around the <a href="https://github.com/catchorg/Catch2/">Catch2</a> testing framework for use with ROS 2.</p>

<p>This can be used for unit testing of ROS 2 related functionality or for integration tests to test the functionality of nodes in C++.</p>

<h2 id="installation">Installation</h2>
<p>To install Debian packages of <code class="language-plaintext highlighter-rouge">catch_ros2</code> simply run the following command (assuming your environment is properly <a href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">set up for installing Debian packages</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-${ROS_DISTRO}-catch-ros2

</code></pre></div></div>
<p>Debian packages are currently available for Humble, Iron, Jazzy, and Rolling ROS 2 distributions.</p>

<p>To build the package from source, clone it into the <code class="language-plaintext highlighter-rouge">src</code> directory of your workspace root directory (<code class="language-plaintext highlighter-rouge">ws</code>). Then from <code class="language-plaintext highlighter-rouge">ws</code> use <code class="language-plaintext highlighter-rouge">colcon build</code>, like any other ROS 2 package.</p>

<h2 id="usage">Usage</h2>
<p>See the <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/">examples</a> section for guides on usage. This README provides an overview, but more details can be found in the links to example source code.</p>

<p>There are two basic ways to use this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#integration-testing">Integration testing</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#unit-testing">Unit testing</a></li>
</ol>

<p>You can also <a href="https://github.com/ngmor/catch_ros2/tree/humble/#selecting-a-main-function">customize further</a> if you need further control.</p>

<h3 id="integration-testing">Integration Testing</h3>
<p>Integration testing is an important way to ensure different elements of your system work together as desired. In ROS, we generally want to test that our nodes behave correctly, which may difficult with typical unit testing.</p>

<p>ROS 2 already contains a <a href="https://github.com/ros2/launch/tree/rolling/launch_testing">framework for writing integration tests in Python</a> which may be more than sufficient for most users. GTest can also be used to test C++ code within an integration test. However, to my knowledge, I have not seen an easy way to create integration tests in C++ with Catch2 - a simple to use but powerful C++ testing framework. The primary motivation of this package is to provide a framework for just that.</p>

<h4 id="components">Components</h4>
<p>For a launch integration test in this framework you need 4 components:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#nodes-under-test">Node(s) under test</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#testing-node">Testing node</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#launch-file">Launch file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#integration-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="nodes-under-test">Node(s) under test</h5>
<p>These are the nodes in your package whose functionality you’d like to test. Nothing special has to be done with these nodes to test them with this framework. This example has <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/integration_aux_node.cpp"><code class="language-plaintext highlighter-rouge">integration_aux_node</code></a> as the node under test.</p>

<h5 id="testing-node">Testing node</h5>
<p>This node is specifically written with Catch2 test cases and assertions to test the functionality of other nodes. The example has <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/integration_test_node.cpp"><code class="language-plaintext highlighter-rouge">integration_test_node</code></a> as the testing node.</p>

<p>If it is linked with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code> (see <a href="https://github.com/ngmor/catch_ros2/tree/humble/#integration-cmake-setup">CMake setup</a>) it does not require a <code class="language-plaintext highlighter-rouge">main</code> function and can be run just like any other ROS 2 node (<code class="language-plaintext highlighter-rouge">ros2 run ${package_name} ${executable_name}</code>). Tests can be executed manually by just running the node like this (along with other necessary nodes).</p>

<p>If more precise functionality beyond the <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/node_main.cpp">default node main</a> of this package is desired, see <a href="https://github.com/ngmor/catch_ros2/tree/humble/#selecting-a-main-function">selecting a main function</a>.</p>

<h5 id="launch-file">Launch file</h5>
<p>To automate the integration test, a <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/example_integration_test.launch.py">Python launch file</a> can be used to launch all the necessary nodes for the test, including the test node. An integration test can also be run manually by simply launching this launch file.</p>

<p>This launch file is the same as any other ROS 2 Python launch file, but the <code class="language-plaintext highlighter-rouge">launch_catch_ros2</code> Python module provides a few useful classes:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2LaunchDescription</code> - a wrapper around the typical <a href="https://github.com/ros2/launch/blob/rolling/launch/launch/launch_description.py"><code class="language-plaintext highlighter-rouge">launch.LaunchDescription</code></a> that includes a “result_file” argument where the results of the test will be output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2IntegrationTestNode</code> - a wrapper around the typical <a href="https://github.com/ros2/launch_ros/blob/rolling/launch_ros/launch_ros/actions/node.py"><code class="language-plaintext highlighter-rouge">launch_ros.actions.Node</code></a> that passes the “result_file” argument to Catch2 (via the default <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main function) and shuts down all nodes on exit. This should be used to launch the <a href="https://github.com/ngmor/catch_ros2/tree/humble/#testing-node">testing node</a>. Only one should be used per integration test.</li>
</ul>

<p><a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/example_integration_test.launch.xml">XML</a> and <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/example_integration_test.launch.yaml">YAML</a> launch files can also be used - see the provided links for examples of the above same launch file implemented in those formats.</p>

<h5 id="integration-cmake-setup">Integration CMake setup</h5>
<p>Most of the <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/integration_test/CMakeLists.txt">CMake required for this integration test</a> is pretty standard for a ROS 2 package (though the ROS 2 boilerplate CMake is not shown in this example). Nodes are built/installed and the launch file is installed to the package’s share directory.</p>

<p>A few items are of note:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(integration_test_node
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>
<p>This links the integration test node with the version of <code class="language-plaintext highlighter-rouge">catch_ros2</code> that includes the <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/node_main.cpp">default main for running test nodes</a>. Only one version of the <code class="language-plaintext highlighter-rouge">catch_ros2</code> library need be linked to a target, depending on the need for a default main. See <a href="https://github.com/ngmor/catch_ros2/tree/humble/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catch_ros2_add_integration_test(ExampleIntegration_Test
  LAUNCH_FILE example_integration_test.launch.py
)

</code></pre></div></div>
<p>This custom CMake function is only necessary if the test should be run automatically whenever <code class="language-plaintext highlighter-rouge">colcon test</code> is run. See <a href="https://github.com/ngmor/catch_ros2/tree/humble/cmake/catch_ros2_add_integration_test.cmake">here</a> for documentation on the function.</p>

<h3 id="unit-testing">Unit Testing</h3>
<p>Unit testing is a good way to ensure specific elements of your package work well on their own. It’s important to ensure functionality is preserved in an ever-evolving codebase.</p>

<p>This package can also be used for unit testing with Catch2. Using Catch2 for unit testing of ROS 2 components is much more straightforward, and you may not need <code class="language-plaintext highlighter-rouge">catch_ros2</code>. However this package provides a few utilities and a newer version of Catch2 than Ubuntu does.</p>

<h4 id="components-1">Components</h4>
<p>Only 2 components are needed to create a unit test with this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#test-source-file">Test source file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/humble/#unit-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="test-source-file">Test source file</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/unit_test/example_unit_test.cpp">source file for unit tests</a> can be written like any other <a href="https://github.com/catchorg/Catch2">Catch2</a> unit test.</p>

<h5 id="unit-cmake-setup">Unit CMake setup</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/unit_test/CMakeLists.txt">CMake setup for unit testing</a> is pretty standard for adding a Catch2 test. The only thing of note is linking the source file with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>, which gives access to <code class="language-plaintext highlighter-rouge">catch_ros2</code> utilities and uses Catch2’s default main function. See <a href="https://github.com/ngmor/catch_ros2/tree/humble/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(example_unit_test
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="utilities">Utilities</h4>
<p><code class="language-plaintext highlighter-rouge">catch_ros2</code> provides some utility functions for unit testing in ROS 2.</p>

<ul>
  <li>
<a href="https://github.com/ngmor/catch_ros2/tree/humble/include/catch_ros2/arguments.hpp">Arguments</a> - utilities for handling command line arguments.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">SimulateArgs</code> - allows you to pass in a string or vector of strings representing command line arguments to create simulated <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code> values to pass into functions or <code class="language-plaintext highlighter-rouge">rclcpp::init()</code>.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/unit_test/example_unit_test.cpp">here</a> and <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/custom_main/example_test_with_custom_main.cpp">here</a> for examples.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">SplitROSArgs</code> - removes ROS arguments from an input <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>, so these arguments won’t cause problems for other functions (like Catch2 sessions).
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/node_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">tokenize</code> - splits a command line string into a vector of strings, ignoring whitespace in quotation marks.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="selecting-a-main-function">Selecting a main function</h3>
<p>There are three options for a main function when using <code class="language-plaintext highlighter-rouge">catch_ros2</code>. Which option is selected depends on which library you link your target to - you should only link to one.</p>

<h4 id="1-default-node-main">1. Default Node Main</h4>
<p>This test node main function (defined <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/node_main.cpp">here</a>) is good for writing ROS 2 test nodes that use Catch2 (ex: for integration tests). It initializes the ROS context with the input arguments, removes the ROS arguments from the input list, runs the Catch session, then shuts down ROS.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>

<h4 id="2-default-catch2-main">2. Default Catch2 Main</h4>
<p>This main function is Catch2’s <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/default_main.cpp">default main function</a>, which is good for typical unit testing scenarios.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="3-defining-a-custom-main">3. Defining a custom main</h4>
<p>If neither of the above two options satisfy your needs, you can define your own custom main function. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/own-main.md">Catch2’s guidelines on this</a>. See <a href="https://github.com/ngmor/catch_ros2/tree/humble/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</p>

<p>If you want your test to behave like a node, you can use <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/node_main.cpp">the <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main</a> as a starting point.</p>

<p>To define your own main but still use this library, link to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2
)

</code></pre></div></div>

<h2 id="catch2-version">Catch2 Version</h2>
<p>Currently this repository uses the <a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#how-to-migrate-projects-from-v2-to-v3">amalgamated version of Catch2</a> as a simple way of vendoring v3.5.4 of Catch2. Ubuntu 22.04 currently only provides Catch2 v2, which ROS 2 depends on, so we’ve made the decision to vendor v3 to be able to use the newest features. In the future, this approach may be abandoned for vendoring Catch2 v3 in its multiple header form.</p>

<p>In order to update the repository for a future release of Catch2 v3, simply copy the amalgamated <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.hpp">header</a> and <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.cpp">source</a> files from the Catch2 repository and replace those <a href="https://github.com/ngmor/catch_ros2/tree/humble/include/catch_amalgamated.hpp">header</a> and <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/catch_amalgamated.cpp">source</a> files in this repository. The <a href="https://github.com/ngmor/catch_ros2/tree/humble/src/default_main.cpp">default main</a> may also need to be updated.</p>

<p>However, since Ubuntu 24.04 provides Catch2 v3.4.0, we may standardize on this version to prevent the need for vendoring v3 for any ROS distros on 24.04. v3 would still be vendored for ROS distros on 22.04. Changes coming soon!</p>

<h2 id="license">License</h2>
<p>This package is released under the Apache-2.0 License. Catch2 is licensed under the BSL-1.0 License (see their repository for more details).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>
</div>
              <hr id="humble-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="humble-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#humble-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#humble-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#humble-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="humble-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="humble-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="humble-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/catch_ros2">catch_ros2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Catch2 testing framework for ROS 2 unit and integration tests.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ngmor/catch_ros2.git">https://github.com/ngmor/catch_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">rolling</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/catch_ros2/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/catch_ros2">catch_ros2</a></td>
                    <td>0.2.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="catch_ros2">catch_ros2</h1>
<p>A lightweight wrapper around the <a href="https://github.com/catchorg/Catch2/">Catch2</a> testing framework for use with ROS 2.</p>

<p>This can be used for unit testing of ROS 2 related functionality or for integration tests to test the functionality of nodes in C++.</p>

<h2 id="installation">Installation</h2>
<p>To install Debian packages of <code class="language-plaintext highlighter-rouge">catch_ros2</code> simply run the following command (assuming your environment is properly <a href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">set up for installing Debian packages</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-${ROS_DISTRO}-catch-ros2

</code></pre></div></div>
<p>Debian packages are currently available for Humble, Iron, Jazzy, and Rolling ROS 2 distributions.</p>

<p>To build the package from source, clone it into the <code class="language-plaintext highlighter-rouge">src</code> directory of your workspace root directory (<code class="language-plaintext highlighter-rouge">ws</code>). Then from <code class="language-plaintext highlighter-rouge">ws</code> use <code class="language-plaintext highlighter-rouge">colcon build</code>, like any other ROS 2 package.</p>

<h2 id="usage">Usage</h2>
<p>See the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/">examples</a> section for guides on usage. This README provides an overview, but more details can be found in the links to example source code.</p>

<p>There are two basic ways to use this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-testing">Integration testing</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-testing">Unit testing</a></li>
</ol>

<p>You can also <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">customize further</a> if you need further control.</p>

<h3 id="integration-testing">Integration Testing</h3>
<p>Integration testing is an important way to ensure different elements of your system work together as desired. In ROS, we generally want to test that our nodes behave correctly, which may difficult with typical unit testing.</p>

<p>ROS 2 already contains a <a href="https://github.com/ros2/launch/tree/rolling/launch_testing">framework for writing integration tests in Python</a> which may be more than sufficient for most users. GTest can also be used to test C++ code within an integration test. However, to my knowledge, I have not seen an easy way to create integration tests in C++ with Catch2 - a simple to use but powerful C++ testing framework. The primary motivation of this package is to provide a framework for just that.</p>

<h4 id="components">Components</h4>
<p>For a launch integration test in this framework you need 4 components:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#nodes-under-test">Node(s) under test</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">Testing node</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#launch-file">Launch file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="nodes-under-test">Node(s) under test</h5>
<p>These are the nodes in your package whose functionality you’d like to test. Nothing special has to be done with these nodes to test them with this framework. This example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_aux_node.cpp"><code class="language-plaintext highlighter-rouge">integration_aux_node</code></a> as the node under test.</p>

<h5 id="testing-node">Testing node</h5>
<p>This node is specifically written with Catch2 test cases and assertions to test the functionality of other nodes. The example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_test_node.cpp"><code class="language-plaintext highlighter-rouge">integration_test_node</code></a> as the testing node.</p>

<p>If it is linked with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code> (see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a>) it does not require a <code class="language-plaintext highlighter-rouge">main</code> function and can be run just like any other ROS 2 node (<code class="language-plaintext highlighter-rouge">ros2 run ${package_name} ${executable_name}</code>). Tests can be executed manually by just running the node like this (along with other necessary nodes).</p>

<p>If more precise functionality beyond the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default node main</a> of this package is desired, see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<h5 id="launch-file">Launch file</h5>
<p>To automate the integration test, a <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.py">Python launch file</a> can be used to launch all the necessary nodes for the test, including the test node. An integration test can also be run manually by simply launching this launch file.</p>

<p>This launch file is the same as any other ROS 2 Python launch file, but the <code class="language-plaintext highlighter-rouge">launch_catch_ros2</code> Python module provides a few useful classes:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2LaunchDescription</code> - a wrapper around the typical <a href="https://github.com/ros2/launch/blob/rolling/launch/launch/launch_description.py"><code class="language-plaintext highlighter-rouge">launch.LaunchDescription</code></a> that includes a “result_file” argument where the results of the test will be output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2IntegrationTestNode</code> - a wrapper around the typical <a href="https://github.com/ros2/launch_ros/blob/rolling/launch_ros/launch_ros/actions/node.py"><code class="language-plaintext highlighter-rouge">launch_ros.actions.Node</code></a> that passes the “result_file” argument to Catch2 (via the default <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main function) and shuts down all nodes on exit. This should be used to launch the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">testing node</a>. Only one should be used per integration test.</li>
</ul>

<p><a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.xml">XML</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.yaml">YAML</a> launch files can also be used - see the provided links for examples of the above same launch file implemented in those formats.</p>

<h5 id="integration-cmake-setup">Integration CMake setup</h5>
<p>Most of the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/CMakeLists.txt">CMake required for this integration test</a> is pretty standard for a ROS 2 package (though the ROS 2 boilerplate CMake is not shown in this example). Nodes are built/installed and the launch file is installed to the package’s share directory.</p>

<p>A few items are of note:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(integration_test_node
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>
<p>This links the integration test node with the version of <code class="language-plaintext highlighter-rouge">catch_ros2</code> that includes the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default main for running test nodes</a>. Only one version of the <code class="language-plaintext highlighter-rouge">catch_ros2</code> library need be linked to a target, depending on the need for a default main. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catch_ros2_add_integration_test(ExampleIntegration_Test
  LAUNCH_FILE example_integration_test.launch.py
)

</code></pre></div></div>
<p>This custom CMake function is only necessary if the test should be run automatically whenever <code class="language-plaintext highlighter-rouge">colcon test</code> is run. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/cmake/catch_ros2_add_integration_test.cmake">here</a> for documentation on the function.</p>

<h3 id="unit-testing">Unit Testing</h3>
<p>Unit testing is a good way to ensure specific elements of your package work well on their own. It’s important to ensure functionality is preserved in an ever-evolving codebase.</p>

<p>This package can also be used for unit testing with Catch2. Using Catch2 for unit testing of ROS 2 components is much more straightforward, and you may not need <code class="language-plaintext highlighter-rouge">catch_ros2</code>. However this package provides a few utilities and a newer version of Catch2 than Ubuntu does.</p>

<h4 id="components-1">Components</h4>
<p>Only 2 components are needed to create a unit test with this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#test-source-file">Test source file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="test-source-file">Test source file</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">source file for unit tests</a> can be written like any other <a href="https://github.com/catchorg/Catch2">Catch2</a> unit test.</p>

<h5 id="unit-cmake-setup">Unit CMake setup</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/CMakeLists.txt">CMake setup for unit testing</a> is pretty standard for adding a Catch2 test. The only thing of note is linking the source file with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>, which gives access to <code class="language-plaintext highlighter-rouge">catch_ros2</code> utilities and uses Catch2’s default main function. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(example_unit_test
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="utilities">Utilities</h4>
<p><code class="language-plaintext highlighter-rouge">catch_ros2</code> provides some utility functions for unit testing in ROS 2.</p>

<ul>
  <li>
<a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_ros2/arguments.hpp">Arguments</a> - utilities for handling command line arguments.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">SimulateArgs</code> - allows you to pass in a string or vector of strings representing command line arguments to create simulated <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code> values to pass into functions or <code class="language-plaintext highlighter-rouge">rclcpp::init()</code>.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">here</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for examples.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">SplitROSArgs</code> - removes ROS arguments from an input <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>, so these arguments won’t cause problems for other functions (like Catch2 sessions).
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">tokenize</code> - splits a command line string into a vector of strings, ignoring whitespace in quotation marks.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="selecting-a-main-function">Selecting a main function</h3>
<p>There are three options for a main function when using <code class="language-plaintext highlighter-rouge">catch_ros2</code>. Which option is selected depends on which library you link your target to - you should only link to one.</p>

<h4 id="1-default-node-main">1. Default Node Main</h4>
<p>This test node main function (defined <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a>) is good for writing ROS 2 test nodes that use Catch2 (ex: for integration tests). It initializes the ROS context with the input arguments, removes the ROS arguments from the input list, runs the Catch session, then shuts down ROS.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>

<h4 id="2-default-catch2-main">2. Default Catch2 Main</h4>
<p>This main function is Catch2’s <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main function</a>, which is good for typical unit testing scenarios.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="3-defining-a-custom-main">3. Defining a custom main</h4>
<p>If neither of the above two options satisfy your needs, you can define your own custom main function. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/own-main.md">Catch2’s guidelines on this</a>. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</p>

<p>If you want your test to behave like a node, you can use <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">the <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main</a> as a starting point.</p>

<p>To define your own main but still use this library, link to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2
)

</code></pre></div></div>

<h2 id="catch2-version">Catch2 Version</h2>
<p>Currently this repository uses the <a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#how-to-migrate-projects-from-v2-to-v3">amalgamated version of Catch2</a> as a simple way of vendoring v3.5.4 of Catch2. Ubuntu 22.04 currently only provides Catch2 v2, which ROS 2 depends on, so we’ve made the decision to vendor v3 to be able to use the newest features. In the future, this approach may be abandoned for vendoring Catch2 v3 in its multiple header form.</p>

<p>In order to update the repository for a future release of Catch2 v3, simply copy the amalgamated <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.hpp">header</a> and <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.cpp">source</a> files from the Catch2 repository and replace those <a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_amalgamated.hpp">header</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/catch_amalgamated.cpp">source</a> files in this repository. The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main</a> may also need to be updated.</p>

<p>However, since Ubuntu 24.04 provides Catch2 v3.4.0, we may standardize on this version to prevent the need for vendoring v3 for any ROS distros on 24.04. v3 would still be vendored for ROS distros on 22.04. Changes coming soon!</p>

<h2 id="license">License</h2>
<p>This package is released under the Apache-2.0 License. Catch2 is licensed under the BSL-1.0 License (see their repository for more details).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>
</div>
              <hr id="jazzy-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="jazzy-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#jazzy-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#jazzy-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#jazzy-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="jazzy-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="jazzy-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="jazzy-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/catch_ros2">catch_ros2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Catch2 testing framework for ROS 2 unit and integration tests.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ngmor/catch_ros2.git">https://github.com/ngmor/catch_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">rolling</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/catch_ros2/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/catch_ros2">catch_ros2</a></td>
                    <td>0.2.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="catch_ros2">catch_ros2</h1>
<p>A lightweight wrapper around the <a href="https://github.com/catchorg/Catch2/">Catch2</a> testing framework for use with ROS 2.</p>

<p>This can be used for unit testing of ROS 2 related functionality or for integration tests to test the functionality of nodes in C++.</p>

<h2 id="installation">Installation</h2>
<p>To install Debian packages of <code class="language-plaintext highlighter-rouge">catch_ros2</code> simply run the following command (assuming your environment is properly <a href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">set up for installing Debian packages</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-${ROS_DISTRO}-catch-ros2

</code></pre></div></div>
<p>Debian packages are currently available for Humble, Iron, Jazzy, and Rolling ROS 2 distributions.</p>

<p>To build the package from source, clone it into the <code class="language-plaintext highlighter-rouge">src</code> directory of your workspace root directory (<code class="language-plaintext highlighter-rouge">ws</code>). Then from <code class="language-plaintext highlighter-rouge">ws</code> use <code class="language-plaintext highlighter-rouge">colcon build</code>, like any other ROS 2 package.</p>

<h2 id="usage">Usage</h2>
<p>See the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/">examples</a> section for guides on usage. This README provides an overview, but more details can be found in the links to example source code.</p>

<p>There are two basic ways to use this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-testing">Integration testing</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-testing">Unit testing</a></li>
</ol>

<p>You can also <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">customize further</a> if you need further control.</p>

<h3 id="integration-testing">Integration Testing</h3>
<p>Integration testing is an important way to ensure different elements of your system work together as desired. In ROS, we generally want to test that our nodes behave correctly, which may difficult with typical unit testing.</p>

<p>ROS 2 already contains a <a href="https://github.com/ros2/launch/tree/rolling/launch_testing">framework for writing integration tests in Python</a> which may be more than sufficient for most users. GTest can also be used to test C++ code within an integration test. However, to my knowledge, I have not seen an easy way to create integration tests in C++ with Catch2 - a simple to use but powerful C++ testing framework. The primary motivation of this package is to provide a framework for just that.</p>

<h4 id="components">Components</h4>
<p>For a launch integration test in this framework you need 4 components:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#nodes-under-test">Node(s) under test</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">Testing node</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#launch-file">Launch file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="nodes-under-test">Node(s) under test</h5>
<p>These are the nodes in your package whose functionality you’d like to test. Nothing special has to be done with these nodes to test them with this framework. This example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_aux_node.cpp"><code class="language-plaintext highlighter-rouge">integration_aux_node</code></a> as the node under test.</p>

<h5 id="testing-node">Testing node</h5>
<p>This node is specifically written with Catch2 test cases and assertions to test the functionality of other nodes. The example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_test_node.cpp"><code class="language-plaintext highlighter-rouge">integration_test_node</code></a> as the testing node.</p>

<p>If it is linked with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code> (see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a>) it does not require a <code class="language-plaintext highlighter-rouge">main</code> function and can be run just like any other ROS 2 node (<code class="language-plaintext highlighter-rouge">ros2 run ${package_name} ${executable_name}</code>). Tests can be executed manually by just running the node like this (along with other necessary nodes).</p>

<p>If more precise functionality beyond the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default node main</a> of this package is desired, see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<h5 id="launch-file">Launch file</h5>
<p>To automate the integration test, a <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.py">Python launch file</a> can be used to launch all the necessary nodes for the test, including the test node. An integration test can also be run manually by simply launching this launch file.</p>

<p>This launch file is the same as any other ROS 2 Python launch file, but the <code class="language-plaintext highlighter-rouge">launch_catch_ros2</code> Python module provides a few useful classes:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2LaunchDescription</code> - a wrapper around the typical <a href="https://github.com/ros2/launch/blob/rolling/launch/launch/launch_description.py"><code class="language-plaintext highlighter-rouge">launch.LaunchDescription</code></a> that includes a “result_file” argument where the results of the test will be output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2IntegrationTestNode</code> - a wrapper around the typical <a href="https://github.com/ros2/launch_ros/blob/rolling/launch_ros/launch_ros/actions/node.py"><code class="language-plaintext highlighter-rouge">launch_ros.actions.Node</code></a> that passes the “result_file” argument to Catch2 (via the default <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main function) and shuts down all nodes on exit. This should be used to launch the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">testing node</a>. Only one should be used per integration test.</li>
</ul>

<p><a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.xml">XML</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.yaml">YAML</a> launch files can also be used - see the provided links for examples of the above same launch file implemented in those formats.</p>

<h5 id="integration-cmake-setup">Integration CMake setup</h5>
<p>Most of the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/CMakeLists.txt">CMake required for this integration test</a> is pretty standard for a ROS 2 package (though the ROS 2 boilerplate CMake is not shown in this example). Nodes are built/installed and the launch file is installed to the package’s share directory.</p>

<p>A few items are of note:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(integration_test_node
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>
<p>This links the integration test node with the version of <code class="language-plaintext highlighter-rouge">catch_ros2</code> that includes the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default main for running test nodes</a>. Only one version of the <code class="language-plaintext highlighter-rouge">catch_ros2</code> library need be linked to a target, depending on the need for a default main. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catch_ros2_add_integration_test(ExampleIntegration_Test
  LAUNCH_FILE example_integration_test.launch.py
)

</code></pre></div></div>
<p>This custom CMake function is only necessary if the test should be run automatically whenever <code class="language-plaintext highlighter-rouge">colcon test</code> is run. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/cmake/catch_ros2_add_integration_test.cmake">here</a> for documentation on the function.</p>

<h3 id="unit-testing">Unit Testing</h3>
<p>Unit testing is a good way to ensure specific elements of your package work well on their own. It’s important to ensure functionality is preserved in an ever-evolving codebase.</p>

<p>This package can also be used for unit testing with Catch2. Using Catch2 for unit testing of ROS 2 components is much more straightforward, and you may not need <code class="language-plaintext highlighter-rouge">catch_ros2</code>. However this package provides a few utilities and a newer version of Catch2 than Ubuntu does.</p>

<h4 id="components-1">Components</h4>
<p>Only 2 components are needed to create a unit test with this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#test-source-file">Test source file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="test-source-file">Test source file</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">source file for unit tests</a> can be written like any other <a href="https://github.com/catchorg/Catch2">Catch2</a> unit test.</p>

<h5 id="unit-cmake-setup">Unit CMake setup</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/CMakeLists.txt">CMake setup for unit testing</a> is pretty standard for adding a Catch2 test. The only thing of note is linking the source file with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>, which gives access to <code class="language-plaintext highlighter-rouge">catch_ros2</code> utilities and uses Catch2’s default main function. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(example_unit_test
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="utilities">Utilities</h4>
<p><code class="language-plaintext highlighter-rouge">catch_ros2</code> provides some utility functions for unit testing in ROS 2.</p>

<ul>
  <li>
<a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_ros2/arguments.hpp">Arguments</a> - utilities for handling command line arguments.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">SimulateArgs</code> - allows you to pass in a string or vector of strings representing command line arguments to create simulated <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code> values to pass into functions or <code class="language-plaintext highlighter-rouge">rclcpp::init()</code>.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">here</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for examples.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">SplitROSArgs</code> - removes ROS arguments from an input <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>, so these arguments won’t cause problems for other functions (like Catch2 sessions).
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">tokenize</code> - splits a command line string into a vector of strings, ignoring whitespace in quotation marks.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="selecting-a-main-function">Selecting a main function</h3>
<p>There are three options for a main function when using <code class="language-plaintext highlighter-rouge">catch_ros2</code>. Which option is selected depends on which library you link your target to - you should only link to one.</p>

<h4 id="1-default-node-main">1. Default Node Main</h4>
<p>This test node main function (defined <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a>) is good for writing ROS 2 test nodes that use Catch2 (ex: for integration tests). It initializes the ROS context with the input arguments, removes the ROS arguments from the input list, runs the Catch session, then shuts down ROS.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>

<h4 id="2-default-catch2-main">2. Default Catch2 Main</h4>
<p>This main function is Catch2’s <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main function</a>, which is good for typical unit testing scenarios.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="3-defining-a-custom-main">3. Defining a custom main</h4>
<p>If neither of the above two options satisfy your needs, you can define your own custom main function. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/own-main.md">Catch2’s guidelines on this</a>. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</p>

<p>If you want your test to behave like a node, you can use <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">the <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main</a> as a starting point.</p>

<p>To define your own main but still use this library, link to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2
)

</code></pre></div></div>

<h2 id="catch2-version">Catch2 Version</h2>
<p>Currently this repository uses the <a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#how-to-migrate-projects-from-v2-to-v3">amalgamated version of Catch2</a> as a simple way of vendoring v3.5.4 of Catch2. Ubuntu 22.04 currently only provides Catch2 v2, which ROS 2 depends on, so we’ve made the decision to vendor v3 to be able to use the newest features. In the future, this approach may be abandoned for vendoring Catch2 v3 in its multiple header form.</p>

<p>In order to update the repository for a future release of Catch2 v3, simply copy the amalgamated <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.hpp">header</a> and <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.cpp">source</a> files from the Catch2 repository and replace those <a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_amalgamated.hpp">header</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/catch_amalgamated.cpp">source</a> files in this repository. The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main</a> may also need to be updated.</p>

<p>However, since Ubuntu 24.04 provides Catch2 v3.4.0, we may standardize on this version to prevent the need for vendoring v3 for any ROS distros on 24.04. v3 would still be vendored for ROS distros on 22.04. Changes coming soon!</p>

<h2 id="license">License</h2>
<p>This package is released under the Apache-2.0 License. Catch2 is licensed under the BSL-1.0 License (see their repository for more details).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>
</div>
              <hr id="kilted-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="kilted-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#kilted-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#kilted-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#kilted-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="kilted-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="kilted-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="kilted-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/catch_ros2">catch_ros2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Catch2 testing framework for ROS 2 unit and integration tests.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ngmor/catch_ros2.git">https://github.com/ngmor/catch_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">rolling</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/catch_ros2/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/catch_ros2">catch_ros2</a></td>
                    <td>0.2.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="catch_ros2">catch_ros2</h1>
<p>A lightweight wrapper around the <a href="https://github.com/catchorg/Catch2/">Catch2</a> testing framework for use with ROS 2.</p>

<p>This can be used for unit testing of ROS 2 related functionality or for integration tests to test the functionality of nodes in C++.</p>

<h2 id="installation">Installation</h2>
<p>To install Debian packages of <code class="language-plaintext highlighter-rouge">catch_ros2</code> simply run the following command (assuming your environment is properly <a href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">set up for installing Debian packages</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-${ROS_DISTRO}-catch-ros2

</code></pre></div></div>
<p>Debian packages are currently available for Humble, Iron, Jazzy, and Rolling ROS 2 distributions.</p>

<p>To build the package from source, clone it into the <code class="language-plaintext highlighter-rouge">src</code> directory of your workspace root directory (<code class="language-plaintext highlighter-rouge">ws</code>). Then from <code class="language-plaintext highlighter-rouge">ws</code> use <code class="language-plaintext highlighter-rouge">colcon build</code>, like any other ROS 2 package.</p>

<h2 id="usage">Usage</h2>
<p>See the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/">examples</a> section for guides on usage. This README provides an overview, but more details can be found in the links to example source code.</p>

<p>There are two basic ways to use this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-testing">Integration testing</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-testing">Unit testing</a></li>
</ol>

<p>You can also <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">customize further</a> if you need further control.</p>

<h3 id="integration-testing">Integration Testing</h3>
<p>Integration testing is an important way to ensure different elements of your system work together as desired. In ROS, we generally want to test that our nodes behave correctly, which may difficult with typical unit testing.</p>

<p>ROS 2 already contains a <a href="https://github.com/ros2/launch/tree/rolling/launch_testing">framework for writing integration tests in Python</a> which may be more than sufficient for most users. GTest can also be used to test C++ code within an integration test. However, to my knowledge, I have not seen an easy way to create integration tests in C++ with Catch2 - a simple to use but powerful C++ testing framework. The primary motivation of this package is to provide a framework for just that.</p>

<h4 id="components">Components</h4>
<p>For a launch integration test in this framework you need 4 components:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#nodes-under-test">Node(s) under test</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">Testing node</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#launch-file">Launch file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="nodes-under-test">Node(s) under test</h5>
<p>These are the nodes in your package whose functionality you’d like to test. Nothing special has to be done with these nodes to test them with this framework. This example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_aux_node.cpp"><code class="language-plaintext highlighter-rouge">integration_aux_node</code></a> as the node under test.</p>

<h5 id="testing-node">Testing node</h5>
<p>This node is specifically written with Catch2 test cases and assertions to test the functionality of other nodes. The example has <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/integration_test_node.cpp"><code class="language-plaintext highlighter-rouge">integration_test_node</code></a> as the testing node.</p>

<p>If it is linked with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code> (see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#integration-cmake-setup">CMake setup</a>) it does not require a <code class="language-plaintext highlighter-rouge">main</code> function and can be run just like any other ROS 2 node (<code class="language-plaintext highlighter-rouge">ros2 run ${package_name} ${executable_name}</code>). Tests can be executed manually by just running the node like this (along with other necessary nodes).</p>

<p>If more precise functionality beyond the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default node main</a> of this package is desired, see <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<h5 id="launch-file">Launch file</h5>
<p>To automate the integration test, a <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.py">Python launch file</a> can be used to launch all the necessary nodes for the test, including the test node. An integration test can also be run manually by simply launching this launch file.</p>

<p>This launch file is the same as any other ROS 2 Python launch file, but the <code class="language-plaintext highlighter-rouge">launch_catch_ros2</code> Python module provides a few useful classes:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2LaunchDescription</code> - a wrapper around the typical <a href="https://github.com/ros2/launch/blob/rolling/launch/launch/launch_description.py"><code class="language-plaintext highlighter-rouge">launch.LaunchDescription</code></a> that includes a “result_file” argument where the results of the test will be output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2IntegrationTestNode</code> - a wrapper around the typical <a href="https://github.com/ros2/launch_ros/blob/rolling/launch_ros/launch_ros/actions/node.py"><code class="language-plaintext highlighter-rouge">launch_ros.actions.Node</code></a> that passes the “result_file” argument to Catch2 (via the default <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main function) and shuts down all nodes on exit. This should be used to launch the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#testing-node">testing node</a>. Only one should be used per integration test.</li>
</ul>

<p><a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.xml">XML</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/example_integration_test.launch.yaml">YAML</a> launch files can also be used - see the provided links for examples of the above same launch file implemented in those formats.</p>

<h5 id="integration-cmake-setup">Integration CMake setup</h5>
<p>Most of the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/integration_test/CMakeLists.txt">CMake required for this integration test</a> is pretty standard for a ROS 2 package (though the ROS 2 boilerplate CMake is not shown in this example). Nodes are built/installed and the launch file is installed to the package’s share directory.</p>

<p>A few items are of note:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(integration_test_node
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>
<p>This links the integration test node with the version of <code class="language-plaintext highlighter-rouge">catch_ros2</code> that includes the <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">default main for running test nodes</a>. Only one version of the <code class="language-plaintext highlighter-rouge">catch_ros2</code> library need be linked to a target, depending on the need for a default main. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catch_ros2_add_integration_test(ExampleIntegration_Test
  LAUNCH_FILE example_integration_test.launch.py
)

</code></pre></div></div>
<p>This custom CMake function is only necessary if the test should be run automatically whenever <code class="language-plaintext highlighter-rouge">colcon test</code> is run. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/cmake/catch_ros2_add_integration_test.cmake">here</a> for documentation on the function.</p>

<h3 id="unit-testing">Unit Testing</h3>
<p>Unit testing is a good way to ensure specific elements of your package work well on their own. It’s important to ensure functionality is preserved in an ever-evolving codebase.</p>

<p>This package can also be used for unit testing with Catch2. Using Catch2 for unit testing of ROS 2 components is much more straightforward, and you may not need <code class="language-plaintext highlighter-rouge">catch_ros2</code>. However this package provides a few utilities and a newer version of Catch2 than Ubuntu does.</p>

<h4 id="components-1">Components</h4>
<p>Only 2 components are needed to create a unit test with this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#test-source-file">Test source file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/rolling/#unit-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="test-source-file">Test source file</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">source file for unit tests</a> can be written like any other <a href="https://github.com/catchorg/Catch2">Catch2</a> unit test.</p>

<h5 id="unit-cmake-setup">Unit CMake setup</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/CMakeLists.txt">CMake setup for unit testing</a> is pretty standard for adding a Catch2 test. The only thing of note is linking the source file with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>, which gives access to <code class="language-plaintext highlighter-rouge">catch_ros2</code> utilities and uses Catch2’s default main function. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(example_unit_test
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="utilities">Utilities</h4>
<p><code class="language-plaintext highlighter-rouge">catch_ros2</code> provides some utility functions for unit testing in ROS 2.</p>

<ul>
  <li>
<a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_ros2/arguments.hpp">Arguments</a> - utilities for handling command line arguments.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">SimulateArgs</code> - allows you to pass in a string or vector of strings representing command line arguments to create simulated <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code> values to pass into functions or <code class="language-plaintext highlighter-rouge">rclcpp::init()</code>.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/unit_test/example_unit_test.cpp">here</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for examples.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">SplitROSArgs</code> - removes ROS arguments from an input <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>, so these arguments won’t cause problems for other functions (like Catch2 sessions).
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">tokenize</code> - splits a command line string into a vector of strings, ignoring whitespace in quotation marks.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="selecting-a-main-function">Selecting a main function</h3>
<p>There are three options for a main function when using <code class="language-plaintext highlighter-rouge">catch_ros2</code>. Which option is selected depends on which library you link your target to - you should only link to one.</p>

<h4 id="1-default-node-main">1. Default Node Main</h4>
<p>This test node main function (defined <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">here</a>) is good for writing ROS 2 test nodes that use Catch2 (ex: for integration tests). It initializes the ROS context with the input arguments, removes the ROS arguments from the input list, runs the Catch session, then shuts down ROS.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>

<h4 id="2-default-catch2-main">2. Default Catch2 Main</h4>
<p>This main function is Catch2’s <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main function</a>, which is good for typical unit testing scenarios.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="3-defining-a-custom-main">3. Defining a custom main</h4>
<p>If neither of the above two options satisfy your needs, you can define your own custom main function. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/own-main.md">Catch2’s guidelines on this</a>. See <a href="https://github.com/ngmor/catch_ros2/tree/rolling/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</p>

<p>If you want your test to behave like a node, you can use <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/node_main.cpp">the <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main</a> as a starting point.</p>

<p>To define your own main but still use this library, link to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2
)

</code></pre></div></div>

<h2 id="catch2-version">Catch2 Version</h2>
<p>Currently this repository uses the <a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#how-to-migrate-projects-from-v2-to-v3">amalgamated version of Catch2</a> as a simple way of vendoring v3.5.4 of Catch2. Ubuntu 22.04 currently only provides Catch2 v2, which ROS 2 depends on, so we’ve made the decision to vendor v3 to be able to use the newest features. In the future, this approach may be abandoned for vendoring Catch2 v3 in its multiple header form.</p>

<p>In order to update the repository for a future release of Catch2 v3, simply copy the amalgamated <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.hpp">header</a> and <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.cpp">source</a> files from the Catch2 repository and replace those <a href="https://github.com/ngmor/catch_ros2/tree/rolling/include/catch_amalgamated.hpp">header</a> and <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/catch_amalgamated.cpp">source</a> files in this repository. The <a href="https://github.com/ngmor/catch_ros2/tree/rolling/src/default_main.cpp">default main</a> may also need to be updated.</p>

<p>However, since Ubuntu 24.04 provides Catch2 v3.4.0, we may standardize on this version to prevent the need for vendoring v3 for any ROS distros on 24.04. v3 would still be vendored for ROS distros on 22.04. Changes coming soon!</p>

<h2 id="license">License</h2>
<p>This package is released under the Apache-2.0 License. Catch2 is licensed under the BSL-1.0 License (see their repository for more details).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>
</div>
              <hr id="rolling-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="rolling-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#rolling-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#rolling-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#rolling-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="rolling-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="rolling-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="rolling-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/catch_ros2">catch_ros2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Catch2 testing framework for ROS 2 unit and integration tests.</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ngmor/catch_ros2.git">https://github.com/ngmor/catch_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">iron</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-05-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/catch_ros2/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/catch_ros2/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/catch_ros2">catch_ros2</a></td>
                    <td>0.2.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="catch_ros2">catch_ros2</h1>
<p>A lightweight wrapper around the <a href="https://github.com/catchorg/Catch2/">Catch2</a> testing framework for use with ROS 2.</p>

<p>This can be used for unit testing of ROS 2 related functionality or for integration tests to test the functionality of nodes in C++.</p>

<h2 id="installation">Installation</h2>
<p>To install Debian packages of <code class="language-plaintext highlighter-rouge">catch_ros2</code> simply run the following command (assuming your environment is properly <a href="https://docs.ros.org/en/rolling/Installation/Ubuntu-Install-Debians.html">set up for installing Debian packages</a>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-${ROS_DISTRO}-catch-ros2

</code></pre></div></div>
<p>Debian packages are currently available for Humble, Iron, Jazzy, and Rolling ROS 2 distributions.</p>

<p>To build the package from source, clone it into the <code class="language-plaintext highlighter-rouge">src</code> directory of your workspace root directory (<code class="language-plaintext highlighter-rouge">ws</code>). Then from <code class="language-plaintext highlighter-rouge">ws</code> use <code class="language-plaintext highlighter-rouge">colcon build</code>, like any other ROS 2 package.</p>

<h2 id="usage">Usage</h2>
<p>See the <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/">examples</a> section for guides on usage. This README provides an overview, but more details can be found in the links to example source code.</p>

<p>There are two basic ways to use this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#integration-testing">Integration testing</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#unit-testing">Unit testing</a></li>
</ol>

<p>You can also <a href="https://github.com/ngmor/catch_ros2/tree/iron/#selecting-a-main-function">customize further</a> if you need further control.</p>

<h3 id="integration-testing">Integration Testing</h3>
<p>Integration testing is an important way to ensure different elements of your system work together as desired. In ROS, we generally want to test that our nodes behave correctly, which may difficult with typical unit testing.</p>

<p>ROS 2 already contains a <a href="https://github.com/ros2/launch/tree/rolling/launch_testing">framework for writing integration tests in Python</a> which may be more than sufficient for most users. GTest can also be used to test C++ code within an integration test. However, to my knowledge, I have not seen an easy way to create integration tests in C++ with Catch2 - a simple to use but powerful C++ testing framework. The primary motivation of this package is to provide a framework for just that.</p>

<h4 id="components">Components</h4>
<p>For a launch integration test in this framework you need 4 components:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#nodes-under-test">Node(s) under test</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#testing-node">Testing node</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#launch-file">Launch file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#integration-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="nodes-under-test">Node(s) under test</h5>
<p>These are the nodes in your package whose functionality you’d like to test. Nothing special has to be done with these nodes to test them with this framework. This example has <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/integration_aux_node.cpp"><code class="language-plaintext highlighter-rouge">integration_aux_node</code></a> as the node under test.</p>

<h5 id="testing-node">Testing node</h5>
<p>This node is specifically written with Catch2 test cases and assertions to test the functionality of other nodes. The example has <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/integration_test_node.cpp"><code class="language-plaintext highlighter-rouge">integration_test_node</code></a> as the testing node.</p>

<p>If it is linked with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code> (see <a href="https://github.com/ngmor/catch_ros2/tree/iron/#integration-cmake-setup">CMake setup</a>) it does not require a <code class="language-plaintext highlighter-rouge">main</code> function and can be run just like any other ROS 2 node (<code class="language-plaintext highlighter-rouge">ros2 run ${package_name} ${executable_name}</code>). Tests can be executed manually by just running the node like this (along with other necessary nodes).</p>

<p>If more precise functionality beyond the <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/node_main.cpp">default node main</a> of this package is desired, see <a href="https://github.com/ngmor/catch_ros2/tree/iron/#selecting-a-main-function">selecting a main function</a>.</p>

<h5 id="launch-file">Launch file</h5>
<p>To automate the integration test, a <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/example_integration_test.launch.py">Python launch file</a> can be used to launch all the necessary nodes for the test, including the test node. An integration test can also be run manually by simply launching this launch file.</p>

<p>This launch file is the same as any other ROS 2 Python launch file, but the <code class="language-plaintext highlighter-rouge">launch_catch_ros2</code> Python module provides a few useful classes:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2LaunchDescription</code> - a wrapper around the typical <a href="https://github.com/ros2/launch/blob/rolling/launch/launch/launch_description.py"><code class="language-plaintext highlighter-rouge">launch.LaunchDescription</code></a> that includes a “result_file” argument where the results of the test will be output.</li>
  <li>
<code class="language-plaintext highlighter-rouge">Catch2IntegrationTestNode</code> - a wrapper around the typical <a href="https://github.com/ros2/launch_ros/blob/rolling/launch_ros/launch_ros/actions/node.py"><code class="language-plaintext highlighter-rouge">launch_ros.actions.Node</code></a> that passes the “result_file” argument to Catch2 (via the default <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main function) and shuts down all nodes on exit. This should be used to launch the <a href="https://github.com/ngmor/catch_ros2/tree/iron/#testing-node">testing node</a>. Only one should be used per integration test.</li>
</ul>

<p><a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/example_integration_test.launch.xml">XML</a> and <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/example_integration_test.launch.yaml">YAML</a> launch files can also be used - see the provided links for examples of the above same launch file implemented in those formats.</p>

<h5 id="integration-cmake-setup">Integration CMake setup</h5>
<p>Most of the <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/integration_test/CMakeLists.txt">CMake required for this integration test</a> is pretty standard for a ROS 2 package (though the ROS 2 boilerplate CMake is not shown in this example). Nodes are built/installed and the launch file is installed to the package’s share directory.</p>

<p>A few items are of note:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(integration_test_node
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>
<p>This links the integration test node with the version of <code class="language-plaintext highlighter-rouge">catch_ros2</code> that includes the <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/node_main.cpp">default main for running test nodes</a>. Only one version of the <code class="language-plaintext highlighter-rouge">catch_ros2</code> library need be linked to a target, depending on the need for a default main. See <a href="https://github.com/ngmor/catch_ros2/tree/iron/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catch_ros2_add_integration_test(ExampleIntegration_Test
  LAUNCH_FILE example_integration_test.launch.py
)

</code></pre></div></div>
<p>This custom CMake function is only necessary if the test should be run automatically whenever <code class="language-plaintext highlighter-rouge">colcon test</code> is run. See <a href="https://github.com/ngmor/catch_ros2/tree/iron/cmake/catch_ros2_add_integration_test.cmake">here</a> for documentation on the function.</p>

<h3 id="unit-testing">Unit Testing</h3>
<p>Unit testing is a good way to ensure specific elements of your package work well on their own. It’s important to ensure functionality is preserved in an ever-evolving codebase.</p>

<p>This package can also be used for unit testing with Catch2. Using Catch2 for unit testing of ROS 2 components is much more straightforward, and you may not need <code class="language-plaintext highlighter-rouge">catch_ros2</code>. However this package provides a few utilities and a newer version of Catch2 than Ubuntu does.</p>

<h4 id="components-1">Components</h4>
<p>Only 2 components are needed to create a unit test with this framework:</p>
<ol>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#test-source-file">Test source file</a></li>
  <li><a href="https://github.com/ngmor/catch_ros2/tree/iron/#unit-cmake-setup">CMake setup</a></li>
</ol>

<h5 id="test-source-file">Test source file</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/unit_test/example_unit_test.cpp">source file for unit tests</a> can be written like any other <a href="https://github.com/catchorg/Catch2">Catch2</a> unit test.</p>

<h5 id="unit-cmake-setup">Unit CMake setup</h5>
<p>The <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/unit_test/CMakeLists.txt">CMake setup for unit testing</a> is pretty standard for adding a Catch2 test. The only thing of note is linking the source file with <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>, which gives access to <code class="language-plaintext highlighter-rouge">catch_ros2</code> utilities and uses Catch2’s default main function. See <a href="https://github.com/ngmor/catch_ros2/tree/iron/#selecting-a-main-function">selecting a main function</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(example_unit_test
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="utilities">Utilities</h4>
<p><code class="language-plaintext highlighter-rouge">catch_ros2</code> provides some utility functions for unit testing in ROS 2.</p>

<ul>
  <li>
<a href="https://github.com/ngmor/catch_ros2/tree/iron/include/catch_ros2/arguments.hpp">Arguments</a> - utilities for handling command line arguments.
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">SimulateArgs</code> - allows you to pass in a string or vector of strings representing command line arguments to create simulated <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code> values to pass into functions or <code class="language-plaintext highlighter-rouge">rclcpp::init()</code>.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/unit_test/example_unit_test.cpp">here</a> and <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/custom_main/example_test_with_custom_main.cpp">here</a> for examples.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">SplitROSArgs</code> - removes ROS arguments from an input <code class="language-plaintext highlighter-rouge">argc</code> and <code class="language-plaintext highlighter-rouge">argv</code>, so these arguments won’t cause problems for other functions (like Catch2 sessions).
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/node_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">tokenize</code> - splits a command line string into a vector of strings, ignoring whitespace in quotation marks.
        <ul>
          <li>See <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="selecting-a-main-function">Selecting a main function</h3>
<p>There are three options for a main function when using <code class="language-plaintext highlighter-rouge">catch_ros2</code>. Which option is selected depends on which library you link your target to - you should only link to one.</p>

<h4 id="1-default-node-main">1. Default Node Main</h4>
<p>This test node main function (defined <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/node_main.cpp">here</a>) is good for writing ROS 2 test nodes that use Catch2 (ex: for integration tests). It initializes the ROS context with the input arguments, removes the ROS arguments from the input list, runs the Catch session, then shuts down ROS.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_node_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_node_main
)

</code></pre></div></div>

<h4 id="2-default-catch2-main">2. Default Catch2 Main</h4>
<p>This main function is Catch2’s <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/default_main.cpp">default main function</a>, which is good for typical unit testing scenarios.</p>

<p>You can use this main by linking to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2_with_main</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2_with_main
)

</code></pre></div></div>

<h4 id="3-defining-a-custom-main">3. Defining a custom main</h4>
<p>If neither of the above two options satisfy your needs, you can define your own custom main function. See <a href="https://github.com/catchorg/Catch2/blob/devel/docs/own-main.md">Catch2’s guidelines on this</a>. See <a href="https://github.com/ngmor/catch_ros2/tree/iron/examples/custom_main/example_test_with_custom_main.cpp">here</a> for an example.</p>

<p>If you want your test to behave like a node, you can use <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/node_main.cpp">the <code class="language-plaintext highlighter-rouge">catch_ros2</code> node main</a> as a starting point.</p>

<p>To define your own main but still use this library, link to <code class="language-plaintext highlighter-rouge">catch_ros2::catch_ros2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>target_link_libraries(${target_name}
  catch_ros2::catch_ros2
)

</code></pre></div></div>

<h2 id="catch2-version">Catch2 Version</h2>
<p>Currently this repository uses the <a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#how-to-migrate-projects-from-v2-to-v3">amalgamated version of Catch2</a> as a simple way of vendoring v3.5.4 of Catch2. Ubuntu 22.04 currently only provides Catch2 v2, which ROS 2 depends on, so we’ve made the decision to vendor v3 to be able to use the newest features. In the future, this approach may be abandoned for vendoring Catch2 v3 in its multiple header form.</p>

<p>In order to update the repository for a future release of Catch2 v3, simply copy the amalgamated <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.hpp">header</a> and <a href="https://github.com/catchorg/Catch2/blob/devel/extras/catch_amalgamated.cpp">source</a> files from the Catch2 repository and replace those <a href="https://github.com/ngmor/catch_ros2/tree/iron/include/catch_amalgamated.hpp">header</a> and <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/catch_amalgamated.cpp">source</a> files in this repository. The <a href="https://github.com/ngmor/catch_ros2/tree/iron/src/default_main.cpp">default main</a> may also need to be updated.</p>

<p>However, since Ubuntu 24.04 provides Catch2 v3.4.0, we may standardize on this version to prevent the need for vendoring v3 for any ROS distros on 24.04. v3 would still be vendored for ROS distros on 22.04. Changes coming soon!</p>

<h2 id="license">License</h2>
<p>This package is released under the Apache-2.0 License. Catch2 is licensed under the BSL-1.0 License (see their repository for more details).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<p>Any contribution that you make to this repository will
be under the Apache 2 License, as dictated by that
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">license</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5. Submission of Contributions. Unless You explicitly state otherwise,
   any Contribution intentionally submitted for inclusion in the Work
   by You to the Licensor shall be under the terms and conditions of
   this License, without any additional terms or conditions.
   Notwithstanding the above, nothing herein shall supersede or modify
   the terms of any separate license agreement you may have executed
   with Licensor regarding such Contributions.
</code></pre></div></div>
</div>
              <hr id="iron-contribute-lists">
              <ul class="nav nav-tabs nav-justified" id="iron-contribute-lists-tabs">
                <li class="better-tabs active">
                  <a href="#iron-contribute-lists-help-wanted" data-toggle="tab"><span class="contribute-lists-help-wanted-count label label-primary">0</span> Help Wanted</a>
                </li>
                <li class="better-tabs">
                  <a href="#iron-contribute-lists-good-first-issue" data-toggle="tab"><span class="contribute-lists-good-first-issue-count label label-primary">0</span> Good First Issue</a>
                </li>
                <li class="better-tabs">
                  <a href="#iron-contribute-lists-pull-requests" data-toggle="tab"><span class="contribute-lists-pull-requests-count label label-primary">0</span> Pull Requests to Review</a>
                </li>
              </ul>
              <div class="tab-content contribute-lists">
                <div class="tab-pane active" id="iron-contribute-lists-help-wanted">
                  <div class="contribute-lists-help-wanted"></div>
                </div>
                <div class="tab-pane" id="iron-contribute-lists-good-first-issue">
                  <div class="contribute-lists-good-first-issue"></div>
                </div>
                <div class="tab-pane" id="iron-contribute-lists-pull-requests">
                  <div class="contribute-lists-pull-requests"></div>
                </div>
              </div>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/catch_ros2">catch_ros2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ngmor-catch_ros2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ngmor-catch_ros2" role="menuitem" tabindex="-1" href="/r/catch_ros2/github-ngmor-catch_ros2" data="github-ngmor-catch_ros2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ngmor-catch_ros2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/ngmor/catch_ros2.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
