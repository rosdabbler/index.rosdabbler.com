<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/slam_toolbox/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">slam_toolbox</li>
        <!--<li class="active">slam_toolbox</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-primary" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class=" older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class=" older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">humble</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>2.6.10</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<table>
  <thead>
    <tr>
      <th>DockerHub</th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/cloud/build/stevemacenski/slam-toolbox.svg?label=build" alt="Build Status"></a></th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/pulls/stevemacenski/slam-toolbox.svg?maxAge=2592000" alt="Build Status"></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Build Farm</strong></td>
      <td><a href="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/"><img src="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/badge/icon" alt="Build Status"></a></td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<p>It is also the currently supported ROS2-SLAM library. See tutorials for working with it in <a href="https://navigation.ros.org/tutorials/docs/navigation2_with_slam.html">ROS2 Navigation here</a>.</p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://joss.theoj.org/papers/10.21105/joss.02783">here</a> and clicking on the image below.</p>

<blockquote>
  <p>Macenski, S., Jambrecic I., “SLAM Toolbox: SLAM for the dynamic world”, Journal of Open Source Software, 6(61), 2783, 2021.</p>
</blockquote>

<blockquote>
  <p>Macenski, S., “On Use of SLAM Toolbox, A fresh(er) look at mapping and localization for the dynamic world”, ROSCon 2019.</p>
</blockquote>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steve-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a>, maintained while at Samsung Research, and largely in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ real-time up to about 30,000 sq. ft. and 3x real-time up to about 60,000 sq. ft. with the largest area (I’m aware of) used was a 200,000 sq. ft. building in synchronous mode (i.e. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/humble//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<h1 id="support-and-contribution">Support and Contribution</h1>

<p>If you have any questions on use or configuration, please post your questions on <a href="https://github.com/SteveMacenski/slam_toolbox/tree/humble/answers.ros.org">ROS Answers</a> and someone from the community will work their hardest to get back to you. Tangible issues in the codebase or feature requests should be made with GitHub issues.</p>

<p>If you’re interested in contributing to this project in a substantial way, please file a public GitHub issue on your new feature / patch. If for some reason the development of this feature is sensitive, please email the maintainers at their email addresses listed in the <code class="language-plaintext highlighter-rouge">package.xml</code> file.</p>

<p>For all contributions, please properly fill in the GitHub issue and PR templates with all necessary context. All PRs must be passing CI and maintaining ABI compatibility within released ROS distributions. A maintainer will follow up shortly thereafter.</p>

<h1 id="03232021-note-on-serialized-files">03/23/2021 Note On Serialized Files</h1>

<p>As of 03/23/2021, the contents of the serialized files has changed. For all new users after this date, this regard this section it does not impact you.</p>

<p>If you have previously existing serialized files (e.g. not <code class="language-plaintext highlighter-rouge">pgm</code> maps, but <code class="language-plaintext highlighter-rouge">.posegraph</code> serialized slam sessions), after this date, you may need to take some action to maintain current features. Unfortunately, an ABI breaking change was required to be made in order to fix a very large bug affecting any 360 or non-axially-mounted LIDAR system.</p>

<p><a href="https://discourse.ros.org/t/request-for-input-potential-existing-slam-toolbox-serialized-file-invalidation/19520">This Discourse post</a> highlights the issues. The frame storing the scan data for the optimizer was incorrect leading to explosions or flipping of maps for 360 and non-axially-aligned robots when using conservative loss functions. This change permanently fixes this issue, however it changes the frame of reference that this data is stored and serialized in. If your system as a non-360 lidar and it is mounted with its frame aligned with the robot base frame, you’re unlikely to notice a problem and can disregard this statement. For all others noticing issues, you have the following options:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel-unfixed</code> branch rather than <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel</code>, which contains the unfixed version of this distribution’s release which will be maintained in parallel to the main branches to have an option to continue with your working solution</li>
  <li>Convert your serialized files into the new reference frame with an offline utility</li>
  <li>Take the raw data and rerun the SLAM sessions to get a new serialized file with the right content</li>
</ul>

<p>More of the conversation can be seen on tickets #198 and #281. I apologize for the inconvenience, however this solves a very large bug that was impacting a large number of users. I’ve worked hard to make sure there’s a viable path forward for everyone.</p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitialization</li>
  <li>pose-graph optimization based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartoprapher, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartoprapher is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programmatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refined local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satisfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving. This method of localization might not be suitable for all applications, it does require quite a bit of tuning for your particular robot and needs high quality odometry. If in doubt, you’re always welcome to use other 2D map localizers in the ecosystem like AMCL. For most beginners or users looking for a good out of the box experience, I’d recommend AMCL.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/humble//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hard set in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (i.e. likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>/scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map</td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency</td>
    </tr>
    <tr>
      <td>pose</td>
      <td><code class="language-plaintext highlighter-rouge">geometry_msgs/PoseWithCovarianceStamped</code></td>
      <td>pose of the base_frame in the configured map_frame along with the covariance calculated from the scan match</td>
    </tr>
  </tbody>
</table>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line search strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">scan_topic</code> - scan topic, <em>absolute</em> path, i.e. <code class="language-plaintext highlighter-rouge">/scan</code> not <code class="language-plaintext highlighter-rouge">scan</code></p>

<p><code class="language-plaintext highlighter-rouge">scan_queue_size</code> - The number of scan messages to queue up before throwing away old ones. Should always be set to 1 in async mode</p>

<p><code class="language-plaintext highlighter-rouge">use_map_saver</code> - Instantiate the map saver service and self-subscribe to the map topic</p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">position_covariance_scale</code> - Amount to scale position covariance when publishing pose from scan match.  This can be used to tune the influence of the pose position in a downstream localization filter.  The covariance represents the uncertainty of the measurement, so scaling up the covariance will result in the pose position having less influence on downstream filters.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">yaw_covariance_scale</code> - Amount to scale yaw covariance when publishing pose from scan match.  See description of position_covariance_scale.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">min_laser_range</code> - Minimum laser range to use for 2D occupancy map rasterizing</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rasterizing</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorithm</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<p><code class="language-plaintext highlighter-rouge">min_pass_through</code> - Number of beams that must pass through a cell before it will be considered to be occupied or unoccupied. This prevents stray beams from messing up the map.</p>

<p><code class="language-plaintext highlighter-rouge">occupancy_threshold</code> - Minimum ratio of beams hitting cell to beams passing through cell to be marked as occupied</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Or install via apt</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-eloquent-slam-toolbox

</code></pre></div></div>

<p>Run your colcon build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">ros2 launch slam_toolbox online_sync_launch.py</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a separate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/humble//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">jazzy</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-15
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>2.8.3</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<p>It is also the currently supported ROS2-SLAM library. See tutorials for working with it in <a href="https://docs.nav2.org/tutorials/docs/navigation2_with_slam.html">ROS 2 Nav2 here</a>.</p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://joss.theoj.org/papers/10.21105/joss.02783">here</a> and clicking on the image below.</p>

<blockquote>
  <p>Macenski, S., Jambrecic I., “SLAM Toolbox: SLAM for the dynamic world”, Journal of Open Source Software, 6(61), 2783, 2021.</p>
</blockquote>

<blockquote>
  <p>Macenski, S., “On Use of SLAM Toolbox, A fresh(er) look at mapping and localization for the dynamic world”, ROSCon 2019.</p>
</blockquote>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steve-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a>, maintained while at Samsung Research, and largely in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ real-time up to about 30,000 sq. ft. and 3x real-time up to about 60,000 sq. ft. with the largest area (I’m aware of) used was a 200,000 sq. ft. building in synchronous mode (i.e. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/jazzy//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>An overview of how the map was generated is presented below:
<img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/jazzy//images/slam_toolbox_sync.png" alt="slam_toolbox_sync_diagram"></p>
<ol>
  <li>ROS Node: SLAM toolbox is run in synchronous mode, which generates a ROS node. This node subscribes to laser scan and odometry topics, and publishes map to odom transform and a map.</li>
  <li>Get odometry and LIDAR data: A callback for the laser topic will generate a pose (using odometry) and a laser scan tied at that node. These PosedScan objects form a queue, which are processed by the algorithm.</li>
  <li>Process Data: The queue of PosedScan objects are used to construct a pose graph; odometry is refined using laser scan matching. This pose graph is used to compute robot pose, and find loop closures. If a loop closure is found, the pose graph is optimized, and pose estimates are updated. Pose estimates are used to compute and publish a map to odom transform for the robot.</li>
  <li>Mapping: Laser scans associated with each pose in the pose graph are used to construct and publish a map.</li>
</ol>

<h1 id="support-and-contribution">Support and Contribution</h1>

<p>If you have any questions on use or configuration, please post your questions on <a href="https://github.com/SteveMacenski/slam_toolbox/tree/jazzy/answers.ros.org">ROS Answers</a> and someone from the community will work their hardest to get back to you. Tangible issues in the codebase or feature requests should be made with GitHub issues.</p>

<p>If you’re interested in contributing to this project in a substantial way, please file a public GitHub issue on your new feature / patch. If for some reason the development of this feature is sensitive, please email the maintainers at their email addresses listed in the <code class="language-plaintext highlighter-rouge">package.xml</code> file.</p>

<p>For all contributions, please properly fill in the GitHub issue and PR templates with all necessary context. All PRs must be passing CI and maintaining ABI compatibility within released ROS distributions. A maintainer will follow up shortly thereafter.</p>

<h1 id="03232021-note-on-serialized-files">03/23/2021 Note On Serialized Files</h1>

<p>As of 03/23/2021, the contents of the serialized files has changed. For all new users after this date, this regard this section it does not impact you.</p>

<p>If you have previously existing serialized files (e.g. not <code class="language-plaintext highlighter-rouge">pgm</code> maps, but <code class="language-plaintext highlighter-rouge">.posegraph</code> serialized slam sessions), after this date, you may need to take some action to maintain current features. Unfortunately, an ABI breaking change was required to be made in order to fix a very large bug affecting any 360 or non-axially-mounted LIDAR system.</p>

<p><a href="https://discourse.ros.org/t/request-for-input-potential-existing-slam-toolbox-serialized-file-invalidation/19520">This Discourse post</a> highlights the issues. The frame storing the scan data for the optimizer was incorrect leading to explosions or flipping of maps for 360 and non-axially-aligned robots when using conservative loss functions. This change permanently fixes this issue, however it changes the frame of reference that this data is stored and serialized in. If your system as a non-360 lidar and it is mounted with its frame aligned with the robot base frame, you’re unlikely to notice a problem and can disregard this statement. For all others noticing issues, you have the following options:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel-unfixed</code> branch rather than <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel</code>, which contains the unfixed version of this distribution’s release which will be maintained in parallel to the main branches to have an option to continue with your working solution</li>
  <li>Convert your serialized files into the new reference frame with an offline utility</li>
  <li>Take the raw data and rerun the SLAM sessions to get a new serialized file with the right content</li>
</ul>

<p>More of the conversation can be seen on tickets #198 and #281. I apologize for the inconvenience, however this solves a very large bug that was impacting a large number of users. I’ve worked hard to make sure there’s a viable path forward for everyone.</p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitialization</li>
  <li>pose-graph optimization based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartographer, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartographer is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programmatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refined local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satisfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving. This method of localization might not be suitable for all applications, it does require quite a bit of tuning for your particular robot and needs high quality odometry. If in doubt, you’re always welcome to use other 2D map localizers in the ecosystem like AMCL. For most beginners or users looking for a good out of the box experience, I’d recommend AMCL.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/jazzy//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hard set in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (i.e. likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>/scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map</td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency</td>
    </tr>
    <tr>
      <td>pose</td>
      <td><code class="language-plaintext highlighter-rouge">geometry_msgs/PoseWithCovarianceStamped</code></td>
      <td>pose of the base_frame in the configured map_frame along with the covariance calculated from the scan match</td>
    </tr>
  </tbody>
</table>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/reset</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Reset</code></td>
      <td>Reset current map back to the initial state</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line search strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">scan_topic</code> - scan topic, <em>absolute</em> path, i.e. <code class="language-plaintext highlighter-rouge">/scan</code> not <code class="language-plaintext highlighter-rouge">scan</code></p>

<p><code class="language-plaintext highlighter-rouge">scan_queue_size</code> - The number of scan messages to queue up before throwing away old ones. Should always be set to 1 in async mode</p>

<p><code class="language-plaintext highlighter-rouge">use_map_saver</code> - Instantiate the map saver service and self-subscribe to the map topic</p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">position_covariance_scale</code> - Amount to scale position covariance when publishing pose from scan match.  This can be used to tune the influence of the pose position in a downstream localization filter.  The covariance represents the uncertainty of the measurement, so scaling up the covariance will result in the pose position having less influence on downstream filters.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">yaw_covariance_scale</code> - Amount to scale yaw covariance when publishing pose from scan match.  See description of position_covariance_scale.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rasterizing</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<p><code class="language-plaintext highlighter-rouge">localization_on_configure</code> - Set to true to set the localization mode to localization during node on_configure transition. Set to false to set the localization mode to mapping instead. Only applies to <code class="language-plaintext highlighter-rouge">map_and_localization_slam_toolbox</code> node.</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorithm</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<p><code class="language-plaintext highlighter-rouge">min_pass_through</code> - Number of beams that must pass through a cell before it will be considered to be occupied or unoccupied. This prevents stray beams from messing up the map.</p>

<p><code class="language-plaintext highlighter-rouge">occupancy_threshold</code> - Minimum ratio of beams hitting cell to beams passing through cell to be marked as occupied</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Or install via apt</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-jazzy-slam-toolbox

</code></pre></div></div>

<p>Run your colcon build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">ros2 launch slam_toolbox online_sync_launch.py</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a separate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/jazzy//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox_msgs">slam_toolbox_msgs</a>
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox_rviz">slam_toolbox_rviz</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">noetic-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-01-21
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#noetic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#noetic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#noetic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>1.5.7</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/slam_toolbox_msgs">slam_toolbox_msgs</a></td>
                    <td>1.5.7</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/slam_toolbox_rviz">slam_toolbox_rviz</a></td>
                    <td>1.5.7</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<table>
  <thead>
    <tr>
      <th>DockerHub</th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/cloud/build/stevemacenski/slam-toolbox.svg?label=build" alt="Build Status"></a></th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/pulls/stevemacenski/slam-toolbox.svg?maxAge=2592000" alt="Build Status"></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Build Farm</strong></td>
      <td><a href="http://build.ros.org/view/Kbin_uX64/job/Mdev__slam_toolbox__ubuntu_bionic_amd64/"><img src="http://build.ros.org/buildStatus/icon?job=Mdev__slam_toolbox__ubuntu_bionic_amd64" alt="Build Status"></a></td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://joss.theoj.org/papers/10.21105/joss.02783">here</a> and clicking on the image below.</p>

<blockquote>
  <p>Macenski, S., Jambrecic I., “SLAM Toolbox: SLAM for the dynamic world”, Journal of Open Source Software, 6(61), 2783, 2021.</p>
</blockquote>

<blockquote>
  <p>Macenski, S., “On Use of SLAM Toolbox, A fresh(er) look at mapping and localization for the dynamic world”, ROSCon 2019.</p>
</blockquote>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steven-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a> and in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap or from the build farm: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ realtime up to about 30,000 sqft and 3x realtime up to about 60,000 sqft. with the largest area (I’m aware of) used was a 200,000 sq.ft. building in synchronous mode (e.i. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work. This data is currently available upon request, but its going to be included in a larger open-source dataset down the line.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/noetic-devel//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>An overview of how the map was generated is presented below:
<img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/noetic-devel//images/slam_toolbox_sync.png" alt="slam_toolbox_sync_diagram"></p>
<ol>
  <li>ROS Node: SLAM toolbox is run in synchronous mode, which generates a ROS node. This node subscribes to laser scan and odometry topics, and publishes map to odom transform and a map.</li>
  <li>Get odometry and LIDAR data: A callback for the laser topic will generate a pose (using odometry) and a laser scan tied at that node. These PosedScan objects form a queue, which are processed by the algorithm.</li>
  <li>Process Data: The queue of PosedScan objects are used to construct a pose graph; odometry is refined using laser scan matching. This pose graph is used to compute robot pose, and find loop closures. If a loop closure is found, the pose graph is optimized, and pose estimates are updated. Pose estimates are used to compute and publish a map to odom transform for the robot.</li>
  <li>Mapping: Laser scans associated with each pose in the pose graph are used to construct and publish a map.</li>
</ol>

<h1 id="03232021-note-on-serialized-files">03/23/2021 Note On Serialized Files</h1>

<p>As of 03/23/2021, the contents of the serialized files has changed. For all new users after this date, this regard this section it does not impact you.</p>

<p>If you have previously existing serialized files (e.g. not <code class="language-plaintext highlighter-rouge">pgm</code> maps, but <code class="language-plaintext highlighter-rouge">.posegraph</code> serialized slam sessions), after this date, you may need to take some action to maintain current features. Unfortunately, an ABI breaking change was required to be made in order to fix a very large bug affecting any 360 or non-axially-mounted LIDAR system.</p>

<p><a href="https://discourse.ros.org/t/request-for-input-potential-existing-slam-toolbox-serialized-file-invalidation/19520">This Discourse post</a> highlights the issues. The frame storing the scan data for the optimizer was incorrect leading to explosions or flipping of maps for 360 and non-axially-aligned robots when using conservative loss functions. This change permanently fixes this issue, however it changes the frame of reference that this data is stored and serialized in. If your system as a non-360 lidar and it is mounted with its frame aligned with the robot base frame, you’re unlikely to notice a problem and can disregard this statement. For all others noticing issues, you have the following options:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel-unfixed</code> branch rather than <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel</code>, which contains the unfixed version of this distribution’s release which will be maintained in parallel to the main branches to have an option to continue with your working solution</li>
  <li>Convert your serialized files into the new reference frame with an offline utility</li>
  <li>Take the raw data and rerun the SLAM sessions to get a new serialized file with the right content</li>
</ul>

<p>More of the conversation can be seen on tickets #198 and #281. I apologize for the inconvenience, however this solves a very large bug that was impacting a large number of users. I’ve worked hard to make sure there’s a viable path forward for everyone.</p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitalization</li>
  <li>pose-graph optimizition based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartoprapher, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartoprapher is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refind local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satesfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h4 id="pose-graph-merging">Pose Graph Merging</h4>

<p>This is under development.</p>

<p>This is to solve the problem of merging many maps together with an initial guess of location in an elastic sense. This is something you just can’t get if you don’t have the full pose-graph and raw data to work with – which we have from our continuous mapping work.</p>

<p>Hint: This is also really good for multi-robot map updating as well :)</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/noetic-devel//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hardset in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (ie likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map</td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency</td>
    </tr>
    <tr>
      <td>pose</td>
      <td><code class="language-plaintext highlighter-rouge">geometry_msgs/PoseWithCovarianceStamped</code></td>
      <td>pose of the base_frame in the configured map_frame along with the covariance calculated from the scan match</td>
    </tr>
  </tbody>
</table>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line searach strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">position_covariance_scale</code> - Amount to scale position covariance when publishing pose from scan match.  This can be used to tune the influence of the pose position in a downstream localization filter.  The covariance represents the uncertainty of the measurement, so scaling up the covariance will result in the pose position having less influence on downstream filters.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">yaw_covariance_scale</code> - Amount to scale yaw covariance when publishing pose from scan match.  See description of position_covariance_scale.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rastering</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorith</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Also released in Melodic / Dashing to the ROS build farm to install debians.</p>

<p>Run your catkin build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">roslaunch slam_toolbox online_sync.launch</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a seperate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap. There’s a generate snap script in the <code class="language-plaintext highlighter-rouge">snap</code> directory to create a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/noetic-devel//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">galactic</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2022-09-23
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#galactic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#galactic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#galactic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>2.5.1</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<table>
  <thead>
    <tr>
      <th>DockerHub</th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/cloud/build/stevemacenski/slam-toolbox.svg?label=build" alt="Build Status"></a></th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/pulls/stevemacenski/slam-toolbox.svg?maxAge=2592000" alt="Build Status"></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Build Farm</strong></td>
      <td><a href="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/"><img src="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/badge/icon" alt="Build Status"></a></td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<p>It is also the currently supported ROS2-SLAM library. See tutorials for working with it in <a href="https://navigation.ros.org/tutorials/docs/navigation2_with_slam.html">ROS2 Navigation here</a>.</p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://joss.theoj.org/papers/10.21105/joss.02783">here</a> and clicking on the image below.</p>

<blockquote>
  <p>Macenski, S., Jambrecic I., “SLAM Toolbox: SLAM for the dynamic world”, Journal of Open Source Software, 6(61), 2783, 2021.</p>
</blockquote>

<blockquote>
  <p>Macenski, S., “On Use of SLAM Toolbox, A fresh(er) look at mapping and localization for the dynamic world”, ROSCon 2019.</p>
</blockquote>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steve-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a>, maintained while at Samsung Research, and largely in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ realtime up to about 30,000 sqft and 3x realtime up to about 60,000 sqft. with the largest area (I’m aware of) used was a 200,000 sq.ft. building in synchronous mode (e.i. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work. This data is currently available upon request, but its going to be included in a larger open-source dataset down the line.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/galactic//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<h1 id="support-and-contribution">Support and Contribution</h1>

<p>If you have any questions on use or configuration, please post your questions on <a href="https://github.com/SteveMacenski/slam_toolbox/tree/galactic/answers.ros.org">ROS Answers</a> and someone from the community will work their hardest to get back to you. Tangible issues in the codebase or feature requests should be made with GitHub issues.</p>

<p>If you’re interested in contributing to this project in a substantial way, please file a public GitHub issue on your new feature / patch. If for some reason the development of this feature is sensitive, please email the maintainers at their email addresses listed in the <code class="language-plaintext highlighter-rouge">package.xml</code> file.</p>

<p>For all contributions, please properly fill in the GitHub issue and PR templates with all necessary context. All PRs must be passing CI and maintaining ABI compatibility within released ROS distributions. A maintainer will follow up shortly thereafter.</p>

<h1 id="03232021-note-on-serialized-files">03/23/2021 Note On Serialized Files</h1>

<p>As of 03/23/2021, the contents of the serialized files has changed. For all new users after this date, this regard this section it does not impact you.</p>

<p>If you have previously existing serialized files (e.g. not <code class="language-plaintext highlighter-rouge">pgm</code> maps, but <code class="language-plaintext highlighter-rouge">.posegraph</code> serialized slam sessions), after this date, you may need to take some action to maintain current features. Unfortunately, an ABI breaking change was required to be made in order to fix a very large bug affecting any 360 or non-axially-mounted LIDAR system.</p>

<p><a href="https://discourse.ros.org/t/request-for-input-potential-existing-slam-toolbox-serialized-file-invalidation/19520">This Discourse post</a> highlights the issues. The frame storing the scan data for the optimizer was incorrect leading to explosions or flipping of maps for 360 and non-axially-aligned robots when using conservative loss functions. This change permanently fixes this issue, however it changes the frame of reference that this data is stored and serialized in. If your system as a non-360 lidar and it is mounted with its frame aligned with the robot base frame, you’re unlikely to notice a problem and can disregard this statement. For all others noticing issues, you have the following options:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel-unfixed</code> branch rather than <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel</code>, which contains the unfixed version of this distribution’s release which will be maintained in parallel to the main branches to have an option to continue with your working solution</li>
  <li>Convert your serialized files into the new reference frame with an offline utility</li>
  <li>Take the raw data and rerun the SLAM sessions to get a new serialized file with the right content</li>
</ul>

<p>More of the conversation can be seen on tickets #198 and #281. I apologize for the inconvenience, however this solves a very large bug that was impacting a large number of users. I’ve worked hard to make sure there’s a viable path forward for everyone.</p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitalization</li>
  <li>pose-graph optimizition based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartoprapher, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartoprapher is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refind local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satesfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving. This method of localization might not be suitable for all applications, it does require quite a bit of tuning for your particular robot and needs high quality odometry. If in doubt, you’re always welcome to use other 2D map localizers in the ecosystem like AMCL. For most beginners or users looking for a good out of the box experience, I’d recommend AMCL.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/galactic//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hardset in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (ie likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>/scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map</td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency</td>
    </tr>
    <tr>
      <td>pose</td>
      <td><code class="language-plaintext highlighter-rouge">geometry_msgs/PoseWithCovarianceStamped</code></td>
      <td>pose of the base_frame in the configured map_frame along with the covariance calculated from the scan match</td>
    </tr>
  </tbody>
</table>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line searach strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">scan_topic</code> - scan topic, <em>absolute</em> path, ei <code class="language-plaintext highlighter-rouge">/scan</code> not <code class="language-plaintext highlighter-rouge">scan</code></p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">position_covariance_scale</code> - Amount to scale position covariance when publishing pose from scan match.  This can be used to tune the influence of the pose position in a downstream localization filter.  The covariance represents the uncertainty of the measurement, so scaling up the covariance will result in the pose position having less influence on downstream filters.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">yaw_covariance_scale</code> - Amount to scale yaw covariance when publishing pose from scan match.  See description of position_covariance_scale.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rastering</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorith</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Or install via apt</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-eloquent-slam-toolbox

</code></pre></div></div>

<p>Run your colcon build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">ros2 launch slam_toolbox online_sync_launch.py</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a seperate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/galactic//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">iron</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-01-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>2.7.4</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<table>
  <thead>
    <tr>
      <th>DockerHub</th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/cloud/build/stevemacenski/slam-toolbox.svg?label=build" alt="Build Status"></a></th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/pulls/stevemacenski/slam-toolbox.svg?maxAge=2592000" alt="Build Status"></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Build Farm</strong></td>
      <td><a href="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/"><img src="http://build.ros2.org/job/Ddev__slam_toolbox__ubuntu_bionic_amd64/badge/icon" alt="Build Status"></a></td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<p>It is also the currently supported ROS2-SLAM library. See tutorials for working with it in <a href="https://navigation.ros.org/tutorials/docs/navigation2_with_slam.html">ROS2 Navigation here</a>.</p>

<h3 id="cite-this-work">Cite This Work</h3>

<p>You can find this work <a href="https://joss.theoj.org/papers/10.21105/joss.02783">here</a> and clicking on the image below.</p>

<blockquote>
  <p>Macenski, S., Jambrecic I., “SLAM Toolbox: SLAM for the dynamic world”, Journal of Open Source Software, 6(61), 2783, 2021.</p>
</blockquote>

<blockquote>
  <p>Macenski, S., “On Use of SLAM Toolbox, A fresh(er) look at mapping and localization for the dynamic world”, ROSCon 2019.</p>
</blockquote>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steve-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a>, maintained while at Samsung Research, and largely in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ real-time up to about 30,000 sq. ft. and 3x real-time up to about 60,000 sq. ft. with the largest area (I’m aware of) used was a 200,000 sq. ft. building in synchronous mode (i.e. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/iron//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>An overview of how the map was generated is presented below:
<img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/iron//images/slam_toolbox_sync.png" alt="slam_toolbox_sync_diagram"></p>
<ol>
  <li>ROS Node: SLAM toolbox is run in synchronous mode, which generates a ROS node. This node subscribes to laser scan and odometry topics, and publishes map to odom transform and a map.</li>
  <li>Get odometry and LIDAR data: A callback for the laser topic will generate a pose (using odometry) and a laser scan tied at that node. These PosedScan objects form a queue, which are processed by the algorithm.</li>
  <li>Process Data: The queue of PosedScan objects are used to construct a pose graph; odometry is refined using laser scan matching. This pose graph is used to compute robot pose, and find loop closures. If a loop closure is found, the pose graph is optimized, and pose estimates are updated. Pose estimates are used to compute and publish a map to odom transform for the robot.</li>
  <li>Mapping: Laser scans associated with each pose in the pose graph are used to construct and publish a map.</li>
</ol>

<h1 id="support-and-contribution">Support and Contribution</h1>

<p>If you have any questions on use or configuration, please post your questions on <a href="https://github.com/SteveMacenski/slam_toolbox/tree/iron/answers.ros.org">ROS Answers</a> and someone from the community will work their hardest to get back to you. Tangible issues in the codebase or feature requests should be made with GitHub issues.</p>

<p>If you’re interested in contributing to this project in a substantial way, please file a public GitHub issue on your new feature / patch. If for some reason the development of this feature is sensitive, please email the maintainers at their email addresses listed in the <code class="language-plaintext highlighter-rouge">package.xml</code> file.</p>

<p>For all contributions, please properly fill in the GitHub issue and PR templates with all necessary context. All PRs must be passing CI and maintaining ABI compatibility within released ROS distributions. A maintainer will follow up shortly thereafter.</p>

<h1 id="03232021-note-on-serialized-files">03/23/2021 Note On Serialized Files</h1>

<p>As of 03/23/2021, the contents of the serialized files has changed. For all new users after this date, this regard this section it does not impact you.</p>

<p>If you have previously existing serialized files (e.g. not <code class="language-plaintext highlighter-rouge">pgm</code> maps, but <code class="language-plaintext highlighter-rouge">.posegraph</code> serialized slam sessions), after this date, you may need to take some action to maintain current features. Unfortunately, an ABI breaking change was required to be made in order to fix a very large bug affecting any 360 or non-axially-mounted LIDAR system.</p>

<p><a href="https://discourse.ros.org/t/request-for-input-potential-existing-slam-toolbox-serialized-file-invalidation/19520">This Discourse post</a> highlights the issues. The frame storing the scan data for the optimizer was incorrect leading to explosions or flipping of maps for 360 and non-axially-aligned robots when using conservative loss functions. This change permanently fixes this issue, however it changes the frame of reference that this data is stored and serialized in. If your system as a non-360 lidar and it is mounted with its frame aligned with the robot base frame, you’re unlikely to notice a problem and can disregard this statement. For all others noticing issues, you have the following options:</p>
<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel-unfixed</code> branch rather than <code class="language-plaintext highlighter-rouge">&lt;distro&gt;-devel</code>, which contains the unfixed version of this distribution’s release which will be maintained in parallel to the main branches to have an option to continue with your working solution</li>
  <li>Convert your serialized files into the new reference frame with an offline utility</li>
  <li>Take the raw data and rerun the SLAM sessions to get a new serialized file with the right content</li>
</ul>

<p>More of the conversation can be seen on tickets #198 and #281. I apologize for the inconvenience, however this solves a very large bug that was impacting a large number of users. I’ve worked hard to make sure there’s a viable path forward for everyone.</p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitialization</li>
  <li>pose-graph optimization based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartographer, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartographer is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programmatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refined local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satisfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving. This method of localization might not be suitable for all applications, it does require quite a bit of tuning for your particular robot and needs high quality odometry. If in doubt, you’re always welcome to use other 2D map localizers in the ecosystem like AMCL. For most beginners or users looking for a good out of the box experience, I’d recommend AMCL.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/iron//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hard set in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (i.e. likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>/scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map</td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency</td>
    </tr>
    <tr>
      <td>pose</td>
      <td><code class="language-plaintext highlighter-rouge">geometry_msgs/PoseWithCovarianceStamped</code></td>
      <td>pose of the base_frame in the configured map_frame along with the covariance calculated from the scan match</td>
    </tr>
  </tbody>
</table>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line search strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">scan_topic</code> - scan topic, <em>absolute</em> path, i.e. <code class="language-plaintext highlighter-rouge">/scan</code> not <code class="language-plaintext highlighter-rouge">scan</code></p>

<p><code class="language-plaintext highlighter-rouge">scan_queue_size</code> - The number of scan messages to queue up before throwing away old ones. Should always be set to 1 in async mode</p>

<p><code class="language-plaintext highlighter-rouge">use_map_saver</code> - Instantiate the map saver service and self-subscribe to the map topic</p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">position_covariance_scale</code> - Amount to scale position covariance when publishing pose from scan match.  This can be used to tune the influence of the pose position in a downstream localization filter.  The covariance represents the uncertainty of the measurement, so scaling up the covariance will result in the pose position having less influence on downstream filters.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">yaw_covariance_scale</code> - Amount to scale yaw covariance when publishing pose from scan match.  See description of position_covariance_scale.  Default: 1.0</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rasterizing</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorithm</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Or install via apt</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install ros-eloquent-slam-toolbox

</code></pre></div></div>

<p>Run your colcon build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">ros2 launch slam_toolbox online_sync_launch.py</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a separate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/iron//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/slam_toolbox">slam_toolbox</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox">slam_toolbox</a>
        
        <a class="label label-primary pkg-label" href="/p/slam_toolbox_msgs">slam_toolbox_msgs</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-SteveMacenski-slam_toolbox
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-SteveMacenski-slam_toolbox" role="menuitem" tabindex="-1" href="/r/slam_toolbox/github-SteveMacenski-slam_toolbox" data="github-SteveMacenski-slam_toolbox">
                    <span class="glyphicon glyphicon-star"></span>
                    github-SteveMacenski-slam_toolbox
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Slam Toolbox for lifelong mapping and localization in potentially massive maps with ROS</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/SteveMacenski/slam_toolbox.git">https://github.com/SteveMacenski/slam_toolbox.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">melodic-devel</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-01-10
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/slam_toolbox/#melodic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#melodic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/slam_toolbox/#melodic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/slam_toolbox">slam_toolbox</a></td>
                    <td>1.1.6</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/slam_toolbox_msgs">slam_toolbox_msgs</a></td>
                    <td>1.1.6</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="slam-toolbox">Slam Toolbox</h2>

<table>
  <thead>
    <tr>
      <th>DockerHub</th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/cloud/build/stevemacenski/slam-toolbox.svg?label=build" alt="Build Status"></a></th>
      <th><a href="https://hub.docker.com/r/stevemacenski/slam-toolbox"><img src="https://img.shields.io/docker/pulls/stevemacenski/slam-toolbox.svg?maxAge=2592000" alt="Build Status"></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Build Farm</strong></td>
      <td><a href="http://build.ros.org/view/Kbin_uX64/job/Mdev__slam_toolbox__ubuntu_bionic_amd64/"><img src="http://build.ros.org/buildStatus/icon?job=Mdev__slam_toolbox__ubuntu_bionic_amd64" alt="Build Status"></a></td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>

<p>We’ve received feedback from users and have robots operating in the following environments with SLAM Toolbox:</p>
<ul>
  <li>Retail</li>
  <li>Warehouses</li>
  <li>Libraries</li>
  <li>Research</li>
</ul>

<p><a href="https://vimeo.com/378682207"><img src="https://user-images.githubusercontent.com/14944147/74176653-f69beb80-4bec-11ea-906a-a233541a6064.png" alt="IMAGE ALT TEXT"></a></p>

<h1 id="introduction">Introduction</h1>

<p>Slam Toolbox is a set of tools and capabilities for 2D SLAM built by <a href="https://www.linkedin.com/in/steven-macenski-41a985101">Steve Macenski</a> while at <a href="https://www.simberobotics.com/">Simbe Robotics</a> and in his free time.</p>

<p>This project contains the ability to do most everything any other available SLAM library, both free and paid, and more. This includes:</p>
<ul>
  <li>Ordinary point-and-shoot 2D SLAM mobile robotics folks expect (start, map, save pgm file) with some nice built in utilities like saving maps</li>
  <li>Continuing to refine, remap, or continue mapping a saved (serialized) pose-graph at any time</li>
  <li>life-long mapping: load a saved pose-graph continue mapping in a space while also removing extraneous information from newly added scans</li>
  <li>an optimization-based localization mode built on the pose-graph. Optionally run localization mode without a prior map for “lidar odometry” mode with local loop closures</li>
  <li>synchronous and asynchronous modes of mapping</li>
  <li>kinematic map merging (with an elastic graph manipulation merging technique in the works)</li>
  <li>plugin-based optimization solvers with a new optimized Google Ceres based plugin</li>
  <li>RVIZ plugin for interacting with the tools</li>
  <li>graph manipulation tools in RVIZ to manipulate nodes and connections during mapping</li>
  <li>Map serialization and lossless data storage</li>
  <li>… more but those are the highlights</li>
</ul>

<p>For running on live production robots, I recommend using the snap or from the build farm: slam-toolbox, it has optimizations in it that make it about 10x faster. You need the deb/source install for the other developer level tools that don’t need to be on the robot (rviz plugins, etc).</p>

<p>This package has been benchmarked mapping building at 5x+ realtime up to about 30,000 sqft and 3x realtime up to about 60,000 sqft. with the largest area (I’m aware of) used was a 200,000 sq.ft. building in synchronous mode (e.i. processing all scans, regardless of lag), and <em>much</em> larger spaces in asynchronous mode.</p>

<p>The video below was collected at <a href="https://www.circuitlaunch.com/">Circuit Launch</a> in Oakland, California. Thanks to <a href="https://svrobo.org/">Silicon Valley Robotics</a> &amp; Circuit Launch for being a testbed for some of this work. This data is currently available upon request, but its going to be included in a larger open-source dataset down the line.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/melodic-devel//images/circuit_launch.gif?raw=true" alt="map_image" title="Map Image"></p>

<h1 id="lifelong-mapping">LifeLong Mapping</h1>

<!--  Continuing mapping Gif here-->

<p>LifeLong mapping is the concept of being able to map a space, completely or partially, and over time, refine and update that map as you continue to interact with the space. Our approach implements this and also takes care to allow for the application of operating in the cloud, as well as mapping with many robots in a shared space (cloud distributed mapping). While Slam Toolbox can also just be used for a point-and-shoot mapping of a space and saving that map as a .pgm file as maps are traditionally stored in, it also allows you to save the pose-graph and metadata losslessly to reload later with the same or different robot and continue to map the space.</p>

<p>Our lifelong mapping consists of a few key steps</p>
<ul>
  <li>Serialization and Deserialization to store and reload map information</li>
  <li>KD-Tree search matching to locate the robot in its position on reinitalization</li>
  <li>pose-graph optimizition based SLAM with 2D scan matching abstraction</li>
</ul>

<p>This will allow the user to create and update existing maps, then serialize the data for use in other mapping sessions, something sorely lacking from most SLAM implementations and nearly all planar SLAM implementations. Other good libraries that do this include RTab-Map and Cartoprapher, though they themselves have their own quirks that make them (in my opinion) unusable for production robotics applications. This library provides the mechanics to save not only the data, but the pose graph, and associated metadata to work with. This has been used to create maps by merging techniques (taking 2 or more serialized objects and creating 1 globally consistent one) as well as continuous mapping techniques (updating 1, same, serialized map object over time and refining it). The major benefit of this over RTab-Map or Cartoprapher is the maturity of the underlying (but heavily modified) <code class="language-plaintext highlighter-rouge">open_karto</code> library the project is based on. The scan matcher of Karto is well known as an extremely good matcher for 2D laser scans and modified versions of Karto can be found in companies across the world.</p>

<p>Slam Toolbox supports all the major modes:</p>
<ul>
  <li>Starting from a predefined dock (assuming to be near start region)</li>
  <li>Starting at any particular node - select a node ID to start near</li>
  <li>Starting in any particular area - indicate current pose in the map frame to start at, like AMCL</li>
</ul>

<p>In the RVIZ interface (see section below) you’ll be able to re-localize in a map or continue mapping graphically or programatically using ROS services.</p>

<p>On time of writing: there a <strong>highly</strong> experimental implementation of what I call “true lifelong” mapping that does support the method for removing nodes over time as well as adding nodes, this results in a true ability to map for life since the computation is bounded by removing extraneous or outdated information. Its recommended to run the non-full LifeLong mapping mode in the cloud for the increased computational burdens if you’d like to be continuously refining a map. However a real and desperately needed application of this is to have multi-session mapping to update just a section of the map or map half an area at a time to create a full (and then static) map for AMCL or Slam Toolbox localization mode, which this will handle in spades. The immediate plan is to create a mode within LifeLong mapping to decay old nodes to bound the computation and allow it to run on the edge by refining the experimental node. Continuing mapping (lifelong) should be used to build a complete map then switch to the pose-graph deformation localization mode until node decay is implemented, and <strong>you should not see any substantial performance impacts</strong>.</p>

<h1 id="localization">Localization</h1>

<!-- map refind local area localization Gif here-->

<p>Localization mode consists of 3 things:</p>
<ul>
  <li>Loads existing serialized map into the node</li>
  <li>Maintains a rolling buffer of recent scans in the pose-graph</li>
  <li>After expiring from the buffer scans are removed and the underlying map is not affected</li>
</ul>

<p>Localization methods on image map files has been around for years and works relatively well. There has not been a great deal of work in academia to refine these algorithms to a degree that satesfies me. However SLAM is a rich and well benchmarked topic. The inspiration of this work was the concept of “Can we make localization, SLAM again?” such that we can take advantage of all the nice things about SLAM for localization, but remove the unbounded computational increase.</p>

<p>To enable, set <code class="language-plaintext highlighter-rouge">mode: localization</code> in the configuration file to allow for the Ceres plugin to set itself correctly to be able to quickly add <em>and remove</em> nodes and constraints from the pose graph, but isn’t strictly required, but a performance optimization. The localization mode will automatically load your pose graph, take the first scan and match it against the local area to further refine your estimated position, and start localizing.</p>

<p>To minimize the amount of changes required for moving to this mode over AMCL, we also expose a subscriber to the <code class="language-plaintext highlighter-rouge">/initialpose</code> topic used by AMCL to relocalize to a position, which also hooks up to the <code class="language-plaintext highlighter-rouge">2D Pose Estimation</code> tool in RVIZ. This way you can enter localization mode with our approach but continue to use the same API as you expect from AMCL for ease of integration.</p>

<p>In summary, this approach I dub <code class="language-plaintext highlighter-rouge">elastic pose-graph localization</code> is where we take existing map pose-graphs and localized with-in them with a rolling window of recent scans. This way we can localize in an existing map using the scan matcher, but not update the underlaying map long-term should something go wrong. It can be considered a replacement to AMCL and results is not needing any .pgm maps ever again. The lifelong mapping/continuous slam mode above will do better if you’d like to modify the underlying graph while moving.</p>

<h2 id="tools">Tools</h2>

<h3 id="plugin-based-optimizers">Plugin based Optimizers</h3>

<p>I have created a pluginlib interface for the ScanSolver abstract class so that you can change optimizers on runtime to test many different ones if you like.</p>

<p>Then I generated plugins for a few different solvers that people might be interested in. I like to swap them out for benchmarking and make sure its the same code running for all. I have supported Ceres, G2O, SPA, and GTSAM.</p>

<p>GTSAM/G2O/SPA is currently “unsupported” although all the code is there. They don’t outperform Ceres settings I describe below so I stopped compiling them to save on build time, but they’re there and work if you would like to use them. PRs to implement other optimizer plugins are welcome.</p>

<h3 id="map-merging---example-uses-of-serialized-raw-data--posegraphs">Map Merging - Example uses of serialized raw data &amp; posegraphs</h3>

<h4 id="kinematic">Kinematic</h4>

<p>This uses RVIZ and the plugin to load any number of posegraphs that will show up in RVIZ under <code class="language-plaintext highlighter-rouge">map_N</code> and a set of interactive markers to allow you to move them around. Once you have them all positioned relative to each other in the way you like, you can merge the submaps into a global <code class="language-plaintext highlighter-rouge">map</code> which can be downloaded with your map server implementation of choice.</p>

<p>It’s more of a demonstration of other things you can do once you have the raw data to work with, but I don’t suspect many people will get much use out of it unless you’re used to stitching maps by hand.</p>

<p>More information in the RVIZ Plugin section below.</p>

<h4 id="pose-graph-merging">Pose Graph Merging</h4>

<p>This is under development.</p>

<p>This is to solve the problem of merging many maps together with an initial guess of location in an elastic sense. This is something you just can’t get if you don’t have the full pose-graph and raw data to work with – which we have from our continuous mapping work.</p>

<p>Hint: This is also really good for multi-robot map updating as well :)</p>

<h3 id="rviz-plugin">RVIZ Plugin</h3>

<p>An rviz plugin is furnished to help with manual loop closures and online / offline mapping. By default interactive mode is off (allowing you to move nodes) as this takes quite a toll on rviz. When you want to move nodes, tick the interactive box, move what you want, and save changes to prompt a manual loop closure. Clear if you made a mistake. When done, exit interactive mode again.</p>

<p>There’s also a tool to help you control online and offline data. You can at any time stop processing new scans or accepting new scans into the queue. This is desirable when you want to allow the package to catch up while the robot sits still (<strong>This option is only meaningful in synchronous mode. In asynchronous mode the robot will never fall behind.</strong>) or you want to stop processing new scans while you do a manual loop closure / manual “help”. If there’s more in the queue than you want, you may also clear it.</p>

<p>Additionally there’s exposed buttons for the serialization and deserialization services to load an old pose-graph to update and refine, or continue mapping, then save back to file. The “Start By Dock” checkbox will try to scan match against the first node (assuming you started at your dock) to give you an odometry estimate to start with. Another option is to start using an inputted position in the GUI or by calling the underlying service. Additionally, you can use the current odometric position estimation if you happened to have just paused the robot or not moved much between runs. Finally (and most usefully), you can use the RVIZ tool for <strong>2D Pose Estimation</strong> to tell it where to go in <strong>localization mode</strong> just like AMCL.</p>

<p>Additionally the RVIZ plugin will allow you to add serialized map files as submaps in RVIZ. They will be displayed with an interactive marker you can translate and rotate to match up, then generate a composite map with the Generate Map button. At that point the composite map is being broadcasted on the <code class="language-plaintext highlighter-rouge">/map</code> topic and you can save it with the <code class="language-plaintext highlighter-rouge">map_saver</code>.</p>

<p>It’s recommended to always continue mapping near the dock, if that’s not possible, look into the starting from pose or map merging techniques. This RVIZ plugin is mostly here as a debug utility, but if you often find yourself mapping areas using rviz already, I’d just have it open. All the RVIZ buttons are implemented using services that a master application can control.</p>

<p>The interface is shown below.</p>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/melodic-devel//images/rviz_plugin.png?raw=true" alt="rviz_plugin" title="Rviz Plugin"></p>

<h3 id="graph-manipulation">Graph Manipulation</h3>

<p>By enabling <code class="language-plaintext highlighter-rouge">Interactive Mode</code>, the graph nodes will change from markers to interactive markers which you can manipulate. When you move a node(s), you can Save Changes and it will send the updated position to the pose-graph and cause an optimization run to occur to change the pose-graph with your new node location. This is helpful if the robot gets pushed, slips, runs into a wall, or otherwise has drifting odometry and you would like to manually correct it.</p>

<p>When a map is sufficiently large, the number of interactive markers in RVIZ may be too large and RVIZ may start to lag. I only recommend using this feature as a testing debug tool and not for production. However if you are able to make it work with 10,000 interactive markers, I’ll merge that PR in a heartbeat. Otherwise I’d restrict the use of this feature to small maps or with limited time to make a quick change and return to static mode by unchecking the box.</p>

<h2 id="metrics">Metrics</h2>

<p>If you’re a weirdo like me and you want to see how I came up with the settings I had for the Ceres optimizer, see below.</p>

<p><img src="https://user-images.githubusercontent.com/14944147/41576505-a6802d76-733c-11e8-8eca-334da2c8bd50.png" alt="ceres_solver_comparison"></p>

<p>The data sets present solve time vs number of nodes in the pose graph on a large dataset, as that is not open source, but suffice to say that the settings I recommend work well. I think anyone would be hardset in a normal application to exceed or find that another solver type is better (that super low curve on the bottom one, yeah, that’s it). Benchmark on a low power 7th gen i7 machine.</p>

<p>It can map <em>very</em> large spaces with reasonable CPU and memory consumption. My default settings increase O(N) on number of elements in the pose graph. I recommend from extensive testing to use the <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code> solver with Ceres and the <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code> preconditioner. Using <code class="language-plaintext highlighter-rouge">LM</code> at the trust region strategy is comparable to the dogleg subspace strategy, but <code class="language-plaintext highlighter-rouge">LM</code> is much better supported so why argue with it.</p>

<p>You can get away without a loss function if your odometry is good (ie likelihood for outliers is extremely low). If you have an abnormal application or expect wheel slippage, I might recommend a <code class="language-plaintext highlighter-rouge">HuberLoss</code> function, which is a really good catch-all loss function if you’re looking for a place to start. All these options and more are available from the ROS parameter server.</p>

<h1 id="api">API</h1>

<p>The following are the services/topics that are exposed for use. See the rviz plugin for an implementation of their use.</p>

<h2 id="subscribed-topics">Subscribed topics</h2>

<table>
  <thead>
    <tr>
      <th>scan</th>
      <th><code class="language-plaintext highlighter-rouge">sensor_msgs/LaserScan</code></th>
      <th>the input scan from your laser to utilize</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>tf</strong></td>
      <td>N/A</td>
      <td>a valid transform from your configured odom_frame to base_frame</td>
    </tr>
  </tbody>
</table>

<h2 id="published-topics">Published topics</h2>

<p>| map  | <code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code> | occupancy grid representation of the pose-graph at <code class="language-plaintext highlighter-rouge">map_update_interval</code> frequency | 
|—–|—-|—-|</p>

<h2 id="exposed-services">Exposed Services</h2>

<table>
  <thead>
    <tr>
      <th>Topic</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/clear_changes</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Clear</code></td>
      <td>Clear all manual pose-graph manipulation changes pending</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/deserialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/DeserializePoseGraph</code></td>
      <td>Load a saved serialized pose-graph files from disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/dynamic_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">nav_msgs/OccupancyGrid</code></td>
      <td>Request the current state of the pose-graph as an occupancy grid</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/manual_loop_closure</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/LoopClosure</code></td>
      <td>Request the manual changes to the pose-graph pending to be processed</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/pause_new_measurements</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/Pause</code></td>
      <td>Pause processing of new incoming laser scans by the toolbox</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/save_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SaveMap</code></td>
      <td>Save the map image file of the pose-graph that is useable for display or AMCL localization. It is a simple wrapper on <code class="language-plaintext highlighter-rouge">map_server/map_saver</code> but is useful.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/serialize_map</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/SerializePoseGraph</code></td>
      <td>Save the map pose-graph and datathat is useable for continued mapping, slam_toolbox localization, offline manipulation, and more</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/slam_toolbox/toggle_interactive_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">slam_toolbox/ToggleInteractive</code></td>
      <td>Toggling in and out of interactive mode, publishing interactive markers of the nodes and their positions to be updated in an application</td>
    </tr>
  </tbody>
</table>

<h1 id="configuration">Configuration</h1>

<p>The following settings and options are exposed to you. My default configuration is given in <code class="language-plaintext highlighter-rouge">config</code> directory.</p>

<h2 id="solver-params">Solver Params</h2>

<p><code class="language-plaintext highlighter-rouge">solver_plugin</code> - The type of nonlinear solver to utilize for karto’s scan solver. Options: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::SpaSolver</code>, <code class="language-plaintext highlighter-rouge">solver_plugins::G2oSolver</code>. Default: <code class="language-plaintext highlighter-rouge">solver_plugins::CeresSolver</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_linear_solver</code> - The linear solver for Ceres to use. Options: <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>, <code class="language-plaintext highlighter-rouge">SPARSE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">ITERATIVE_SCHUR</code>, <code class="language-plaintext highlighter-rouge">CGNR</code>. Defaults to <code class="language-plaintext highlighter-rouge">SPARSE_NORMAL_CHOLESKY</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_preconditioner</code> - The preconditioner to use with that solver. Options: <code class="language-plaintext highlighter-rouge">JACOBI</code>, <code class="language-plaintext highlighter-rouge">IDENTITY</code> (none), <code class="language-plaintext highlighter-rouge">SCHUR_JACOBI</code>. Defaults to <code class="language-plaintext highlighter-rouge">JACOBI</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_trust_strategy</code> - The trust region strategy. Line searach strategies are not exposed because they perform poorly for this use. Options: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>, <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">LEVENBERG_MARQUARDT</code>.</p>

<p><code class="language-plaintext highlighter-rouge">ceres_dogleg_type</code> - The dogleg strategy to use if the trust strategy is <code class="language-plaintext highlighter-rouge">DOGLEG</code>. Options: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code>, <code class="language-plaintext highlighter-rouge">SUBSPACE_DOGLEG</code>. Default: <code class="language-plaintext highlighter-rouge">TRADITIONAL_DOGLEG</code></p>

<p><code class="language-plaintext highlighter-rouge">ceres_loss_function</code> - The type of loss function to reject outlier measurements. None is equatable to a squared loss. Options: <code class="language-plaintext highlighter-rouge">None</code>, <code class="language-plaintext highlighter-rouge">HuberLoss</code>, <code class="language-plaintext highlighter-rouge">CauchyLoss</code>. Default: <code class="language-plaintext highlighter-rouge">None</code>.</p>

<p><code class="language-plaintext highlighter-rouge">mode</code> - “mapping” or “localization” mode for performance optimizations in the Ceres problem creation</p>

<h2 id="toolbox-params">Toolbox Params</h2>

<p><code class="language-plaintext highlighter-rouge">odom_frame</code> - Odometry frame</p>

<p><code class="language-plaintext highlighter-rouge">map_frame</code> - Map frame</p>

<p><code class="language-plaintext highlighter-rouge">base_frame</code> - Base frame</p>

<p><code class="language-plaintext highlighter-rouge">map_file_name</code> - Name of the pose-graph file to load on startup if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_pose</code> - Pose to start pose-graph mapping/localization in, if available</p>

<p><code class="language-plaintext highlighter-rouge">map_start_at_dock</code> - Starting pose-graph loading at the dock (first node), if available. If both pose and dock are set, it will use pose</p>

<p><code class="language-plaintext highlighter-rouge">debug_logging</code> - Change logger to debug</p>

<p><code class="language-plaintext highlighter-rouge">throttle_scans</code> - Number of scans to throttle in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_publish_period</code> - The map to odom transform publish period. 0 will not publish transforms</p>

<p><code class="language-plaintext highlighter-rouge">map_update_interval</code> - Interval to update the 2D occupancy map for other applications / visualization</p>

<p><code class="language-plaintext highlighter-rouge">enable_interactive_mode</code> - Whether or not to allow for interactive mode to be enabled. Interactive mode will retain a cache of laser scans mapped to their ID for visualization in interactive mode. As a result the memory for the process will increase. This is manually disabled in localization and lifelong modes since they would increase the memory utilization over time. Valid for either mapping or continued mapping modes.</p>

<p><code class="language-plaintext highlighter-rouge">resolution</code> - Resolution of the 2D occupancy map to generate</p>

<p><code class="language-plaintext highlighter-rouge">max_laser_range</code> - Maximum laser range to use for 2D occupancy map rastering</p>

<p><code class="language-plaintext highlighter-rouge">minimum_time_interval</code> - The minimum duration of time between scans to be processed in synchronous mode</p>

<p><code class="language-plaintext highlighter-rouge">transform_timeout</code> - TF timeout for looking up transforms</p>

<p><code class="language-plaintext highlighter-rouge">tf_buffer_duration</code> - Duration to store TF messages for lookup. Set high if running offline at multiple times speed in synchronous mode.</p>

<p><code class="language-plaintext highlighter-rouge">stack_size_to_use</code> - The number of bytes to reset the stack size to, to enable serialization/deserialization of files. A liberal default is 40000000, but less is fine.</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_distance</code> - Minimum distance of travel before processing a new scan</p>

<h2 id="matcher-params">Matcher Params</h2>

<p><code class="language-plaintext highlighter-rouge">use_scan_matching</code> - whether to use scan matching to refine odometric pose (uh, why would you not?)</p>

<p><code class="language-plaintext highlighter-rouge">use_scan_barycenter</code> - Whether to use the barycenter or scan pose</p>

<p><code class="language-plaintext highlighter-rouge">minimum_travel_heading</code> - Minimum changing in heading to justify an update</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_size</code> - The number of scans to buffer into a chain, also used as the number of scans in the circular buffer of localization mode</p>

<p><code class="language-plaintext highlighter-rouge">scan_buffer_maximum_scan_distance</code> - Maximum distance of a scan from the pose before removing the scan from the buffer</p>

<p><code class="language-plaintext highlighter-rouge">link_match_minimum_response_fine</code> - The threshold link matching algorithm response for fine resolution to pass</p>

<p><code class="language-plaintext highlighter-rouge">link_scan_maximum_distance</code> - Maximum distance between linked scans to be valid</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_maximum_distance</code> - Maximum threshold of distance for scans to be considered for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">do_loop_closing</code> - Whether to do loop closure (if you’re not sure, the answer is “true”)</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_chain_size</code> - The minimum chain length of scans to look for loop closure</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_maximum_variance_coarse</code> - The threshold variance in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_coarse</code> - The threshold response of the loop closure algorithm in coarse search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">loop_match_minimum_response_fine</code> - The threshold response of the loop closure algorithm in fine search to pass to refine</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_dimension</code> - Search grid size to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_resolution</code> - Search grid resolution to do scan correlation over</p>

<p><code class="language-plaintext highlighter-rouge">correlation_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_dimension</code> - Size of the search grid over the loop closure algorith</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_resolution</code> - Search grid resolution to do loop closure over</p>

<p><code class="language-plaintext highlighter-rouge">loop_search_space_smear_deviation</code> - Amount of multimodal smearing to smooth out responses</p>

<p><code class="language-plaintext highlighter-rouge">distance_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">angle_variance_penalty</code> - A penalty to apply to a matched scan as it differs from the odometric pose</p>

<p><code class="language-plaintext highlighter-rouge">fine_search_angle_offset</code> - Range of angles to test for fine scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_search_angle_offset</code> - Range of angles to test for coarse scan matching</p>

<p><code class="language-plaintext highlighter-rouge">coarse_angle_resolution</code> - Resolution of angles over the Offset range to test in scan matching</p>

<p><code class="language-plaintext highlighter-rouge">minimum_angle_penalty</code> - Smallest penalty an angle can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">minimum_distance_penalty</code> - Smallest penalty a scan can have to ensure the size doesn’t blow up</p>

<p><code class="language-plaintext highlighter-rouge">use_response_expansion</code> - Whether to automatically increase the search grid size if no viable match is found</p>

<h1 id="install">Install</h1>

<p>ROSDep will take care of the major things</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep install -q -y -r --from-paths src --ignore-src

</code></pre></div></div>

<p>Also released in Melodic / Dashing to the ROS build farm to install debians.</p>

<p>Run your catkin build procedure of choice.</p>

<p>You can run via <code class="language-plaintext highlighter-rouge">roslaunch slam_toolbox online_sync.launch</code></p>

<h1 id="etc">Etc</h1>

<h2 id="nanoflann">NanoFlann!</h2>

<p>In order to do some operations quickly for continued mapping and localization, I make liberal use of NanoFlann (shout out!).</p>

<h2 id="brief-incursion-into-snaps">Brief incursion into snaps</h2>

<p>Snap are completely isolated containerized packages that one can run through the Canonical organization on a large number of Linux distributions. They’re similar to Docker containers but it doesn’t share the kernel or any of the libraries, and rather has everything internal as essentially a seperate partitioned operating system based on Ubuntu Core.</p>

<p>We package up slam toolbox in this way for a nice multiple-on speed up in execution from a couple of pretty nuanced reasons in this particular project, but generally speaking you shouldn’t expect a speedup from a snap. There’s a generate snap script in the <code class="language-plaintext highlighter-rouge">snap</code> directory to create a snap.</p>

<p>Since Snaps are totally isolated and there’s no override flags like in Docker, there’s only a couple of fixed directories that both the snap and the host system can write and read from, including SNAP_COMMON (usually in <code class="language-plaintext highlighter-rouge">/var/snap/[snap name]/common</code>). Therefore, this is the place that if you’re serializing and deserializing maps, you need to have them accessible to that directory.</p>

<p>You can optionally store all your serialized maps there, move maps there as needed, take maps from there after serialization, or do my favorite option and <code class="language-plaintext highlighter-rouge">link</code> the directories with <code class="language-plaintext highlighter-rouge">ln</code> to where ever you normally store your maps and you’re wanting to dump your serialized map files.</p>

<p>Example of <code class="language-plaintext highlighter-rouge">ln</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#           Source                           Linked
sudo ln -s /home/steve/maps/serialized_map/ /var/snap/slam-toolbox/common

</code></pre></div></div>

<p>and then all you have to do when you specify a map to use is set the filename to <code class="language-plaintext highlighter-rouge">slam-toolbox/map_name</code> and it should work no matter if you’re running in a snap, docker, or on bare metal. The <code class="language-plaintext highlighter-rouge">-s</code> makes a symbol link so rather than <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/*</code> containing the maps, <code class="language-plaintext highlighter-rouge">/var/snap/slam-toolbox/common/serialized_map/*</code> will. By default on bare metal, the maps will be saved in <code class="language-plaintext highlighter-rouge">.ros</code></p>

<h2 id="more-gifs">More Gifs!</h2>

<p><img src="https://raw.githubusercontent.com/SteveMacenski/slam_toolbox/melodic-devel//images/mapping_steves_apartment.gif?raw=true" alt="map_image" title="Map Image"></p>

<p>If someone from iRobot can use this to tell me my Roomba serial number by correlating to its maps, I’ll buy them lunch and probably try to hire them.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/SteveMacenski/slam_toolbox.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
