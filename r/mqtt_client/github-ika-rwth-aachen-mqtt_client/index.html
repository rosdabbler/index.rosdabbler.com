<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/mqtt_client/github-ika-rwth-aachen-mqtt_client/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">mqtt_client</li>
        <!--<li class="active">mqtt_client</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-primary" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#noetic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#noetic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#noetic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client">mqtt_client</a>
        
        <a class="label label-primary pkg-label" href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS / ROS 2 C++ Node for bi-directionally bridging messages between ROS and MQTT</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/ika-rwth-aachen/mqtt_client.git">https://github.com/ika-rwth-aachen/mqtt_client.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-10-28
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/mqtt_client/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/mqtt_client/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/mqtt_client">mqtt_client</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/mqtt_client_interfaces">mqtt_client_interfaces</a></td>
                    <td>2.3.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="mqtt_client">mqtt_client</h1>

<p align="center">
  <img src="https://img.shields.io/github/v/release/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <img src="https://img.shields.io/github/license/ika-rwth-aachen/mqtt_client">&lt;/a&gt;
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/industrial_ci.yml/badge.svg"></a>
  <a href="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml"><img src="https://github.com/ika-rwth-aachen/mqtt_client/actions/workflows/docker-ros.yml/badge.svg"></a>
  <img src="https://img.shields.io/badge/ROS-noetic-blueviolet">
  <img src="https://img.shields.io/badge/ROS%202-humble|iron|jazzy|rolling-blueviolet">
  <a href="https://github.com/ika-rwth-aachen/mqtt_client"><img src="https://img.shields.io/github/stars/ika-rwth-aachen/mqtt_client?style=social"></a>
</p>

<p>The <em>mqtt_client</em> package provides a ROS nodelet or ROS 2 component node that enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol. This works generically for arbitrary ROS message types. The <em>mqtt_client</em> can also exchange primitive messages with MQTT clients running on devices not based on ROS.</p>

<blockquote>
  <p>[!IMPORTANT]<br>
This repository is open-sourced and maintained by the <a href="https://www.ika.rwth-aachen.de/"><strong>Institute for Automotive Engineering (ika) at RWTH Aachen University</strong></a>.<br>
<strong>V2X Communication</strong> is one of many research topics within our <a href="https://www.ika.rwth-aachen.de/en/competences/fields-of-research/vehicle-intelligence-automated-driving.html"><em>Vehicle Intelligence &amp; Automated Driving</em></a> domain.<br>
If you would like to learn more about how we can support your automated driving or robotics efforts, feel free to reach out to us!<br>
:email: <strong><em>opensource@ika.rwth-aachen.de</em></strong></p>
</blockquote>

<ul>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#installation">Installation</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#docker-ros">docker-ros</a></li>
    </ul>
  </li>
  <li>
<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#usage">Usage</a>
    <ul>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#launch">Launch</a></li>
      <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a></li>
    </ul>
  </li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#package-summary">Package Summary</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#how-it-works">How It Works</a></li>
  <li><a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#acknowledgements">Acknowledgements</a></li>
</ul>

<h2 id="installation">Installation</h2>

<p>The <em>mqtt_client</em> package is released as an official ROS / ROS 2 package and can easily be installed via a package manager.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-mqtt-client</span>

</code></pre></div></div>

<p>If you would like to install <em>mqtt_client</em> from source, simply clone this repository into your ROS workspace. All dependencies that are listed in the ROS <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/package.xml"><code class="language-plaintext highlighter-rouge">package.xml</code></a> can be installed using <a href="http://wiki.ros.org/rosdep"><em>rosdep</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mqtt_client$</span>
rosdep <span class="nb">install</span> <span class="nt">-r</span> <span class="nt">--ignore-src</span> <span class="nt">--from-paths</span> <span class="nb">.</span>

<span class="c"># ROS</span>
<span class="c"># workspace$</span>
catkin build <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release mqtt_client

<span class="c"># ROS 2</span>
<span class="c"># workspace$</span>
colcon build <span class="nt">--packages-up-to</span> mqtt_client <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Release

</code></pre></div></div>

<h3 id="docker-ros">docker-ros</h3>

<p><em>mqtt_client</em> is also available as a Docker image, containerized through <a href="https://github.com/ika-rwth-aachen/docker-ros"><em>docker-ros</em></a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros

<span class="c"># ROS 2</span>
docker run <span class="nt">--rm</span> ghcr.io/ika-rwth-aachen/mqtt_client:ros2

</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>The <em>mqtt_client</em> can be easily integrated into an existing ROS-based system. Below, you first find a quick start guide to test the <em>mqtt_client</em> on a single machine. Then, more details are presented on how to launch and configure it in more complex applications.</p>

<h3 id="quick-start">Quick Start</h3>

<p>Follow these steps to quickly launch a working <em>mqtt_client</em> that is sending ROS messages via an MQTT broker to itself.</p>

<h4 id="demo-broker">Demo Broker</h4>

<p>It is assumed that an MQTT broker (such as <a href="https://mosquitto.org/"><em>Mosquitto</em></a>) is running on <code class="language-plaintext highlighter-rouge">localhost:1883</code>.</p>

<p>For this demo, you may easily launch <em>Mosquitto</em> with its default configuration using <em>Docker</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">--network</span> host <span class="nt">--name</span> mosquitto eclipse-mosquitto

</code></pre></div></div>

<p>For a more advanced setup of your own broker, check out our instructions for running an MQTT broker in Docker with enabled authentication and encryption <a href="https://github.com/ika-rwth-aachen/mqtt-in-docker">here</a>.</p>

<h4 id="demo-configuration">Demo Configuration</h4>

<p>The <em>mqtt_client</em> is best configured with a ROS parameter <em>yaml</em> file. The configuration shown below (also see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>) allows an exchange of messages as follows:</p>

<ul>
  <li>ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> are sent to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/ros</code> are published locally on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>;</li>
  <li>primitive ROS messages received locally on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code> are sent as primitive (string) messages to the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code>;</li>
  <li>MQTT messages received from the broker on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> are published locally as primitive ROS messages on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">1883</span>
<span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/ros</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/ping/primitive</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/ros</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/ros</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span> <span class="s">pingpong/primitive</span>
      <span class="na">ros_topic</span><span class="pi">:</span> <span class="s">/pong/primitive</span>
      <span class="na">primitive</span><span class="pi">:</span> <span class="kc">true</span>

</code></pre></div></div>

<h4 id="demo-client-launch">Demo Client Launch</h4>

<p>After building your ROS workspace, launch the <em>mqtt_client</em> node with the pre-configured demo parameters using <em>roslaunch</em>, which should yield the following output.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<pre><code class="language-txt">[ WARN] [1665575657.358869079]: Parameter 'broker/tls/enabled' not set, defaulting to '0'
[ WARN] [1665575657.359798329]: Parameter 'client/id' not set, defaulting to ''
[ WARN] [1665575657.359810889]: Client buffer can not be enabled when client ID is empty
[ WARN] [1665575657.360300703]: Parameter 'client/clean_session' not set, defaulting to '1'
[ WARN] [1665575657.360576344]: Parameter 'client/keep_alive_interval' not set, defaulting to '60.000000'
[ WARN] [1665575657.360847295]: Parameter 'client/max_inflight' not set, defaulting to '65535'
[ INFO] [1665575657.361281461]: Bridging ROS topic '/ping/ros' to MQTT topic 'pingpong/ros'
[ INFO] [1665575657.361303380]: Bridging primitive ROS topic '/ping/primitive' to MQTT topic 'pingpong/primitive'
[ INFO] [1665575657.361352809]: Bridging MQTT topic 'pingpong/ros' to ROS topic '/pong/ros'
[ INFO] [1665575657.361370558]: Bridging MQTT topic 'pingpong/primitive' to primitive ROS topic '/pong/primitive'
[ INFO] [1665575657.362153083]: Connecting to broker at 'tcp://localhost:1883' ...
[ INFO] [1665575657.462622065]: Connected to broker at 'tcp://localhost:1883'

</code></pre>

<p>Note that the <em>mqtt_client</em> successfully connected to the broker and also echoed which ROS/MQTT topics are being bridged. For testing the communication between <em>mqtt_client</em>, itself, and other MQTT clients, open five new terminals.</p>

<p>In order to test the communication among <em>mqtt_clients</em>, publish any ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/ros</code> and wait for a response on ROS topic <code class="language-plaintext highlighter-rouge">/pong/ros</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1st terminal: publish ROS message to /ping</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/ros std_msgs/String <span class="s2">"Hello MQTT"</span>

<span class="c"># ROS 2</span>
ros2 topic pub /ping/ros std_msgs/msg/String <span class="s2">"{data: </span><span class="se">\"</span><span class="s2">Hello MQTT</span><span class="se">\"</span><span class="s2">}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2nd terminal: listen for ROS messages on /pong</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/ros

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /pong/ros

</code></pre></div></div>

<p>In order to test the communication between <em>mqtt_client</em> and other MQTT clients, publish a primitive ROS message on ROS topic <code class="language-plaintext highlighter-rouge">/ping/primitive</code>, directly publish a primitive MQTT message on MQTT topic <code class="language-plaintext highlighter-rouge">pingpong/primitive</code> and wait for responses on ROS topic <code class="language-plaintext highlighter-rouge">/pong/primitive</code>. Note that you need to restart the ROS 2 <em>mqtt_client</em> with a different config file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS 2</span>
<span class="c"># mqtt_client$</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="si">$(</span>ros2 pkg prefix mqtt_client<span class="si">)</span>/share/mqtt_client/config/params.ros2.primitive.yaml

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3rd terminal: publish primitive ROS message to /ping/primitive</span>

<span class="c"># ROS</span>
rostopic pub <span class="nt">-r</span> 1 /ping/primitive std_msgs/Int32 42

<span class="c"># ROS2</span>
ros2 topic pub /ping/primitive std_msgs/msg/Int32 <span class="s2">"{data: 42}"</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 4th terminal: listen for primitive ROS messages on /pong/primitive</span>

<span class="c"># ROS</span>
rostopic <span class="nb">echo</span> /pong/primitive

<span class="c"># ROS2</span>
ros2 topic <span class="nb">echo</span> /pong/primitive

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 5th terminal: publish primitive MQTT message to pingpong/primitive directly using mosquitto_pub</span>
docker run <span class="nt">--rm</span> <span class="nt">--network</span> host eclipse-mosquitto mosquitto_pub <span class="nt">-h</span> localhost <span class="nt">-t</span> <span class="s2">"pingpong/primitive"</span> <span class="nt">--repeat</span> 20 <span class="nt">--repeat-delay</span> 1 <span class="nt">-m</span> 69

</code></pre></div></div>

<p>If everything works as expected, the second terminal should print a message at 1Hz, while the fourth terminal should print two different messages at 1Hz.</p>

<h3 id="launch">Launch</h3>

<p>You can start the <em>mqtt_client</em> node with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml

</code></pre></div></div>

<p>This will automatically load the provided demo <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.yaml"><code class="language-plaintext highlighter-rouge">params.yaml</code></a> / <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client/config/params.ros2.yaml"><code class="language-plaintext highlighter-rouge">params.ros2.yaml</code></a>. If you wish to load your custom configuration file, simply pass <code class="language-plaintext highlighter-rouge">params_file</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
roslaunch mqtt_client standalone.launch params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

<span class="c"># ROS 2</span>
ros2 launch mqtt_client standalone.launch.ros2.xml params_file:<span class="o">=</span><span class="s2">"&lt;/PATH/TO/PARAMS.YAML&gt;"</span>

</code></pre></div></div>

<p>In order to exploit the benefits of <em>mqtt_client</em> being a ROS nodelet / ROS 2 component, load the nodelet / component to your own nodelet manager / component container.</p>

<h3 id="configuration">Configuration</h3>

<p>All available ROS parameters supported by the <em>mqtt_client</em> and their default values (in <code class="language-plaintext highlighter-rouge">[]</code>) are listed in the following.</p>

<h4 id="broker-parameters">Broker Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">broker</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span>              <span class="c1"># [localhost] IP address or hostname of the machine running the MQTT broker</span>
  <span class="na">port</span><span class="pi">:</span>              <span class="c1"># [1883] port the MQTT broker is listening on</span>
  <span class="na">user</span><span class="pi">:</span>              <span class="c1"># username used for authenticating to the broker (if empty, will try to connect anonymously)</span>
  <span class="na">pass</span><span class="pi">:</span>              <span class="c1"># password used for authenticating to the broker</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span>           <span class="c1"># [false] whether to connect via SSL/TLS</span>
    <span class="na">ca_certificate</span><span class="pi">:</span>    <span class="c1"># [/etc/ssl/certs/ca-certificates.crt] CA certificate file trusted by client (relative to ROS_HOME)</span>

</code></pre></div></div>

<h4 id="client-parameters">Client Parameters</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">client</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>                   <span class="c1"># unique ID string used to identify the client (broker may allow empty ID and automatically generate one)</span>
  <span class="na">buffer</span><span class="pi">:</span>
    <span class="na">size</span><span class="pi">:</span>                 <span class="c1"># [0] maximum number of messages buffered by the bridge when not connected to broker (only available if client ID is not empty)</span>
    <span class="na">directory</span><span class="pi">:</span>            <span class="c1"># [buffer] directory used to buffer messages when not connected to broker (relative to ROS_HOME)</span>
  <span class="na">last_will</span><span class="pi">:</span>
    <span class="na">topic</span><span class="pi">:</span>                <span class="c1"># topic used for this client's last-will message (no last will, if not specified)</span>
    <span class="na">message</span><span class="pi">:</span>              <span class="c1"># [offline] last-will message</span>
    <span class="na">qos</span><span class="pi">:</span>                  <span class="c1"># [0] QoS value for last-will message</span>
    <span class="na">retained</span><span class="pi">:</span>             <span class="c1"># [false] whether to retain last-will message</span>
  <span class="na">clean_session</span><span class="pi">:</span>        <span class="c1"># [true] whether to use a clean session for this client</span>
  <span class="na">keep_alive_interval</span><span class="pi">:</span>  <span class="c1"># [60.0] keep-alive interval in seconds</span>
  <span class="na">max_inflight</span><span class="pi">:</span>         <span class="c1"># [65535] maximum number of inflight messages</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="na">certificate</span><span class="pi">:</span>          <span class="c1"># client certificate file (only needed if broker requires client certificates; relative to ROS_HOME)</span>
    <span class="na">key</span><span class="pi">:</span>                  <span class="c1"># client private key file (relative to ROS_HOME)</span>
    <span class="na">password</span><span class="pi">:</span>             <span class="c1"># client private key password</span>
    <span class="na">version</span><span class="pi">:</span>              <span class="c1"># TLS version (https://github.com/eclipse/paho.mqtt.cpp/blob/master/src/mqtt/ssl_options.h#L305)</span>
    <span class="na">verify</span><span class="pi">:</span>               <span class="c1"># verify the client should conduct post-connect checks.</span>
    <span class="na">alpn_protos</span><span class="pi">:</span>          <span class="c1"># list of ALPN protocols (https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_alpn_protos.html)</span>

</code></pre></div></div>

<h4 id="bridge-parameters">Bridge Parameters</h4>

<h5 id="ros">ROS</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>              <span class="c1"># Array specifying which ROS topics to map to which MQTT topics</span>
    <span class="pi">-</span> <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic whose messages are transformed to MQTT messages</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>  <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS subscriber queue size</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>      <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>              <span class="c1"># Array specifying which MQTT topics to map to which ROS topics</span>
    <span class="pi">-</span> <span class="na">mqtt_topic</span><span class="pi">:</span>        <span class="c1"># MQTT topic on which messages are received from the broker</span>
      <span class="na">ros_topic</span><span class="pi">:</span>         <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">primitive</span><span class="pi">:</span>         <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>           <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>    <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>       <span class="c1"># [false] whether to latch ROS message</span>

</code></pre></div></div>

<h5 id="ros-2">ROS 2</h5>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">bridge</span><span class="pi">:</span>
  <span class="na">ros2mqtt</span><span class="pi">:</span>                <span class="c1"># Object specifying which ROS topics to map to which MQTT topics</span>
    <span class="na">ros_topics</span><span class="pi">:</span>            <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span> <span class="c1"># The ROS topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">ros_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">mqtt_topic</span><span class="pi">:</span>          <span class="c1"># MQTT topic on which the corresponding ROS messages are sent to the broker</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the publisher</span>
      <span class="na">inject_timestamp</span><span class="pi">:</span>    <span class="c1"># [false] whether to attach a timestamp to a ROS2MQTT payload (for latency computation on receiver side)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS subscriber queue size</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [auto] One of "auto", "system_default", "reliable", "best_effort". If auto, the QoS is automatically determined via the publisher</span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [auto] One of "auto", "system_default", "volatile", "transient_local". If auto, the QoS is automatically determined via the publisher</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
          <span class="na">retained</span><span class="pi">:</span>        <span class="c1"># [false] whether to retain MQTT message</span>
  <span class="na">mqtt2ros</span><span class="pi">:</span>                <span class="c1"># Object specifying which MQTT topics to map to which ROS topics</span>
    <span class="na">mqtt_topics</span><span class="pi">:</span>           <span class="c1"># Array specifying which ROS topics to bridge</span>
      <span class="pi">-</span> <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span> <span class="c1"># The MQTT topic that should be bridged, corresponds to the sub-object in the YAML</span>
    <span class="pi">{{</span> <span class="nv">mqtt_topic_name</span> <span class="pi">}}</span><span class="err">:</span>
      <span class="na">ros_topic</span><span class="pi">:</span>           <span class="c1"># ROS topic on which corresponding MQTT messages are published</span>
      <span class="na">ros_type</span><span class="pi">:</span>            <span class="c1"># [*empty*] If set, the ROS msg type provided will be used. If empty, the type is automatically deduced via the MQTT message</span>
      <span class="na">primitive</span><span class="pi">:</span>           <span class="c1"># [false] whether to publish as primitive message (if coming from non-ROS MQTT client)</span>
      <span class="na">advanced</span><span class="pi">:</span>
        <span class="na">mqtt</span><span class="pi">:</span>
          <span class="na">qos</span><span class="pi">:</span>             <span class="c1"># [0] MQTT QoS value</span>
        <span class="na">ros</span><span class="pi">:</span>
          <span class="na">queue_size</span><span class="pi">:</span>      <span class="c1"># [1] ROS publisher queue size</span>
          <span class="na">latched</span><span class="pi">:</span>         <span class="c1"># [false] whether to latch ROS message</span>
          <span class="na">qos</span><span class="pi">:</span>
            <span class="na">reliability</span><span class="pi">:</span>   <span class="c1"># [system_default] One of "system_default", "reliable", "best_effort". </span>
            <span class="na">durability</span><span class="pi">:</span>    <span class="c1"># [system_default] One of "system_default", "volatile", "transient_local". </span>

</code></pre></div></div>

<h2 id="primitive-messages">Primitive Messages</h2>

<p>As seen in the <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#quick-start">Quick Start</a>, the <em>mqtt_client</em> can not only exchange arbitrary ROS messages with other <em>mqtt_clients</em>, but it can also exchange primitive message data with other non-<em>mqtt_client</em> MQTT clients. This allows ROS-based devices to exchange primitive messages with devices not based on ROS. The <code class="language-plaintext highlighter-rouge">primitive</code> parameter can be set for both ROS-to-MQTT (<code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code>) and for MQTT-to-ROS (<code class="language-plaintext highlighter-rouge">bridge/mqtt2ros</code>) transmissions.</p>

<p>If a ROS-to-MQTT transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code> and the ROS message type is one of the supported primitive ROS message types, the raw data is published as a string. The supported primitive ROS message types are <a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Char.html"><code class="language-plaintext highlighter-rouge">std_msgs/Char</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt8.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt32.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/UInt16.html"><code class="language-plaintext highlighter-rouge">std_msgs/UInt64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int8.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int8</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int16.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int16</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int64</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>, <a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>.</p>

<p>If an MQTT-to-ROS transmission is configured as <code class="language-plaintext highlighter-rouge">primitive</code>, the MQTT message is interpreted and published as a primitive data type, if possible. The message is probed in the following order: <code class="language-plaintext highlighter-rouge">bool</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Bool.html"><code class="language-plaintext highlighter-rouge">std_msgs/Bool</code></a>), <code class="language-plaintext highlighter-rouge">int</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Int32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Int32</code></a>), <code class="language-plaintext highlighter-rouge">float</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/Float32.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float32</code></a>), <code class="language-plaintext highlighter-rouge">string</code> (<a href="http://docs.ros.org/en/api/std_msgs/html/msg/String.html"><code class="language-plaintext highlighter-rouge">std_msgs/String</code></a>).</p>

<h2 id="latency-computation">Latency Computation</h2>

<p>The <em>mqtt_client</em> provides built-in functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. Note that this functionality is only available for non-primitive messages (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#primitive-messages">Primitive Messages</a>). To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. <strong>Naturally, this is only accurate to the level of synchronization between clocks on sending and receiving machine.</strong></p>

<p>In order to inject the current timestamp into outgoing MQTT messages, the parameter <code class="language-plaintext highlighter-rouge">inject_timestamp</code> has to be set for the corresponding <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt</code> entry. The receiving <em>mqtt_client</em> will then automatically publish the measured latency in seconds as a ROS <code class="language-plaintext highlighter-rouge">std_msgs/Float64</code> message on topic <code class="language-plaintext highlighter-rouge">/&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;</code>.</p>

<p>These latencies can be printed easily with <em>rostopic echo</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rostopic <span class="nb">echo</span> <span class="nt">--clear</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 topic <span class="nb">echo</span> /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<p>or plotted with <a href="http://wiki.ros.org/rqt_plot">rqt_plot</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ROS</span>
rosrun rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

<span class="c"># ROS 2</span>
ros2 run rqt_plot rqt_plot /&lt;mqtt_client_name&gt;/latencies/&lt;mqtt2ros/ros_topic&gt;/data

</code></pre></div></div>

<h2 id="package-summary">Package Summary</h2>

<p>This short package summary documents the package in line with the <a href="http://wiki.ros.org/StyleGuide">ROS Wiki Style Guide</a>.</p>

<h3 id="ros-1">ROS</h3>

<h4 id="nodelets">Nodelets</h4>

<h5 id="mqtt_clientmqttclient"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="http://wiki.ros.org/topic_tools"><code class="language-plaintext highlighter-rouge">topic_tools/ShapeShifter</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros[*]/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services">Services</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">~is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</li>
</ul>

<h6 id="parameters">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h3 id="ros-2-1">ROS 2</h3>

<h4 id="components">Components</h4>

<h5 id="mqtt_clientmqttclient-1"><code class="language-plaintext highlighter-rouge">mqtt_client/MqttClient</code></h5>

<p>Enables connected ROS-based devices or robots to exchange ROS messages via an MQTT broker using the <a href="http://mqtt.org">MQTT</a> protocol.</p>

<h6 id="subscribed-topics-1">Subscribed Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/ros2mqtt/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericSubscription.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic whose messages are transformed to MQTT messages and sent to the MQTT broker. May have arbitrary ROS message type.</li>
</ul>

<h6 id="published-topics-1">Published Topics</h6>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/ros2_packages/rolling/api/rclcpp/generated/classrclcpp_1_1GenericPublisher.html"><code class="language-plaintext highlighter-rouge">rclcpp::SerializedMessage</code></a>)
ROS topic on which MQTT messages received from the MQTT broker are published. May have arbitrary ROS message type.</li>
  <li>
<code class="language-plaintext highlighter-rouge">~/latencies/&lt;bridge/mqtt2ros/ros_topic&gt;</code> (<a href="https://docs.ros.org/en/api/std_msgs/html/msg/Float64.html"><code class="language-plaintext highlighter-rouge">std_msgs/Float64</code></a>)
Latencies measured on the message transfer to <code class="language-plaintext highlighter-rouge">&lt;bridge/mqtt2ros/ros_topic&gt;</code> are published here, if the received messages have a timestamp injected (see <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#latency-computation">Latency Computation</a>).</li>
</ul>

<h6 id="services-1">Services</h6>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/is_connected</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/IsConnected.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/IsConnected</code></a>)
Returns whether the client is connected to the MQTT broker.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_ros2mqtt_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewRos2MqttBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewRos2MqttBridge</code></a>)
Returns whether a new ROS -&gt; MQTT bridge was created.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">~/new_mqtt2ros_bridge</code> (<a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/srv/NewMqtt2RosBridge.srv"><code class="language-plaintext highlighter-rouge">mqtt_client/srv/NewMqtt2RosBridge</code></a>)
Returns whether a new MQTT -&gt; ROS bridge was created.</p>
  </li>
</ul>

<h6 id="parameters-1">Parameters</h6>

<p>See <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/#configuration">Configuration</a>.</p>

<h2 id="how-it-works">How It Works</h2>

<h3 id="ros-2">ROS</h3>

<p>The <em>mqtt_client</em> is able to bridge ROS messages of arbitrary message type to an MQTT broker. To this end, it needs to employ generic ROS subscribers and publishers, which only take shape at runtime.</p>

<p>These generic ROS subscribers and publishers are realized through <a href="http://docs.ros.org/diamondback/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html">topic_tools::ShapeShifter</a>. For each pair of <code class="language-plaintext highlighter-rouge">ros_topic</code> and <code class="language-plaintext highlighter-rouge">mqtt_topic</code> specified under <code class="language-plaintext highlighter-rouge">bridge/ros2mqtt/</code>, a ROS subscriber is setup with the following callback signature:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">ros2mqtt</span><span class="p">(</span><span class="n">topic_tools</span><span class="o">::</span><span class="n">ShapeShifter</span><span class="o">::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside the callback, the generic messages received on the <code class="language-plaintext highlighter-rouge">ros_topic</code> are serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a>. The serialized form is then ready to be sent to the MQTT broker on the specified <code class="language-plaintext highlighter-rouge">mqtt_topic</code>.</p>

<p>Upon retrieval of an MQTT message, it is republished as a ROS message on the ROS network. To this end, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a> is used to have the ShapeShifter publisher take the shape of the specific ROS message type.</p>

<p>The required metainformation on the ROS message type can however only be extracted in the ROS subscriber callback of the publishing <em>mqtt_client</em> with calls to <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#af05fbf42757658e4c6a0f99ff72f7daa">topic_tools::ShapeShifter::getMD5Sum</a>, <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a9d57b2285213fda5e878ce7ebc42f0fb">topic_tools::ShapeShifter::getDataType</a>, and <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a503af7234eeba0ccefca64c4d0cc1df0">topic_tools::ShapeShifter::getMessageDefinition</a>. These attributes are wrapped in a ROS message of custom type <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a>, serialized using <a href="http://wiki.ros.org/roscpp/Overview/MessagesSerializationAndAdaptingTypes">ros::serialization</a> and also shared via the MQTT broker on a special topic.</p>

<p>When an <em>mqtt_client</em> receives such ROS message type metainformation, it configures the corresponding ROS ShapeShifter publisher using <a href="http://docs.ros.org/indigo/api/topic_tools/html/classtopic__tools_1_1ShapeShifter.html#a2b74b522fb49dac05d48f466b6b87d2d">topic_tools::ShapeShifter::morph</a>.</p>

<p>The <em>mqtt_client</em> also provides functionality to measure the latency of transferring a ROS message via an MQTT broker back to ROS. To this end, the sending client injects the current timestamp into the MQTT message. The receiving client can then compute the latency between message reception time and the injected timestamp. The information about whether a timestamp is injected is also included in the custom <a href="https://github.com/ika-rwth-aachen/mqtt_client/tree/main/mqtt_client_interfaces/msg/RosMsgType.msg">mqtt_client::RosMsgType</a> message that is sent before. The actual <code class="language-plaintext highlighter-rouge">std::vector&lt;uint8&gt;</code> message payload takes on one of the following forms:</p>

<pre><code class="language-txt">[... serialized timestamp ... | ... serialized ROS messsage ...]
[... serialized ROS messsage ...]

</code></pre>

<p>To summarize, the dataflow is as follows:</p>

<ul>
  <li>a ROS message of arbitrary type is received on ROS topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_ros_topic&gt;</code> and passed to the generic callback
    <ul>
      <li>ROS message type information is extracted and wrapped as a <code class="language-plaintext highlighter-rouge">RosMsgType</code>
</li>
      <li>ROS message type information is serialized and sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
      <li>the actual ROS message is serialized</li>
      <li>if <code class="language-plaintext highlighter-rouge">inject_timestamp</code>, the current timestamp is serialized and concatenated with the message</li>
      <li>the actual MQTT message is sent via the MQTT broker on MQTT topic <code class="language-plaintext highlighter-rouge">&lt;ros2mqtt_mqtt_topic&gt;</code>
</li>
    </ul>
  </li>
  <li>an MQTT message containing the ROS message type information is received on MQTT topic <code class="language-plaintext highlighter-rouge">mqtt_client/ros_msg_type/&lt;ros2mqtt_mqtt_topic&gt;</code>
    <ul>
      <li>message type information is extracted and the ShapeShifter ROS publisher is configured</li>
      <li>information about whether a timestamp is injected is stored for the specific topic</li>
    </ul>
  </li>
  <li>an MQTT message containing the actual ROS message is received
    <ul>
      <li>depending on whether a timestamp is injected, it is decoded into the serialized ROS message and the serialized timestamp</li>
      <li>if the message contained a timestamp, the latency is computed and published on ROS topic <code class="language-plaintext highlighter-rouge">~/latencies/&lt;mqtt2ros_ros_topic&gt;</code>
</li>
      <li>the serialized ROS message is published using the <em>ShapeShifter</em> on ROS topic <code class="language-plaintext highlighter-rouge">&lt;mqtt2ros_ros_topic&gt;</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>This research is accomplished within the projects <a href="https://6gem.de/">6GEM</a> (FKZ 16KISK036K) and <a href="https://www.unicaragil.de/">UNICAR<em>agil</em></a> (FKZ 16EMO0284K). We acknowledge the financial support for the projects by the Federal Ministry of Education and Research of Germany (BMBF).</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/mqtt_client">mqtt_client</a> <small>repository</small></h3>
        <span class="label label-default">mqtt</span> <span class="label label-default">ros</span> <span class="label label-default">ros2</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-ika-rwth-aachen-mqtt_client
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-ika-rwth-aachen-mqtt_client" role="menuitem" tabindex="-1" href="/r/mqtt_client/github-ika-rwth-aachen-mqtt_client" data="github-ika-rwth-aachen-mqtt_client">
                    <span class="glyphicon glyphicon-star"></span>
                    github-ika-rwth-aachen-mqtt_client
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/ika-rwth-aachen/mqtt_client.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
