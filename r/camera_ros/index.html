<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/camera_ros/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">camera_ros</li>
        <!--<li class="active">camera_ros</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
        <a class="label label-primary pkg-label" href="/p/camera_ros">camera_ros</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS 2 node for libcamera supported cameras (V4L2, Raspberry Pi Camera Modules)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/christianrauch/camera_ros.git">https://github.com/christianrauch/camera_ros.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/camera_ros/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/camera_ros">camera_ros</a></td>
                    <td>0.4.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="ros-2-node-for-libcamera">ROS 2 node for libcamera</h1>

<p>This ROS 2 node provides support for a variety of cameras via <a href="https://libcamera.org">libcamera</a>. Amongst others, this node supports V4L2 and <a href="https://www.raspberrypi.com/documentation/computers/camera_software.html">Raspberry Pi cameras</a>.</p>

<h2 id="installation">Installation</h2>

<p>Binary packages are available via the ROS package repository for some Linux and ROS distributions (check with <code class="language-plaintext highlighter-rouge">rosdep resolve camera_ros</code>). If it’s available, you can install the DEB or RPM packages via:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># source a ROS distribution</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="c"># DEB package</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>
<span class="c"># RPM package</span>
<span class="nb">sudo </span>dnf <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>

</code></pre></div></div>

<blockquote>
  <p>[!NOTE]
This also installs the package <a href="https://index.ros.org/r/libcamera/"><code class="language-plaintext highlighter-rouge">libcamera</code></a> as dependency. This is the bloomed version of the official upstream repo at https://git.libcamera.org/libcamera/libcamera.git and may not contain full support for all Raspberry Pi camera modules. If you need full camera module support on Raspberry Pi, you have to build the “raspberrypi” fork from https://github.com/raspberrypi/libcamera manually.</p>
</blockquote>

<h2 id="build-instructions">Build Instructions</h2>

<h3 id="libcamera">libcamera</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> node depends on libcamera version 0.1 or later. There are different ways to install this dependency:</p>

<ul>
  <li>
    <p><strong>System Package:</strong> Most Linux distributions provide a binary libcamera package. However, the Raspberry Pi OS uses a <a href="https://github.com/raspberrypi/libcamera">custom libcamera fork</a> with additional support for newer camera modules. When using the distribution packages, you have to skip the <code class="language-plaintext highlighter-rouge">libcamera</code> rosdep key when resolving dependencies (<code class="language-plaintext highlighter-rouge">rosdep install [...] --skip-keys=libcamera</code>).</p>
  </li>
  <li>
    <p><strong>ROS Package:</strong> You can also install a newer version from the ROS repo (package <code class="language-plaintext highlighter-rouge">ros-$ROS_DISTRO-libcamera</code>). This package will be installed by default when building <code class="language-plaintext highlighter-rouge">camera_ros</code> from source and resolving the rosdep keys.</p>
  </li>
  <li>
    <p><strong>Source:</strong> Finally, you can always build libcamera from source. This is currently the only option for using the “raspberrypi” fork on Ubuntu. You can build libcamera as part of the ROS workspace using <code class="language-plaintext highlighter-rouge">colcon-meson</code>. This is recommended over a system-wide installation as it avoids conflicts with the system package. You will need to install the following dependencies:</p>
    <ol>
      <li>Install the libcamera build dependencies according to https://libcamera.org/getting-started.html#dependencies.</li>
      <li>Install <code class="language-plaintext highlighter-rouge">colcon-meson</code> via the package manager, <code class="language-plaintext highlighter-rouge">sudo apt install -y python3-colcon-meson</code>, or pip, <code class="language-plaintext highlighter-rouge">pip install colcon-meson</code>.</li>
    </ol>
  </li>
</ul>

<h3 id="camera_ros">camera_ros</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> package is built together with libcamera in a colcon workspace:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create workspace</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/camera_ws/src
<span class="nb">cd</span> ~/camera_ws/src

<span class="c"># check out libcamera</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install </span>python3-colcon-meson
<span class="c"># Option A: official upstream</span>
git clone https://git.libcamera.org/libcamera/libcamera.git
<span class="c"># Option B: raspberrypi fork with support for newer camera modules</span>
<span class="c"># git clone https://github.com/raspberrypi/libcamera.git</span>

<span class="c"># check out this camera_ros repository</span>
git clone https://github.com/christianrauch/camera_ros.git

<span class="c"># resolve binary dependencies and build workspace</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="nb">cd</span> ~/camera_ws/
rosdep <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--from-paths</span> src <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> <span class="nv">$ROS_DISTRO</span> <span class="nt">--skip-keys</span><span class="o">=</span>libcamera
colcon build <span class="nt">--event-handlers</span><span class="o">=</span>console_direct+

</code></pre></div></div>

<p>If you are using a binary distribution of libcamera, you can skip adding this to the workspace. Additionally, if you want to use the bloomed libcamera package in the ROS repos, you can also omit <code class="language-plaintext highlighter-rouge">--skip-keys=libcamera</code> and have this binary dependency resolved automatically.</p>

<h2 id="launching-the-node">Launching the Node</h2>

<p>The package provides a standalone node executable:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run camera_ros camera_node

</code></pre></div></div>
<p>a composable node (<code class="language-plaintext highlighter-rouge">camera::CameraNode</code>):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 component standalone camera_ros camera::CameraNode

</code></pre></div></div>
<p>and an example launch file for the composable node:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch camera_ros camera.launch.py

</code></pre></div></div>

<h2 id="interfaces">Interfaces</h2>

<p>The camera node interfaces are compatible with the <a href="https://github.com/ros-perception/image_pipeline"><code class="language-plaintext highlighter-rouge">image_pipeline</code></a> stack. The node publishes the camera images and camera parameters and provides a service to set the camera parameters.</p>

<h3 id="topics">Topics</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/Image</code></td>
      <td>image</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw/compressed</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CompressedImage</code></td>
      <td>image (compressed)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CameraInfo</code></td>
      <td>camera parameters</td>
    </tr>
  </tbody>
</table>

<h3 id="services">Services</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/set_camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/srv/SetCameraInfo</code></td>
      <td>set camera parameters</td>
    </tr>
  </tbody>
</table>

<h2 id="parameters">Parameters</h2>

<p>The node provides two sets of parameters:</p>
<ol>
  <li>static read-only parameters to configure the camera stream once at the beginning</li>
  <li>dynamic parameters which are generated from the camera controls to change per-frame settings and which can be changed at runtime</li>
</ol>

<p>Those parameters can be set on the command line:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># standalone executable</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2
<span class="c"># composable node</span>
ros2 component standalone camera_ros camera::CameraNode <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2

</code></pre></div></div>
<p>or dynamically via the <a href="https://docs.ros.org/en/rolling/Concepts/Basic/About-Parameters.html">ROS parameter API</a>.</p>

<h3 id="static-camera-stream-configuration">Static Camera Stream Configuration</h3>

<p>The camera stream is configured once when the node starts via the following static read-only parameters:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera</code></td>
      <td>
<code class="language-plaintext highlighter-rouge">integer</code> or <code class="language-plaintext highlighter-rouge">string</code>
</td>
      <td>selects the camera by index (e.g. <code class="language-plaintext highlighter-rouge">0</code>) or by name (e.g. <code class="language-plaintext highlighter-rouge">/base/soc/i2c0mux/i2c@1/ov5647@36</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">role</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>configures the camera with a <code class="language-plaintext highlighter-rouge">StreamRole</code> (possible choices: <code class="language-plaintext highlighter-rouge">raw</code>, <code class="language-plaintext highlighter-rouge">still</code>, <code class="language-plaintext highlighter-rouge">video</code>, <code class="language-plaintext highlighter-rouge">viewfinder</code>) [default: <code class="language-plaintext highlighter-rouge">viewfinder</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">format</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>a <code class="language-plaintext highlighter-rouge">PixelFormat</code> that is supported by the camera [default: auto]</td>
    </tr>
    <tr>
      <td>
<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code>
</td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>desired image resolution [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sensor_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>desired raw sensor format resolution (format: <code class="language-plaintext highlighter-rouge">width:height</code>) [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orientation</code></td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>camera orientation in 90 degree steps (possible choices: <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">90</code>, <code class="language-plaintext highlighter-rouge">180</code>, <code class="language-plaintext highlighter-rouge">270</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera_info_url</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>URL for a camera calibration YAML file (see <a href="https://github.com/christianrauch/camera_ros/tree/main/#calibration">Calibration</a>) [default: <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>]</td>
    </tr>
  </tbody>
</table>

<p>The configuration is done in the following order:</p>
<ol>
  <li>select camera via <code class="language-plaintext highlighter-rouge">camera</code>
</li>
  <li>configure camera stream via <code class="language-plaintext highlighter-rouge">role</code>
</li>
  <li>set the pixel format for the stream via <code class="language-plaintext highlighter-rouge">format</code>
</li>
  <li>set the image resolution for the stream via <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>
</li>
  <li>set the sensor mode resolution for the raw feed from camera to GPU</li>
</ol>

<p>Each stream role only supports a discrete set of data stream configurations as a combination of the image resolution and pixel format. The selected stream configuration is validated at the end of this sequence and adjusted to the closest valid stream configuration.</p>

<p>By default, the node will select the first available camera and configures it with the default pixel format and image resolution. If a parameter has not been set, the node will print the available options and inform the user about the default choice.</p>

<p>The node avoids memory copies of the image data by directly mapping from a camera pixel format to a ROS image format, with the exception of converting between “raw” and “compressed” image formats when requested by the user. As an effect, not all pixel formats that are supported by the camera may be supported by the ROS image message. Hence, the options for <code class="language-plaintext highlighter-rouge">format</code> are limited to pixel formats that are supported by the camera and the raw ROS image message.</p>

<h3 id="sensor-modes-and-cropping">Sensor Modes and Cropping</h3>

<p>Most camera modules provide different sensor modes, some of which provide a smaller resolution version of the full picture, whereas others have a limited field-of-view, e.g. by allowing for the selection of a 3:2 image from a 16:9 sensor, a more native ‘digital zoom’ effect by cropping the picture etc. The benefit of this is to perform compute intensive tasks at the source (the sensor), rather than downstream in the GPU or in application code. Unless we specify the sensor mode we want, libcamera will automatically select one. Unfortunately, it is not guaranteed that the selected mode will be a full sensor mode, leading to a potential cropping of the picture.</p>

<p>Example: When configuring a 640x480 output stream on a Raspberry Pi Camera Module v2, libcamera will automatically choose a heavily cropped 640x480 sensor mode, leading to a digital zoom of ~2.5x.</p>

<p>See the <a href="https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf">PiCamera2 Documentation, section 4.2.2.3</a> for a detailed explanation. The <a href="https://picamera.readthedocs.io/en/release-1.13/fov.html#sensor-modes">PiCamera Documentation</a> has a good visualization of the issue. Read the documentation of your camera to see what modes are available, and which (if any) raw formats are cropped.</p>

<h3 id="dynamic-frame-configuration-controls">Dynamic Frame Configuration (controls)</h3>

<p>The dynamic parameters are created at runtime by inspecting the <a href="https://libcamera.org/api-html/namespacelibcamera_1_1controls.html">controls</a> that are exposed by the camera. The set of exposed controls is camera-dependent. The ROS parameters are directly formatted from the exposed controls, hence the parameter names match the control names.</p>

<p>libcamera does not expose the framerate directly as a parameter. Instead, the framerate range has to be converted to a duration:
\(\text{duration} = \frac{1}{\text{framerate}} \cdot 10^6 \\ µs\)
and then set via the control <code class="language-plaintext highlighter-rouge">FrameDurationLimits</code>, if it is exposed by the camera:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set fixed framerate of 20 Hz (50 ms)</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> FrameDurationLimits:<span class="o">=</span><span class="s2">"[50000,50000]"</span>

</code></pre></div></div>

<h2 id="calibration">Calibration</h2>

<p>The node uses the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> to manage the <a href="https://docs.ros.org/en/rolling/p/image_pipeline/camera_info.html">camera parameters</a>, such as the camera intrinsics for projection and distortion coefficients for rectification. Its tasks include loading the parameters from the calibration file, publishing them on <code class="language-plaintext highlighter-rouge">~/camera_info</code> and setting new parameters via service <code class="language-plaintext highlighter-rouge">~/set_camera_info</code>.</p>

<p>The URL for the camera calibration file can be set using the <code class="language-plaintext highlighter-rouge">camera_info_url</code> parameter, however it defaults to <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>. Note that when setting the URL manually, the provided string must be in the URL format, not a local file path (eg. <code class="language-plaintext highlighter-rouge">file:///home/nonroot/camera/calibration.yaml</code>). For more information, please take a look at the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> <a href="https://docs.ros.org/en/ros2_packages/rolling/api/camera_info_manager/generated/classcamera__info__manager_1_1CameraInfoManager.html">API documentation</a>.</p>

<p>If the camera has not been calibrated yet and the calibration file does not exist, the node will warn the user about the missing file (<code class="language-plaintext highlighter-rouge">Camera calibration file ~/.ros/camera_info/$NAME.yaml not found</code>) and publish zero-initialised intrinsic parameters. If you do not need to project between the 2D image plane and the 3D camera frame or rectify the image, you can safely ignore this.</p>

<p>To calibrate the camera and set the parameters, you can use the <a href="https://docs.ros.org/en/rolling/p/camera_calibration/"><code class="language-plaintext highlighter-rouge">cameracalibrator</code></a> from the <code class="language-plaintext highlighter-rouge">camera_calibration</code> package or any other node that interfaces with the <code class="language-plaintext highlighter-rouge">~/set_camera_info</code> service.</p>

<h2 id="trouble-shooting">Trouble Shooting</h2>

<p>To debug the node, first compile it in <code class="language-plaintext highlighter-rouge">Debug</code> mode:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Debug

</code></pre></div></div>
<p>and then run the node with libcamera and ROS debug information in <code class="language-plaintext highlighter-rouge">gdb</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LIBCAMERA_LOG_LEVELS</span><span class="o">=</span><span class="k">*</span>:DEBUG ros2 run <span class="nt">--prefix</span> <span class="s1">'gdb -ex run --args'</span> camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">--log-level</span> camera:<span class="o">=</span>debug <span class="nt">-p</span> width:<span class="o">=</span>640 <span class="nt">-p</span> height:<span class="o">=</span>480

</code></pre></div></div>

<h3 id="common-issues">Common Issues</h3>

<h4 id="no-camera-is-detected-exception-no-cameras-available">No camera is detected (exception <code class="language-plaintext highlighter-rouge">no cameras available</code>)</h4>

<p>For standard V4L2 camera devices, check that its connection is detected (<code class="language-plaintext highlighter-rouge">lsusb</code>) and that it is also detected by V4L2 (<code class="language-plaintext highlighter-rouge">v4l2-ctl --list-devices</code>).</p>

<p>On the Raspberry Pi, use <code class="language-plaintext highlighter-rouge">sudo vclog --msg</code> to inspect the VideoCore log messages for detected cameras. <code class="language-plaintext highlighter-rouge">vclog</code> is part of Raspberry Pi’s <code class="language-plaintext highlighter-rouge">utils</code> repo at https://github.com/raspberrypi/utils. If this is not available in your distribution, such as Ubuntu, you have to build it from source:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install build dependencies</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> wget ca-certificates gcc libc6-dev
<span class="c"># download vclog and build</span>
wget https://raw.githubusercontent.com/raspberrypi/utils/refs/heads/master/vclog/vclog.c
gcc vclog.c <span class="nt">-o</span> vclog
<span class="c"># show VideoCore log messages</span>
<span class="nb">sudo</span> ./vclog <span class="nt">--msg</span>

</code></pre></div></div>

<p>In the VideoCore log, you should find something like <code class="language-plaintext highlighter-rouge">Found camera 'ov5647' []</code> or <code class="language-plaintext highlighter-rouge">Found camera 'imx708' [...]</code>, which indicates the connected sensor, in these cases the <em>OmniVision OV5647</em> and <em>Sony IMX708</em>. Look up this sensor in the <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#hardware-specification">Raspberry Pi camera modules <em>Hardware Specification</em></a> and match the detected sensor with with the camera module. In this case, the <em>OmniVision OV5647</em> image sensor belongs to the Camera Module 1 and the <em>Sony IMX708</em> to the Camera Module 3.</p>

<p>If you are using a Raspberry Pi Camera Module, make sure that it is supported by the libcamera variant that you have installed. For example, the official upstream libcamera supports the Camera Module 1 (OmniVision OV5647), while the Camera Module 3 (Sony IMX708) is currently only supported by the “raspberrypi” fork of libcamera. To verify that your camera is working with libcamera, build the <code class="language-plaintext highlighter-rouge">cam</code> example from the libcamera repo and list the camera devices with <code class="language-plaintext highlighter-rouge">cam -l</code>. For a camera with the <em>OmniVision OV5647</em> sensor, this will show something like <code class="language-plaintext highlighter-rouge">'ov5647' (/base/axi/pcie@120000/rp1/i2c@88000/ov5647@36)</code> and for the <em>Sony IMX708</em> something like <code class="language-plaintext highlighter-rouge">'imx708_wide' (/base/axi/pcie@120000/rp1/i2c@88000/imx708@1a)</code>.</p>

<h4 id="buffer-allocation-issues-exception-failed-to-allocate-buffers">Buffer allocation issues (exception <code class="language-plaintext highlighter-rouge">Failed to allocate buffers</code>)</h4>

<p>If the node fails to allocate buffers, you are probably running out of video memory. This is most likely the case on resource constrained devices with limited memory, such as the Raspberry Pi Zero.</p>

<p>To avoid this, either increase the video memory via <code class="language-plaintext highlighter-rouge">raspi-config</code>, or decrease the buffer size by reducing the image resolution (parameters <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>) and/or selecting a chroma subsampled or compressed pixel format that uses less bits per pixel (parameter <code class="language-plaintext highlighter-rouge">format</code>). For example, a raw format like <code class="language-plaintext highlighter-rouge">XRGB8888</code> uses 32 bits for each individual pixel, while a chroma subsampled format like <code class="language-plaintext highlighter-rouge">YUYV</code> only uses 32 bits per two pixels due to the subsampling of the colour components. For details on pixel formats, see the <a href="https://www.kernel.org/doc/html/latest/userspace-api/media/v4l/pixfmt.html">Linux Kernel Image Formats documentation</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
        <a class="label label-primary pkg-label" href="/p/camera_ros">camera_ros</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS 2 node for libcamera supported cameras (V4L2, Raspberry Pi Camera Modules)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/christianrauch/camera_ros.git">https://github.com/christianrauch/camera_ros.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/camera_ros/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/camera_ros">camera_ros</a></td>
                    <td>0.4.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="ros-2-node-for-libcamera">ROS 2 node for libcamera</h1>

<p>This ROS 2 node provides support for a variety of cameras via <a href="https://libcamera.org">libcamera</a>. Amongst others, this node supports V4L2 and <a href="https://www.raspberrypi.com/documentation/computers/camera_software.html">Raspberry Pi cameras</a>.</p>

<h2 id="installation">Installation</h2>

<p>Binary packages are available via the ROS package repository for some Linux and ROS distributions (check with <code class="language-plaintext highlighter-rouge">rosdep resolve camera_ros</code>). If it’s available, you can install the DEB or RPM packages via:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># source a ROS distribution</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="c"># DEB package</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>
<span class="c"># RPM package</span>
<span class="nb">sudo </span>dnf <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>

</code></pre></div></div>

<blockquote>
  <p>[!NOTE]
This also installs the package <a href="https://index.ros.org/r/libcamera/"><code class="language-plaintext highlighter-rouge">libcamera</code></a> as dependency. This is the bloomed version of the official upstream repo at https://git.libcamera.org/libcamera/libcamera.git and may not contain full support for all Raspberry Pi camera modules. If you need full camera module support on Raspberry Pi, you have to build the “raspberrypi” fork from https://github.com/raspberrypi/libcamera manually.</p>
</blockquote>

<h2 id="build-instructions">Build Instructions</h2>

<h3 id="libcamera">libcamera</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> node depends on libcamera version 0.1 or later. There are different ways to install this dependency:</p>

<ul>
  <li>
    <p><strong>System Package:</strong> Most Linux distributions provide a binary libcamera package. However, the Raspberry Pi OS uses a <a href="https://github.com/raspberrypi/libcamera">custom libcamera fork</a> with additional support for newer camera modules. When using the distribution packages, you have to skip the <code class="language-plaintext highlighter-rouge">libcamera</code> rosdep key when resolving dependencies (<code class="language-plaintext highlighter-rouge">rosdep install [...] --skip-keys=libcamera</code>).</p>
  </li>
  <li>
    <p><strong>ROS Package:</strong> You can also install a newer version from the ROS repo (package <code class="language-plaintext highlighter-rouge">ros-$ROS_DISTRO-libcamera</code>). This package will be installed by default when building <code class="language-plaintext highlighter-rouge">camera_ros</code> from source and resolving the rosdep keys.</p>
  </li>
  <li>
    <p><strong>Source:</strong> Finally, you can always build libcamera from source. This is currently the only option for using the “raspberrypi” fork on Ubuntu. You can build libcamera as part of the ROS workspace using <code class="language-plaintext highlighter-rouge">colcon-meson</code>. This is recommended over a system-wide installation as it avoids conflicts with the system package. You will need to install the following dependencies:</p>
    <ol>
      <li>Install the libcamera build dependencies according to https://libcamera.org/getting-started.html#dependencies.</li>
      <li>Install <code class="language-plaintext highlighter-rouge">colcon-meson</code> via the package manager, <code class="language-plaintext highlighter-rouge">sudo apt install -y python3-colcon-meson</code>, or pip, <code class="language-plaintext highlighter-rouge">pip install colcon-meson</code>.</li>
    </ol>
  </li>
</ul>

<h3 id="camera_ros">camera_ros</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> package is built together with libcamera in a colcon workspace:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create workspace</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/camera_ws/src
<span class="nb">cd</span> ~/camera_ws/src

<span class="c"># check out libcamera</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install </span>python3-colcon-meson
<span class="c"># Option A: official upstream</span>
git clone https://git.libcamera.org/libcamera/libcamera.git
<span class="c"># Option B: raspberrypi fork with support for newer camera modules</span>
<span class="c"># git clone https://github.com/raspberrypi/libcamera.git</span>

<span class="c"># check out this camera_ros repository</span>
git clone https://github.com/christianrauch/camera_ros.git

<span class="c"># resolve binary dependencies and build workspace</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="nb">cd</span> ~/camera_ws/
rosdep <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--from-paths</span> src <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> <span class="nv">$ROS_DISTRO</span> <span class="nt">--skip-keys</span><span class="o">=</span>libcamera
colcon build <span class="nt">--event-handlers</span><span class="o">=</span>console_direct+

</code></pre></div></div>

<p>If you are using a binary distribution of libcamera, you can skip adding this to the workspace. Additionally, if you want to use the bloomed libcamera package in the ROS repos, you can also omit <code class="language-plaintext highlighter-rouge">--skip-keys=libcamera</code> and have this binary dependency resolved automatically.</p>

<h2 id="launching-the-node">Launching the Node</h2>

<p>The package provides a standalone node executable:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run camera_ros camera_node

</code></pre></div></div>
<p>a composable node (<code class="language-plaintext highlighter-rouge">camera::CameraNode</code>):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 component standalone camera_ros camera::CameraNode

</code></pre></div></div>
<p>and an example launch file for the composable node:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch camera_ros camera.launch.py

</code></pre></div></div>

<h2 id="interfaces">Interfaces</h2>

<p>The camera node interfaces are compatible with the <a href="https://github.com/ros-perception/image_pipeline"><code class="language-plaintext highlighter-rouge">image_pipeline</code></a> stack. The node publishes the camera images and camera parameters and provides a service to set the camera parameters.</p>

<h3 id="topics">Topics</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/Image</code></td>
      <td>image</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw/compressed</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CompressedImage</code></td>
      <td>image (compressed)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CameraInfo</code></td>
      <td>camera parameters</td>
    </tr>
  </tbody>
</table>

<h3 id="services">Services</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/set_camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/srv/SetCameraInfo</code></td>
      <td>set camera parameters</td>
    </tr>
  </tbody>
</table>

<h2 id="parameters">Parameters</h2>

<p>The node provides two sets of parameters:</p>
<ol>
  <li>static read-only parameters to configure the camera stream once at the beginning</li>
  <li>dynamic parameters which are generated from the camera controls to change per-frame settings and which can be changed at runtime</li>
</ol>

<p>Those parameters can be set on the command line:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># standalone executable</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2
<span class="c"># composable node</span>
ros2 component standalone camera_ros camera::CameraNode <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2

</code></pre></div></div>
<p>or dynamically via the <a href="https://docs.ros.org/en/rolling/Concepts/Basic/About-Parameters.html">ROS parameter API</a>.</p>

<h3 id="static-camera-stream-configuration">Static Camera Stream Configuration</h3>

<p>The camera stream is configured once when the node starts via the following static read-only parameters:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera</code></td>
      <td>
<code class="language-plaintext highlighter-rouge">integer</code> or <code class="language-plaintext highlighter-rouge">string</code>
</td>
      <td>selects the camera by index (e.g. <code class="language-plaintext highlighter-rouge">0</code>) or by name (e.g. <code class="language-plaintext highlighter-rouge">/base/soc/i2c0mux/i2c@1/ov5647@36</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">role</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>configures the camera with a <code class="language-plaintext highlighter-rouge">StreamRole</code> (possible choices: <code class="language-plaintext highlighter-rouge">raw</code>, <code class="language-plaintext highlighter-rouge">still</code>, <code class="language-plaintext highlighter-rouge">video</code>, <code class="language-plaintext highlighter-rouge">viewfinder</code>) [default: <code class="language-plaintext highlighter-rouge">viewfinder</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">format</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>a <code class="language-plaintext highlighter-rouge">PixelFormat</code> that is supported by the camera [default: auto]</td>
    </tr>
    <tr>
      <td>
<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code>
</td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>desired image resolution [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sensor_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>desired raw sensor format resolution (format: <code class="language-plaintext highlighter-rouge">width:height</code>) [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orientation</code></td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>camera orientation in 90 degree steps (possible choices: <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">90</code>, <code class="language-plaintext highlighter-rouge">180</code>, <code class="language-plaintext highlighter-rouge">270</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera_info_url</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>URL for a camera calibration YAML file (see <a href="https://github.com/christianrauch/camera_ros/tree/main/#calibration">Calibration</a>) [default: <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>]</td>
    </tr>
  </tbody>
</table>

<p>The configuration is done in the following order:</p>
<ol>
  <li>select camera via <code class="language-plaintext highlighter-rouge">camera</code>
</li>
  <li>configure camera stream via <code class="language-plaintext highlighter-rouge">role</code>
</li>
  <li>set the pixel format for the stream via <code class="language-plaintext highlighter-rouge">format</code>
</li>
  <li>set the image resolution for the stream via <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>
</li>
  <li>set the sensor mode resolution for the raw feed from camera to GPU</li>
</ol>

<p>Each stream role only supports a discrete set of data stream configurations as a combination of the image resolution and pixel format. The selected stream configuration is validated at the end of this sequence and adjusted to the closest valid stream configuration.</p>

<p>By default, the node will select the first available camera and configures it with the default pixel format and image resolution. If a parameter has not been set, the node will print the available options and inform the user about the default choice.</p>

<p>The node avoids memory copies of the image data by directly mapping from a camera pixel format to a ROS image format, with the exception of converting between “raw” and “compressed” image formats when requested by the user. As an effect, not all pixel formats that are supported by the camera may be supported by the ROS image message. Hence, the options for <code class="language-plaintext highlighter-rouge">format</code> are limited to pixel formats that are supported by the camera and the raw ROS image message.</p>

<h3 id="sensor-modes-and-cropping">Sensor Modes and Cropping</h3>

<p>Most camera modules provide different sensor modes, some of which provide a smaller resolution version of the full picture, whereas others have a limited field-of-view, e.g. by allowing for the selection of a 3:2 image from a 16:9 sensor, a more native ‘digital zoom’ effect by cropping the picture etc. The benefit of this is to perform compute intensive tasks at the source (the sensor), rather than downstream in the GPU or in application code. Unless we specify the sensor mode we want, libcamera will automatically select one. Unfortunately, it is not guaranteed that the selected mode will be a full sensor mode, leading to a potential cropping of the picture.</p>

<p>Example: When configuring a 640x480 output stream on a Raspberry Pi Camera Module v2, libcamera will automatically choose a heavily cropped 640x480 sensor mode, leading to a digital zoom of ~2.5x.</p>

<p>See the <a href="https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf">PiCamera2 Documentation, section 4.2.2.3</a> for a detailed explanation. The <a href="https://picamera.readthedocs.io/en/release-1.13/fov.html#sensor-modes">PiCamera Documentation</a> has a good visualization of the issue. Read the documentation of your camera to see what modes are available, and which (if any) raw formats are cropped.</p>

<h3 id="dynamic-frame-configuration-controls">Dynamic Frame Configuration (controls)</h3>

<p>The dynamic parameters are created at runtime by inspecting the <a href="https://libcamera.org/api-html/namespacelibcamera_1_1controls.html">controls</a> that are exposed by the camera. The set of exposed controls is camera-dependent. The ROS parameters are directly formatted from the exposed controls, hence the parameter names match the control names.</p>

<p>libcamera does not expose the framerate directly as a parameter. Instead, the framerate range has to be converted to a duration:
\(\text{duration} = \frac{1}{\text{framerate}} \cdot 10^6 \\ µs\)
and then set via the control <code class="language-plaintext highlighter-rouge">FrameDurationLimits</code>, if it is exposed by the camera:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set fixed framerate of 20 Hz (50 ms)</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> FrameDurationLimits:<span class="o">=</span><span class="s2">"[50000,50000]"</span>

</code></pre></div></div>

<h2 id="calibration">Calibration</h2>

<p>The node uses the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> to manage the <a href="https://docs.ros.org/en/rolling/p/image_pipeline/camera_info.html">camera parameters</a>, such as the camera intrinsics for projection and distortion coefficients for rectification. Its tasks include loading the parameters from the calibration file, publishing them on <code class="language-plaintext highlighter-rouge">~/camera_info</code> and setting new parameters via service <code class="language-plaintext highlighter-rouge">~/set_camera_info</code>.</p>

<p>The URL for the camera calibration file can be set using the <code class="language-plaintext highlighter-rouge">camera_info_url</code> parameter, however it defaults to <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>. Note that when setting the URL manually, the provided string must be in the URL format, not a local file path (eg. <code class="language-plaintext highlighter-rouge">file:///home/nonroot/camera/calibration.yaml</code>). For more information, please take a look at the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> <a href="https://docs.ros.org/en/ros2_packages/rolling/api/camera_info_manager/generated/classcamera__info__manager_1_1CameraInfoManager.html">API documentation</a>.</p>

<p>If the camera has not been calibrated yet and the calibration file does not exist, the node will warn the user about the missing file (<code class="language-plaintext highlighter-rouge">Camera calibration file ~/.ros/camera_info/$NAME.yaml not found</code>) and publish zero-initialised intrinsic parameters. If you do not need to project between the 2D image plane and the 3D camera frame or rectify the image, you can safely ignore this.</p>

<p>To calibrate the camera and set the parameters, you can use the <a href="https://docs.ros.org/en/rolling/p/camera_calibration/"><code class="language-plaintext highlighter-rouge">cameracalibrator</code></a> from the <code class="language-plaintext highlighter-rouge">camera_calibration</code> package or any other node that interfaces with the <code class="language-plaintext highlighter-rouge">~/set_camera_info</code> service.</p>

<h2 id="trouble-shooting">Trouble Shooting</h2>

<p>To debug the node, first compile it in <code class="language-plaintext highlighter-rouge">Debug</code> mode:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Debug

</code></pre></div></div>
<p>and then run the node with libcamera and ROS debug information in <code class="language-plaintext highlighter-rouge">gdb</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LIBCAMERA_LOG_LEVELS</span><span class="o">=</span><span class="k">*</span>:DEBUG ros2 run <span class="nt">--prefix</span> <span class="s1">'gdb -ex run --args'</span> camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">--log-level</span> camera:<span class="o">=</span>debug <span class="nt">-p</span> width:<span class="o">=</span>640 <span class="nt">-p</span> height:<span class="o">=</span>480

</code></pre></div></div>

<h3 id="common-issues">Common Issues</h3>

<h4 id="no-camera-is-detected-exception-no-cameras-available">No camera is detected (exception <code class="language-plaintext highlighter-rouge">no cameras available</code>)</h4>

<p>For standard V4L2 camera devices, check that its connection is detected (<code class="language-plaintext highlighter-rouge">lsusb</code>) and that it is also detected by V4L2 (<code class="language-plaintext highlighter-rouge">v4l2-ctl --list-devices</code>).</p>

<p>On the Raspberry Pi, use <code class="language-plaintext highlighter-rouge">sudo vclog --msg</code> to inspect the VideoCore log messages for detected cameras. <code class="language-plaintext highlighter-rouge">vclog</code> is part of Raspberry Pi’s <code class="language-plaintext highlighter-rouge">utils</code> repo at https://github.com/raspberrypi/utils. If this is not available in your distribution, such as Ubuntu, you have to build it from source:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install build dependencies</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> wget ca-certificates gcc libc6-dev
<span class="c"># download vclog and build</span>
wget https://raw.githubusercontent.com/raspberrypi/utils/refs/heads/master/vclog/vclog.c
gcc vclog.c <span class="nt">-o</span> vclog
<span class="c"># show VideoCore log messages</span>
<span class="nb">sudo</span> ./vclog <span class="nt">--msg</span>

</code></pre></div></div>

<p>In the VideoCore log, you should find something like <code class="language-plaintext highlighter-rouge">Found camera 'ov5647' []</code> or <code class="language-plaintext highlighter-rouge">Found camera 'imx708' [...]</code>, which indicates the connected sensor, in these cases the <em>OmniVision OV5647</em> and <em>Sony IMX708</em>. Look up this sensor in the <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#hardware-specification">Raspberry Pi camera modules <em>Hardware Specification</em></a> and match the detected sensor with with the camera module. In this case, the <em>OmniVision OV5647</em> image sensor belongs to the Camera Module 1 and the <em>Sony IMX708</em> to the Camera Module 3.</p>

<p>If you are using a Raspberry Pi Camera Module, make sure that it is supported by the libcamera variant that you have installed. For example, the official upstream libcamera supports the Camera Module 1 (OmniVision OV5647), while the Camera Module 3 (Sony IMX708) is currently only supported by the “raspberrypi” fork of libcamera. To verify that your camera is working with libcamera, build the <code class="language-plaintext highlighter-rouge">cam</code> example from the libcamera repo and list the camera devices with <code class="language-plaintext highlighter-rouge">cam -l</code>. For a camera with the <em>OmniVision OV5647</em> sensor, this will show something like <code class="language-plaintext highlighter-rouge">'ov5647' (/base/axi/pcie@120000/rp1/i2c@88000/ov5647@36)</code> and for the <em>Sony IMX708</em> something like <code class="language-plaintext highlighter-rouge">'imx708_wide' (/base/axi/pcie@120000/rp1/i2c@88000/imx708@1a)</code>.</p>

<h4 id="buffer-allocation-issues-exception-failed-to-allocate-buffers">Buffer allocation issues (exception <code class="language-plaintext highlighter-rouge">Failed to allocate buffers</code>)</h4>

<p>If the node fails to allocate buffers, you are probably running out of video memory. This is most likely the case on resource constrained devices with limited memory, such as the Raspberry Pi Zero.</p>

<p>To avoid this, either increase the video memory via <code class="language-plaintext highlighter-rouge">raspi-config</code>, or decrease the buffer size by reducing the image resolution (parameters <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>) and/or selecting a chroma subsampled or compressed pixel format that uses less bits per pixel (parameter <code class="language-plaintext highlighter-rouge">format</code>). For example, a raw format like <code class="language-plaintext highlighter-rouge">XRGB8888</code> uses 32 bits for each individual pixel, while a chroma subsampled format like <code class="language-plaintext highlighter-rouge">YUYV</code> only uses 32 bits per two pixels due to the subsampling of the colour components. For details on pixel formats, see the <a href="https://www.kernel.org/doc/html/latest/userspace-api/media/v4l/pixfmt.html">Linux Kernel Image Formats documentation</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
        <a class="label label-primary pkg-label" href="/p/camera_ros">camera_ros</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS 2 node for libcamera supported cameras (V4L2, Raspberry Pi Camera Modules)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/christianrauch/camera_ros.git">https://github.com/christianrauch/camera_ros.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/camera_ros/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/camera_ros">camera_ros</a></td>
                    <td>0.4.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="ros-2-node-for-libcamera">ROS 2 node for libcamera</h1>

<p>This ROS 2 node provides support for a variety of cameras via <a href="https://libcamera.org">libcamera</a>. Amongst others, this node supports V4L2 and <a href="https://www.raspberrypi.com/documentation/computers/camera_software.html">Raspberry Pi cameras</a>.</p>

<h2 id="installation">Installation</h2>

<p>Binary packages are available via the ROS package repository for some Linux and ROS distributions (check with <code class="language-plaintext highlighter-rouge">rosdep resolve camera_ros</code>). If it’s available, you can install the DEB or RPM packages via:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># source a ROS distribution</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="c"># DEB package</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>
<span class="c"># RPM package</span>
<span class="nb">sudo </span>dnf <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>

</code></pre></div></div>

<blockquote>
  <p>[!NOTE]
This also installs the package <a href="https://index.ros.org/r/libcamera/"><code class="language-plaintext highlighter-rouge">libcamera</code></a> as dependency. This is the bloomed version of the official upstream repo at https://git.libcamera.org/libcamera/libcamera.git and may not contain full support for all Raspberry Pi camera modules. If you need full camera module support on Raspberry Pi, you have to build the “raspberrypi” fork from https://github.com/raspberrypi/libcamera manually.</p>
</blockquote>

<h2 id="build-instructions">Build Instructions</h2>

<h3 id="libcamera">libcamera</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> node depends on libcamera version 0.1 or later. There are different ways to install this dependency:</p>

<ul>
  <li>
    <p><strong>System Package:</strong> Most Linux distributions provide a binary libcamera package. However, the Raspberry Pi OS uses a <a href="https://github.com/raspberrypi/libcamera">custom libcamera fork</a> with additional support for newer camera modules. When using the distribution packages, you have to skip the <code class="language-plaintext highlighter-rouge">libcamera</code> rosdep key when resolving dependencies (<code class="language-plaintext highlighter-rouge">rosdep install [...] --skip-keys=libcamera</code>).</p>
  </li>
  <li>
    <p><strong>ROS Package:</strong> You can also install a newer version from the ROS repo (package <code class="language-plaintext highlighter-rouge">ros-$ROS_DISTRO-libcamera</code>). This package will be installed by default when building <code class="language-plaintext highlighter-rouge">camera_ros</code> from source and resolving the rosdep keys.</p>
  </li>
  <li>
    <p><strong>Source:</strong> Finally, you can always build libcamera from source. This is currently the only option for using the “raspberrypi” fork on Ubuntu. You can build libcamera as part of the ROS workspace using <code class="language-plaintext highlighter-rouge">colcon-meson</code>. This is recommended over a system-wide installation as it avoids conflicts with the system package. You will need to install the following dependencies:</p>
    <ol>
      <li>Install the libcamera build dependencies according to https://libcamera.org/getting-started.html#dependencies.</li>
      <li>Install <code class="language-plaintext highlighter-rouge">colcon-meson</code> via the package manager, <code class="language-plaintext highlighter-rouge">sudo apt install -y python3-colcon-meson</code>, or pip, <code class="language-plaintext highlighter-rouge">pip install colcon-meson</code>.</li>
    </ol>
  </li>
</ul>

<h3 id="camera_ros">camera_ros</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> package is built together with libcamera in a colcon workspace:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create workspace</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/camera_ws/src
<span class="nb">cd</span> ~/camera_ws/src

<span class="c"># check out libcamera</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install </span>python3-colcon-meson
<span class="c"># Option A: official upstream</span>
git clone https://git.libcamera.org/libcamera/libcamera.git
<span class="c"># Option B: raspberrypi fork with support for newer camera modules</span>
<span class="c"># git clone https://github.com/raspberrypi/libcamera.git</span>

<span class="c"># check out this camera_ros repository</span>
git clone https://github.com/christianrauch/camera_ros.git

<span class="c"># resolve binary dependencies and build workspace</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="nb">cd</span> ~/camera_ws/
rosdep <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--from-paths</span> src <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> <span class="nv">$ROS_DISTRO</span> <span class="nt">--skip-keys</span><span class="o">=</span>libcamera
colcon build <span class="nt">--event-handlers</span><span class="o">=</span>console_direct+

</code></pre></div></div>

<p>If you are using a binary distribution of libcamera, you can skip adding this to the workspace. Additionally, if you want to use the bloomed libcamera package in the ROS repos, you can also omit <code class="language-plaintext highlighter-rouge">--skip-keys=libcamera</code> and have this binary dependency resolved automatically.</p>

<h2 id="launching-the-node">Launching the Node</h2>

<p>The package provides a standalone node executable:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run camera_ros camera_node

</code></pre></div></div>
<p>a composable node (<code class="language-plaintext highlighter-rouge">camera::CameraNode</code>):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 component standalone camera_ros camera::CameraNode

</code></pre></div></div>
<p>and an example launch file for the composable node:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch camera_ros camera.launch.py

</code></pre></div></div>

<h2 id="interfaces">Interfaces</h2>

<p>The camera node interfaces are compatible with the <a href="https://github.com/ros-perception/image_pipeline"><code class="language-plaintext highlighter-rouge">image_pipeline</code></a> stack. The node publishes the camera images and camera parameters and provides a service to set the camera parameters.</p>

<h3 id="topics">Topics</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/Image</code></td>
      <td>image</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw/compressed</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CompressedImage</code></td>
      <td>image (compressed)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CameraInfo</code></td>
      <td>camera parameters</td>
    </tr>
  </tbody>
</table>

<h3 id="services">Services</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/set_camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/srv/SetCameraInfo</code></td>
      <td>set camera parameters</td>
    </tr>
  </tbody>
</table>

<h2 id="parameters">Parameters</h2>

<p>The node provides two sets of parameters:</p>
<ol>
  <li>static read-only parameters to configure the camera stream once at the beginning</li>
  <li>dynamic parameters which are generated from the camera controls to change per-frame settings and which can be changed at runtime</li>
</ol>

<p>Those parameters can be set on the command line:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># standalone executable</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2
<span class="c"># composable node</span>
ros2 component standalone camera_ros camera::CameraNode <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2

</code></pre></div></div>
<p>or dynamically via the <a href="https://docs.ros.org/en/rolling/Concepts/Basic/About-Parameters.html">ROS parameter API</a>.</p>

<h3 id="static-camera-stream-configuration">Static Camera Stream Configuration</h3>

<p>The camera stream is configured once when the node starts via the following static read-only parameters:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera</code></td>
      <td>
<code class="language-plaintext highlighter-rouge">integer</code> or <code class="language-plaintext highlighter-rouge">string</code>
</td>
      <td>selects the camera by index (e.g. <code class="language-plaintext highlighter-rouge">0</code>) or by name (e.g. <code class="language-plaintext highlighter-rouge">/base/soc/i2c0mux/i2c@1/ov5647@36</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">role</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>configures the camera with a <code class="language-plaintext highlighter-rouge">StreamRole</code> (possible choices: <code class="language-plaintext highlighter-rouge">raw</code>, <code class="language-plaintext highlighter-rouge">still</code>, <code class="language-plaintext highlighter-rouge">video</code>, <code class="language-plaintext highlighter-rouge">viewfinder</code>) [default: <code class="language-plaintext highlighter-rouge">viewfinder</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">format</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>a <code class="language-plaintext highlighter-rouge">PixelFormat</code> that is supported by the camera [default: auto]</td>
    </tr>
    <tr>
      <td>
<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code>
</td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>desired image resolution [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sensor_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>desired raw sensor format resolution (format: <code class="language-plaintext highlighter-rouge">width:height</code>) [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orientation</code></td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>camera orientation in 90 degree steps (possible choices: <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">90</code>, <code class="language-plaintext highlighter-rouge">180</code>, <code class="language-plaintext highlighter-rouge">270</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera_info_url</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>URL for a camera calibration YAML file (see <a href="https://github.com/christianrauch/camera_ros/tree/main/#calibration">Calibration</a>) [default: <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>]</td>
    </tr>
  </tbody>
</table>

<p>The configuration is done in the following order:</p>
<ol>
  <li>select camera via <code class="language-plaintext highlighter-rouge">camera</code>
</li>
  <li>configure camera stream via <code class="language-plaintext highlighter-rouge">role</code>
</li>
  <li>set the pixel format for the stream via <code class="language-plaintext highlighter-rouge">format</code>
</li>
  <li>set the image resolution for the stream via <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>
</li>
  <li>set the sensor mode resolution for the raw feed from camera to GPU</li>
</ol>

<p>Each stream role only supports a discrete set of data stream configurations as a combination of the image resolution and pixel format. The selected stream configuration is validated at the end of this sequence and adjusted to the closest valid stream configuration.</p>

<p>By default, the node will select the first available camera and configures it with the default pixel format and image resolution. If a parameter has not been set, the node will print the available options and inform the user about the default choice.</p>

<p>The node avoids memory copies of the image data by directly mapping from a camera pixel format to a ROS image format, with the exception of converting between “raw” and “compressed” image formats when requested by the user. As an effect, not all pixel formats that are supported by the camera may be supported by the ROS image message. Hence, the options for <code class="language-plaintext highlighter-rouge">format</code> are limited to pixel formats that are supported by the camera and the raw ROS image message.</p>

<h3 id="sensor-modes-and-cropping">Sensor Modes and Cropping</h3>

<p>Most camera modules provide different sensor modes, some of which provide a smaller resolution version of the full picture, whereas others have a limited field-of-view, e.g. by allowing for the selection of a 3:2 image from a 16:9 sensor, a more native ‘digital zoom’ effect by cropping the picture etc. The benefit of this is to perform compute intensive tasks at the source (the sensor), rather than downstream in the GPU or in application code. Unless we specify the sensor mode we want, libcamera will automatically select one. Unfortunately, it is not guaranteed that the selected mode will be a full sensor mode, leading to a potential cropping of the picture.</p>

<p>Example: When configuring a 640x480 output stream on a Raspberry Pi Camera Module v2, libcamera will automatically choose a heavily cropped 640x480 sensor mode, leading to a digital zoom of ~2.5x.</p>

<p>See the <a href="https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf">PiCamera2 Documentation, section 4.2.2.3</a> for a detailed explanation. The <a href="https://picamera.readthedocs.io/en/release-1.13/fov.html#sensor-modes">PiCamera Documentation</a> has a good visualization of the issue. Read the documentation of your camera to see what modes are available, and which (if any) raw formats are cropped.</p>

<h3 id="dynamic-frame-configuration-controls">Dynamic Frame Configuration (controls)</h3>

<p>The dynamic parameters are created at runtime by inspecting the <a href="https://libcamera.org/api-html/namespacelibcamera_1_1controls.html">controls</a> that are exposed by the camera. The set of exposed controls is camera-dependent. The ROS parameters are directly formatted from the exposed controls, hence the parameter names match the control names.</p>

<p>libcamera does not expose the framerate directly as a parameter. Instead, the framerate range has to be converted to a duration:
\(\text{duration} = \frac{1}{\text{framerate}} \cdot 10^6 \\ µs\)
and then set via the control <code class="language-plaintext highlighter-rouge">FrameDurationLimits</code>, if it is exposed by the camera:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set fixed framerate of 20 Hz (50 ms)</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> FrameDurationLimits:<span class="o">=</span><span class="s2">"[50000,50000]"</span>

</code></pre></div></div>

<h2 id="calibration">Calibration</h2>

<p>The node uses the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> to manage the <a href="https://docs.ros.org/en/rolling/p/image_pipeline/camera_info.html">camera parameters</a>, such as the camera intrinsics for projection and distortion coefficients for rectification. Its tasks include loading the parameters from the calibration file, publishing them on <code class="language-plaintext highlighter-rouge">~/camera_info</code> and setting new parameters via service <code class="language-plaintext highlighter-rouge">~/set_camera_info</code>.</p>

<p>The URL for the camera calibration file can be set using the <code class="language-plaintext highlighter-rouge">camera_info_url</code> parameter, however it defaults to <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>. Note that when setting the URL manually, the provided string must be in the URL format, not a local file path (eg. <code class="language-plaintext highlighter-rouge">file:///home/nonroot/camera/calibration.yaml</code>). For more information, please take a look at the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> <a href="https://docs.ros.org/en/ros2_packages/rolling/api/camera_info_manager/generated/classcamera__info__manager_1_1CameraInfoManager.html">API documentation</a>.</p>

<p>If the camera has not been calibrated yet and the calibration file does not exist, the node will warn the user about the missing file (<code class="language-plaintext highlighter-rouge">Camera calibration file ~/.ros/camera_info/$NAME.yaml not found</code>) and publish zero-initialised intrinsic parameters. If you do not need to project between the 2D image plane and the 3D camera frame or rectify the image, you can safely ignore this.</p>

<p>To calibrate the camera and set the parameters, you can use the <a href="https://docs.ros.org/en/rolling/p/camera_calibration/"><code class="language-plaintext highlighter-rouge">cameracalibrator</code></a> from the <code class="language-plaintext highlighter-rouge">camera_calibration</code> package or any other node that interfaces with the <code class="language-plaintext highlighter-rouge">~/set_camera_info</code> service.</p>

<h2 id="trouble-shooting">Trouble Shooting</h2>

<p>To debug the node, first compile it in <code class="language-plaintext highlighter-rouge">Debug</code> mode:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Debug

</code></pre></div></div>
<p>and then run the node with libcamera and ROS debug information in <code class="language-plaintext highlighter-rouge">gdb</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LIBCAMERA_LOG_LEVELS</span><span class="o">=</span><span class="k">*</span>:DEBUG ros2 run <span class="nt">--prefix</span> <span class="s1">'gdb -ex run --args'</span> camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">--log-level</span> camera:<span class="o">=</span>debug <span class="nt">-p</span> width:<span class="o">=</span>640 <span class="nt">-p</span> height:<span class="o">=</span>480

</code></pre></div></div>

<h3 id="common-issues">Common Issues</h3>

<h4 id="no-camera-is-detected-exception-no-cameras-available">No camera is detected (exception <code class="language-plaintext highlighter-rouge">no cameras available</code>)</h4>

<p>For standard V4L2 camera devices, check that its connection is detected (<code class="language-plaintext highlighter-rouge">lsusb</code>) and that it is also detected by V4L2 (<code class="language-plaintext highlighter-rouge">v4l2-ctl --list-devices</code>).</p>

<p>On the Raspberry Pi, use <code class="language-plaintext highlighter-rouge">sudo vclog --msg</code> to inspect the VideoCore log messages for detected cameras. <code class="language-plaintext highlighter-rouge">vclog</code> is part of Raspberry Pi’s <code class="language-plaintext highlighter-rouge">utils</code> repo at https://github.com/raspberrypi/utils. If this is not available in your distribution, such as Ubuntu, you have to build it from source:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install build dependencies</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> wget ca-certificates gcc libc6-dev
<span class="c"># download vclog and build</span>
wget https://raw.githubusercontent.com/raspberrypi/utils/refs/heads/master/vclog/vclog.c
gcc vclog.c <span class="nt">-o</span> vclog
<span class="c"># show VideoCore log messages</span>
<span class="nb">sudo</span> ./vclog <span class="nt">--msg</span>

</code></pre></div></div>

<p>In the VideoCore log, you should find something like <code class="language-plaintext highlighter-rouge">Found camera 'ov5647' []</code> or <code class="language-plaintext highlighter-rouge">Found camera 'imx708' [...]</code>, which indicates the connected sensor, in these cases the <em>OmniVision OV5647</em> and <em>Sony IMX708</em>. Look up this sensor in the <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#hardware-specification">Raspberry Pi camera modules <em>Hardware Specification</em></a> and match the detected sensor with with the camera module. In this case, the <em>OmniVision OV5647</em> image sensor belongs to the Camera Module 1 and the <em>Sony IMX708</em> to the Camera Module 3.</p>

<p>If you are using a Raspberry Pi Camera Module, make sure that it is supported by the libcamera variant that you have installed. For example, the official upstream libcamera supports the Camera Module 1 (OmniVision OV5647), while the Camera Module 3 (Sony IMX708) is currently only supported by the “raspberrypi” fork of libcamera. To verify that your camera is working with libcamera, build the <code class="language-plaintext highlighter-rouge">cam</code> example from the libcamera repo and list the camera devices with <code class="language-plaintext highlighter-rouge">cam -l</code>. For a camera with the <em>OmniVision OV5647</em> sensor, this will show something like <code class="language-plaintext highlighter-rouge">'ov5647' (/base/axi/pcie@120000/rp1/i2c@88000/ov5647@36)</code> and for the <em>Sony IMX708</em> something like <code class="language-plaintext highlighter-rouge">'imx708_wide' (/base/axi/pcie@120000/rp1/i2c@88000/imx708@1a)</code>.</p>

<h4 id="buffer-allocation-issues-exception-failed-to-allocate-buffers">Buffer allocation issues (exception <code class="language-plaintext highlighter-rouge">Failed to allocate buffers</code>)</h4>

<p>If the node fails to allocate buffers, you are probably running out of video memory. This is most likely the case on resource constrained devices with limited memory, such as the Raspberry Pi Zero.</p>

<p>To avoid this, either increase the video memory via <code class="language-plaintext highlighter-rouge">raspi-config</code>, or decrease the buffer size by reducing the image resolution (parameters <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>) and/or selecting a chroma subsampled or compressed pixel format that uses less bits per pixel (parameter <code class="language-plaintext highlighter-rouge">format</code>). For example, a raw format like <code class="language-plaintext highlighter-rouge">XRGB8888</code> uses 32 bits for each individual pixel, while a chroma subsampled format like <code class="language-plaintext highlighter-rouge">YUYV</code> only uses 32 bits per two pixels due to the subsampling of the colour components. For details on pixel formats, see the <a href="https://www.kernel.org/doc/html/latest/userspace-api/media/v4l/pixfmt.html">Linux Kernel Image Formats documentation</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
        <a class="label label-primary pkg-label" href="/p/camera_ros">camera_ros</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">ROS 2 node for libcamera supported cameras (V4L2, Raspberry Pi Camera Modules)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/christianrauch/camera_ros.git">https://github.com/christianrauch/camera_ros.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-04-24
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/camera_ros/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/camera_ros/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/camera_ros">camera_ros</a></td>
                    <td>0.4.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="ros-2-node-for-libcamera">ROS 2 node for libcamera</h1>

<p>This ROS 2 node provides support for a variety of cameras via <a href="https://libcamera.org">libcamera</a>. Amongst others, this node supports V4L2 and <a href="https://www.raspberrypi.com/documentation/computers/camera_software.html">Raspberry Pi cameras</a>.</p>

<h2 id="installation">Installation</h2>

<p>Binary packages are available via the ROS package repository for some Linux and ROS distributions (check with <code class="language-plaintext highlighter-rouge">rosdep resolve camera_ros</code>). If it’s available, you can install the DEB or RPM packages via:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># source a ROS distribution</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="c"># DEB package</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>
<span class="c"># RPM package</span>
<span class="nb">sudo </span>dnf <span class="nb">install </span>ros-<span class="nv">$ROS_DISTRO</span><span class="nt">-camera-ros</span>

</code></pre></div></div>

<blockquote>
  <p>[!NOTE]
This also installs the package <a href="https://index.ros.org/r/libcamera/"><code class="language-plaintext highlighter-rouge">libcamera</code></a> as dependency. This is the bloomed version of the official upstream repo at https://git.libcamera.org/libcamera/libcamera.git and may not contain full support for all Raspberry Pi camera modules. If you need full camera module support on Raspberry Pi, you have to build the “raspberrypi” fork from https://github.com/raspberrypi/libcamera manually.</p>
</blockquote>

<h2 id="build-instructions">Build Instructions</h2>

<h3 id="libcamera">libcamera</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> node depends on libcamera version 0.1 or later. There are different ways to install this dependency:</p>

<ul>
  <li>
    <p><strong>System Package:</strong> Most Linux distributions provide a binary libcamera package. However, the Raspberry Pi OS uses a <a href="https://github.com/raspberrypi/libcamera">custom libcamera fork</a> with additional support for newer camera modules. When using the distribution packages, you have to skip the <code class="language-plaintext highlighter-rouge">libcamera</code> rosdep key when resolving dependencies (<code class="language-plaintext highlighter-rouge">rosdep install [...] --skip-keys=libcamera</code>).</p>
  </li>
  <li>
    <p><strong>ROS Package:</strong> You can also install a newer version from the ROS repo (package <code class="language-plaintext highlighter-rouge">ros-$ROS_DISTRO-libcamera</code>). This package will be installed by default when building <code class="language-plaintext highlighter-rouge">camera_ros</code> from source and resolving the rosdep keys.</p>
  </li>
  <li>
    <p><strong>Source:</strong> Finally, you can always build libcamera from source. This is currently the only option for using the “raspberrypi” fork on Ubuntu. You can build libcamera as part of the ROS workspace using <code class="language-plaintext highlighter-rouge">colcon-meson</code>. This is recommended over a system-wide installation as it avoids conflicts with the system package. You will need to install the following dependencies:</p>
    <ol>
      <li>Install the libcamera build dependencies according to https://libcamera.org/getting-started.html#dependencies.</li>
      <li>Install <code class="language-plaintext highlighter-rouge">colcon-meson</code> via the package manager, <code class="language-plaintext highlighter-rouge">sudo apt install -y python3-colcon-meson</code>, or pip, <code class="language-plaintext highlighter-rouge">pip install colcon-meson</code>.</li>
    </ol>
  </li>
</ul>

<h3 id="camera_ros">camera_ros</h3>

<p>The <code class="language-plaintext highlighter-rouge">camera_ros</code> package is built together with libcamera in a colcon workspace:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create workspace</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> ~/camera_ws/src
<span class="nb">cd</span> ~/camera_ws/src

<span class="c"># check out libcamera</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install </span>python3-colcon-meson
<span class="c"># Option A: official upstream</span>
git clone https://git.libcamera.org/libcamera/libcamera.git
<span class="c"># Option B: raspberrypi fork with support for newer camera modules</span>
<span class="c"># git clone https://github.com/raspberrypi/libcamera.git</span>

<span class="c"># check out this camera_ros repository</span>
git clone https://github.com/christianrauch/camera_ros.git

<span class="c"># resolve binary dependencies and build workspace</span>
<span class="nb">source</span> /opt/ros/<span class="nv">$ROS_DISTRO</span>/setup.bash
<span class="nb">cd</span> ~/camera_ws/
rosdep <span class="nb">install</span> <span class="nt">-y</span> <span class="nt">--from-paths</span> src <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> <span class="nv">$ROS_DISTRO</span> <span class="nt">--skip-keys</span><span class="o">=</span>libcamera
colcon build <span class="nt">--event-handlers</span><span class="o">=</span>console_direct+

</code></pre></div></div>

<p>If you are using a binary distribution of libcamera, you can skip adding this to the workspace. Additionally, if you want to use the bloomed libcamera package in the ROS repos, you can also omit <code class="language-plaintext highlighter-rouge">--skip-keys=libcamera</code> and have this binary dependency resolved automatically.</p>

<h2 id="launching-the-node">Launching the Node</h2>

<p>The package provides a standalone node executable:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run camera_ros camera_node

</code></pre></div></div>
<p>a composable node (<code class="language-plaintext highlighter-rouge">camera::CameraNode</code>):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 component standalone camera_ros camera::CameraNode

</code></pre></div></div>
<p>and an example launch file for the composable node:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch camera_ros camera.launch.py

</code></pre></div></div>

<h2 id="interfaces">Interfaces</h2>

<p>The camera node interfaces are compatible with the <a href="https://github.com/ros-perception/image_pipeline"><code class="language-plaintext highlighter-rouge">image_pipeline</code></a> stack. The node publishes the camera images and camera parameters and provides a service to set the camera parameters.</p>

<h3 id="topics">Topics</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/Image</code></td>
      <td>image</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/image_raw/compressed</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CompressedImage</code></td>
      <td>image (compressed)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/msg/CameraInfo</code></td>
      <td>camera parameters</td>
    </tr>
  </tbody>
</table>

<h3 id="services">Services</h3>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">~/set_camera_info</code></td>
      <td><code class="language-plaintext highlighter-rouge">sensor_msgs/srv/SetCameraInfo</code></td>
      <td>set camera parameters</td>
    </tr>
  </tbody>
</table>

<h2 id="parameters">Parameters</h2>

<p>The node provides two sets of parameters:</p>
<ol>
  <li>static read-only parameters to configure the camera stream once at the beginning</li>
  <li>dynamic parameters which are generated from the camera controls to change per-frame settings and which can be changed at runtime</li>
</ol>

<p>Those parameters can be set on the command line:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># standalone executable</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2
<span class="c"># composable node</span>
ros2 component standalone camera_ros camera::CameraNode <span class="nt">-p</span> param1:<span class="o">=</span>arg1 <span class="nt">-p</span> param2:<span class="o">=</span>arg2

</code></pre></div></div>
<p>or dynamically via the <a href="https://docs.ros.org/en/rolling/Concepts/Basic/About-Parameters.html">ROS parameter API</a>.</p>

<h3 id="static-camera-stream-configuration">Static Camera Stream Configuration</h3>

<p>The camera stream is configured once when the node starts via the following static read-only parameters:</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera</code></td>
      <td>
<code class="language-plaintext highlighter-rouge">integer</code> or <code class="language-plaintext highlighter-rouge">string</code>
</td>
      <td>selects the camera by index (e.g. <code class="language-plaintext highlighter-rouge">0</code>) or by name (e.g. <code class="language-plaintext highlighter-rouge">/base/soc/i2c0mux/i2c@1/ov5647@36</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">role</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>configures the camera with a <code class="language-plaintext highlighter-rouge">StreamRole</code> (possible choices: <code class="language-plaintext highlighter-rouge">raw</code>, <code class="language-plaintext highlighter-rouge">still</code>, <code class="language-plaintext highlighter-rouge">video</code>, <code class="language-plaintext highlighter-rouge">viewfinder</code>) [default: <code class="language-plaintext highlighter-rouge">viewfinder</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">format</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>a <code class="language-plaintext highlighter-rouge">PixelFormat</code> that is supported by the camera [default: auto]</td>
    </tr>
    <tr>
      <td>
<code class="language-plaintext highlighter-rouge">width</code>, <code class="language-plaintext highlighter-rouge">height</code>
</td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>desired image resolution [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sensor_mode</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>desired raw sensor format resolution (format: <code class="language-plaintext highlighter-rouge">width:height</code>) [default: auto]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">orientation</code></td>
      <td><code class="language-plaintext highlighter-rouge">integer</code></td>
      <td>camera orientation in 90 degree steps (possible choices: <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">90</code>, <code class="language-plaintext highlighter-rouge">180</code>, <code class="language-plaintext highlighter-rouge">270</code>) [default: <code class="language-plaintext highlighter-rouge">0</code>]</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">camera_info_url</code></td>
      <td><code class="language-plaintext highlighter-rouge">string</code></td>
      <td>URL for a camera calibration YAML file (see <a href="https://github.com/christianrauch/camera_ros/tree/main/#calibration">Calibration</a>) [default: <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>]</td>
    </tr>
  </tbody>
</table>

<p>The configuration is done in the following order:</p>
<ol>
  <li>select camera via <code class="language-plaintext highlighter-rouge">camera</code>
</li>
  <li>configure camera stream via <code class="language-plaintext highlighter-rouge">role</code>
</li>
  <li>set the pixel format for the stream via <code class="language-plaintext highlighter-rouge">format</code>
</li>
  <li>set the image resolution for the stream via <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>
</li>
  <li>set the sensor mode resolution for the raw feed from camera to GPU</li>
</ol>

<p>Each stream role only supports a discrete set of data stream configurations as a combination of the image resolution and pixel format. The selected stream configuration is validated at the end of this sequence and adjusted to the closest valid stream configuration.</p>

<p>By default, the node will select the first available camera and configures it with the default pixel format and image resolution. If a parameter has not been set, the node will print the available options and inform the user about the default choice.</p>

<p>The node avoids memory copies of the image data by directly mapping from a camera pixel format to a ROS image format, with the exception of converting between “raw” and “compressed” image formats when requested by the user. As an effect, not all pixel formats that are supported by the camera may be supported by the ROS image message. Hence, the options for <code class="language-plaintext highlighter-rouge">format</code> are limited to pixel formats that are supported by the camera and the raw ROS image message.</p>

<h3 id="sensor-modes-and-cropping">Sensor Modes and Cropping</h3>

<p>Most camera modules provide different sensor modes, some of which provide a smaller resolution version of the full picture, whereas others have a limited field-of-view, e.g. by allowing for the selection of a 3:2 image from a 16:9 sensor, a more native ‘digital zoom’ effect by cropping the picture etc. The benefit of this is to perform compute intensive tasks at the source (the sensor), rather than downstream in the GPU or in application code. Unless we specify the sensor mode we want, libcamera will automatically select one. Unfortunately, it is not guaranteed that the selected mode will be a full sensor mode, leading to a potential cropping of the picture.</p>

<p>Example: When configuring a 640x480 output stream on a Raspberry Pi Camera Module v2, libcamera will automatically choose a heavily cropped 640x480 sensor mode, leading to a digital zoom of ~2.5x.</p>

<p>See the <a href="https://datasheets.raspberrypi.com/camera/picamera2-manual.pdf">PiCamera2 Documentation, section 4.2.2.3</a> for a detailed explanation. The <a href="https://picamera.readthedocs.io/en/release-1.13/fov.html#sensor-modes">PiCamera Documentation</a> has a good visualization of the issue. Read the documentation of your camera to see what modes are available, and which (if any) raw formats are cropped.</p>

<h3 id="dynamic-frame-configuration-controls">Dynamic Frame Configuration (controls)</h3>

<p>The dynamic parameters are created at runtime by inspecting the <a href="https://libcamera.org/api-html/namespacelibcamera_1_1controls.html">controls</a> that are exposed by the camera. The set of exposed controls is camera-dependent. The ROS parameters are directly formatted from the exposed controls, hence the parameter names match the control names.</p>

<p>libcamera does not expose the framerate directly as a parameter. Instead, the framerate range has to be converted to a duration:
\(\text{duration} = \frac{1}{\text{framerate}} \cdot 10^6 \\ µs\)
and then set via the control <code class="language-plaintext highlighter-rouge">FrameDurationLimits</code>, if it is exposed by the camera:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set fixed framerate of 20 Hz (50 ms)</span>
ros2 run camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">-p</span> FrameDurationLimits:<span class="o">=</span><span class="s2">"[50000,50000]"</span>

</code></pre></div></div>

<h2 id="calibration">Calibration</h2>

<p>The node uses the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> to manage the <a href="https://docs.ros.org/en/rolling/p/image_pipeline/camera_info.html">camera parameters</a>, such as the camera intrinsics for projection and distortion coefficients for rectification. Its tasks include loading the parameters from the calibration file, publishing them on <code class="language-plaintext highlighter-rouge">~/camera_info</code> and setting new parameters via service <code class="language-plaintext highlighter-rouge">~/set_camera_info</code>.</p>

<p>The URL for the camera calibration file can be set using the <code class="language-plaintext highlighter-rouge">camera_info_url</code> parameter, however it defaults to <code class="language-plaintext highlighter-rouge">~/.ros/camera_info/$NAME.yaml</code>. Note that when setting the URL manually, the provided string must be in the URL format, not a local file path (eg. <code class="language-plaintext highlighter-rouge">file:///home/nonroot/camera/calibration.yaml</code>). For more information, please take a look at the <code class="language-plaintext highlighter-rouge">CameraInfoManager</code> <a href="https://docs.ros.org/en/ros2_packages/rolling/api/camera_info_manager/generated/classcamera__info__manager_1_1CameraInfoManager.html">API documentation</a>.</p>

<p>If the camera has not been calibrated yet and the calibration file does not exist, the node will warn the user about the missing file (<code class="language-plaintext highlighter-rouge">Camera calibration file ~/.ros/camera_info/$NAME.yaml not found</code>) and publish zero-initialised intrinsic parameters. If you do not need to project between the 2D image plane and the 3D camera frame or rectify the image, you can safely ignore this.</p>

<p>To calibrate the camera and set the parameters, you can use the <a href="https://docs.ros.org/en/rolling/p/camera_calibration/"><code class="language-plaintext highlighter-rouge">cameracalibrator</code></a> from the <code class="language-plaintext highlighter-rouge">camera_calibration</code> package or any other node that interfaces with the <code class="language-plaintext highlighter-rouge">~/set_camera_info</code> service.</p>

<h2 id="trouble-shooting">Trouble Shooting</h2>

<p>To debug the node, first compile it in <code class="language-plaintext highlighter-rouge">Debug</code> mode:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build <span class="nt">--cmake-args</span> <span class="nt">-DCMAKE_BUILD_TYPE</span><span class="o">=</span>Debug

</code></pre></div></div>
<p>and then run the node with libcamera and ROS debug information in <code class="language-plaintext highlighter-rouge">gdb</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LIBCAMERA_LOG_LEVELS</span><span class="o">=</span><span class="k">*</span>:DEBUG ros2 run <span class="nt">--prefix</span> <span class="s1">'gdb -ex run --args'</span> camera_ros camera_node <span class="nt">--ros-args</span> <span class="nt">--log-level</span> camera:<span class="o">=</span>debug <span class="nt">-p</span> width:<span class="o">=</span>640 <span class="nt">-p</span> height:<span class="o">=</span>480

</code></pre></div></div>

<h3 id="common-issues">Common Issues</h3>

<h4 id="no-camera-is-detected-exception-no-cameras-available">No camera is detected (exception <code class="language-plaintext highlighter-rouge">no cameras available</code>)</h4>

<p>For standard V4L2 camera devices, check that its connection is detected (<code class="language-plaintext highlighter-rouge">lsusb</code>) and that it is also detected by V4L2 (<code class="language-plaintext highlighter-rouge">v4l2-ctl --list-devices</code>).</p>

<p>On the Raspberry Pi, use <code class="language-plaintext highlighter-rouge">sudo vclog --msg</code> to inspect the VideoCore log messages for detected cameras. <code class="language-plaintext highlighter-rouge">vclog</code> is part of Raspberry Pi’s <code class="language-plaintext highlighter-rouge">utils</code> repo at https://github.com/raspberrypi/utils. If this is not available in your distribution, such as Ubuntu, you have to build it from source:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># install build dependencies</span>
<span class="nb">sudo </span>apt <span class="nt">-y</span> <span class="nb">install</span> <span class="nt">--no-install-recommends</span> wget ca-certificates gcc libc6-dev
<span class="c"># download vclog and build</span>
wget https://raw.githubusercontent.com/raspberrypi/utils/refs/heads/master/vclog/vclog.c
gcc vclog.c <span class="nt">-o</span> vclog
<span class="c"># show VideoCore log messages</span>
<span class="nb">sudo</span> ./vclog <span class="nt">--msg</span>

</code></pre></div></div>

<p>In the VideoCore log, you should find something like <code class="language-plaintext highlighter-rouge">Found camera 'ov5647' []</code> or <code class="language-plaintext highlighter-rouge">Found camera 'imx708' [...]</code>, which indicates the connected sensor, in these cases the <em>OmniVision OV5647</em> and <em>Sony IMX708</em>. Look up this sensor in the <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#hardware-specification">Raspberry Pi camera modules <em>Hardware Specification</em></a> and match the detected sensor with with the camera module. In this case, the <em>OmniVision OV5647</em> image sensor belongs to the Camera Module 1 and the <em>Sony IMX708</em> to the Camera Module 3.</p>

<p>If you are using a Raspberry Pi Camera Module, make sure that it is supported by the libcamera variant that you have installed. For example, the official upstream libcamera supports the Camera Module 1 (OmniVision OV5647), while the Camera Module 3 (Sony IMX708) is currently only supported by the “raspberrypi” fork of libcamera. To verify that your camera is working with libcamera, build the <code class="language-plaintext highlighter-rouge">cam</code> example from the libcamera repo and list the camera devices with <code class="language-plaintext highlighter-rouge">cam -l</code>. For a camera with the <em>OmniVision OV5647</em> sensor, this will show something like <code class="language-plaintext highlighter-rouge">'ov5647' (/base/axi/pcie@120000/rp1/i2c@88000/ov5647@36)</code> and for the <em>Sony IMX708</em> something like <code class="language-plaintext highlighter-rouge">'imx708_wide' (/base/axi/pcie@120000/rp1/i2c@88000/imx708@1a)</code>.</p>

<h4 id="buffer-allocation-issues-exception-failed-to-allocate-buffers">Buffer allocation issues (exception <code class="language-plaintext highlighter-rouge">Failed to allocate buffers</code>)</h4>

<p>If the node fails to allocate buffers, you are probably running out of video memory. This is most likely the case on resource constrained devices with limited memory, such as the Raspberry Pi Zero.</p>

<p>To avoid this, either increase the video memory via <code class="language-plaintext highlighter-rouge">raspi-config</code>, or decrease the buffer size by reducing the image resolution (parameters <code class="language-plaintext highlighter-rouge">width</code> and <code class="language-plaintext highlighter-rouge">height</code>) and/or selecting a chroma subsampled or compressed pixel format that uses less bits per pixel (parameter <code class="language-plaintext highlighter-rouge">format</code>). For example, a raw format like <code class="language-plaintext highlighter-rouge">XRGB8888</code> uses 32 bits for each individual pixel, while a chroma subsampled format like <code class="language-plaintext highlighter-rouge">YUYV</code> only uses 32 bits per two pixels due to the subsampling of the colour components. For details on pixel formats, see the <a href="https://www.kernel.org/doc/html/latest/userspace-api/media/v4l/pixfmt.html">Linux Kernel Image Formats documentation</a>.</p>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/camera_ros">camera_ros</a> <small>repository</small></h3>
        <span class="label label-default">raspberry-pi</span> <span class="label label-default">v4l2</span> <span class="label label-default">ros2</span> <span class="label label-default">libcamera</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-christianrauch-camera_ros
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-christianrauch-camera_ros" role="menuitem" tabindex="-1" href="/r/camera_ros/github-christianrauch-camera_ros" data="github-christianrauch-camera_ros">
                    <span class="glyphicon glyphicon-star"></span>
                    github-christianrauch-camera_ros
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/christianrauch/camera_ros.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
