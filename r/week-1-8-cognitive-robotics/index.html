<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/week-1-8-cognitive-robotics/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">week-1-8-cognitive-robotics</li>
        <!--<li class="active">week-1-8-cognitive-robotics</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-default" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-primary" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>jazzy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        
        <a class="label label-primary pkg-label" href="/p/turtlebot3_mogi">turtlebot3_mogi</a>
        
        <a class="label label-primary pkg-label" href="/p/turtlebot3_mogi_py">turtlebot3_mogi_py</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Machine learning based line following using TurtleBot3 with ROS2 Jazzy and Gazebo Harmonic</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/mogi-ros/week-1-8-cognitive-robotics.git">https://github.com/mogi-ros/week-1-8-cognitive-robotics.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-03-31
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNKNOWN
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/week-1-8-cognitive-robotics/#github-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/week-1-8-cognitive-robotics/#github-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/week-1-8-cognitive-robotics/#github-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/turtlebot3_mogi">turtlebot3_mogi</a></td>
                    <td>1.0.0</td>
                  </tr>
                
                  <tr>
                    <td><a href="/p/turtlebot3_mogi_py">turtlebot3_mogi_py</a></td>
                    <td>1.0.0</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="week-1-8-cognitive-robotics">Week 1-8: Cognitive robotics</h1>

<h2 id="this-is-how-far-we-will-get-by-the-end-of-this-lesson">This is how far we will get by the end of this lesson:</h2>
<p><a href="https://youtu.be/Exqm_VrOytY"><img width="600" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/youtube-line-following.png"></a></p>

<h2 id="here-you-can-see-a-short-video-about-the-final-projects-from-the-previous-years">Here you can see a short video about the final projects from the previous years:</h2>

<p><a href="https://youtu.be/opmUsI7y6Y8"><img width="600" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/projects.png"></a></p>

<h1 id="table-of-contents">Table of Contents</h1>
<ol>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#ros-basics">ROS basics</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#gazebo-basics">Gazebo basics</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#turtlebot3-simulation">Turtlebot3 simulation</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#test-on-the-real-turtlebot3">Test on the real Turtlebot3</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#turtlebot3-mogi">Turtlebot3 MOGI</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#line-following">Line following</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#neural-network">Neural network</a></li>
  <li><a href="https://github.com/mogi-ros/week-1-8-cognitive-robotics/tree/main/#test-on-the-real-robot">Test on the real robot</a></li>
</ol>

<h1 id="ros-basics">ROS basics</h1>

<h2 id="what-is-ros2">What is ROS(2)?</h2>
<p>ROS, or Robot Operating System, is an open-source framework designed to facilitate the development of robotic applications. It provides a collection of tools, libraries, and conventions that simplify the process of designing complex robot behaviors across a wide variety of robotic platforms.</p>

<p>ROS was initially developed in 2007 by the Stanford Artificial Intelligence Laboratory and continued by Willow Garage, with the goal of providing a common platform for research and development in robotics. The primary motivation was to create a standard framework that could support a broad range of robotic applications, promote code reuse, and foster collaboration within the robotics community.</p>

<p>Key reasons for ROS development include:</p>

<ul>
  <li>
<strong>Standardization</strong>: Creating a common platform that simplifies the integration of different hardware and software components.</li>
  <li>
<strong>Modularity</strong>: Enabling the development of modular and reusable software components (nodes) that can be easily shared and adapted for various robotic systems.</li>
  <li>
<strong>Community Collaboration</strong>: Encouraging collaboration among researchers and developers, resulting in a vast collection of tools and libraries.</li>
</ul>

<h3 id="transition-to-ros-2">Transition to ROS 2</h3>

<p>ROS 2 was developed to address the limitations of ROS 1 and meet the growing demands for industrial and commercial robotics applications. The development began around 2014 and aimed to enhance the capabilities of ROS, particularly in areas such as security, real-time performance, and support for multi-robot systems. In practice, the biggest difference is in the underlying middleware, ROS1 uses a custom transport layer and message-passing system that was not designed for real-time or distributed applications (see ROS1’s <a href="http://wiki.ros.org/roscore"><code class="language-plaintext highlighter-rouge">roscore</code></a>).</p>

<p>The latest ROS1 release is ROS Noetic which was intended to be used on Ubuntu 20.04. It goes to <a href="http://wiki.ros.org/Distributions">EOL in May, 2025</a> together with Ubuntu 20.04.</p>

<h2 id="required-softwares">Required softwares</h2>

<details>
<summary>Ubuntu 24.04 LTS</summary>

<br>In the course we'll use ROS2 [Jazzy Jalisco](https://docs.ros.org/en/jazzy/index.html), which requires Ubuntu 24.04 for the smoothest operation.

You have a couple of options, but the most recommended is the native installation of the operating system - external SSD, dual boot, etc.

1) Native install, the most recommended way. You will learn how to set up the environment, there won't be difficulties with GPU acceleration and many more advantages.
2) Windows 11 WSL2 (Windows Subsystem Linux), see [instructions](https://documentation.ubuntu.com/wsl/en/latest/guides/install-ubuntu-wsl2/). It's a straightforward way if you want to use within Windows environment. You can still learn how to set up the environment but can be more challenging with GUI applications and 3D acceleration.
3) Virtual machine, VMware fusion is [now free for personal use](https://blogs.vmware.com/teamfusion/2024/05/fusion-pro-now-available-free-for-personal-use.html). Less flexible than WSL2 on Windows 11 but works well on macOS. 3D acceleration can be challenging.
4) Docker container. First it might look an easy way to use any ROS distribution on any host operating system, but it's getting more and more challenging if we need GUI applications, 3D acceleration and can be confusing for beginners how to work within the container. You might miss some important experience with setting up the environment if using a pre-configured container image. I only recommend this way for experienced Docker users.
5) Using an online environment e.g. [The Construct](https://www.theconstruct.ai). It looks promising that you don't have to install any special software, but you won't gain experience with setting up the environment. It can be difficult to cherry pick the software versions you need and accessing GUI applications through the web interface is a poor experience.

The options 1 and 2 are the most practical and preferred ways to use ROS. In an exotic case, if you want to run Ubuntu 24.04 and ROS2 Jazzy on macOS and Apple silicon [this](https://www.youtube.com/watch?v=kDosGTdwqO0) is a very good tutorial.

&gt;Pro tip if you want to mount directories from your host system into your guest Ubuntu 24.04 running in VMware fusion, more details [on this link](https://www.liquidweb.com/blog/create-vmware-shared-folder/):
&gt;
```bash
&gt;/usr/bin/vmhgfs-fuse .host:/BME/ROS2-lessons /home/david/ros2_ws/src/ROS2-lessons -o subtype=vmhgfs-fuse,allow_other
&gt;
```
</details>

<details>
<summary>Visual Studio Code</summary>

<br>The recommended code editor during the course is [Visual Studio Code](https://code.visualstudio.com/docs/setup/setup-overview), but it's up to your choice if you want to go with your different editor. Depending on your Ubuntu install method you might install it natively on Ubuntu, in your virtual environment or on your host operating system.

Recommended extensions to install:
- Markdown All in One
- C/C++
- Python
- CMake Tools
- Remote - SSH - if you work on physical robots, too
- Remote - WSL - if you do the course using WSL2
</details>

<details>
<summary>GitHub and a git client</summary>

<br>The course materials are available on GitHub, and the submissions of your final projects shall also use GitHub. *You'll need a very good excuse why to use alternative git solutions like GitLab.*

So I encourage everyone to [register your GitHub accounts](https://github.com/home), and if you are there don't forget to [sign up for the GitHub Student Developer Pack](https://education.github.com/pack) which gives you a bunch of powerful developer tools for free.

I recommend to use a graphical git client that can boost your experience with git, in my optinion the best one is [GitKraken](https://www.gitkraken.com), which is not a free software, but you get the pro version as part of the GitHub Student Developr Pack! If you prefer using git as a *cli* tool then no worries, it's absoluetely all right.

</details>

<details>
<summary>Markdown</summary>

<br>Markdown is not a standalone software but rather a lightweight, plain-text formatting language used to create formatted documents. It was created by John Gruber in 2004 with the goal of being easy to read and write, using simple syntax to style text, create lists, links, images, and more. It is widely used for writing documentation, readme files, and content for static websites.

Basic Markdown Syntax

- Headings: `#` Heading 1, `##` Heading 2, etc.
- Bold: `**bold text**` or `__bold text__`
- Italic: `*italic text*` or `_italic text_`
- Lists:
    - Unordered: `- Item` or `* Item`
    - Ordered: `1. Item`
    - Links: `[Link text](URL)`
    - Images: `![Alt text](Image URL)`
    - Code: Inline code or code blocks using triple backticks (
```)

GitHub Flavored Markdown (GFM)

GitHub Flavored Markdown (GFM) is a variant of Markdown used by GitHub to provide additional features and syntax that are not available in standard Markdown. It includes:

- Tables:
    
```
    | Column 1 | Column 2 |
    |----------|----------|
    | Row 1    | Data     |
    | Row 2    | Data     |
    
```
- Task lists:
    
```
    - [x] Task 1
    - [ ] Task 2
    
```
- Strikethrough: `~~strikethrough text~~`
- Syntax highlighting in a specific language:
    
```
    
```python
    def hello_world():
    print("Hello, world!")
    
```
- Tables of Contents
- @mentions for users, references to issues, and pull requests using #number

Most of the tips and tricks that you might need for your own project documentation can be found [in the source of this readme](https://github.com/MOGI-ROS/Week-1-2-Introduction-to-ROS2/blob/main/README.md?plain=1) that you read right now, feel free to use any snippets from it!

</details>

<details>
<summary>A good terminal</summary>

<br>It's up to your choice which terminal tool would you like to use, but I strongly recommend one that support multiple split windows in a single unified window, because we will use a **lot of** terminals! On Linux, I can recommend  `terminator`:
![alt text][image2]

In case you use WSL2, the built-in Windows terminal also support multiple panes and works really well!
![alt text][image3]

</details>

<details>
<summary>And finally, install ROS2 Jazzy</summary>

<br>ROS always had very good and detailed installed guides, it's not anything different for ROS2's Jazzy release.
The installation steps can be found [here](https://docs.ros.org/en/jazzy/Installation/Ubuntu-Install-Debs.html), with Ubuntu 24.04 it can be installed simply through pre-built, binary `deb` packages.

After installing it we have to set up our ROS2 environment with the following command:

```bash
source /opt/ros/jazzy/setup.bash

```

By default, we have to run this command in every new shell session we start, but there is a powerful tool in Linux for such use cases. `.bashrc` file is always in the user's home directory and it is used for user-specific settings for our shell sessions. You can edit `.bashrc` directly in a terminal window with a basic text editor, like `nano`:


```bash
david@david-ubuntu24:~$ nano .bashrc

```

Here, you can add your custom user-specific settings in the end of the file, that will be executed every time you initiate a new shell session.
I created an [example gist](https://gist.github.com/dudasdavid/bb2366e2a68bf1401ed692e41fed04d8) that you can add to the end of your file and use it during the course.

ROS2 Jazzy has [an even more detailed tutorial](https://docs.ros.org/en/jazzy/Tutorials/Beginner-CLI-Tools/Configuring-ROS2-Environment.html) about setting up your environment, you can check it out, too!

</details>

<h2 id="running-some-examples">Running some examples</h2>

<p>Your ROS2 install comes with a couple of good examples as you can also find it <a href="https://docs.ros.org/en/jazzy/Installation/Ubuntu-Install-Debs.html#try-some-examples">on the install page</a>.</p>

<p>Let’s try them!</p>

<p>The following command starts a simple <code class="language-plaintext highlighter-rouge">publisher</code> written in C++. A <code class="language-plaintext highlighter-rouge">publisher</code> is a node that is responsible for sending messages with a certain type over a specific <code class="language-plaintext highlighter-rouge">topic</code> (in this example the topic’s name is <code class="language-plaintext highlighter-rouge">chatter</code> and the type is a string). A <code class="language-plaintext highlighter-rouge">topic</code> is a communication pipeline in the publish-subscribe communication model where a single message is sent to multiple subscribers, unlike message-queues that are point-to-point models, where a single message is sent to a single consumer. Publishers broadcast messages to topics, and subscribers listen to those topics to receive a copy of the message.</p>

<blockquote>
  <p>Publish-subscribe models are asynchronous, one-to-many or many-to-many interactions where the publishers don’t know how many subscribers there are (if any). Therefore publisher never expects any response or confirmation from the subscribers.</p>
</blockquote>

<p>Now, let’s run the demo publisher written in C++:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run demo_nodes_cpp talker

</code></pre></div></div>

<p>Your output should look like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 run demo_nodes_cpp talker
<span class="o">[</span>INFO] <span class="o">[</span>1727116062.558281395] <span class="o">[</span>talker]: Publishing: <span class="s1">'Hello World: 1'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727116063.558177802] <span class="o">[</span>talker]: Publishing: <span class="s1">'Hello World: 2'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727116064.558010534] <span class="o">[</span>talker]: Publishing: <span class="s1">'Hello World: 3'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727116065.557939861] <span class="o">[</span>talker]: Publishing: <span class="s1">'Hello World: 4'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727116066.557849645] <span class="o">[</span>talker]: Publishing: <span class="s1">'Hello World: 5'</span>

</code></pre></div></div>

<p>Let’s start a subscriber - written in Python - in another terminal window, which subscribes to the <code class="language-plaintext highlighter-rouge">chatter</code> topic and listens to the publisher node’s messages:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 run demo_nodes_py listener
<span class="o">[</span>INFO] <span class="o">[</span>1727116231.574662048] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 170]
<span class="o">[</span>INFO] <span class="o">[</span>1727116232.560517676] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 171]
<span class="o">[</span>INFO] <span class="o">[</span>1727116233.558907367] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 172]
<span class="o">[</span>INFO] <span class="o">[</span>1727116234.560768278] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 173]
<span class="o">[</span>INFO] <span class="o">[</span>1727116235.559821377] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 174]
<span class="o">[</span>INFO] <span class="o">[</span>1727116236.559993767] <span class="o">[</span>listener]: I heard: <span class="o">[</span>Hello World: 175]

</code></pre></div></div>

<h3 id="useful-cli-and-graphical-tools">Useful cli and graphical tools</h3>
<p>Now both nodes are running we can try a few useful tools. The first on let us know what kind of nodes are running in your ROS2 system:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node list

</code></pre></div></div>

<p>Which gives us the following output:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 node list
/listener
/talker

</code></pre></div></div>

<p>If we want to know more about one of our nodes, we can use the <code class="language-plaintext highlighter-rouge">ros2 node info /node</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 node info /listener 
/listener
  Subscribers:
    /chatter: std_msgs/msg/String
  Publishers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
    /rosout: rcl_interfaces/msg/Log
  Service Servers:
    /listener/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /listener/get_parameter_types: rcl_interfaces/srv/GetParameterTypes
    /listener/get_parameters: rcl_interfaces/srv/GetParameters
    /listener/get_type_description: type_description_interfaces/srv/GetTypeDescription
    /listener/list_parameters: rcl_interfaces/srv/ListParameters
    /listener/set_parameters: rcl_interfaces/srv/SetParameters
    /listener/set_parameters_atomically: rcl_interfaces/srv/SetParametersAtomically
  Service Clients:

  Action Servers:

  Action Clients:

</code></pre></div></div>

<p>At the moment, the most interesting detail we can gather about a node is if it’s subscribing or publishing to any topic. In later lessons we’ll learn more about parameters and services.</p>

<hr>

<p>In a very similar way, we can also list all of our topics with <code class="language-plaintext highlighter-rouge">ros2 topic list</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 topic list 
/chatter
/parameter_events
/rosout

</code></pre></div></div>

<p>And we can get more details about a certain topic with the <code class="language-plaintext highlighter-rouge">ros2 topic info /topic</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 topic info /chatter 
Type: std_msgs/msg/String
Publisher count: 1
Subscription count: 1

</code></pre></div></div>

<p>Another powerful tool is <code class="language-plaintext highlighter-rouge">rqt_graph</code> that helps us visualizing the nodes and topics in a graph.
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/rqt_graph_1.png" alt="alt text" title="rqt_graph"></p>

<p><code class="language-plaintext highlighter-rouge">rqt_graph</code> can be used as a standalone tool, or part of <code class="language-plaintext highlighter-rouge">rqt</code> which can be used to build a complete dashboard to mintor and control your nodes. We’ll spend a lot of time with it, at the moment let’s just see the message monitoring function:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/rqt_1.png" alt="alt text" title="rqt"></p>

<hr>

<h3 id="lets-run-more-examples-turtlesim">Let’s run more examples: turtlesim</h3>
<p>Let’s see another built in example which is a simple 2D plotter game.</p>
<blockquote>
  <p>In a case it’s not automatically installed, you can install it with the following command:</p>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-turtlesim

</code></pre></div>  </div>
</blockquote>

<p>To run the main node just execute the follwoing command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlesim turtlesim_node

</code></pre></div></div>

<p>And in another terminal start its remote controller, you can simply drive the turtle with the arrows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlesim turtle_teleop_key

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/turtlesim_1.png" alt="alt text" title="turtlesim"></p>

<p>We can use the same tools as before to see the running nodes and topics, here is how does it look like in <code class="language-plaintext highlighter-rouge">rqt_graph</code>.
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/rqt_graph_2.png" alt="alt text" title="rqt_graph"></p>

<blockquote>
  <p>We should notice two important things:</p>

  <ol>
    <li>turtlesim is more complex than the previous example with multiple services and parameters that we’ll check in the end of this lesson.</li>
    <li>the turtle is controlled with a <code class="language-plaintext highlighter-rouge">cmd_vel</code> message which is a 6D vector in space. We’ll use this exact same message type in the future to drive our simulated robots.</li>
  </ol>
</blockquote>

<p>Now let’s move on to create our own nodes!</p>

<h2 id="create-a-colcon-workspace">Create a colcon workspace</h2>

<p>To create, build and run custom nodes we need packages, but first we need a workspace where we’ll maintain our future packages.
There are 2 new terms we must learn about ROS2 workspaces:</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">ament</code> provides the underlying build system and tools specifically for ROS2 packages. <code class="language-plaintext highlighter-rouge">ament_cmake</code> is a CMake-based build system for C/C++ nodes and <code class="language-plaintext highlighter-rouge">ament_python</code> provides the tools for packing and installing python nodes and libraries.</li>
  <li>
<code class="language-plaintext highlighter-rouge">colcon</code> (COmmand Line COLlectioN) is a general-purpose tool to build and manage entire workspaces with various build systems, including ament, cmake, make, and more.</li>
</ol>

<p>It means that our ROS2 workspace will be a <code class="language-plaintext highlighter-rouge">colcon workspace</code> which - in the backround - will use <code class="language-plaintext highlighter-rouge">ament</code> for building the individual packages.</p>

<blockquote>
  <p>If you have experience with ROS1, <code class="language-plaintext highlighter-rouge">colcon</code> and <code class="language-plaintext highlighter-rouge">ament</code> replaces the old <code class="language-plaintext highlighter-rouge">catkin</code> tools.</p>
</blockquote>

<p>Let’s create our workspace inside our user’s home directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/ros2_ws/src
<span class="nb">cd</span> ~/ros2_ws

</code></pre></div></div>

<blockquote>
  <p>A workspace must have a <code class="language-plaintext highlighter-rouge">src</code> folder where we maintain the source files of our packages, during building of the workspace colcon will create folders for the deployment of binaries and other output files.</p>
</blockquote>

<p>Let’s go into the <code class="language-plaintext highlighter-rouge">src</code> folder and create our first python package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 pkg create <span class="nt">--build-type</span> ament_python bme_ros2_tutorials_py

</code></pre></div></div>
<blockquote>
  <p>During package creation we should define if it’s a C/C++ (<code class="language-plaintext highlighter-rouge">ament_cmake</code>) or a python (<code class="language-plaintext highlighter-rouge">ament_python</code>) package. If we don’t do it, the default is always <code class="language-plaintext highlighter-rouge">ament_cmake</code>!</p>
</blockquote>

<p>We’ll put our python scripts under <code class="language-plaintext highlighter-rouge">bme_ros2_tutorials_py</code> which is an automatically created folder with the same name as our package, it already has an empty file <code class="language-plaintext highlighter-rouge">__init__.py</code>, let’s add our first node here: <code class="language-plaintext highlighter-rouge">hello_world.py</code>.</p>

<blockquote>
  <p>We can create files in Linux in several different ways, just a few examples:</p>
  <ul>
    <li>Right click in the folder using the desktop environment</li>
    <li>Through the development environment, in our case Visual Studio Code</li>
    <li>From command line in the current folder using the <code class="language-plaintext highlighter-rouge">touch</code> command: <code class="language-plaintext highlighter-rouge">touch hello_world.py</code>
</li>
  </ul>
</blockquote>

<p>At this point our workspace should look like this (other files and folders are not important at this point):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>tree <span class="nt">-L</span> 4
<span class="nb">.</span>
└── src
    └── bme_ros2_tutorials_py
        ├── bme_ros2_tutorials_py
        │   ├── __init__.py
        │   └── hello_world.py
        ├── package.xml
        └── setup.py

</code></pre></div></div>

<blockquote>
  <p>It’s always recommended to fill the <code class="language-plaintext highlighter-rouge">description</code>, <code class="language-plaintext highlighter-rouge">maintainer</code> with your name and email address and <code class="language-plaintext highlighter-rouge">license</code> fields in your <code class="language-plaintext highlighter-rouge">package.xml</code> and <code class="language-plaintext highlighter-rouge">setup.py</code> files. I personally prefer a highly permissive license in non-commercial packages of mine, like <code class="language-plaintext highlighter-rouge">BSD</code> or <code class="language-plaintext highlighter-rouge">Apache License 2.0</code>.</p>
</blockquote>

<h2 id="lets-write-the-simplest-possible-hello_world-in-python">Let’s write the simplest possible <code class="language-plaintext highlighter-rouge">hello_world</code> in python:</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="c1"># Main entry point, args is a parameter that is used to pass arguments to the main function
</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello, world!</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Check if the script is being run directly
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<p>Although this is a python script that doesn’t require any compilation, we have to make sure that <code class="language-plaintext highlighter-rouge">ament</code> will pack, copy and install our node. It’s important to understand that we are not running python scripts directly from the source folder!</p>

<p>Let’s edit <code class="language-plaintext highlighter-rouge">setup.py</code> that was automatically generated when we defined that our package will use <code class="language-plaintext highlighter-rouge">ament_python</code>.</p>

<p>Add an entry point for our python node. An entry point describes the folder, the filename (without <code class="language-plaintext highlighter-rouge">.py</code>) and the main entry point within the script:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">...</span>
        <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
            <span class="sh">'</span><span class="s">console_scripts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                <span class="sh">'</span><span class="s">py_hello_world = bme_ros2_tutorials_py.hello_world:main</span><span class="sh">'</span>
            <span class="p">],</span>
        <span class="p">},</span>
<span class="bp">...</span>

</code></pre></div></div>

<p>Our first node within our first package is ready for building it! Build must be initiated always in the root of our workspace!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/ros2_ws

</code></pre></div></div>

<p>And here we execute the <code class="language-plaintext highlighter-rouge">colcon build</code> command.</p>

<p>After a successful build we have to update our environnment to make sure ROS2 cli tools are aware about of any new packages. To do this we have to run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source install</span>/setup.bash

</code></pre></div></div>

<p>As we did with the base ROS2 environment, we can add this to the <code class="language-plaintext highlighter-rouge">.bashrc</code> so it’ll be automatically sourced every time when we open a terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/ros2_ws/install/setup.bash

</code></pre></div></div>

<p>And now we are ready to run our first node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run bme_ros2_tutorials_py py_hello_world

</code></pre></div></div>

<p>Athough we could run our first node, it was just a plain python script, not using any ROS API. Let’s upgrade hello world to a more <em>ROS-like</em> hello world. We import the <code class="language-plaintext highlighter-rouge">rclpy</code> which is the ROS2 python API and we start using the most basic functions of <code class="language-plaintext highlighter-rouge">rclpy</code> like <code class="language-plaintext highlighter-rouge">init()</code>, <code class="language-plaintext highlighter-rouge">create_node()</code> and <code class="language-plaintext highlighter-rouge">shutdown()</code>. If you already want to do a deep-dive in the API functions you can find everything <a href="https://docs.ros.org/en/jazzy/Concepts/Basic/About-Client-Libraries.html#the-rclpy-package">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span> <span class="c1"># Import ROS2 python interface
</span>
<span class="c1"># Main entry point, args is a parameter that is used to pass arguments to the main function
</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>                          <span class="c1"># Initialize the ROS2 python interface
</span>    <span class="n">node</span> <span class="o">=</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">create_node</span><span class="p">(</span><span class="sh">'</span><span class="s">python_hello_world</span><span class="sh">'</span><span class="p">)</span> <span class="c1"># Node constructor, give it a name
</span>    <span class="n">node</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello, ROS2!</span><span class="sh">"</span><span class="p">)</span>         <span class="c1"># Use the ROS2 node's built in logger
</span>    <span class="n">node</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>                            <span class="c1"># Node destructor
</span>    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>                               <span class="c1"># Shut the ROS2 python interface down
</span>
<span class="c1"># Check if the script is being run directly
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<p>We don’t have to do anything with <code class="language-plaintext highlighter-rouge">setup.py</code>, the entrypoint is already there, but we have to re-build the colcon workspace!</p>

<p>After the build we can run our node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run bme_ros2_tutorials_py py_hello_world

</code></pre></div></div>

<h2 id="create-a-python-publisher">Create a python publisher</h2>

<p>Let’s make our first publisher in python, we create a new file in the <code class="language-plaintext highlighter-rouge">bme_ros2_tutorials_py</code> folder: <code class="language-plaintext highlighter-rouge">publisher.py</code>.</p>

<p>We start expanding step-by-step our knowledge about the ROS2 API with publishing related functions (<code class="language-plaintext highlighter-rouge">create_publisher()</code> and <code class="language-plaintext highlighter-rouge">publish()</code>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span> <span class="c1"># Import 'String' from ROS2 standard messages
</span><span class="kn">import</span> <span class="n">time</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">create_node</span><span class="p">(</span><span class="sh">'</span><span class="s">python_publisher</span><span class="sh">'</span><span class="p">)</span>
    <span class="c1"># Register the node as publisher
</span>    <span class="c1"># It will publish 'String' type to the topic named 'topic' (with a queue size of 10)
</span>    <span class="n">publisher</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="nc">String</span><span class="p">()</span>                     <span class="c1"># Initialize msg as a 'String' instance
</span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">ok</span><span class="p">():</span>                  <span class="c1"># Breaks the loop on ctrl+c
</span>        <span class="n">msg</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Hello, world: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">'</span> <span class="c1"># Write the actual string into msg's data field
</span>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">node</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Publishing: </span><span class="sh">"</span><span class="si">{</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="si">}</span><span class="sh">"'</span><span class="p">)</span>
        <span class="n">publisher</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>         <span class="c1"># Let the node publish the msg according to the publisher setup
</span>        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>                <span class="c1"># Python wait function in seconds
</span>
    <span class="n">node</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<p>We have to edit <code class="language-plaintext highlighter-rouge">setup.py</code>, registering our new node as entry point:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">...</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">console_scripts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">py_hello_world = bme_ros2_tutorials_py.hello_world:main</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">py_publisher = bme_ros2_tutorials_py.publisher:main</span><span class="sh">'</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="bp">...</span>

</code></pre></div></div>

<p>Don’t forget to rebuild the workspace and we can run our new node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 run bme_ros2_tutorials_py py_publisher
<span class="o">[</span>INFO] <span class="o">[</span>1727526317.470055907] <span class="o">[</span>python_publisher]: Publishing: <span class="s2">"Hello, world: 0"</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727526317.971461827] <span class="o">[</span>python_publisher]: Publishing: <span class="s2">"Hello, world: 1"</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727526318.473896872] <span class="o">[</span>python_publisher]: Publishing: <span class="s2">"Hello, world: 2"</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727526318.977439178] <span class="o">[</span>python_publisher]: Publishing: <span class="s2">"Hello, world: 3"</span>

</code></pre></div></div>

<p>We can observe the published topic through <code class="language-plaintext highlighter-rouge">rqt</code>’s topic monitor:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/rqt_2.png" alt="alt text" title="rqt"></p>

<p>Or we can use a simple but powerful tool, the <code class="language-plaintext highlighter-rouge">topic echo</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 topic <span class="nb">echo</span> /topic 
data: <span class="s1">'Hello, world: 23'</span>
<span class="nt">---</span>
data: <span class="s1">'Hello, world: 24'</span>
<span class="nt">---</span>
data: <span class="s1">'Hello, world: 25'</span>

</code></pre></div></div>

<p>The publisher node above is very simple and looks exactly how we historically impelented nodes in ROS1. But ROS2 provides more powerful API functions and also places a greater emphasis on object-oriented programming. So let’s create another publisher in a more OOP way and using the timer functions (<code class="language-plaintext highlighter-rouge">create_timer()</code>) of the ROS2 API. The other important API function is <code class="language-plaintext highlighter-rouge">rclpy.spin(node)</code> which keeps the node running until we don’t quit it with <code class="language-plaintext highlighter-rouge">ctrl+c</code> in the terminal.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>     <span class="c1"># Import ROS2 Node as parent for our own node class
</span><span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MyPublisherNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">"</span><span class="s">python_publisher_oop</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">publisher_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_publisher</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_timer</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">timer_callback</span><span class="p">)</span>     <span class="c1"># Timer callback, period in seconds, not frequency!
</span>        <span class="n">self</span><span class="p">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">msg</span> <span class="o">=</span> <span class="nc">String</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Publisher OOP has been started.</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">timer_callback</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>                                        <span class="c1"># Timer callback function implementation
</span>        <span class="n">self</span><span class="p">.</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Hello, world: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Publishing: </span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="si">}</span><span class="sh">"'</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">publisher_</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">msg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="nc">MyPublisherNode</span><span class="p">()</span> <span class="c1"># node is now a custom class based on ROS2 Node
</span>    <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>         <span class="c1"># Keeps the node running until it's closed with ctrl+c
</span>    <span class="n">node</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<p>As we did previously, add the new script’s entrypoint in the <code class="language-plaintext highlighter-rouge">setup.py</code>, build the workspace and run our new node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run bme_ros2_tutorials_py py_publisher_oop

</code></pre></div></div>

<h2 id="create-a-python-subscriber">Create a python subscriber</h2>

<p>Let’s create a new file <code class="language-plaintext highlighter-rouge">subscriber.py</code> in our python package (<code class="language-plaintext highlighter-rouge">bme_ros2_tutorials_py</code>). First we make a very simple implementation and after that we’ll implement a more OOP version of it again. We further extend our knowledge with more API functions related to subscriptions (<code class="language-plaintext highlighter-rouge">create_subscription()</code>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">create_node</span><span class="p">(</span><span class="sh">'</span><span class="s">python_subscriber</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscriber_callback</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>                      <span class="c1"># Subscriber callback will be invoked every time when a message arrives to the topic it has subsctibed
</span>        <span class="n">node</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">I heard: </span><span class="si">{</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># Register the node as a subscriber on a certain topic: 'topic' (with a certain data type: String)
</span>    <span class="c1"># and assign the callback function that will be invoked when a message arrives to the topic
</span>    <span class="c1"># with a queue size of 10 which determines how many incoming messages can be held in the subscriber’s
</span>    <span class="c1"># queue while waiting to be processed by the callback function
</span>    <span class="n">subscriber</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="p">,</span> <span class="n">subscriber_callback</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> 
    <span class="n">node</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Subsciber has been started.</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="n">node</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<p>Add the node to the <code class="language-plaintext highlighter-rouge">setup.py</code> file as a new entry point</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="bp">...</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">console_scripts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">'</span><span class="s">py_hello_world = bme_ros2_tutorials_py.hello_world:main</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">py_publisher = bme_ros2_tutorials_py.publisher:main</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">py_publisher_oop = bme_ros2_tutorials_py.publisher_oop:main</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">py_subscriber = bme_ros2_tutorials_py.subscriber:main</span><span class="sh">'</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="bp">...</span>

</code></pre></div></div>

<p>Then, build the workspace and we can run our new node!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 run bme_ros2_tutorials_py py_subscriber
<span class="o">[</span>INFO] <span class="o">[</span>1727606328.416973729] <span class="o">[</span>python_subscriber]: Subsciber has been started.

</code></pre></div></div>

<p>If we don’t start a publisher, then our subscriber is just keep listening to the <code class="language-plaintext highlighter-rouge">/topic</code> but the callback function is not invoked. The node doesn’t stop running because of the <code class="language-plaintext highlighter-rouge">rclpy.spin(node)</code>  function.</p>

<p>Let’s start our C++ publisher in another terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 run bme_ros2_tutorials_cpp publisher_cpp 
<span class="o">[</span>INFO] <span class="o">[</span>1727606744.184678739] <span class="o">[</span>cpp_publisher]: CPP publisher has been started.
<span class="o">[</span>INFO] <span class="o">[</span>1727606744.685934650] <span class="o">[</span>cpp_publisher]: Publishing: <span class="s1">'Hello, world: 0'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727606745.185073828] <span class="o">[</span>cpp_publisher]: Publishing: <span class="s1">'Hello, world: 1'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727606745.686288921] <span class="o">[</span>cpp_publisher]: Publishing: <span class="s1">'Hello, world: 2'</span>
<span class="o">[</span>INFO] <span class="o">[</span>1727606746.186169881] <span class="o">[</span>cpp_publisher]: Publishing: <span class="s1">'Hello, world: 3'</span>

</code></pre></div></div>

<p>And let’s see what happens with the subscriber! It’s subscription callback function is invoked every time when the publisher sends a message onto the <code class="language-plaintext highlighter-rouge">/topic</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 run bme_ros2_tutorials_py py_subscriber
<span class="o">[</span>INFO] <span class="o">[</span>1727606614.099180007] <span class="o">[</span>python_subscriber]: Subsciber has been started.
<span class="o">[</span>INFO] <span class="o">[</span>1727606744.695260304] <span class="o">[</span>python_subscriber]: I heard: Hello, world: 0
<span class="o">[</span>INFO] <span class="o">[</span>1727606745.187956805] <span class="o">[</span>python_subscriber]: I heard: Hello, world: 1
<span class="o">[</span>INFO] <span class="o">[</span>1727606745.689289484] <span class="o">[</span>python_subscriber]: I heard: Hello, world: 2
<span class="o">[</span>INFO] <span class="o">[</span>1727606746.188467429] <span class="o">[</span>python_subscriber]: I heard: Hello, world: 3

</code></pre></div></div>

<p>We can also check it with <code class="language-plaintext highlighter-rouge">rqt_graph</code>:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/rqt_graph_3.png" alt="alt text" title="rqt_graph"></p>

<blockquote>
  <p>And we can also observe the language agnostic approach of ROS2, without any additional effort this middleware provides interfacing between nodes written in different programming languages.</p>
</blockquote>

<p>As before, let’s make our subscriber more OOP using our previous template from the publisher. Compared to the publisher we just need to replace the timer callback with a subscription callback and that’s all!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="n">std_msgs.msg</span> <span class="kn">import</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">MySubscriberNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">"</span><span class="s">python_subsciber_oop</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">subscriber_callback</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Subsciber OOP has been started.</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">subscriber_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">get_logger</span><span class="p">().</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">I heard: </span><span class="si">{</span><span class="n">msg</span><span class="p">.</span><span class="n">data</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="nc">MySubscriberNode</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">node</span><span class="p">.</span><span class="nf">destroy_node</span><span class="p">()</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>
<p>Build the workspace and run the node.</p>

<h2 id="launchfiles">Launchfiles</h2>

<p>As you noticed with the previous examples we have to use as many terminals as many nodes we start. With a simple publisher and subscriber this isn’t really a big deal, but in more complex robotic projects, it’s quite common to use ROS nodes in the range of tens or even hundreds. Therefore ROS provides an efficient interface to start multiple nodes together and even re-map their topics to different ones or change its parameters instead of changing the source code itself.</p>

<p>Compared to ROS1 it’s a bit more complicated to bundle these launchfiles with our nodes, so as a best practice, I recommend creating an individual pakage only for our launcfiles.</p>

<p>Let’s create a new package with <code class="language-plaintext highlighter-rouge">ament_cmake</code> or simply without specifying the build type (by default it’s <code class="language-plaintext highlighter-rouge">ament_cmake</code>).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 pkg create bme_ros2_tutorials_bringup

</code></pre></div></div>

<p>Now let’s create a <code class="language-plaintext highlighter-rouge">launch</code> folder within this new package.
We can freely delete include and src folders:</p>

<blockquote>
  <p>If you want to delete a folder from command line that is not empty you can use the <code class="language-plaintext highlighter-rouge">rm -rf folder</code> command</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> <span class="nt">-rf</span> include/ src/

</code></pre></div></div>

<p>Add the following to the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to install the content of <code class="language-plaintext highlighter-rouge">launch</code> when we build the workspce:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">install</span><span class="o">(</span>DIRECTORY
  launch
  DESTINATION share/<span class="k">${</span><span class="nv">PROJECT_NAME</span><span class="k">}</span>
<span class="o">)</span>

</code></pre></div></div>

<p>Create a new launch file, and let’s call it <code class="language-plaintext highlighter-rouge">publisher_subscriber.launch.py</code>. In ROS2 the launchfiles are special declarative python scripts (with some imperative flavours) instead of the <code class="language-plaintext highlighter-rouge">xml</code> files we used in ROS1! Actually ROS2 also has the possibility to use <code class="language-plaintext highlighter-rouge">xml</code> based launch files, but the general usage and the documentation of this feature is very poor. Initially the python based launch system was intended to be the backend of xml launchfiles but it wasn’t ready for the initial launch of ROS2 and the community rather jumped on using the python launch system.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>publisher_subscriber.launch.py

</code></pre></div></div>

<p>Let’s create our template that we can re-use in the future with only one publisher first. When we add a node to the launch file we must define the the <code class="language-plaintext highlighter-rouge">package</code>, the <code class="language-plaintext highlighter-rouge">node</code> (executable) and a freely chosen <code class="language-plaintext highlighter-rouge">name</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="n">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="n">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="nc">LaunchDescription</span><span class="p">()</span>

    <span class="n">publisher_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="sh">"</span><span class="s">bme_ros2_tutorials_py</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">py_publisher</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">my_publisher</span><span class="sh">"</span>
    <span class="p">)</span>

    <span class="n">ld</span><span class="p">.</span><span class="nf">add_action</span><span class="p">(</span><span class="n">publisher_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ld</span>

</code></pre></div></div>

<p>Build and don’t forget to source the workspace because we added a new package!</p>

<p>After it we can execute our launchfile with the <code class="language-plaintext highlighter-rouge">ros2 launch</code> command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 launch bme_ros2_tutorials_bringup publisher_subscriber.launch.py
<span class="o">[</span>INFO] <span class="o">[</span>launch]: All log files can be found below /home/david/.ros/log/2024-09-29-14-17-29-864407-david-ubuntu24-41228
<span class="o">[</span>INFO] <span class="o">[</span>launch]: Default logging verbosity is <span class="nb">set </span>to INFO
<span class="o">[</span>INFO] <span class="o">[</span>py_publisher-1]: process started with pid <span class="o">[</span>41231]
<span class="o">[</span>py_publisher-1] <span class="o">[</span>INFO] <span class="o">[</span>1727612250.056173684] <span class="o">[</span>my_publisher]: Publishing: <span class="s2">"Hello, world: 0"</span>
<span class="o">[</span>py_publisher-1] <span class="o">[</span>INFO] <span class="o">[</span>1727612250.559170990] <span class="o">[</span>my_publisher]: Publishing: <span class="s2">"Hello, world: 1"</span>
<span class="o">[</span>py_publisher-1] <span class="o">[</span>INFO] <span class="o">[</span>1727612251.061618736] <span class="o">[</span>my_publisher]: Publishing: <span class="s2">"Hello, world: 2"</span>

</code></pre></div></div>

<blockquote>
  <p>If we don’t write the <em><code class="language-plaintext highlighter-rouge">launch</code></em> word explicitly in the filename of our launch file, the <code class="language-plaintext highlighter-rouge">ros2 launch</code> cli tool won’t be able to autocomplete the filenames.</p>
</blockquote>

<p>We can notice that our node is now called <code class="language-plaintext highlighter-rouge">my_publisher</code> instead of <code class="language-plaintext highlighter-rouge">python_publisher</code> as we coded in the node itself earlier. With the launch files we can easily rename our nodes for better handling and organizing as our application scales up.</p>

<p>We can use the <code class="language-plaintext highlighter-rouge">node list</code> tool to list our nodes and the output will look like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~/ros2_ws<span class="nv">$ </span>ros2 node list 
/my_publisher

</code></pre></div></div>

<h3 id="now-lets-add-the-subscriber-too">Now let’s add the subscriber too:</h3>

<p>Every time when we add a node to the launch file we also have to register it with the <code class="language-plaintext highlighter-rouge">ld.add_action()</code> function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="n">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="nc">LaunchDescription</span><span class="p">()</span>

    <span class="n">publisher_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="sh">"</span><span class="s">bme_ros2_tutorials_py</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">py_publisher</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">my_publisher</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">subscriber_node</span> <span class="o">=</span> <span class="nc">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="sh">"</span><span class="s">bme_ros2_tutorials_py</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">py_subscriber</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">my_subscriber</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ld</span><span class="p">.</span><span class="nf">add_action</span><span class="p">(</span><span class="n">publisher_node</span><span class="p">)</span>
    <span class="n">ld</span><span class="p">.</span><span class="nf">add_action</span><span class="p">(</span><span class="n">subscriber_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ld</span>

</code></pre></div></div>

<p>Don’t forget to rebuild the workspace so the changed launchfile will be installed, after that we can run it!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 launch bme_ros2_tutorials_bringup publisher_subscriber.launch.py
<span class="o">[</span>INFO] <span class="o">[</span>launch]: All log files can be found below /home/david/.ros/log/2024-09-29-14-20-15-603371-david-ubuntu24-41380
<span class="o">[</span>INFO] <span class="o">[</span>launch]: Default logging verbosity is <span class="nb">set </span>to INFO
<span class="o">[</span>INFO] <span class="o">[</span>py_publisher-1]: process started with pid <span class="o">[</span>41383]
<span class="o">[</span>INFO] <span class="o">[</span>py_subscriber-2]: process started with pid <span class="o">[</span>41384]
<span class="o">[</span>py_publisher-1] <span class="o">[</span>INFO] <span class="o">[</span>1727612415.811451529] <span class="o">[</span>my_publisher]: Publishing: <span class="s2">"Hello, world: 0"</span>
<span class="o">[</span>py_subscriber-2] <span class="o">[</span>INFO] <span class="o">[</span>1727612415.811459737] <span class="o">[</span>my_subscriber]: Subsciber has been started.
<span class="o">[</span>py_subscriber-2] <span class="o">[</span>INFO] <span class="o">[</span>1727612415.811878677] <span class="o">[</span>my_subscriber]: I heard: Hello, world: 0
<span class="o">[</span>py_publisher-1] <span class="o">[</span>INFO] <span class="o">[</span>1727612416.313222973] <span class="o">[</span>my_publisher]: Publishing: <span class="s2">"Hello, world: 1"</span>
<span class="o">[</span>py_subscriber-2] <span class="o">[</span>INFO] <span class="o">[</span>1727612416.315340170] <span class="o">[</span>my_subscriber]: I heard: Hello, world: 1

</code></pre></div></div>

<p>We can see that both nodes started and their logging to the standard output is combined in this single terminal window.</p>

<p>We can verify this with <code class="language-plaintext highlighter-rouge">node list</code> or using <code class="language-plaintext highlighter-rouge">rqt_graph</code> visually:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 node list 
/my_publisher
/my_subscriber

</code></pre></div></div>

<p>We can also verify the used topics with the <code class="language-plaintext highlighter-rouge">topic list</code> tool:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>david@david-ubuntu24:~<span class="nv">$ </span>ros2 topic list 
/parameter_events
/rosout
/topic

</code></pre></div></div>

<h1 id="gazebo-basics">Gazebo basics</h1>
<p>Gazebo is a powerful robotics simulation tool that provides a 3D environment for simulating robots, sensors, and objects. It is widely used in the ROS ecosystem for testing and developing robotics algorithms in a realistic virtual environment before deploying them to real hardware.</p>

<p>Gazebo integrates tightly with ROS, enabling simulation and control of robots using ROS topics, services, and actions. In ROS2 with the latest Gazebo releases the integration is facilitated by <code class="language-plaintext highlighter-rouge">ros_gz</code>.</p>

<p>Key Features of Gazebo:</p>

<ul>
  <li>3D Physics Engine:
  Simulates rigid body dynamics, collision detection, and other physics phenomena using engines like ODE, Bullet, and DART.</li>
  <li>Realistic Sensors:
  Simulates cameras, LiDAR, IMUs, GPS, and other sensors with configurable parameters.</li>
  <li>Plugins:
  Extensible via plugins to control robots, customize physics, or add functionality.</li>
  <li>Worlds and Models:
  Enables users to create complex environments with pre-built or custom objects and robots.</li>
</ul>

<p>Besides Gazebo, there are many alternative simulation environments for ROS, but usually the setup of these simulators are more complicated and less documented. Certain simulators also have very high requirements for the GPU.</p>

<table>
  <thead>
    <tr>
      <th><strong>Simulator</strong></th>
      <th><strong>Best For</strong></th>
      <th><strong>Advantages</strong></th>
      <th><strong>Disadvantages</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Gazebo</strong></td>
      <td>General robotics simulation in ROS</td>
      <td>Free, accurate physics, ROS support</td>
      <td>Moderate visuals, resource-heavy</td>
    </tr>
    <tr>
      <td><strong>Unity</strong></td>
      <td>High-fidelity visuals and AI/ML tasks</td>
      <td>Realistic graphics, AI tools</td>
      <td>Steep learning curve, not robotics-specific</td>
    </tr>
    <tr>
      <td><strong>Webots</strong></td>
      <td>Beginner-friendly robotics simulation</td>
      <td>Easy setup, cross-platform</td>
      <td>Limited graphics, less customizable</td>
    </tr>
    <tr>
      <td><strong>Isaac Sim</strong></td>
      <td>High-end AI and robotics simulation</td>
      <td>High-fidelity physics, AI support</td>
      <td>GPU-intensive, complex setup</td>
    </tr>
  </tbody>
</table>

<h2 id="install-gazebo">Install Gazebo</h2>

<p>Before we install Gazebo we have to understand the compatibility between Gazebo versions and ROS distributions.</p>

<table>
  <thead>
    <tr>
      <th><strong>ROS Distribution</strong></th>
      <th><strong>Gazebo Citadel (LTS)</strong></th>
      <th><strong>Gazebo Fortress (LTS)</strong></th>
      <th><strong>Gazebo Garden</strong></th>
      <th><strong>Gazebo Harmonic (LTS)</strong></th>
      <th><strong>Gazebo Ionic</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ROS 2 Rolling</strong></td>
      <td>❌</td>
      <td>❌</td>
      <td>⚡</td>
      <td>⚡</td>
      <td>✅</td>
    </tr>
    <tr>
      <td><strong>ROS 2 Jazzy (LTS)</strong></td>
      <td>❌</td>
      <td>❌</td>
      <td>⚡</td>
      <td>✅</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><strong>ROS 2 Iron</strong></td>
      <td>❌</td>
      <td>✅</td>
      <td>⚡</td>
      <td>⚡</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><strong>ROS 2 Humble (LTS)</strong></td>
      <td>❌</td>
      <td>✅</td>
      <td>⚡</td>
      <td>⚡</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><strong>ROS 2 Foxy (LTS)</strong></td>
      <td>✅</td>
      <td>❌</td>
      <td>❌</td>
      <td>❌</td>
      <td>❌</td>
    </tr>
    <tr>
      <td><strong>ROS 1 Noetic (LTS)</strong></td>
      <td>✅</td>
      <td>⚡</td>
      <td>❌</td>
      <td>❌</td>
      <td>❌</td>
    </tr>
  </tbody>
</table>

<p>Since we use the latest LTS ROS2 distribution, Jazzy, we need Gazebo Harmonic.</p>

<p>To install Gazebo Harmonic binaries on Ubuntu 24.04 simply follow the steps <a href="https://gazebosim.org/docs/harmonic/install_ubuntu/">on this link</a>.</p>

<p>Once it’s installed we can try it with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gz sim shapes.sdf

</code></pre></div></div>

<p>If everything works well you should see the following screen:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/gazebo.png" alt="alt text" title="Shapes.sdf"></p>

<p>If you have a problem with opening this example <code class="language-plaintext highlighter-rouge">shapes.sdf</code> there might be various reasons that requires some debugging skills with Gazebo and Linux.</p>

<ul>
  <li>If you see a <code class="language-plaintext highlighter-rouge">Segmentation fault (Address not mapped to object [(nil)])</code> due to problems with <code class="language-plaintext highlighter-rouge">Qt</code> you can try to set the following environmental variable to force Qt to use X11 instead of Wayland. <a href="https://robotics.stackexchange.com/questions/111547/gazebo-crashes-immediately-segmentation-fault-address-not-mapped-to-object-0">Link</a>
</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nb">export </span><span class="nv">QT_QPA_PLATFORM</span><span class="o">=</span>xcb
    
</code></pre></div></div>

<ul>
  <li>If you run Gazebo in WSL2 or virtual machine the most common problem is with the 3D acceleration with the OGRE2 rendering engine of Gazebo. You can either try disabling HW acceleration (not recommended) or you can switch the older OGRE rendering engine with the following arguments. <a href="https://github.com/gazebosim/gz-sim/issues/1492">Link</a>
</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    gz sim shapes.sdf <span class="nt">--render-engine</span> ogre
    
</code></pre></div></div>

<ul>
  <li>If you run Ubuntu natively on a machine with an integrated Intel GPU and a discrete GPU you can check <a href="https://gazebosim.org/docs/harmonic/troubleshooting/#problems-with-dual-intel-and-nvidia-gpu-systems">this troubleshooting guide</a>.</li>
</ul>

<p>After Gazebo successfully starts we can install the Gazebo ROS integration with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-ros-gz

</code></pre></div></div>

<p>You can find the official install guide <a href="https://gazebosim.org/docs/harmonic/ros_installation/">here</a>.</p>

<h2 id="run-gazebo-examples">Run Gazebo examples</h2>

<p>Let’s start again the <code class="language-plaintext highlighter-rouge">gz sim shapes.sdf</code> example again and let’s see what is important on the Gazebo GUI:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/gazebo-1.png" alt="alt text" title="Gazebo GUI"></p>

<ol>
  <li>Blue - Start and pause the simulation. By default Gazebo starts the simulation paused but if you add the <code class="language-plaintext highlighter-rouge">-r</code> when you start Gazebo it automatically starts the simulation.</li>
  <li>Cyan - The display shows the real time factor. It should be always close to 100%, if it drops seriously (below 60-70%) it’s recommended to change the simulation step size. We’ll see this later.</li>
  <li>Red - You can add basic shapes or lights here and you can move and rotate them.</li>
  <li>Pink - The model hierarchy, every item in the simulation is shown here, you can check the links (children) of the model, their collision, inertia, etc.</li>
  <li>Green - Detailed information of the selected model in <code class="language-plaintext highlighter-rouge">4.</code> some parameters can be changed most of them are read only.</li>
  <li>Plug-in browser, we’ll open useful tools like <code class="language-plaintext highlighter-rouge">Resource Spawner</code>, <code class="language-plaintext highlighter-rouge">Visualize Lidar</code>, <code class="language-plaintext highlighter-rouge">Image Display</code>, etc.</li>
</ol>

<p>Gazebo has an online model database available <a href="https://app.gazebosim.org/">here</a>, you can browse and download models from here. Normally this online model library is accessible within Gazebo although there might be issues in WSL2 or in virtual machines, so I prepared an offline model library with some basic models.</p>

<p>You can <a href="https://drive.google.com/file/d/1tcfoLFReEW1XNHPUAeLpIz2iZXqQBvo_/view?usp=share_link">download this offline model library</a> from Google Drive.</p>

<p>After download unzip it and place it in the home folder of your user. To let Gazebo know about the offline model library we have to set the <code class="language-plaintext highlighter-rouge">GZ_SIM_RESOURCE_PATH</code> environmental variable, the best is to add it to the <code class="language-plaintext highlighter-rouge">.bashrc</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">GZ_SIM_RESOURCE_PATH</span><span class="o">=</span>~/gazebo_models

</code></pre></div></div>

<p>After setting up the offline model library let’s open the <code class="language-plaintext highlighter-rouge">empty.sdf</code> in Gazebo and add a few models through the <code class="language-plaintext highlighter-rouge">Resource Spawner</code> within the <code class="language-plaintext highlighter-rouge">plug-in browser</code>:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/gazebo-2.png" alt="alt text" title="Gazebo models"></p>

<h1 id="turtlebot3-simulation">Turtlebot3 simulation</h1>

<p>In this lesson we’ll use <a href="https://emanual.robotis.com/docs/en/platform/turtlebot3/overview/">the simulated and the real Turtlebot3 robot</a> in <code class="language-plaintext highlighter-rouge">burger</code> configuration. Turtlebot3 is not supported anymore with the latest ROS2 and Gazebo distributions, but we maintain our own packages to ensure compatibility.</p>

<p>Let’s download the following GitHub repositories with the right branch (using the <code class="language-plaintext highlighter-rouge">-b branch</code> flag) to our colcon workspace:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">git clone -b ros2 https://github.com/MOGI-ROS/turtlebot3_msgs</span>
<span class="s">git clone -b mogi-ros2 https://github.com/MOGI-ROS/turtlebot3</span>
<span class="s">git clone -b new_gazebo https://github.com/MOGI-ROS/turtlebot3_simulations</span>

</code></pre></div></div>

<p>We’ll need to install a couple of other dependencies with <code class="language-plaintext highlighter-rouge">apt</code> - don’t forget to run <code class="language-plaintext highlighter-rouge">sudo apt update</code> and <code class="language-plaintext highlighter-rouge">sudo apt upgrade</code> if your system is not up to date:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-dynamixel-sdk
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-hardware-interface
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-nav2-msgs
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-nav2-costmap-2d
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-nav2-map-server
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-nav2-bt-navigator
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-nav2-bringup
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-interactive-marker-twist-server
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-cartographer-ros
<span class="nb">sudo </span>apt <span class="nb">install </span>ros-jazzy-slam-toolbox

</code></pre></div></div>

<blockquote>
  <p>If for some reasons you want to install the Dynamixel SDK from source you can download the following branch from GitHub:</p>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git clone <span class="nt">-b</span> humble-devel https://github.com/MOGI-ROS/DynamixelSDK/

</code></pre></div>  </div>
  <p>and if your Dynamixel SDK runs into a problem with module <code class="language-plaintext highlighter-rouge">em</code>, uninstall existing <code class="language-plaintext highlighter-rouge">em</code> and install this version as it’s reported in <a href="https://github.com/ros2/rosidl/issues/779">this GitHub issue</a>. You might also need to install the module <code class="language-plaintext highlighter-rouge">lark</code>:</p>

  <div class="language-bash highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span><span class="nv">empy</span><span class="o">==</span>3.3.4
pip <span class="nb">install </span>lark

</code></pre></div>  </div>
</blockquote>

<p>Before we can test the Turtlebot3 packages we have to set up <code class="language-plaintext highlighter-rouge">TURTLEBOT3_MODEL</code> environmental variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TURTLEBOT3_MODEL</span><span class="o">=</span>burger

</code></pre></div></div>

<p>It’s only valid for that terminal session where you set it up, so it’s recommended to add it into your <code class="language-plaintext highlighter-rouge">.bashrc</code> file so every time when you open a new terminal, it will be executed. You can use the <a href="https://gist.github.com/dudasdavid/bb2366e2a68bf1401ed692e41fed04d8">following gist</a> as an example how to set up the .bashrc file.</p>

<p>After building the workspace and sourcing the <code class="language-plaintext highlighter-rouge">setup.bash</code> file we can test the simulation of the Turtlebot3 burger:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_gazebo empty_world.launch.py

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/turtlebot.png" alt="alt text" title="Turtlebot"></p>

<p>If we start a keyboard teleop node we can already drive the robot in the simulation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard 

</code></pre></div></div>

<p>Or there is another example world:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_gazebo turtlebot3_world.launch.py

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/turtlebot-1.png" alt="alt text" title="Turtlebot"></p>

<p>Where we can try the <code class="language-plaintext highlighter-rouge">cartographer</code> package for mapping:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_cartographer cartographer.launch.py use_sim:<span class="o">=</span><span class="nb">true</span>

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/slam.png" alt="alt text" title="SLAM"></p>

<p>There is a third simulated environment:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_gazebo turtlebot3_house.launch.py

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/turtlebot-2.png" alt="alt text" title="Turtlebot"></p>

<p>Where we can try the <code class="language-plaintext highlighter-rouge">nav2</code> navigation stack:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_navigation2 navigation2_use_sim_time.launch.py map_yaml_file:<span class="o">=</span>/home/david/ros2_ws/src/turtlebot3_simulations/turtlebot3_gazebo/maps/map.yaml

</code></pre></div></div>
<blockquote>
  <p>Replace the <code class="language-plaintext highlighter-rouge">map_yaml</code> path to your path!</p>
</blockquote>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/navigation.png" alt="alt text" title="Navigation"></p>

<h1 id="test-on-the-real-turtlebot3">Test on the real Turtlebot3</h1>

<p>Let’s try the same functionality on the real Turtlebot3 Burger. The robots at the lab are updated to the latest SD card image but in case you need to write the official MOGI image to another SD card you find it <a href="https://drive.google.com/file/d/1DOdRYKexACRd480pxIIv4g2WUbkFnlHY/view?usp=sharing">here</a>.</p>

<blockquote>
  <p>On Linux you can use the <code class="language-plaintext highlighter-rouge">dd</code> tool to create a backup or write your image back on a card. <code class="language-plaintext highlighter-rouge">if</code> is the input file and <code class="language-plaintext highlighter-rouge">of</code> is the output file.
To create a backup you can run the following command, where <code class="language-plaintext highlighter-rouge">/dev/sda</code> must match the path to your SD card:</p>

  <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>sudo dd if=/dev/sda of=/home/david/backup.img status=progress

</code></pre></div>  </div>
  <p>And you can easily write an image file back to the card:</p>

  <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>sudo dd of=/dev/sda if=/home/david/backup.img status=progress

</code></pre></div>  </div>
</blockquote>

<p>With the MOGI image the robots are already fully set up, <a href="https://gist.github.com/dudasdavid/a7412c46ff7c174e670a5b2b5ea1e340">this is the <code class="language-plaintext highlighter-rouge">.bashrc</code></a> that is running on the robots.</p>

<p>It’s useful to take a look especially on this environmental variable:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set up a ROS2 domain ID</span>
<span class="nb">export </span><span class="nv">ROS_DOMAIN_ID</span><span class="o">=</span>30

</code></pre></div></div>

<p>This environment variable used in ROS2 that plays a key role in how nodes communicate over the DDS (Data Distribution Service) middleware. It partitions the DDS network into isolated segments. Nodes with the same domain ID can discover and communicate with each other, while nodes with different domain IDs remain isolated.</p>

<p>First, we have to make sure that the robots are on the same wireless network, if needed this must be set up using a screen and a keyboard. The wifi networks can be configured by editing the <code class="language-plaintext highlighter-rouge">/etc/netplan/50-cloud-init.yaml</code> file.</p>

<p>When the robot is on the same network as our PC we can connect to it using SSH, where the user name is <code class="language-plaintext highlighter-rouge">pi</code> and the IP address must match with our robot’s IP address:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">ssh pi@192.168.1.45</span>

</code></pre></div></div>
<p>Then we are asked to enter the password, which is <code class="language-plaintext highlighter-rouge">123</code> for this image:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">pi@192.168.1.45's password</span><span class="err">:</span>

</code></pre></div></div>

<p>The ROS2 workspace is already set up on the robot, we can run the following launch file to start all the functions of the real robot:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_bringup hardware.launch.py

</code></pre></div></div>

<p>The on the PC we can start the teleop node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard 

</code></pre></div></div>

<blockquote>
  <p>I suggest to decrease the linear and angular speeds with the <code class="language-plaintext highlighter-rouge">z</code> key to some value like this:</p>

  <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>q/z : increase/decrease max speeds by 10%
currently:	speed 0.12709329141645007	turn 0.25418658283290013 

</code></pre></div>  </div>
</blockquote>

<p>Then on the PC we can try a SLAM algorithm like the <code class="language-plaintext highlighter-rouge">cartographer</code> as before or the best open-source SLAM package <code class="language-plaintext highlighter-rouge">slam_toolbox</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_slam_toolbox slam_toolbox.launch.py 

</code></pre></div></div>

<p>or if you prefer <code class="language-plaintext highlighter-rouge">cartographer</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_cartographer cartographer.launch.py

</code></pre></div></div>

<h1 id="turtlebot3-mogi">Turtlebot3 MOGI</h1>

<p>After this point we’ll use the <code class="language-plaintext highlighter-rouge">turtlebot3_mogi</code> package which is available in this repository and you can download into your workspace with the following command:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">git clone https://github.com/MOGI-ROS/Week-1-8-Cognitive-robotics</span>

</code></pre></div></div>

<p>If you’ve already downloaded it and you want to make sure it’s up-to-date you can run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull

</code></pre></div></div>

<p>Let’s see what is in the package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>turtlebot3_mogi<span class="nv">$ </span>tree
<span class="nb">.</span>
├── CMakeLists.txt
├── package.xml
├── gazebo_models
│   ├── dark_bg
│   │   ├── meshes
│   │   │   └── dark_bg.dae
│   │   ├── model.config
│   │   └── model.sdf
│   ├── light_bg
│   │   ├── meshes
│   │   │   └── light_bg.dae
│   │   ├── model.config
│   │   └── model.sdf
│   └── red_line
│       ├── meshes
│       │   └── red_line.dae
│       ├── model.config
│       └── model.sdf
├── launch
│   ├── check_urdf.launch.py
│   ├── robot_mapping.launch.py
│   ├── robot_navigation.launch.py
│   ├── robot_visualization.launch.py
│   ├── simulation_bringup_line_follow.launch.py
│   ├── simulation_bringup_navigation.launch.py
│   ├── simulation_bringup_navigation_with_slam.launch.py
│   └── simulation_bringup_slam.launch.py
├── maps
│   ├── map.pgm
│   └── map.yaml
├── meshes
│   ├── dark_bg.blend
│   └── light_bg.blend
├── rviz
│   ├── robot_basic.rviz
│   ├── robot_mapping.rviz
│   ├── robot_navigation.rviz
│   ├── turtlebot3_line_follower.rviz
│   ├── turtlebot3_navigation.rviz
│   ├── turtlebot3_slam.rviz
│   └── urdf.rviz
└── worlds
    ├── dark_background.sdf
    ├── empty.sdf
    ├── light_background.sdf
    └── red_line.sdf

</code></pre></div></div>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">gazebo_models</code>: 3D models for the line following worlds</li>
  <li>
<code class="language-plaintext highlighter-rouge">launch</code>: Default launch files are already part of the starting package, we can test the package with <code class="language-plaintext highlighter-rouge">simulation_bringup_slam.launch.py</code>. Launchfiles starting with <code class="language-plaintext highlighter-rouge">robot_</code> prefix are intended to run with the real robot.</li>
  <li>
<code class="language-plaintext highlighter-rouge">maps</code>: saved map for testing the <code class="language-plaintext highlighter-rouge">simulation_bringup_navigation.launch.py</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">meshes</code>: this folder contains the 3D models of the line following worlds in native Blender format.</li>
  <li>
<code class="language-plaintext highlighter-rouge">rviz</code>: Pre-configured RViz2 layouts</li>
  <li>
<code class="language-plaintext highlighter-rouge">worlds</code>: default Gazebo worlds that we’ll use in the simulations.</li>
</ul>

<hr>

<p>Important: this package has a dependency on the <code class="language-plaintext highlighter-rouge">mogi_trajectory_server</code> package that helps visualizing the robot’s past trajectory. You can download this package from git to your workspace to use it:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">git clone https://github.com/MOGI-ROS/mogi_trajectory_server</span>

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/trajectory.png" alt="alt text" title="mogi_trajectory_server"></p>

<hr>

<p>Some launchfiles of the package acts as a simple wrapper to quickly launch the simulations that we already tried previous weeks. Let’s try them out one by one, first the SLAM mapping:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_slam.launch.py

</code></pre></div></div>

<p>In another terminal run a teleop node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard

</code></pre></div></div>

<p>We can try the navigation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_navigation.launch.py

</code></pre></div></div>

<p>And finally a navigation without having an a priori map and running real time SLAM:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_navigation_with_slam.launch.py

</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/navigation-slam.png" alt="alt text" title="Navigation"></p>

<p>There are 3 launch files that are intended to use with the real robot and not with the simulation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi robot_visualization.launch.py 
ros2 launch turtlebot3_mogi robot_mapping.launch.py
ros2 launch turtlebot3_mogi robot_navigation.launch.py

</code></pre></div></div>

<p>To use these launchfiles, make sure that the robot is on the same network and its ROS nodes are started - on the robot:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_bringup hardware.launch.py

</code></pre></div></div>

<p>And finally there is one more launch file that we will use during the next weeks:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/line-following.png" alt="alt text" title="Line following"></p>

<p>We can switch to another world with dark background and a light colored line (<code class="language-plaintext highlighter-rouge">dark_background.sdf</code>)  by changing the launch file or overriding the world argument when we launch the file:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">world_arg</span> <span class="o">=</span> <span class="nc">DeclareLaunchArgument</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">world</span><span class="sh">'</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="sh">'</span><span class="s">light_background.sdf</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Name of the Gazebo world file to load</span><span class="sh">'</span>
<span class="p">)</span>

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/line-following-1.png" alt="alt text" title="Line following"></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py world:<span class="o">=</span>dark_background.sdf

</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">turtlebot3_mogi</code> package already includes the different colored tracks that I made in Blender, you can find a short tutorial about how to create your own world in Blender:</p>

<p><a href="https://www.youtube.com/watch?v=i9JbusxTcOg"><img width="400" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/blender.png"></a></p>

<p>You can also see the recording of another tutorial video about modeling in Blender:</p>

<p><a href="https://www.youtube.com/watch?v=K5v3cWsks8w"><img width="400" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/blender_2.png"></a></p>

<blockquote>
  <p>The Blender files can be found in the <code class="language-plaintext highlighter-rouge">turtlebot3_mogi/meshes</code> folder!</p>
</blockquote>

<h1 id="line-following">Line following</h1>

<h2 id="setting-up-a-python-virtual-environment">Setting up a Python virtual environment</h2>

<p>First, we have to set up a python virtual environment where we’ll install the python packages that we’ll use in the next weeks. I call my virtual environment as <code class="language-plaintext highlighter-rouge">tf</code> because primarily I use it for Tensorflow.</p>

<p>There are various ways to set up and use a Python virtual environment, here I show an example using the <code class="language-plaintext highlighter-rouge">pipx</code> package.</p>

<p>Install the following packages using <code class="language-plaintext highlighter-rouge">apt</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>python3-pip
<span class="nb">sudo </span>apt <span class="nb">install </span>pipx

</code></pre></div></div>

<p>Then we are ready to start using the <code class="language-plaintext highlighter-rouge">pipx</code> package, run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipx ensurepath
pipx <span class="nb">install </span>virtualenv
pipx <span class="nb">install </span>virtualenvwrapper

</code></pre></div></div>

<p>Now let’s edit our <code class="language-plaintext highlighter-rouge">.bashrc</code> file, the <code class="language-plaintext highlighter-rouge">pipx ensurepath</code> command added a line that we’ll change now. Replace the following line:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Created by `pipx` on 2024-12-15 20:49:03</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:/home/david/.local/bin"</span>

</code></pre></div></div>

<p>to this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Virtual environment for pipx and  tensorflow</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:/home/</span><span class="nv">$USER</span><span class="s2">/.local/bin"</span>
<span class="nb">export </span><span class="nv">WORKON_HOME</span><span class="o">=</span>~/.virtualenvs
<span class="nb">export </span><span class="nv">VIRTUALENVWRAPPER_PYTHON</span><span class="o">=</span>/home/<span class="nv">$USER</span>/.local/share/pipx/venvs/virtualenvwrapper/bin/python3
<span class="nb">source</span> /home/<span class="nv">$USER</span>/.local/share/pipx/venvs/virtualenvwrapper/bin/virtualenvwrapper_lazy.sh
workon tf

</code></pre></div></div>

<p>Start a new terminal and you’ll get the following error message because in <code class="language-plaintext highlighter-rouge">.bashrc</code> we used the command <code class="language-plaintext highlighter-rouge">workon tf</code> but there is no virtual environment named <code class="language-plaintext highlighter-rouge">tf</code> yet:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">ERROR</span><span class="pi">:</span> <span class="s">Environment 'tf' does not exist. Create it with 'mkvirtualenv tf'.</span>

</code></pre></div></div>

<p>So let’s create one with the following command:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">mkvirtualenv tf</span>

</code></pre></div></div>

<p>Now, start a new terminal and you should see the active virtual environment between parentheses in your terminal:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">(tf) david@david-ubuntu24:~$</span> 

</code></pre></div></div>

<h2 id="install-python-packages">Install Python packages</h2>

<p>Let’s install Python packages that we’ll use, to ensure compatibility with the codes in this repository let’s use a specific version from <code class="language-plaintext highlighter-rouge">numpy</code> and <code class="language-plaintext highlighter-rouge">tensorflow</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span><span class="o">==</span><span class="mf">2.18.0</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">imutils</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">learn</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">opencv</span><span class="o">-</span><span class="n">python</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span><span class="o">==</span><span class="mf">1.26.4</span>

</code></pre></div></div>

<h2 id="line-following-with-opencv">Line following with OpenCV:</h2>

<blockquote>
  <p>OpenCV (Open Source Computer Vision Library) is a free, open-source library used for computer vision, image processing, and machine learning. It provides tools to analyze visual data from images and videos, such as detecting faces, objects, and motion, or applying filters and transformations. OpenCV is widely used in robotics, AI, and real-time applications, and it supports many programming languages, including Python and C++. It helps developers easily build systems that can “see” and interpret visual information.</p>
</blockquote>

<p>As we saw in the previous chapter, we can start the simulation that is set up for the line following with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py

</code></pre></div></div>

<p>Now let’s try the node that follows the line with image processing using OpenCV:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlebot3_mogi_py line_follower

</code></pre></div></div>

<p>The robot starts follwoing the line and we see the following window:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/line-following-2.png" alt="alt text" title="Line following"></p>

<p>Let’s analyze the code! We create a subscriber for compressed images from the robot’s camera and a publisher for the <code class="language-plaintext highlighter-rouge">cmd_vel</code> topic that will drive the robot. We also start another thread that guarantees that the <code class="language-plaintext highlighter-rouge">spin()</code> function is called regardless how long our image processing will take. The <code class="language-plaintext highlighter-rouge">spin()</code> function is essential to ensure that <code class="language-plaintext highlighter-rouge">image_callback()</code> will be always executed and we won’t miss frames.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ImageSubscriber</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">'</span><span class="s">image_subscriber</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="sh">'''</span><span class="s">
        # Create a subscriber with a queue size of 1 to only keep the last frame
        self.subscription = self.create_subscription(
            Image,
            </span><span class="sh">'</span><span class="s">image_raw</span><span class="sh">'</span><span class="s">,  # Replace with your topic name
            self.image_callback,
            1  # Queue size of 1
        )
        </span><span class="sh">'''</span>

        <span class="n">self</span><span class="p">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
            <span class="n">CompressedImage</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">image_raw/compressed</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Replace with your topic name
</span>            <span class="n">self</span><span class="p">.</span><span class="n">image_callback</span><span class="p">,</span>
            <span class="mi">1</span>  <span class="c1"># Queue size of 1
</span>        <span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_publisher</span><span class="p">(</span><span class="n">Twist</span><span class="p">,</span> <span class="sh">'</span><span class="s">cmd_vel</span><span class="sh">'</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># Initialize CvBridge
</span>        <span class="n">self</span><span class="p">.</span><span class="n">bridge</span> <span class="o">=</span> <span class="nc">CvBridge</span><span class="p">()</span>
        
        <span class="c1"># Variable to store the latest frame
</span>        <span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">frame_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>  <span class="c1"># Lock to ensure thread safety
</span>        
        <span class="c1"># Flag to control the display loop
</span>        <span class="n">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1"># Start a separate thread for spinning (to ensure image_callback keeps receiving new frames)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">spin_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="nc">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">spin_thread_func</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spin_thread</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">spin_thread_func</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Separate thread function for rclpy spinning.</span><span class="sh">"""</span>
        <span class="k">while</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">ok</span><span class="p">()</span> <span class="ow">and</span> <span class="n">self</span><span class="p">.</span><span class="n">running</span><span class="p">:</span>
            <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin_once</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">image_callback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Callback function to receive and store the latest frame.</span><span class="sh">"""</span>
        <span class="c1"># Convert ROS Image message to OpenCV format and store it
</span>        <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">frame_lock</span><span class="p">:</span>
            <span class="c1">#self.latest_frame = self.bridge.imgmsg_to_cv2(msg, "bgr8")
</span>            <span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">bridge</span><span class="p">.</span><span class="nf">compressed_imgmsg_to_cv2</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">desired_encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">bgr8</span><span class="sh">"</span><span class="p">)</span>

</code></pre></div></div>

<p>Then we run the <code class="language-plaintext highlighter-rouge">display_image()</code> function in an infinite loop which uses built-in OpnCV functions to create a window and display the <code class="language-plaintext highlighter-rouge">result</code> image. OpenCV is also responsible for handling keyboard commands, if we press <code class="language-plaintext highlighter-rouge">q</code> key the node will stop. Of course, the node can be also stopped with <code class="language-plaintext highlighter-rouge">Ctrl+C</code> if the focus is on the command line.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">display_image</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>

        <span class="c1"># Create a single OpenCV window
</span>        <span class="n">cv2</span><span class="p">.</span><span class="nf">namedWindow</span><span class="p">(</span><span class="sh">"</span><span class="s">frame</span><span class="sh">"</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">WINDOW_NORMAL</span><span class="p">)</span>
        <span class="n">cv2</span><span class="p">.</span><span class="nf">resizeWindow</span><span class="p">(</span><span class="sh">"</span><span class="s">frame</span><span class="sh">"</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">rclpy</span><span class="p">.</span><span class="nf">ok</span><span class="p">():</span>
            <span class="c1"># Check if there is a new frame available
</span>            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

                <span class="c1"># Process the current image
</span>                <span class="n">mask</span><span class="p">,</span> <span class="n">contour</span><span class="p">,</span> <span class="n">crosshair</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">process_image</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span><span class="p">)</span>

                <span class="c1"># Add processed images as small images on top of main image
</span>                <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">add_small_pictures</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span><span class="p">,</span> <span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">contour</span><span class="p">,</span> <span class="n">crosshair</span><span class="p">])</span>

                <span class="c1"># Show the latest frame
</span>                <span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="sh">"</span><span class="s">frame</span><span class="sh">"</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">latest_frame</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># Clear the frame after displaying
</span>
            <span class="c1"># Check for quit key
</span>            <span class="k">if</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="nf">ord</span><span class="p">(</span><span class="sh">'</span><span class="s">q</span><span class="sh">'</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">stop_robot</span><span class="p">()</span>
                <span class="n">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>

        <span class="c1"># Close OpenCV window after quitting
</span>        <span class="n">cv2</span><span class="p">.</span><span class="nf">destroyAllWindows</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">running</span> <span class="o">=</span> <span class="bp">False</span>

</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">result</code> frame is created using a simple function that overlays 3 small images on the original frame from the camera.</p>

<p>Every image processing and publishing the commands on the <code class="language-plaintext highlighter-rouge">cmd_vel</code> topic is happening within the <code class="language-plaintext highlighter-rouge">process_image()</code> function:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">process_image</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="nc">Twist</span><span class="p">()</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">rows</span><span class="p">,</span><span class="n">cols</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># 1. Convert to HLS color space to extract lightness channel
</span>        <span class="n">H</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">S</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">convert2hls</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># 2. Invert lightness channel if we follow a dark line on a light background
</span>        <span class="n">L</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">L</span> <span class="c1"># Invert lightness channel
</span>
        <span class="c1"># 3. apply a polygon mask to filter out simulation's bright sky
</span>        <span class="n">L_masked</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply_polygon_mask</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

        <span class="c1"># 4. For light line on dark background in simulation:
</span>        <span class="n">lightnessMask</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">threshold_binary</span><span class="p">(</span><span class="n">L_masked</span><span class="p">,</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

        <span class="c1"># For light line on dark background in real life environment:
</span>        <span class="c1">#lightnessMask = self.threshold_binary(L_masked, (180, 255))
</span>        <span class="n">stackedMask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dstack</span><span class="p">((</span><span class="n">lightnessMask</span><span class="p">,</span> <span class="n">lightnessMask</span><span class="p">,</span> <span class="n">lightnessMask</span><span class="p">))</span>
        <span class="n">contourMask</span> <span class="o">=</span> <span class="n">stackedMask</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">crosshairMask</span> <span class="o">=</span> <span class="n">stackedMask</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>

        <span class="c1"># 5. return value of findContours depends on OpenCV version
</span>        <span class="p">(</span><span class="n">contours</span><span class="p">,</span><span class="n">hierarchy</span><span class="p">)</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">findContours</span><span class="p">(</span><span class="n">lightnessMask</span><span class="p">.</span><span class="nf">copy</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>

        <span class="c1"># overlay mask on lightness image to show masked area on the small picture
</span>        <span class="n">lightnessMask</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">addWeighted</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">lightnessMask</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># 6. Find the biggest contour (if detected) and calculate its centroid
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="n">biggest_contour</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="p">.</span><span class="n">contourArea</span><span class="p">)</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">moments</span><span class="p">(</span><span class="n">biggest_contour</span><span class="p">)</span>

            <span class="c1"># Make sure that "m00" won't cause ZeroDivisionError: float division by zero
</span>            <span class="k">if</span> <span class="n">M</span><span class="p">[</span><span class="sh">"</span><span class="s">m00</span><span class="sh">"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="sh">"</span><span class="s">m10</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">M</span><span class="p">[</span><span class="sh">"</span><span class="s">m00</span><span class="sh">"</span><span class="p">])</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="sh">"</span><span class="s">m01</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">M</span><span class="p">[</span><span class="sh">"</span><span class="s">m00</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

            <span class="c1"># Show contour and centroid
</span>            <span class="n">cv2</span><span class="p">.</span><span class="nf">drawContours</span><span class="p">(</span><span class="n">contourMask</span><span class="p">,</span> <span class="n">biggest_contour</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">cv2</span><span class="p">.</span><span class="nf">circle</span><span class="p">(</span><span class="n">contourMask</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Show crosshair and difference from middle point
</span>            <span class="n">cv2</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">crosshairMask</span><span class="p">,(</span><span class="n">cx</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">cx</span><span class="p">,</span><span class="n">rows</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">cv2</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">crosshairMask</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="n">cy</span><span class="p">),(</span><span class="n">cols</span><span class="p">,</span><span class="n">cy</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">cv2</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">crosshairMask</span><span class="p">,(</span><span class="nf">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">0</span><span class="p">),(</span><span class="nf">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">rows</span><span class="p">),(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>

            <span class="c1"># Chase the ball
</span>            <span class="c1">#print(abs(cols - cx), cx, cols)
</span>            <span class="k">if</span> <span class="nf">abs</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.05</span>
                <span class="k">if</span> <span class="n">cols</span><span class="o">/</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">cx</span><span class="p">:</span>
                    <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.15</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Publish cmd_vel
</span>        <span class="n">self</span><span class="p">.</span><span class="n">publisher</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Return processed frames
</span>        <span class="k">return</span> <span class="n">lightnessMask</span><span class="p">,</span> <span class="n">contourMask</span><span class="p">,</span> <span class="n">crosshairMask</span>

</code></pre></div></div>

<p>The image processing pipeline is the following:</p>
<ol>
  <li>Convert the RGB image to HLS color space so we can extract the lightness channel</li>
  <li>Invert lightness channel if we want to detect a dark line on lighter background</li>
  <li>Add a polygon mask to filter out disturbances of the environment</li>
  <li>Apply a highpass binary threshold on lightness channel so we can detect light objects (white), everything else is black</li>
  <li>Find all the white contours on the binary image</li>
  <li>Find the biggest contour and calculate its centroid</li>
</ol>

<p>Let’s switch to the dark background:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py world:<span class="o">=</span>dark_background.sdf

</code></pre></div></div>

<p>And don’t forget to turn off inverting the lightness channel!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1"># 2. Invert lightness channel if we follow a dark line on a light background
</span>        <span class="c1">#L = 255 - L # Invert lightness channel
</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/line-following-3.png" alt="alt text" title="Line following"></p>

<p>You can try to tune the channel filter for the 3rd world in the package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py world:<span class="o">=</span>red_line.sdf

</code></pre></div></div>

<blockquote>
  <p>It’s difficult to do it with the lightness channel because both the background’s and line’s lightness values are similar although they are clearly different on the hue channel. In RGB color space it would be even easier to segment the line from its background.</p>
</blockquote>

<h1 id="neural-network">Neural network</h1>

<p>In this chapter we’ll create our own convolutional neural network (CNN) and train it for following the line. But before that, let’s see what did we learn from the line following with OpenCV:</p>

<h2 id="lessons-learnt-from-image-processing-with-opencv">Lessons learnt from image processing with OpenCV</h2>
<ol>
  <li>With color space filtering we only focus on one property of line (color) but our model wasn’t trying to detect it’s shape or any other properties.</li>
  <li>Color space filtering is very sensitive in changes in environment or with the object. We have to adjust filter values for changed conditions. Also it’s possible that we have to significantly modify the image processing pipeline because the problem can be solved e.g. in another color space.</li>
  <li>We had high resolution information (in number of pixels) about how much do we have to turn but we didn’t use that. Above 20 pixels difference - between the centerpoint and the centroid of the line - the robot was turning to the left or right on a fixed radius. We’ll apply the same logic to the neural network.</li>
</ol>

<h2 id="create-and-label-the-training-dataset">Create and label the training dataset</h2>

<p>To save training images let’s start the simulation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py

</code></pre></div></div>

<p>Start a teleop node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard

</code></pre></div></div>

<p>And finally, we will run the <code class="language-plaintext highlighter-rouge">save_training_images</code> node that can save training images by pressing the <code class="language-plaintext highlighter-rouge">s</code> key, but before that, make sure that <code class="language-plaintext highlighter-rouge">self.save_path</code> is set to your own directory in the node:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ImageSubscriber</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">'</span><span class="s">image_subscriber</span><span class="sh">'</span><span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">subscription</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
            <span class="n">CompressedImage</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">image_raw/compressed</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># Replace with your topic name
</span>            <span class="n">self</span><span class="p">.</span><span class="n">image_callback</span><span class="p">,</span>
            <span class="mi">1</span>  <span class="c1"># Queue size of 1
</span>        <span class="p">)</span>

        <span class="n">self</span><span class="p">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/home/david/ros2_ws/src/ROS2-lessons/Week-1-8-Cognitive-robotics/turtlebot3_mogi_py/saved_images/</span><span class="sh">"</span>

</code></pre></div></div>

<p>If the path is set up correctly we can run the node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlebot3_mogi_py save_training_images

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/saving-images.png" alt="alt text" title="Saving images"></p>

<p>To label the saved images we just simply have to copy the images to the suitable folder under the <code class="language-plaintext highlighter-rouge">training_images</code> folder. We only distinguish 4 labels:</p>
<ul>
  <li>Forward</li>
  <li>Turn left</li>
  <li>Turn right</li>
  <li>There is no line on the image</li>
</ul>

<p>There are already about 100-100 training images in the package from both dark and light background environments under different lighting conditions also some images from a real-world environment. The training data is not balanced though with the images where there is no line. This is good enough for the training but you can add your own images! Intentionally, there aren’t any images about the red line with green background, we want to verify later how well does our generalized model perform on a completely new environment.</p>

<h2 id="train-the-neural-network">Train the neural network</h2>

<p>The <code class="language-plaintext highlighter-rouge">turtlebot3_mogi</code> package already has a trained network in <code class="language-plaintext highlighter-rouge">network_model</code> folder that is ready to use. This model was trained using the following Tensorflow and Keras version:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tensorflow version: 2.18.0
Keras version: 3.7.0

</code></pre></div></div>
<blockquote>
  <p>TensorFlow:<br>
TensorFlow is an open-source deep learning library developed by Google. It helps build, train, and deploy machine learning models, especially neural networks, using efficient tools for math, data handling, and GPU acceleration.</p>

  <p>Keras:<br>
Keras is a high-level API that runs on top of TensorFlow. It makes building and training models easier and more user-friendly with a simple, intuitive interface.</p>
</blockquote>

<p>If you installed a different Tensorflow or Keras version you might need to train a new network before using it.</p>

<p>There is already a training script in the package - although this isn’t a ROS node just a simple python script! So don’t run it with <code class="language-plaintext highlighter-rouge">ros2 run ...</code>!
First, navigate to the right folder then run the script:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">(tf) david@david-ubuntu24:~/ros2_ws/src/ROS2-lessons/Week-1-8-Cognitive-robotics/turtlebot3_mogi_py/turtlebot3_mogi_py$ python train_network.py</span> 
<span class="pi">[</span><span class="nv">INFO</span><span class="pi">]</span> <span class="na">Version</span><span class="pi">:</span>
<span class="na">Tensorflow version</span><span class="pi">:</span> <span class="s">2.18.0</span>
<span class="na">Keras version</span><span class="pi">:</span> <span class="s">b'3.7.0'</span>
<span class="pi">[</span><span class="nv">INFO</span><span class="pi">]</span> <span class="s">loading images and labels...</span>

</code></pre></div></div>

<blockquote>
  <p>In 2025 April there isn’t any tensorflow version that could support CUDA version higher than 12.5 which might result in incompatibility with Ubuntu 24.04. If you have to disable GPU acceleration until compatibility issues are resolved, just set temporarily the following environmental variable in the right terminal window:</p>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="s">export CUDA_VISIBLE_DEVICES=""</span>

</code></pre></div>  </div>
  <p>You can check the current compatibility table on <a href="https://www.tensorflow.org/install/source#gpu">this link</a>.</p>
</blockquote>

<p>Let’s take a look on the code! The most important part of the code is just a couple of lines:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># initialize the model
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[INFO] compiling model...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="nf">build_LeNet</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nc">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">INIT_LR</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="sh">"</span><span class="s">binary_crossentropy</span><span class="sh">"</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">accuracy</span><span class="sh">"</span><span class="p">])</span>
 
<span class="c1"># print model summary
</span><span class="n">model</span><span class="p">.</span><span class="nf">summary</span><span class="p">()</span>

<span class="c1"># checkpoint the best model
</span><span class="n">checkpoint_filepath</span> <span class="o">=</span> <span class="sh">"</span><span class="s">..//network_model//model.best.keras</span><span class="sh">"</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="nc">ModelCheckpoint</span><span class="p">(</span><span class="n">checkpoint_filepath</span><span class="p">,</span> <span class="n">monitor</span> <span class="o">=</span> <span class="sh">'</span><span class="s">val_loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># set a learning rate annealer
</span><span class="n">reduce_lr</span> <span class="o">=</span> <span class="nc">ReduceLROnPlateau</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="sh">'</span><span class="s">val_loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

<span class="c1"># callbacks
</span><span class="n">callbacks_list</span><span class="o">=</span><span class="p">[</span><span class="n">reduce_lr</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">]</span>

<span class="c1"># train the network
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[INFO] training network...</span><span class="sh">"</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">),</span> <span class="n">epochs</span><span class="o">=</span><span class="n">EPOCHS</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks_list</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div></div>

<p>This will initialize a model using the <code class="language-plaintext highlighter-rouge">build_LeNet</code> function, then turns on 2 important functions:</p>
<ul>
  <li>ModelCheckpoint() will guarantee that if it finds a better fitting model during the training, it saves it. So in the end we won’t only have the <em>last</em> model, but also the <em>best</em> model.</li>
  <li>ReduceLROnPlateau() helps reducing the learning rate (how much it can update the weights) if it detects that our model cannot find a more fitting optimum during the training due to too high learning rate. Higher learning rate is better in the beginning but later it’s a risk of overshooting or missing the bottom.</li>
</ul>

<p>But what is the <code class="language-plaintext highlighter-rouge">build_LeNet</code> function?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_LeNet</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
    <span class="c1"># initialize the model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="nc">Sequential</span><span class="p">()</span>
    <span class="n">inputShape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

    <span class="c1"># After Keras 2.3 we need an Input layer instead of passing it as a parameter to the first layer
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Input</span><span class="p">(</span><span class="n">inputShape</span><span class="p">))</span>

    <span class="c1"># first set of CONV =&gt; RELU =&gt; POOL layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Conv2D</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="sh">"</span><span class="s">same</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="c1"># second set of CONV =&gt; RELU =&gt; POOL layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Conv2D</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="sh">"</span><span class="s">same</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="c1"># first (and only) set of FC =&gt; RELU layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Flatten</span><span class="p">())</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dense</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>

    <span class="c1"># softmax classifier
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dense</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">softmax</span><span class="sh">"</span><span class="p">))</span>

    <span class="c1"># return the constructed network architecture
</span>    <span class="k">return</span> <span class="n">model</span>

</code></pre></div></div>

<p>LeNet-5 was originally invented by Yann LeCun and colleagues for handwritten digit recognition on the MNIST dataset in 1998! It’s first predecessor is dated back to 1989 though as the first 
It was one of the first convolutional neural networks (CNN). LeNet-5 was pioneering for CNNs and laid the groundwork for modern deep learning in vision.</p>

<p>I’m cheating a little bit here, because this network that we use is significantly bigger than the original LeNet-5 that had the following architecture:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┏━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┓</span>
<span class="err">┃</span> <span class="n">Layer</span>   <span class="err">┃</span> <span class="n">Type</span>                   <span class="err">┃</span> <span class="n">Output</span> <span class="n">Shape</span> <span class="err">┃</span> <span class="n">Params</span> <span class="n">Calculation</span>          <span class="err">┃</span> <span class="n">Parameters</span> <span class="err">┃</span>
<span class="err">┣━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━╋━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╋━━━━━━━━━━━━┫</span>
<span class="err">┃</span> <span class="n">Input</span>   <span class="err">┃</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="err">┃</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="err">┃</span> <span class="n">No</span> <span class="n">params</span>                   <span class="err">┃</span> <span class="mi">0</span>          <span class="err">┃</span>
<span class="err">┃</span> <span class="n">C1</span>      <span class="err">┃</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="p">)</span>         <span class="err">┃</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>  <span class="err">┃</span> <span class="p">(</span><span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="err">×</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="err">×</span> <span class="mi">6</span> <span class="o">=</span> <span class="mi">156</span>       <span class="err">┃</span> <span class="mi">156</span>        <span class="err">┃</span>
<span class="err">┃</span> <span class="n">S2</span>      <span class="err">┃</span> <span class="n">AveragePooling2D</span><span class="p">(</span><span class="mi">2</span><span class="err">×</span><span class="mi">2</span><span class="p">)</span>  <span class="err">┃</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>  <span class="err">┃</span> <span class="n">No</span> <span class="n">params</span>                   <span class="err">┃</span> <span class="mi">0</span>          <span class="err">┃</span>
<span class="err">┃</span> <span class="n">C3</span>      <span class="err">┃</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="p">)</span>        <span class="err">┃</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="err">┃</span> <span class="p">(</span><span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="err">×</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="err">×</span> <span class="mi">16</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="mi">416</span>    <span class="err">┃</span> <span class="mi">2</span><span class="p">,</span><span class="mi">416</span>      <span class="err">┃</span>
<span class="err">┃</span> <span class="n">S4</span>      <span class="err">┃</span> <span class="n">AveragePooling2D</span><span class="p">(</span><span class="mi">2</span><span class="err">×</span><span class="mi">2</span><span class="p">)</span>  <span class="err">┃</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>   <span class="err">┃</span> <span class="n">No</span> <span class="n">params</span>                   <span class="err">┃</span> <span class="mi">0</span>          <span class="err">┃</span>
<span class="err">┃</span> <span class="n">C5</span>      <span class="err">┃</span> <span class="n">Conv2D</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="p">)</span>       <span class="err">┃</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>  <span class="err">┃</span> <span class="p">(</span><span class="mi">5</span><span class="err">×</span><span class="mi">5</span><span class="err">×</span><span class="mi">16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="err">×</span> <span class="mi">120</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span><span class="mi">120</span> <span class="err">┃</span> <span class="mi">48</span><span class="p">,</span><span class="mi">120</span>     <span class="err">┃</span>
<span class="err">┃</span> <span class="n">Flatten</span> <span class="err">┃</span> <span class="err">–</span>                      <span class="err">┃</span> <span class="p">(</span><span class="mi">120</span><span class="p">,)</span>       <span class="err">┃</span> <span class="n">No</span> <span class="n">params</span>                   <span class="err">┃</span> <span class="mi">0</span>          <span class="err">┃</span>
<span class="err">┃</span> <span class="n">F6</span>      <span class="err">┃</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span>              <span class="err">┃</span> <span class="p">(</span><span class="mi">84</span><span class="p">,)</span>        <span class="err">┃</span> <span class="mi">120</span><span class="err">×</span><span class="mi">84</span> <span class="o">+</span> <span class="mi">84</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="mi">164</span>        <span class="err">┃</span> <span class="mi">10</span><span class="p">,</span><span class="mi">164</span>     <span class="err">┃</span>
<span class="err">┃</span> <span class="n">Output</span>  <span class="err">┃</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>              <span class="err">┃</span> <span class="p">(</span><span class="mi">10</span><span class="p">,)</span>        <span class="err">┃</span> <span class="mi">84</span><span class="err">×</span><span class="mi">10</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">=</span> <span class="mi">850</span>            <span class="err">┃</span> <span class="mi">850</span>        <span class="err">┃</span>
<span class="err">┗━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━┛</span>
<span class="n">Total</span> <span class="n">params</span><span class="o">:</span> <span class="mi">61</span><span class="p">,</span><span class="mi">706</span> 

</code></pre></div></div>

<p>Our version of LeNet has about 1 million trainable parameters!</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓</span>
<span class="err">┃</span> <span class="n">Layer</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span>                         <span class="err">┃</span> <span class="n">Output</span> <span class="n">Shape</span>                <span class="err">┃</span>         <span class="n">Param</span> <span class="err">#</span> <span class="err">┃</span>
<span class="err">┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩</span>
<span class="err">│</span> <span class="n">conv2d</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>           <span class="mi">1</span><span class="p">,</span><span class="mi">520</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>              <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>         <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">conv2d_1</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>          <span class="err">│</span>          <span class="mi">25</span><span class="p">,</span><span class="mo">050</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_1</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d_1</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>       <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>            <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">flatten</span> <span class="p">(</span><span class="n">Flatten</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">1800</span><span class="p">)</span>                <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                        <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>                 <span class="err">│</span>         <span class="mi">900</span><span class="p">,</span><span class="mi">500</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_2</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>                 <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense_1</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>           <span class="mi">2</span><span class="p">,</span><span class="mo">004</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_3</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">└──────────────────────────────────────┴─────────────────────────────┴─────────────────┘</span>
 <span class="n">Total</span> <span class="n">params</span><span class="o">:</span> <span class="mi">929</span><span class="p">,</span><span class="mo">074</span> <span class="p">(</span><span class="mf">3.54</span> <span class="n">MB</span><span class="p">)</span>
 <span class="n">Trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">929</span><span class="p">,</span><span class="mo">074</span> <span class="p">(</span><span class="mf">3.54</span> <span class="n">MB</span><span class="p">)</span>
 <span class="n">Non</span><span class="o">-</span><span class="n">trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">B</span><span class="p">)</span>

</code></pre></div></div>

<p>1 million parameters might look a lot, especially compared to the original LeNet-5’s 61k parameters. But let’s put into more context:</p>
<ul>
  <li>GPT-2 XL was a state of the art LLM (large language model) in 2019, it has 1.5 billion paremeters</li>
  <li>GPT-3 has 175 billion parameters</li>
  <li>GPT-4 isn’t openly published anymore, but it’s assumed it has around 500-1000 billion parameters</li>
  <li>DeepSeek V2’s architecture is open-source, there are different downloadable models, the biggest one has 671 billion parameters and it’s about 404GB. The smallest one had 1.5 billion parameters and its size is 1.1GB.</li>
</ul>

<p>These are all LLMs but how did we get there in about 20 (30) years from the first CNNs.</p>

<ul>
  <li>CNNs are focusing on spatial patterns that makes them very efficient in image processing.</li>
  <li>RNNs were also introduced in the late ’80s, but their major real life application was around the early 2000s to generate basic character sequences or predict the next words in a sentence. It focuses on temporal patterns, but it had problems with vanishing gradient during training - the model cannot learn from earlier inputs with long sequences when it goes back many time steps.</li>
  <li>LSTMs (Long-short term memory) addressed to solve the issues of RNNs and these were the state of the art neural networks around 2013-2018 for natural language processing. LSTM cells were introduced to preserve important input that was flowing forward during training without vanishing. Although it was a huge step for natural language processing and it handles temporal data better (text, speech), it was slow and had issues with longer sequences. Since it was still analyzing the input word by word, it was hard to remember words from earler.</li>
  <li>Transformers (LLMs based on transformers) made LSTMs completely obsolete since 2018, they handle long sequences very well and it’s fast with parallelism. It handles longer sequences much better because it has attention that can extract the important information from the context.</li>
</ul>

<p>But let’s come back to our training and let’s see how did it go!
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/training.png" alt="alt text" title="Training"></p>

<p>Accuracy measures how many predictions were correct out of all predictions. Higher accuracy = better performance.
Loss is a formula that compares the model’s prediction to the true value (label) and gives a number representing how wrong it is. The goal of training is to minimize the loss.</p>

<p>The loss was successfully minimized during training, but the validation loss doesn’t look great. This usually means our model is overfitting or not generalizing well to new, unseen data. That can have multiple reasons:</p>
<ol>
  <li>It learns training data too well (memorizes), but struggles on validation data.</li>
  <li>If validation data has noise, imbalance, or different distribution, loss may stay higher.</li>
  <li>Model is too complex, large models memorize training data easily but don’t generalize well.</li>
</ol>

<p>Although our model is not exactly small, still it’s far from too high complexity, we can exclude point 3.</p>

<p>We can reduce overfitting by adding dropout after certain layers. Dropout randomly turns off neurons during training so it prevents over-reliance on specific ones. Helps the model generalize better which shouldt reduce our validation loss!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_LeNet</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">classes</span><span class="p">):</span>
    <span class="c1"># initialize the model
</span>    <span class="n">model</span> <span class="o">=</span> <span class="nc">Sequential</span><span class="p">()</span>
    <span class="n">inputShape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

    <span class="c1"># After Keras 2.3 we need an Input layer instead of passing it as a parameter to the first layer
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Input</span><span class="p">(</span><span class="n">inputShape</span><span class="p">))</span>

    <span class="c1"># first set of CONV =&gt; RELU =&gt; POOL layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Conv2D</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="sh">"</span><span class="s">same</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="c1"># Optional Dropout after first pool (small value)
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>

    <span class="c1"># second set of CONV =&gt; RELU =&gt; POOL layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Conv2D</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="sh">"</span><span class="s">same</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

    <span class="c1"># Optional Dropout again
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>

    <span class="c1"># first (and only) set of FC =&gt; RELU layers
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Flatten</span><span class="p">())</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dense</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">relu</span><span class="sh">"</span><span class="p">))</span>

    <span class="c1"># Dropout after fully connected (higher value)
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="c1"># softmax classifier
</span>    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Dense</span><span class="p">(</span><span class="n">classes</span><span class="p">))</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Activation</span><span class="p">(</span><span class="sh">"</span><span class="s">softmax</span><span class="sh">"</span><span class="p">))</span>

    <span class="c1"># return the constructed network architecture
</span>    <span class="k">return</span> <span class="n">model</span>

</code></pre></div></div>

<p>Let’s try the model training with the dropouts:
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/training-1.png" alt="alt text" title="Training"></p>

<p>We can clearly see the impact of droupout on the smaller spikes, but it was not improving our validation loss at all. Let’s remember that our training set is not balanced on images with no line, only 20 pictures compared to the other 3 classes with 100 pictures. But then we should have random results after every training, right?</p>

<p>Not really, we intentionally fixed all of our random seeds in the beginning of the script to make sure that the trainings are reproducible!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fix every random seed to make the training reproducible
</span><span class="nf">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">set_seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

</code></pre></div></div>

<p>Let’s try different random seeds:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fix every random seed to make the training reproducible
</span><span class="nf">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nf">set_seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

</code></pre></div></div>

<p>And the result is much better!</p>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/training-2.png" alt="alt text" title="Training"></p>

<p>This time we were lucky, the validation loss was high only because of a not balanced input data - less images for no line - we don’t have to change anything on our model.</p>

<h2 id="line-following-with-cnn">Line following with CNN</h2>

<p>The labeling and training we did is a very simple classification. It’ll look the whole image and will predict if our robot has to drive straight, turn left or right or if there isn’t any line on the image. There are more complex image processing CNNs like detection and segmentation:</p>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th><strong>Classification</strong></th>
      <th><strong>Object Detection</strong></th>
      <th><strong>Segmentation</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>What it does</strong></td>
      <td>Predicts 1+ labels for the entire image</td>
      <td>Detects and classifies objects with bounding boxes</td>
      <td>Labels each pixel with a class (and instance)</td>
    </tr>
    <tr>
      <td><strong>Example</strong></td>
      <td>“This is a cat”</td>
      <td>“Cat at top-left, dog at bottom-right”</td>
      <td>“These pixels are cat, those are dog”</td>
    </tr>
    <tr>
      <td><strong>Labeling Effort</strong></td>
      <td>
<strong>Easy</strong> – one label/image</td>
      <td>
<strong>Medium</strong> – draw boxes + labels</td>
      <td>
<strong>Hard</strong> – pixel-wise annotation</td>
    </tr>
    <tr>
      <td><strong>Training Complexity</strong></td>
      <td>
<strong>Low</strong> – smaller models</td>
      <td>
<strong>Medium</strong> – more complex models</td>
      <td>
<strong>High</strong> – large models, lots of data</td>
    </tr>
    <tr>
      <td><strong>Inference Cost</strong></td>
      <td>
<strong>Low</strong> – runs fast</td>
      <td>
<strong>Medium</strong> – real-time possible on decent GPU</td>
      <td>
<strong>High</strong> – needs strong GPU for real-time</td>
    </tr>
    <tr>
      <td><strong>Use in Real-Time</strong></td>
      <td><strong>Very suitable</strong></td>
      <td><strong>Possible with optimization</strong></td>
      <td>
<strong>Challenging</strong>, especially on edge devices</td>
    </tr>
  </tbody>
</table>

<p>It’s time to try out the model we trained, first start the simulation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py

</code></pre></div></div>

<p>Then in another terminal start the line following with the neural network:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlebot3_mogi_py line_follower_cnn

</code></pre></div></div>

<p>If the right version of Tensorflow and Keras is installed the node will start and we see the following information in the terminal:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">OpenCV version</span><span class="pi">:</span> <span class="s">4.11.0</span>  
<span class="na">Tensorflow version</span><span class="pi">:</span> <span class="s">2.18.0</span>  
<span class="na">Keras version</span><span class="pi">:</span> <span class="s">3.7.0</span>  
<span class="na">CNN model</span><span class="pi">:</span> <span class="s">/home/david/ros2_ws/install/turtlebot3_mogi_py/share/turtlebot3_mogi_py/network_model/model.best.keras</span>
<span class="s">Model's Keras version</span><span class="err">:</span> <span class="s">3.7.0</span>  

</code></pre></div></div>

<blockquote>
  <p>If your Keras version doesn’t match you’ll get the follwoing message and the node stops.</p>

  <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="s">You are using Keras version 3.6.0 , but the model was built using 3.7.0</span>

</code></pre></div>  </div>
</blockquote>

<p>Here is a video about the node and the simulation:<br>
<a href="https://youtu.be/ImYu4pY0-ds"><img width="600" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/youtube-cnn.png"></a></p>

<p>But what do we see on the small images?<br>
<img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/line-following-4.png" alt="alt text" title="Line following"></p>

<p>We extract the <code class="language-plaintext highlighter-rouge">conv2d_1</code> layer on the left and the <code class="language-plaintext highlighter-rouge">activation_1</code> right after it on the right.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define a new model to extract intermediate layer outputs
</span><span class="n">self</span><span class="p">.</span><span class="n">activation_model_1</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">get_layer</span><span class="p">(</span><span class="sh">"</span><span class="s">conv2d_1</span><span class="sh">"</span><span class="p">).</span><span class="n">output</span><span class="p">)</span>
<span class="n">self</span><span class="p">.</span><span class="n">activation_model_2</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">get_layer</span><span class="p">(</span><span class="sh">"</span><span class="s">activation_1</span><span class="sh">"</span><span class="p">).</span><span class="n">output</span><span class="p">)</span>

</code></pre></div></div>

<p>As a reminder, here is architecture of our CNN:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓</span>
<span class="err">┃</span> <span class="n">Layer</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span>                         <span class="err">┃</span> <span class="n">Output</span> <span class="n">Shape</span>                <span class="err">┃</span>         <span class="n">Param</span> <span class="err">#</span> <span class="err">┃</span>
<span class="err">┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩</span>
<span class="err">│</span> <span class="n">conv2d</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>           <span class="mi">1</span><span class="p">,</span><span class="mi">520</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>              <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>         <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">conv2d_1</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>          <span class="err">│</span>          <span class="mi">25</span><span class="p">,</span><span class="mo">050</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_1</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>          <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d_1</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>       <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>            <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">flatten</span> <span class="p">(</span><span class="n">Flatten</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">1800</span><span class="p">)</span>                <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                        <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>                 <span class="err">│</span>         <span class="mi">900</span><span class="p">,</span><span class="mi">500</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_2</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>                 <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense_1</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>           <span class="mi">2</span><span class="p">,</span><span class="mo">004</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_3</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">└──────────────────────────────────────┴─────────────────────────────┴─────────────────┘</span>
 <span class="n">Total</span> <span class="n">params</span><span class="o">:</span> <span class="mi">929</span><span class="p">,</span><span class="mo">074</span> <span class="p">(</span><span class="mf">3.54</span> <span class="n">MB</span><span class="p">)</span>
 <span class="n">Trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">929</span><span class="p">,</span><span class="mo">074</span> <span class="p">(</span><span class="mf">3.54</span> <span class="n">MB</span><span class="p">)</span>
 <span class="n">Non</span><span class="o">-</span><span class="n">trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">B</span><span class="p">)</span>

</code></pre></div></div>

<p>Let’s try it with the dark line:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py world:<span class="o">=</span>dark_background.sdf

</code></pre></div></div>

<p>And also with the red line, let’s remember here that there were no training images with the red line!</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py world:<span class="o">=</span>red_line.sdf

</code></pre></div></div>

<p><a href="https://youtu.be/vRrFWKucU9A"><img width="600" src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/youtube-cnn-1.png"></a></p>

<h1 id="test-on-the-real-robot">Test on the real robot</h1>

<p>The above architecture with about 1 million parameters is too big to run on the robot’s slow Raspberry Pi 3, but as we saw the original LeNet-5 had only 61,706 parameters and was able to classify handwritten characters. Also we saw that classification CNNs are usually small and suitable for real time usage.</p>

<p>On the <code class="language-plaintext highlighter-rouge">robot</code> branch there is a much smaller network with only 932 trainable parameters (1000 times smaller than our previous network):</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓</span>
<span class="err">┃</span> <span class="n">Layer</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span>                         <span class="err">┃</span> <span class="n">Output</span> <span class="n">Shape</span>                <span class="err">┃</span>         <span class="n">Param</span> <span class="err">#</span> <span class="err">┃</span>
<span class="err">┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩</span>
<span class="err">│</span> <span class="n">conv2d</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>           <span class="err">│</span>              <span class="mi">52</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>              <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>           <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>         <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>             <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">conv2d_1</span> <span class="p">(</span><span class="n">Conv2D</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>             <span class="err">│</span>             <span class="mi">204</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_1</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>             <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">max_pooling2d_1</span> <span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">)</span>       <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>             <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">flatten</span> <span class="p">(</span><span class="n">Flatten</span><span class="p">)</span>                    <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>                  <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                        <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>                  <span class="err">│</span>             <span class="mi">544</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_2</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>                  <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">dense_1</span> <span class="p">(</span><span class="n">Dense</span><span class="p">)</span>                      <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>             <span class="mi">132</span> <span class="err">│</span>
<span class="err">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</span>
<span class="err">│</span> <span class="n">activation_3</span> <span class="p">(</span><span class="n">Activation</span><span class="p">)</span>            <span class="err">│</span> <span class="p">(</span><span class="n">None</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>                   <span class="err">│</span>               <span class="mi">0</span> <span class="err">│</span>
<span class="err">└──────────────────────────────────────┴─────────────────────────────┴─────────────────┘</span>
 <span class="n">Total</span> <span class="n">params</span><span class="o">:</span> <span class="mi">932</span> <span class="p">(</span><span class="mf">3.64</span> <span class="n">KB</span><span class="p">)</span>
 <span class="n">Trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">932</span> <span class="p">(</span><span class="mf">3.64</span> <span class="n">KB</span><span class="p">)</span>
 <span class="n">Non</span><span class="o">-</span><span class="n">trainable</span> <span class="n">params</span><span class="o">:</span> <span class="mi">0</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">B</span><span class="p">)</span>

</code></pre></div></div>

<p>Switch to the <code class="language-plaintext highlighter-rouge">robot</code> branch, rebuild the workspace and try the node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_mogi simulation_bringup_line_follow.launch.py

</code></pre></div></div>

<p>Then in another terminal start the line following with the neural network:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlebot3_mogi_py line_follower_cnn

</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/mogi-ros/week-1-8-cognitive-robotics/main/./assets/smaller-cnn.png" alt="alt text" title="CNN for the robot"></p>

<p>We only have 4 neurons in the <code class="language-plaintext highlighter-rouge">conv2d_1</code> and <code class="language-plaintext highlighter-rouge">activation_1</code> layers.</p>

<p>On the real turtlebots we should always have the <code class="language-plaintext highlighter-rouge">robot</code> branch checked out, and then we can start this small CNN without the graphical interface with the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 launch turtlebot3_bringup hardware.launch.py

</code></pre></div></div>

<p>Then in another terminal start the line following with the neural network:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run turtlebot3_mogi_py line_follower_cnn_robot

</code></pre></div></div>

</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/week-1-8-cognitive-robotics">week-1-8-cognitive-robotics</a> <small>repository</small></h3>
        <span class="label label-default">opencv</span> <span class="label label-default">localization</span> <span class="label label-default">camera</span> <span class="label label-default">navigation</span> <span class="label label-default">mapping</span> <span class="label label-default">tensorflow</span> <span class="label label-default">python3</span> <span class="label label-default">lidar</span> <span class="label label-default">gazebo</span> <span class="label label-default">slam</span> <span class="label label-default">line-following</span> <span class="label label-default">harmonics</span> <span class="label label-default">amcl</span> <span class="label label-default">gazebo-simulator</span> <span class="label label-default">cnn-classification</span> <span class="label label-default">turtlebot3</span> <span class="label label-default">line-follower-robot</span> <span class="label label-default">ros2-jazzy</span> 
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-mogi-ros-week-1-8-cognitive-robotics
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-mogi-ros-week-1-8-cognitive-robotics" role="menuitem" tabindex="-1" href="/r/week-1-8-cognitive-robotics/github-mogi-ros-week-1-8-cognitive-robotics" data="github-mogi-ros-week-1-8-cognitive-robotics">
                    <span class="glyphicon glyphicon-star"></span>
                    github-mogi-ros-week-1-8-cognitive-robotics
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/mogi-ros/week-1-8-cognitive-robotics.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
