<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Index</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top:20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/repos">Repos</a></li>
        <li class="active">ess_imu_driver2</li>
        <!--<li class="active">ess_imu_driver2</li>-->
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/ess_imu_driver2">ess_imu_driver2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Latest ROS2 Linux driver package for EPSON IMU using UART or SPI interface (includes C driver)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/cubicleguy/ess_imu_driver2.git">https://github.com/cubicleguy/ess_imu_driver2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">humble</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-12-09
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/ess_imu_driver2/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ess_imu_driver2/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ess_imu_driver2/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/ess_imu_driver2">ess_imu_driver2</a></td>
                    <td>2.0.2</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="readme-for-epson-imu-driver-for-ros2-node">README for Epson IMU Driver for ROS2 Node</h1>

<!---toc start-->

<ul>
  <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#readme-for-epson-imu-driver-for-ros2-node">README for Epson IMU Driver for ROS2 Node</a>
    <ul>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#what-is-this-repository-for">What is this repository for?</a></li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#what-kind-of-hardware-or-software-will-i-likely-need">What kind of hardware or software will I likely need?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#for-the-uart-interface">For the UART Interface:</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#for-the-spi-interface">For the SPI Interface:</a></li>
        </ul>
      </li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#how-do-i-use-the-driver">How do I use the driver?</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#how-do-i-use-the-driver-if-usleep-is-not-supported-for-time-delays">How do I use the driver if usleep() is not supported for time delays?</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#how-do-i-use-the-driver-with-gpios-to-control-imu-reset-drdy-ext-pins">How do I use the driver with GPIOs to control IMU RESET#, DRDY, EXT pins?</a></li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#how-do-i-build-install-run-this-package">How do I build, install, run this package?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#example-console-output-of-colcon-build">Example console output of <em>colcon build</em>:</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#example-console-output-of-launching-ros-node">Example console output of launching ROS node:</a></li>
        </ul>
      </li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#what-does-this-ros-imu-node-publish-as-messages">What does this ROS IMU Node publish as messages?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#ros-topic-message-imudata">ROS Topic Message /imu/data</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#ros-topic-message-imudata_raw">ROS Topic Message /imu/data_raw</a></li>
        </ul>
      </li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#why-am-i-seeing-inaccurate-ros-timestamps-high-latencies-or-slower-than-expected-imu-data-rates">Why am I seeing inaccurate ROS timestamps, high latencies, or slower than expected IMU data rates?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#ros-timestamps">ROS timestamps</a></li>
          <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#when-using-usb-uart-bridges">When using USB-UART bridges</a>
            <ul>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#modifying-latency_timer-by-udev-mechanism">Modifying <em>latency_timer</em> by udev mechanism</a></li>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#modifying-latency_timer-by-sysfs-mechanism">Modifying <em>latency_timer</em> by sysfs mechanism</a></li>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#modifying-low_latency-flag-using-setserial-utility">Modifying <em>low_latency</em> flag using <em>setserial</em> utility</a></li>
            </ul>
          </li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#when-using-the-spi-interface">When using the SPI interface</a></li>
        </ul>
      </li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#package-contents">Package Contents</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/humble/#references">References</a></li>
    </ul>
  </li>
</ul>

<!---toc end-->

<h2 id="what-is-this-repository-for">What is this repository for?</h2>

<ul>
  <li>This code is a ROS2 package for demonstrating a ROS2 node that configures and publishes IMU messages from a supported Epson IMU.</li>
  <li>This code provides software communication between Epson IMU and ROS using the either the UART or SPI interface.</li>
  <li>For the UART connection, this code uses the standard Unix Terminal I/O library (termios) for communicating either direct or by USB-serial converter such as FTDI USB-UART bridge ICs.</li>
  <li>For the SPI connection, this code uses the <a href="https://github.com/WiringPi/WiringPi/">Unofficial wiringPi</a> library for accessing GPIO and SPI functions on the Raspberry Pi platform running Ubuntu Linux distro.</li>
  <li>This ROS2 node demonstration software is a ROS C++ wrapper around the Linux C driver software:
    <ul>
      <li>
<em>src/epson_imu_uart_ros2_node.cpp</em> is for the UART interface</li>
      <li>
<em>src/epson_imu_spi_ros2_node.cpp</em> is for the SPI interface</li>
    </ul>
  </li>
  <li>The other source files in <code class="language-plaintext highlighter-rouge">src/</code> are based on the Linux C driver originally released and can be found here:
<a href="https://github.com/cubicleguy/imu_linux_example">Linux C driver and logger example for EPSON IMU</a>
</li>
  <li>Information about ROS2, and tutorials can be found: <a href="https://docs.ros.org/">ROS.org</a>
</li>
</ul>

<h2 id="what-kind-of-hardware-or-software-will-i-likely-need">What kind of hardware or software will I likely need?</h2>

<ul>
  <li>Epson IMU <a href="https://global.epson.com/products_and_drivers/sensing_system/imu/">Epson IMU models</a>
    <ul>
      <li>At the time software release:
        <ul>
          <li>G320PDG0, G320PDGN, G354PDH0, G364PDCA, G364PDC0</li>
          <li>G365PDC1, G365PDF1, G370PDF1, G370PDS0</li>
          <li>G330PDG0, G366PDG0, G370PDG0, G370PDT0</li>
          <li>G570PR20</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ROS2 Foxy or Humble (via download) <a href="https://docs.ros.org/en/humble/Installation.html">ROS.org</a>
</li>
  <li>This software was developed and tested on the following:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ROS2:        Foxy, Humble
  Description: Ubuntu 20.04 LTS, Ubuntu 22.04 LTS
  Hardware Platform: Core i7 PC, Raspberry Pi 3B+, RaspberryPi 4

</code></pre></div></div>

<h3 id="for-the-uart-interface">For the UART Interface:</h3>

<ul>
  <li>Epson USB evaluation board or equivalent FTDI USB-Serial interface connecting the Epson IMU to ROS host (tty/serial) <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV041</a>
</li>
  <li>Alternatively, a direct connection from the Epson IMU to the ROS platform supporting a 3.3V CMOS compatible UART interface <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV031</a>.</li>
</ul>

<h3 id="for-the-spi-interface">For the SPI Interface:</h3>

<ul>
  <li>
<strong>NOTE:</strong> This software is intended for an embedded Linux host system with 3.3V I/O compatible SPI interface (SCLK, MISO, MOSI) and 3 GPIOs (CS#, RST#, DRDY).</li>
  <li>For Raspberry Pi, if not enabled already the SPI interface can be enabled using <code class="language-plaintext highlighter-rouge">raspi-config</code> or equivalent.</li>
  <li>This code uses a separate GPIO to manually control CS# chipselect instead of the chipselect assigned to by the RapsberryPi SPI interface.
    <ul>
      <li>The chipselect assigned by the HW SPI interface should also work, but has not been thoroughly tested.</li>
    </ul>
  </li>
  <li>Epson Breakout evaluation board or some equivalent is required to connect to the 3.3V CMOS compatible pins of the ROS host (SPI &amp; GPIOs) <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV031</a>
</li>
</ul>

<h2 id="how-do-i-use-the-driver">How do I use the driver?</h2>

<ul>
  <li>
    <p>This code assumes that the user is familiar with building ROS2 packages using the <code class="language-plaintext highlighter-rouge">colcon build</code> process</p>
  </li>
  <li>
    <p>This README is <em>NOT</em> detailed step by step instructions on how to build and install ROS2 software.</p>
  </li>
  <li>
    <p>Please refer to the ROS.org website for more detailed instructions on the ROS package build process. <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html">ROS.org</a></p>
  </li>
  <li>
    <p><strong>NOTE:</strong> At a bare minimum, the user must re-build the package with colcon after modifying the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to configure any of the following:</p>

    <ul>
      <li>serial interface type, <code class="language-plaintext highlighter-rouge">INTERFACE=</code> (UART or SPI)</li>
      <li>host platform type, <code class="language-plaintext highlighter-rouge">PLATFORM=</code> (RPI or NONE=PC)</li>
    </ul>
  </li>
  <li>
    <p>Changes to IMU settings should be made by editing the <code class="language-plaintext highlighter-rouge">.py</code> launch files located in the <code class="language-plaintext highlighter-rouge">launch/</code> folder instead of modifying the <code class="language-plaintext highlighter-rouge">src\</code> source files</p>
  </li>
</ul>

<h2 id="how-do-i-use-the-driver-if-usleep-is-not-supported-for-time-delays">How do I use the driver if usleep() is not supported for time delays?</h2>

<ul>
  <li>
<strong>NOTE:</strong> In the <code class="language-plaintext highlighter-rouge">hcl_linux.c</code> or <code class="language-plaintext highlighter-rouge">hcl_rpi.c</code>, there are <code class="language-plaintext highlighter-rouge">seDelayMS()</code> and <code class="language-plaintext highlighter-rouge">seDelayMicroSecs()</code> wrapper functions for time delays in millisecond and microseconds, respectively.</li>
  <li>On embedded Linux platforms, the user may need to modify and redirect to platform specific delay routines if <code class="language-plaintext highlighter-rouge">usleep()</code> is not supported.</li>
  <li>For example on RaspberryPi, the time delay functions for millisecond and microseconds are redirected to WiringPi library <code class="language-plaintext highlighter-rouge">delay()</code> and <code class="language-plaintext highlighter-rouge">delayMicroseconds()</code>, respectively.</li>
  <li>If a hardware delay is not available from a library, then a software delay loop is possible but not preferred.</li>
</ul>

<h2 id="how-do-i-use-the-driver-with-gpios-to-control-imu-reset-drdy-ext-pins">How do I use the driver with GPIOs to control IMU RESET#, DRDY, EXT pins?</h2>

<ul>
  <li>When connecting the IMU using the UART interface, the use of GPIO pins for connecting to the IMU <code class="language-plaintext highlighter-rouge">RESET#</code> or <code class="language-plaintext highlighter-rouge">DRDY</code> is optional, but can be useful on an embedded Linux platforms (such as RapsberryPi).</li>
  <li>When connecting the IMU using the SPI interface, the use of GPIO pins for connecting to the IMU <code class="language-plaintext highlighter-rouge">DRDY</code> is mandatory (<code class="language-plaintext highlighter-rouge">RESET#</code> is recommended, <code class="language-plaintext highlighter-rouge">EXT</code> is optional).</li>
  <li>When using the <code class="language-plaintext highlighter-rouge">time_correction</code> function for accurate time stamping with an external 3.3V GNSS 1PPS signal, the IMU <code class="language-plaintext highlighter-rouge">EXT</code> pin must be connected to the 1PPS.</li>
  <li>The user can choose to control the IMU <code class="language-plaintext highlighter-rouge">CS#</code> pin directly with a designated host GPIO output or connect to the designated chipselect of the SPI interface (i.e. <code class="language-plaintext highlighter-rouge">SPI_CE0</code> pin on the RapsberryPi)</li>
  <li>Where possible, connecting the <code class="language-plaintext highlighter-rouge">RESET#</code> and forcing a Hardware Reset during every IMU initialization is recommended for better robustness.</li>
  <li>This code is structured to simplify editing to redirect GPIO control to low-level hardware library GPIO function calls.</li>
  <li>There are no standard methods to implement GPIO connections on embedded Linux platform, but the following source files typically need changing:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/hcl_linux.c
src/hcl_gpio.c
src/hcl_gpio.h

</code></pre></div></div>

<ul>
  <li>
    <p>Typically, an external library needs to be invoked to initialize &amp; enable GPIO HW functions on the user’s embedded platform.</p>
  </li>
  <li>
    <p>This typically requires the following changes to <code class="language-plaintext highlighter-rouge">hcl_linux.c</code> (Refer to <code class="language-plaintext highlighter-rouge">hcl_rpi.c</code> as a template):</p>

    <ul>
      <li>add <code class="language-plaintext highlighter-rouge">#include</code> to external library near the top of <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>
</li>
      <li>add the initialization call to the HW library inside the <code class="language-plaintext highlighter-rouge">seInit()</code> function in <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>
</li>
    </ul>
  </li>
</ul>

<p>For example on a Raspberry Pi, the following changes can be made to <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

  #include &lt;stdint.h&gt;
  #include &lt;stdio.h&gt;
  #include &lt;wiringPi.h&gt;  // &lt;== Added external library

  int seInit(void)
  {
    // Initialize wiringPi libraries                                                   // &lt;== Added
    printf("\r\nInitializing libraries...");                                           // &lt;== Added
    if(wiringPiSetupGpio() != 0) {                                                     // &lt;== Added external library initialization
      printf("\r\nError: could not initialize wiringPI libraries. Exiting...\r\n");    // &lt;== Added
      return NG;                                                                       // &lt;== Added
    }                                                                                  // &lt;== Added
    printf("...done.");

    return OK;
  }

...

</code></pre></div></div>

<ul>
  <li>Typically, the GPIO pins need to be assigned according to embedded HW platform-specific <strong>pin numbering</strong> and requires changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.h</code>.</li>
</ul>

<p><strong>NOTE:</strong> When using the SPI interface, if direct <code class="language-plaintext highlighter-rouge">CS#</code> control is not by GPIO, then connect IMU <code class="language-plaintext highlighter-rouge">CS#</code> pin to the RPI <code class="language-plaintext highlighter-rouge">SPI0_CE0 (P1_24)</code>.</p>

<p>For example on a Raspberry Pi, the changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.h</code> assume the following pin mapping:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epson IMU                   Raspberry Pi
---------------------------------------------------
EPSON_RESET                 RPI_GPIO_P1_15 (GPIO22) Output
EPSON_DRDY                  RPI_GPIO_P1_18 (GPIO24) Input

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

// Prototypes for generic GPIO functions
int gpioInit(void);
int gpioRelease(void);

void gpioSet(uint8_t pin);
void gpioClr(uint8_t pin);
uint8_t gpioGetPinLevel(uint8_t pin);

#define RPI_GPIO_P1_15              22                    // &lt;== Added
#define RPI_GPIO_P1_18              24                    // &lt;== Added

#define EPSON_RESET                 RPI_GPIO_P1_15        // &lt;== Added
#define EPSON_DRDY                  RPI_GPIO_P1_18        // &lt;== Added
...

</code></pre></div></div>

<ul>
  <li>
    <p>The external HW library will typically have GPIO pin control functions such as <code class="language-plaintext highlighter-rouge">set_output()</code>, <code class="language-plaintext highlighter-rouge">set_input()</code>, <code class="language-plaintext highlighter-rouge">set()</code>, <code class="language-plaintext highlighter-rouge">reset()</code>, <code class="language-plaintext highlighter-rouge">read_pin_level()</code>, etc…</p>
  </li>
  <li>
    <p>The user should redirect the function calls in <code class="language-plaintext highlighter-rouge">hcl_gpio.c</code> for <code class="language-plaintext highlighter-rouge">gpioInit()</code>, <code class="language-plaintext highlighter-rouge">gpioRelease()</code>, <code class="language-plaintext highlighter-rouge">gpioSet()</code>, <code class="language-plaintext highlighter-rouge">gpioClr()</code>, <code class="language-plaintext highlighter-rouge">gpioGetPinLevel()</code> to such equivalent external HW library pin control functions.</p>
  </li>
  <li>
    <p>For example on a Raspberry Pi, the following are changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.c</code> which can be used as a template:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "hcl.h"
#include "hcl_gpio.h"
#include &lt;wiringPi.h&gt;                         // &lt;== Added external library

...

int gpioInit(void)
{
	pinMode(EPSON_RESET, OUTPUT);               // &lt;== Added external call RESET Output Pin
	pinMode(EPSON_DRDY, INPUT);                 // &lt;== Added external call DRDY Input Pin
	pullUpDnControl(EPSON_DRDY, PUD_OFF) ;      // &lt;== Added external call Disable any internal pullup or pulldown resistance

	return OK;
}

...

int gpioRelease(void)
{
	return OK;
}

...

void gpioSet(uint8_t pin)
{
	digitalWrite(pin, HIGH);                    // &lt;== Added external call set pin HIGH
}

...

void gpioClr(uint8_t pin)
{
	digitalWrite(pin, LOW);                     // &lt;== Added external call set pin LOW
}

...

uint8_t gpioGetPinLevel(uint8_t pin)
{
	return (digitalRead(pin));                  // &lt;== Added external call to return pin state of input pin
}

...

</code></pre></div></div>

<h2 id="how-do-i-build-install-run-this-package">How do I build, install, run this package?</h2>

<p>The Epson IMU ROS2 driver is designed for building with the standard ROS2 colcon build environment.
For more information on setting up the ROS2 environment refer to: <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Configuring-ROS2-Environment.html">Installing and Configuring ROS Environment</a>.
For more information on setting up the ROS2 colcon environment refer to: <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html">ROS2 Tutorial</a></p>

<ol>
  <li>Place this package (including folders) into a new folder within your colcon workspace <code class="language-plaintext highlighter-rouge">src\</code> folder.
For example, we recommend using the folder name <code class="language-plaintext highlighter-rouge">ess_imu_driver2</code>
</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/src/ess_imu_driver2/

</code></pre></div></div>

<ol>
  <li>
    <p>Modify the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to select the serial interface type <code class="language-plaintext highlighter-rouge">INTERFACE=</code> and platform type <code class="language-plaintext highlighter-rouge">PLATFORM=</code> that matches your ROS2 system and connection to the Epson IMU.
Refer to the comments in the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> for additional info.
<strong>NOTE:</strong> You <em>MUST</em> re-build using <code class="language-plaintext highlighter-rouge">colcon build</code> after any changes in the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>.</p>
  </li>
  <li>
    <p>From the colcon workspace folder run <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> to build all ROS2 packages located in the <code class="language-plaintext highlighter-rouge">&lt;colcon_workspace&gt;/src/</code> folder.
<strong>NOTE:</strong> Re-run <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> to rebuild the software after making any changes to any of the <code class="language-plaintext highlighter-rouge">.c</code> or <code class="language-plaintext highlighter-rouge">.cpp</code> or <code class="language-plaintext highlighter-rouge">.h</code> source files.</p>
  </li>
</ol>

<p><strong>NOTE:</strong> It is recommended to change IMU settings by editing the parameters in the <code class="language-plaintext highlighter-rouge">.py</code> launch file, instead of modifying the <code class="language-plaintext highlighter-rouge">.c</code>, <code class="language-plaintext highlighter-rouge">.cpp</code>, <code class="language-plaintext highlighter-rouge">.h</code> source files directly.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/colcon build --packages-select ess_imu_driver2 --symlink-install

</code></pre></div></div>

<ol>
  <li>Reload the current ROS2 environment variables that may have changed after the colcon build process by entering the following from the <code class="language-plaintext highlighter-rouge">\&lt;colcon_workspace&gt;</code>:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source ./install/setup.bash

</code></pre></div></div>

<ol>
  <li>Modify the <code class="language-plaintext highlighter-rouge">.py</code> launch file in the <code class="language-plaintext highlighter-rouge">launch/</code> folder to set your desired IMU configure parameter options at runtime:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>serial_port</td>
      <td>specifies UART port on the system when built and configured for UART in the CMakeLists.txt</td>
    </tr>
    <tr>
      <td>frame_id</td>
      <td>specifies the value in the IMU message frame_id field</td>
    </tr>
    <tr>
      <td>burst_polling_rate</td>
      <td>specifies the driver internal polling rate for the serial port input buffer (typically does not need changing)</td>
    </tr>
    <tr>
      <td>imu_dout_rate</td>
      <td>specifies the IMU output data rate</td>
    </tr>
    <tr>
      <td>imu_filter_sel</td>
      <td>specifies the IMU filter setting</td>
    </tr>
    <tr>
      <td>quaternion_output_en</td>
      <td>enables or disables quaternion output (not supported on all IMU models)</td>
    </tr>
    <tr>
      <td>atti_profile</td>
      <td>specifies the attitude motion profile (not supported on all IMU models)</td>
    </tr>
    <tr>
      <td>output_32bit_en</td>
      <td>enables or disables outputting sensor data in 32 or 16 bit resolution</td>
    </tr>
    <tr>
      <td>time_correction_en</td>
      <td>enables time correction function using IMU counter reset function &amp; external 1PPS connection to IMU GPIO2/EXT pin. <strong>Cannot be used when ext_trigger_en=1</strong>
</td>
    </tr>
  </tbody>
</table>

<p><strong>NOTE:</strong> The <code class="language-plaintext highlighter-rouge">.py</code> launch file passes IMU configuration settings to ROS node at runtime. Therefore, re-building with <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> when changing the <code class="language-plaintext highlighter-rouge">.py</code> launch file is not required.
<strong>NOTE:</strong> When using this software on older ROS2 versions (Dashing or Eloquent) the <code class="language-plaintext highlighter-rouge">.py</code> launch file needs to be modified to replace <code class="language-plaintext highlighter-rouge">namespace</code> parameter from <code class="language-plaintext highlighter-rouge">executable</code> to <code class="language-plaintext highlighter-rouge">node_executable</code></p>

<ol>
  <li>Start the Epson IMU ROS2 driver use the appropriate <code class="language-plaintext highlighter-rouge">.py</code> launch file located in <code class="language-plaintext highlighter-rouge">launch/</code>. All parameters are described in the in-line comments of the <code class="language-plaintext highlighter-rouge">.py</code> launch file.</li>
</ol>

<p>For example, to launch the ROS2 node:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/ros2 launch ess_imu_driver2 launch.py

</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Launch File</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>launch.py</td>
      <td>Publishes to <code class="language-plaintext highlighter-rouge">imu/data</code> for IMU models that support <code class="language-plaintext highlighter-rouge">gyro</code>, <code class="language-plaintext highlighter-rouge">accel</code>, and <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code> or <code class="language-plaintext highlighter-rouge">imu/data_raw</code> for IMU models that do not support <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code>
</td>
    </tr>
    <tr>
      <td>raw_launch.py</td>
      <td>Publishes to <code class="language-plaintext highlighter-rouge">imu/data_raw</code> and does not enable or update <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code>
</td>
    </tr>
    <tr>
      <td>tc_launch.py</td>
      <td>Same as launch.py except time correction function is enabled (GNSS 1PPS signal must be connected to IMU EXT pin)</td>
    </tr>
  </tbody>
</table>

<h3 id="example-console-output-of-colcon-build">Example console output of <em>colcon build</em>:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@RPI4-RC:~/ros2_ws$ colcon build --symlink-install --packages-select ess_imu_driver2
Starting &gt;&gt;&gt; ess_imu_driver2
Finished &lt;&lt;&lt; ess_imu_driver2 [29.3s]

Summary: 1 package finished [30.1s]
user@RPI4-RC:~/ros2_ws$

</code></pre></div></div>

<h3 id="example-console-output-of-launching-ros-node">Example console output of launching ROS node:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@RPI4-RC:~/ros2_ws$ ros2 launch ess_imu_driver2 launch.py
[INFO] [launch]: All log files can be found below /home/user/.ros/log/2024-07-31-12-52-53-476565-VDC-RPI4-RC-853040
[INFO] [launch]: Default logging verbosity is set to INFO
[INFO] [ess_imu_driver2_node-1]: process started with pid [853041]
[ess_imu_driver2_node-1] [INFO] [1722455573.931168183] [epson_node]: frame_id:                  imu_link
[ess_imu_driver2_node-1] [INFO] [1722455573.931458588] [epson_node]: time_correction_en:        0
[ess_imu_driver2_node-1] [INFO] [1722455573.931508699] [epson_node]: burst_polling_rate:        4000.0
[ess_imu_driver2_node-1] [WARN] [1722455573.931558883] [epson_node]: Not specified param temperature_topic. Set default value:       /epson_imu/tempc
[ess_imu_driver2_node-1] [WARN] [1722455573.931592180] [epson_node]: Not specified param ext_trigger_en. Set default value:  0
[ess_imu_driver2_node-1] [INFO] [1722455573.931624976] [epson_node]: imu_dout_rate:             4
[ess_imu_driver2_node-1] [INFO] [1722455573.931657012] [epson_node]: imu_filter_sel:            5
[ess_imu_driver2_node-1] [INFO] [1722455573.931688253] [epson_node]: quaternion_output_en:      1
[ess_imu_driver2_node-1] [INFO] [1722455573.931718123] [epson_node]: output_32bit_en:           1
[ess_imu_driver2_node-1] [INFO] [1722455573.931761197] [epson_node]: atti_profile:              0
[ess_imu_driver2_node-1] [INFO] [1722455576.933310504] [epson_node]: Checking sensor power on status...
[ess_imu_driver2_node-1] [INFO] [1722455577.135333655] [epson_node]: Detecting sensor model...
[ess_imu_driver2_node-1] ...Initializing wiringPI library......done....delay for GPIO pins...
[ess_imu_driver2_node-1] Reading device model and serial number...
[ess_imu_driver2_node-1] PRODUCT ID:    G366PDG0
[ess_imu_driver2_node-1] [INFO] [1722455577.139222921] [epson_node]: Initializing Sensor...
[ess_imu_driver2_node-1] [INFO] [1722455577.146912528] [epson_node]: Epson IMU initialized.
[ess_imu_driver2_node-1] SERIAL ID:     T1000062
[ess_imu_driver2_node-1] [INFO] [1722455577.147432672] [epson_node]: Sensor started...



</code></pre></div></div>

<h2 id="what-does-this-ros-imu-node-publish-as-messages">What does this ROS IMU Node publish as messages?</h2>

<p>The Epson IMU ROS node will publish messages as convention per <a href="http://www.ros.org/reps/rep-0145.html">REP 145</a>.</p>

<ul>
  <li>For IMU models that do not support quaternion output, the <code class="language-plaintext highlighter-rouge">.py</code> launch file will remap IMU messages to <code class="language-plaintext highlighter-rouge">/imu/data_raw</code> and only update the fields for <code class="language-plaintext highlighter-rouge">angular_velocity</code> (gyro), and <code class="language-plaintext highlighter-rouge">linear_acceleration</code> (accel).</li>
  <li>For IMU models that supports and enables quaternion, the <code class="language-plaintext highlighter-rouge">.py</code> launch file will remap IMU messages to <code class="language-plaintext highlighter-rouge">/imu/data</code> and update <code class="language-plaintext highlighter-rouge">angular_velocity</code> (gyro), <code class="language-plaintext highlighter-rouge">linear_acceleration</code> (accel), and <code class="language-plaintext highlighter-rouge">orientation</code> field using the internal extended Kalman Filter.</li>
  <li>Temperature sensor data from the IMU will publish on topic <code class="language-plaintext highlighter-rouge">/epson_imu/tempc</code>
</li>
</ul>

<h3 id="ros-topic-message-imudata">ROS Topic Message /imu/data</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
header:
  stamp:
    sec: 1685644337
    nanosec: 660167310
  frame_id: imu_link
orientation:
  x: 0.9999865293502808
  y: -0.00023142248392105103
  z: 0.002697369083762169
  w: -0.004425106570124626
orientation_covariance:
- -1.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
angular_velocity:
  x: 0.00032043419196270406
  y: -0.0005722396308556199
  z: 0.0002733084256760776
angular_velocity_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
linear_acceleration:
  x: 0.04799626022577286
  y: -0.07659434527158737
  z: -9.828039169311523
linear_acceleration_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
---

</code></pre></div></div>

<h3 id="ros-topic-message-imudata_raw">ROS Topic Message /imu/data_raw</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
header:
  stamp:
    sec: 1685643703
    nanosec: 402378465
  frame_id: imu_link
orientation:
  x: 0.0
  y: 0.0
  z: 0.0
  w: 0.0
orientation_covariance:
- -1.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
angular_velocity:
  x: -0.0002180843148380518
  y: 7.883128273533657e-05
  z: 6.580488116014749e-05
angular_velocity_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
linear_acceleration:
  x: 0.07670824229717255
  y: -0.056904129683971405
  z: -9.818550109863281
linear_acceleration_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
---

</code></pre></div></div>

<h2 id="why-am-i-seeing-inaccurate-ros-timestamps-high-latencies-or-slower-than-expected-imu-data-rates">Why am I seeing inaccurate ROS timestamps, high latencies, or slower than expected IMU data rates?</h2>

<h3 id="ros-timestamps">ROS timestamps</h3>

<ul>
  <li>By default, the ROS node publishes using the ROS/Unix current timestamp at the time of processing.</li>
  <li>Latencies from system overhead, system loading, and buffering will cause timestamp inaccuracies between the sensor data and this ROS/Unix timestamp.</li>
  <li>To improve timestamp accuracy, the user should consider using the time correction function with a GNSS receiver with 1PPS output to increase clock accuracy on the ROS host system:
    <ul>
      <li>Consider setting up <a href="https://chrony-project.org/examples.html">chrony</a> and <a href="https://gpsd.io/">gpsd</a> with the GNSS receiver’s 1PPS signal connected to constrain the host system clock drift</li>
      <li>Consider connecting the GNSS receiver’s 1PPS signal to the Epson IMU GPIO2/EXT with <code class="language-plaintext highlighter-rouge">time_correction</code> enabled in the <code class="language-plaintext highlighter-rouge">.py</code> launch file to improve time-stamp accuracy of the IMU sensor messages</li>
    </ul>
  </li>
</ul>

<h3 id="when-using-usb-uart-bridges">When using USB-UART bridges</h3>

<ul>
  <li>If your connection between the Epson IMU UART interface and the Linux host is by FTDI ICs, the <code class="language-plaintext highlighter-rouge">latency_timer</code> setting in the FTDI driver may be large i.e. typically 16 (msec).</li>
  <li>This may affect the UART latency and maximum IMU data rates on your host system.</li>
  <li>There are 3 methods listed below to reduce the impact of this latency.</li>
</ul>

<h4 id="modifying-latency_timer-by-udev-mechanism">Modifying <em>latency_timer</em> by udev mechanism</h4>

<ul>
  <li>
<a href="https://wiki.debian.org/udev">udev</a> is a device manager for Linux that can dynamically create and remove devices in <em>userspace</em> and run commands when new devices appear or other events</li>
  <li>Create a udev rule to automatically set the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1 when an FTDI USB-UART device is plugged in to a USB port.</li>
  <li>For example, the following text file named <code class="language-plaintext highlighter-rouge">99-ftdi_sio.rules</code> can be put in the <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d</code> directory</li>
</ul>

<p><strong>NOTE:</strong> This requires root (sudo) access to create or copy file in <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d</code>
<strong>NOTE:</strong> This is the recommended method because it is automatic when device is plugged in, but it affects ALL FTDI USB-UART devices on the system</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SUBSYSTEM=="usb-serial", DRIVER=="ftdi_sio", ATTR{latency_timer}="1"

</code></pre></div></div>

<h4 id="modifying-latency_timer-by-sysfs-mechanism">Modifying <em>latency_timer</em> by sysfs mechanism</h4>

<ul>
  <li>The example below reads the <code class="language-plaintext highlighter-rouge">latency_timer</code> setting for <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code> which returns 16msec.</li>
  <li>Then, it sets the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1msec, and confirms it by read back.</li>
</ul>

<p><strong>NOTE: This may require root (sudo su) access on your system to execute.</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
16
echo 1 &gt; /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
cat /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
1

</code></pre></div></div>

<h4 id="modifying-low_latency-flag-using-setserial-utility">Modifying <em>low_latency</em> flag using <em>setserial</em> utility</h4>

<ul>
  <li>The example below sets the <code class="language-plaintext highlighter-rouge">low_latency</code> flag for <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code>.</li>
  <li>This will have the same effect as setting the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1msec.</li>
  <li>This can be confirmed by running the <code class="language-plaintext highlighter-rouge">setserial</code> command again.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@user:~$ setserial /dev/ttyUSB0
/dev/ttyUSB0, UART: unknown, Port: 0x0000, IRQ: 0

user@user:~$ setserial /dev/ttyUSB0 low_latency

user@user:~$ setserial /dev/ttyUSB0
/dev/ttyUSB0, UART: unknown, Port: 0x0000, IRQ: 0, Flags: low_latency

</code></pre></div></div>

<h3 id="when-using-the-spi-interface">When using the SPI interface</h3>

<ul>
  <li>latency issues with SPI interface will largely depend on your host system’s processing load and capabilities.</li>
  <li>If your ROS platform is running too many ROS node packages or too slow, it may not react fast enough to detect the rising edge of the IMU DRDY signal and
process the IMU sampling data.</li>
  <li>Try modifying the <code class="language-plaintext highlighter-rouge">dout_rate</code> and <code class="language-plaintext highlighter-rouge">filter_sel</code> setting in the <code class="language-plaintext highlighter-rouge">.py</code> launch file to the slowest setting that can meet your system requirements.</li>
  <li>Try monitoring the DRDY signal on the IMU with a oscilloscope to verify the stability of the IMU DRDY signal and seeing that it matches the expected <code class="language-plaintext highlighter-rouge">dout_rate</code> frequency.</li>
  <li>Try to set the SPI clock rate to maximum of 1MHz (1000000) in the <code class="language-plaintext highlighter-rouge">_node.cpp</code> for the <code class="language-plaintext highlighter-rouge">spiInit()</code> function call:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

    while (rclcpp::ok() &amp;&amp; !spiInit(SPI_MODE3, 1000000)) {
      RCLCPP_WARN(this-&gt;get_logger(),
                  "Retry to initialize the SPI layer in 1 second period...");
      one_sec.sleep();
    }

...

</code></pre></div></div>

<h2 id="package-contents">Package Contents</h2>

<p>The Epson IMU ROS2 driver-related sub-folders &amp; root files are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>launch/        &lt;== various example launch files
src/           &lt;== source code for ROS2 node C++ wrapper, IMU Linux C driver, and additional README_src.md (specifically for building and using the IMU Linux C driver as stand-alone without ROS support)
CMakeLists.txt &lt;== cmake build script used by colcon
LICENSE.txt    &lt;== description of the applicable licenses
package.xml    &lt;== colcon package description
README.md      &lt;== general README

</code></pre></div></div>

<h2 id="references">References</h2>

<ol>
  <li>https://index.ros.org/doc/ros2/</li>
</ol>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        
        <a class="label label-primary pkg-label" href="/p/ess_imu_driver2">ess_imu_driver2</a>
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        
        <div class="panel panel-default">
          
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body" style="overflow-x: auto">
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Latest ROS2 Linux driver package for EPSON IMU using UART or SPI interface (includes C driver)</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/cubicleguy/ess_imu_driver2.git">https://github.com/cubicleguy/ess_imu_driver2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">jazzy</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-12-09
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-primary">
          
          MAINTAINED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/ess_imu_driver2/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ess_imu_driver2/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ess_imu_driver2/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Packages</h3></div>
          <div class="panel-body">
            
            
              <table class="table table-condensed table-hover table-striped">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody>
                
                  <tr>
                    <td><a href="/p/ess_imu_driver2">ess_imu_driver2</a></td>
                    <td>2.0.3</td>
                  </tr>
                
                </tbody>
              </table>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">README</h3></div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="readme-for-epson-imu-driver-for-ros2-node">README for Epson IMU Driver for ROS2 Node</h1>

<!---toc start-->

<ul>
  <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#readme-for-epson-imu-driver-for-ros2-node">README for Epson IMU Driver for ROS2 Node</a>
    <ul>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#what-is-this-repository-for">What is this repository for?</a></li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#what-kind-of-hardware-or-software-will-i-likely-need">What kind of hardware or software will I likely need?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#for-the-uart-interface">For the UART Interface:</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#for-the-spi-interface">For the SPI Interface:</a></li>
        </ul>
      </li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#how-do-i-use-the-driver">How do I use the driver?</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#how-do-i-use-the-driver-if-usleep-is-not-supported-for-time-delays">How do I use the driver if usleep() is not supported for time delays?</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#how-do-i-use-the-driver-with-gpios-to-control-imu-reset-drdy-ext-pins">How do I use the driver with GPIOs to control IMU RESET#, DRDY, EXT pins?</a></li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#how-do-i-build-install-run-this-package">How do I build, install, run this package?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#example-console-output-of-colcon-build">Example console output of <em>colcon build</em>:</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#example-console-output-of-launching-ros-node">Example console output of launching ROS node:</a></li>
        </ul>
      </li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#what-does-this-ros-imu-node-publish-as-messages">What does this ROS IMU Node publish as messages?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#ros-topic-message-imudata">ROS Topic Message /imu/data</a></li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#ros-topic-message-imudata_raw">ROS Topic Message /imu/data_raw</a></li>
        </ul>
      </li>
      <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#why-am-i-seeing-inaccurate-ros-timestamps-high-latencies-or-slower-than-expected-imu-data-rates">Why am I seeing inaccurate ROS timestamps, high latencies, or slower than expected IMU data rates?</a>
        <ul>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#ros-timestamps">ROS timestamps</a></li>
          <li>
<a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#when-using-usb-uart-bridges">When using USB-UART bridges</a>
            <ul>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#modifying-latency_timer-by-udev-mechanism">Modifying <em>latency_timer</em> by udev mechanism</a></li>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#modifying-latency_timer-by-sysfs-mechanism">Modifying <em>latency_timer</em> by sysfs mechanism</a></li>
              <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#modifying-low_latency-flag-using-setserial-utility">Modifying <em>low_latency</em> flag using <em>setserial</em> utility</a></li>
            </ul>
          </li>
          <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#when-using-the-spi-interface">When using the SPI interface</a></li>
        </ul>
      </li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#package-contents">Package Contents</a></li>
      <li><a href="https://github.com/cubicleguy/ess_imu_driver2/tree/jazzy/#references">References</a></li>
    </ul>
  </li>
</ul>

<!---toc end-->

<h2 id="what-is-this-repository-for">What is this repository for?</h2>

<ul>
  <li>This code is a ROS2 package for demonstrating a ROS2 node that configures and publishes IMU messages from a supported Epson IMU.</li>
  <li>This code provides software communication between Epson IMU and ROS using the either the UART or SPI interface.</li>
  <li>For the UART connection, this code uses the standard Unix Terminal I/O library (termios) for communicating either direct or by USB-serial converter such as FTDI USB-UART bridge ICs.</li>
  <li>For the SPI connection, this code uses the <a href="https://github.com/WiringPi/WiringPi/">Unofficial wiringPi</a> library for accessing GPIO and SPI functions on the Raspberry Pi platform running Ubuntu Linux distro.</li>
  <li>This ROS2 node demonstration software is a ROS C++ wrapper around the Linux C driver software:
    <ul>
      <li>
<em>src/epson_imu_uart_ros2_node.cpp</em> is for the UART interface</li>
      <li>
<em>src/epson_imu_spi_ros2_node.cpp</em> is for the SPI interface</li>
    </ul>
  </li>
  <li>The other source files in <code class="language-plaintext highlighter-rouge">src/</code> are based on the Linux C driver originally released and can be found here:
<a href="https://github.com/cubicleguy/imu_linux_example">Linux C driver and logger example for EPSON IMU</a>
</li>
  <li>Information about ROS2, and tutorials can be found: <a href="https://docs.ros.org/">ROS.org</a>
</li>
</ul>

<h2 id="what-kind-of-hardware-or-software-will-i-likely-need">What kind of hardware or software will I likely need?</h2>

<ul>
  <li>Epson IMU <a href="https://global.epson.com/products_and_drivers/sensing_system/imu/">Epson IMU models</a>
    <ul>
      <li>At the time software release:
        <ul>
          <li>G320PDG0, G320PDGN, G354PDH0, G364PDCA, G364PDC0</li>
          <li>G365PDC1, G365PDF1, G370PDF1, G370PDS0</li>
          <li>G330PDG0, G366PDG0, G370PDG0, G370PDT0</li>
          <li>G570PR20</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ROS2 Foxy or Humble or Jazzy</li>
  <li>This software was developed and tested on the following:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ROS2:        Foxy, Humble, Jazzy
  Description: Ubuntu 20.04 LTS, Ubuntu 22.04 LTS, Ubuntu 24.04 LTS
  Hardware Platform: Core i7 PC, Raspberry Pi 3B+, RaspberryPi 4

</code></pre></div></div>

<h3 id="for-the-uart-interface">For the UART Interface:</h3>

<ul>
  <li>Epson USB evaluation board or equivalent FTDI USB-Serial interface connecting the Epson IMU to ROS host (tty/serial) <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV041</a>
</li>
  <li>Alternatively, a direct connection from the Epson IMU to the ROS platform supporting a 3.3V CMOS compatible UART interface <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV031</a>.</li>
</ul>

<h3 id="for-the-spi-interface">For the SPI Interface:</h3>

<ul>
  <li>
<strong>NOTE:</strong> This software is intended for an embedded Linux host system with 3.3V I/O compatible SPI interface (SCLK, MISO, MOSI) and 3 GPIOs (CS#, RST#, DRDY).</li>
  <li>For Raspberry Pi, if not enabled already the SPI interface can be enabled using <code class="language-plaintext highlighter-rouge">raspi-config</code> or equivalent.</li>
  <li>This code uses a separate GPIO to manually control CS# chipselect instead of the chipselect assigned to by the RapsberryPi SPI interface.
    <ul>
      <li>The chipselect assigned by the HW SPI interface should also work, but has not been thoroughly tested.</li>
    </ul>
  </li>
  <li>Epson Breakout evaluation board or some equivalent is required to connect to the 3.3V CMOS compatible pins of the ROS host (SPI &amp; GPIOs) <a href="https://global.epson.com/products_and_drivers/sensing_system/technical_info/evaluation_tools/">See M-G32EV031</a>
</li>
</ul>

<h2 id="how-do-i-use-the-driver">How do I use the driver?</h2>

<ul>
  <li>
    <p>This code assumes that the user is familiar with building ROS2 packages using the <code class="language-plaintext highlighter-rouge">colcon build</code> process</p>
  </li>
  <li>
    <p>This README is <em>NOT</em> detailed step by step instructions on how to build and install ROS2 software.</p>
  </li>
  <li>
    <p>Please refer to the ROS.org website for more detailed instructions on the ROS package build process. <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html">ROS.org</a></p>
  </li>
  <li>
    <p><strong>NOTE:</strong> At a bare minimum, the user must re-build the package with colcon after modifying the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to configure any of the following:</p>

    <ul>
      <li>serial interface type, <code class="language-plaintext highlighter-rouge">INTERFACE=</code> (UART or SPI)</li>
      <li>host platform type, <code class="language-plaintext highlighter-rouge">PLATFORM=</code> (RPI or NONE=PC)</li>
    </ul>
  </li>
  <li>
    <p>Changes to IMU settings should be made by editing the <code class="language-plaintext highlighter-rouge">.py</code> launch files located in the <code class="language-plaintext highlighter-rouge">launch/</code> folder instead of modifying the <code class="language-plaintext highlighter-rouge">src\</code> source files</p>
  </li>
</ul>

<h2 id="how-do-i-use-the-driver-if-usleep-is-not-supported-for-time-delays">How do I use the driver if usleep() is not supported for time delays?</h2>

<ul>
  <li>
<strong>NOTE:</strong> In the <code class="language-plaintext highlighter-rouge">hcl_linux.c</code> or <code class="language-plaintext highlighter-rouge">hcl_rpi.c</code>, there are <code class="language-plaintext highlighter-rouge">seDelayMS()</code> and <code class="language-plaintext highlighter-rouge">seDelayMicroSecs()</code> wrapper functions for time delays in millisecond and microseconds, respectively.</li>
  <li>On embedded Linux platforms, the user may need to modify and redirect to platform specific delay routines if <code class="language-plaintext highlighter-rouge">usleep()</code> is not supported.</li>
  <li>For example on RaspberryPi, the time delay functions for millisecond and microseconds are redirected to WiringPi library <code class="language-plaintext highlighter-rouge">delay()</code> and <code class="language-plaintext highlighter-rouge">delayMicroseconds()</code>, respectively.</li>
  <li>If a hardware delay is not available from a library, then a software delay loop is possible but not preferred.</li>
</ul>

<h2 id="how-do-i-use-the-driver-with-gpios-to-control-imu-reset-drdy-ext-pins">How do I use the driver with GPIOs to control IMU RESET#, DRDY, EXT pins?</h2>

<ul>
  <li>When connecting the IMU using the UART interface, the use of GPIO pins for connecting to the IMU <code class="language-plaintext highlighter-rouge">RESET#</code> or <code class="language-plaintext highlighter-rouge">DRDY</code> is optional, but can be useful on an embedded Linux platforms (such as RapsberryPi).</li>
  <li>When connecting the IMU using the SPI interface, the use of GPIO pins for connecting to the IMU <code class="language-plaintext highlighter-rouge">DRDY</code> is mandatory (<code class="language-plaintext highlighter-rouge">RESET#</code> is recommended, <code class="language-plaintext highlighter-rouge">EXT</code> is optional).</li>
  <li>When using the <code class="language-plaintext highlighter-rouge">time_correction</code> function for accurate time stamping with an external 3.3V GNSS 1PPS signal, the IMU <code class="language-plaintext highlighter-rouge">EXT</code> pin must be connected to the 1PPS.</li>
  <li>The user can choose to control the IMU <code class="language-plaintext highlighter-rouge">CS#</code> pin directly with a designated host GPIO output or connect to the designated chipselect of the SPI interface (i.e. <code class="language-plaintext highlighter-rouge">SPI_CE0</code> pin on the RapsberryPi)</li>
  <li>Where possible, connecting the <code class="language-plaintext highlighter-rouge">RESET#</code> and forcing a Hardware Reset during every IMU initialization is recommended for better robustness.</li>
  <li>This code is structured to simplify editing to redirect GPIO control to low-level hardware library GPIO function calls.</li>
  <li>There are no standard methods to implement GPIO connections on embedded Linux platform, but the following source files typically need changing:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>src/hcl_linux.c
src/hcl_gpio.c
src/hcl_gpio.h

</code></pre></div></div>

<ul>
  <li>
    <p>Typically, an external library needs to be invoked to initialize &amp; enable GPIO HW functions on the user’s embedded platform.</p>
  </li>
  <li>
    <p>This typically requires the following changes to <code class="language-plaintext highlighter-rouge">hcl_linux.c</code> (Refer to <code class="language-plaintext highlighter-rouge">hcl_rpi.c</code> as a template):</p>

    <ul>
      <li>add <code class="language-plaintext highlighter-rouge">#include</code> to external library near the top of <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>
</li>
      <li>add the initialization call to the HW library inside the <code class="language-plaintext highlighter-rouge">seInit()</code> function in <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>
</li>
    </ul>
  </li>
</ul>

<p>For example on a Raspberry Pi, the following changes can be made to <code class="language-plaintext highlighter-rouge">hcl_linux.c</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

  #include &lt;stdint.h&gt;
  #include &lt;stdio.h&gt;
  #include &lt;wiringPi.h&gt;  // &lt;== Added external library

  int seInit(void)
  {
    // Initialize wiringPi libraries                                                   // &lt;== Added
    printf("\r\nInitializing libraries...");                                           // &lt;== Added
    if(wiringPiSetupGpio() != 0) {                                                     // &lt;== Added external library initialization
      printf("\r\nError: could not initialize wiringPI libraries. Exiting...\r\n");    // &lt;== Added
      return NG;                                                                       // &lt;== Added
    }                                                                                  // &lt;== Added
    printf("...done.");

    return OK;
  }

...

</code></pre></div></div>

<ul>
  <li>Typically, the GPIO pins need to be assigned according to embedded HW platform-specific <strong>pin numbering</strong> and requires changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.h</code>.</li>
</ul>

<p><strong>NOTE:</strong> When using the SPI interface, if direct <code class="language-plaintext highlighter-rouge">CS#</code> control is not by GPIO, then connect IMU <code class="language-plaintext highlighter-rouge">CS#</code> pin to the RPI <code class="language-plaintext highlighter-rouge">SPI0_CE0 (P1_24)</code>.</p>

<p>For example on a Raspberry Pi, the changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.h</code> assume the following pin mapping:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Epson IMU                   Raspberry Pi
---------------------------------------------------
EPSON_RESET                 RPI_GPIO_P1_15 (GPIO22) Output
EPSON_DRDY                  RPI_GPIO_P1_18 (GPIO24) Input

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

// Prototypes for generic GPIO functions
int gpioInit(void);
int gpioRelease(void);

void gpioSet(uint8_t pin);
void gpioClr(uint8_t pin);
uint8_t gpioGetPinLevel(uint8_t pin);

#define RPI_GPIO_P1_15              22                    // &lt;== Added
#define RPI_GPIO_P1_18              24                    // &lt;== Added

#define EPSON_RESET                 RPI_GPIO_P1_15        // &lt;== Added
#define EPSON_DRDY                  RPI_GPIO_P1_18        // &lt;== Added
...

</code></pre></div></div>

<ul>
  <li>
    <p>The external HW library will typically have GPIO pin control functions such as <code class="language-plaintext highlighter-rouge">set_output()</code>, <code class="language-plaintext highlighter-rouge">set_input()</code>, <code class="language-plaintext highlighter-rouge">set()</code>, <code class="language-plaintext highlighter-rouge">reset()</code>, <code class="language-plaintext highlighter-rouge">read_pin_level()</code>, etc…</p>
  </li>
  <li>
    <p>The user should redirect the function calls in <code class="language-plaintext highlighter-rouge">hcl_gpio.c</code> for <code class="language-plaintext highlighter-rouge">gpioInit()</code>, <code class="language-plaintext highlighter-rouge">gpioRelease()</code>, <code class="language-plaintext highlighter-rouge">gpioSet()</code>, <code class="language-plaintext highlighter-rouge">gpioClr()</code>, <code class="language-plaintext highlighter-rouge">gpioGetPinLevel()</code> to such equivalent external HW library pin control functions.</p>
  </li>
  <li>
    <p>For example on a Raspberry Pi, the following are changes to <code class="language-plaintext highlighter-rouge">hcl_gpio.c</code> which can be used as a template:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "hcl.h"
#include "hcl_gpio.h"
#include &lt;wiringPi.h&gt;                         // &lt;== Added external library

...

int gpioInit(void)
{
	pinMode(EPSON_RESET, OUTPUT);               // &lt;== Added external call RESET Output Pin
	pinMode(EPSON_DRDY, INPUT);                 // &lt;== Added external call DRDY Input Pin
	pullUpDnControl(EPSON_DRDY, PUD_OFF) ;      // &lt;== Added external call Disable any internal pullup or pulldown resistance

	return OK;
}

...

int gpioRelease(void)
{
	return OK;
}

...

void gpioSet(uint8_t pin)
{
	digitalWrite(pin, HIGH);                    // &lt;== Added external call set pin HIGH
}

...

void gpioClr(uint8_t pin)
{
	digitalWrite(pin, LOW);                     // &lt;== Added external call set pin LOW
}

...

uint8_t gpioGetPinLevel(uint8_t pin)
{
	return (digitalRead(pin));                  // &lt;== Added external call to return pin state of input pin
}

...

</code></pre></div></div>

<h2 id="how-do-i-build-install-run-this-package">How do I build, install, run this package?</h2>

<p>The Epson IMU ROS2 driver is designed for building with the standard ROS2 colcon build environment.
For more information on setting up the ROS2 environment refer to: <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Configuring-ROS2-Environment.html">Installing and Configuring ROS Environment</a>.
For more information on setting up the ROS2 colcon environment refer to: <a href="https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html">ROS2 Tutorial</a></p>

<ol>
  <li>Place this package (including folders) into a new folder within your colcon workspace <code class="language-plaintext highlighter-rouge">src\</code> folder.
For example, we recommend using the folder name <code class="language-plaintext highlighter-rouge">ess_imu_driver2</code>
</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/src/ess_imu_driver2/

</code></pre></div></div>

<ol>
  <li>
    <p>Modify the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to select the serial interface type <code class="language-plaintext highlighter-rouge">INTERFACE=</code> and platform type <code class="language-plaintext highlighter-rouge">PLATFORM=</code> that matches your ROS2 system and connection to the Epson IMU.
Refer to the comments in the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> for additional info.
<strong>NOTE:</strong> You <em>MUST</em> re-build using <code class="language-plaintext highlighter-rouge">colcon build</code> after any changes in the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>.</p>
  </li>
  <li>
    <p>From the colcon workspace folder run <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> to build all ROS2 packages located in the <code class="language-plaintext highlighter-rouge">&lt;colcon_workspace&gt;/src/</code> folder.
<strong>NOTE:</strong> Re-run <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> to rebuild the software after making any changes to any of the <code class="language-plaintext highlighter-rouge">.c</code> or <code class="language-plaintext highlighter-rouge">.cpp</code> or <code class="language-plaintext highlighter-rouge">.h</code> source files.</p>
  </li>
</ol>

<p><strong>NOTE:</strong> It is recommended to change IMU settings by editing the parameters in the <code class="language-plaintext highlighter-rouge">.py</code> launch file, instead of modifying the <code class="language-plaintext highlighter-rouge">.c</code>, <code class="language-plaintext highlighter-rouge">.cpp</code>, <code class="language-plaintext highlighter-rouge">.h</code> source files directly.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/colcon build --packages-select ess_imu_driver2 --symlink-install

</code></pre></div></div>

<ol>
  <li>Reload the current ROS2 environment variables that may have changed after the colcon build process by entering the following from the <code class="language-plaintext highlighter-rouge">\&lt;colcon_workspace&gt;</code>:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source ./install/setup.bash

</code></pre></div></div>

<ol>
  <li>Modify the <code class="language-plaintext highlighter-rouge">.py</code> launch file in the <code class="language-plaintext highlighter-rouge">launch/</code> folder to set your desired IMU configure parameter options at runtime:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>serial_port</td>
      <td>specifies UART port on the system when built and configured for UART in the CMakeLists.txt</td>
    </tr>
    <tr>
      <td>frame_id</td>
      <td>specifies the value in the IMU message frame_id field</td>
    </tr>
    <tr>
      <td>burst_polling_rate</td>
      <td>specifies the driver internal polling rate for the serial port input buffer (typically does not need changing)</td>
    </tr>
    <tr>
      <td>imu_dout_rate</td>
      <td>specifies the IMU output data rate</td>
    </tr>
    <tr>
      <td>imu_filter_sel</td>
      <td>specifies the IMU filter setting</td>
    </tr>
    <tr>
      <td>quaternion_output_en</td>
      <td>enables or disables quaternion output (not supported on all IMU models)</td>
    </tr>
    <tr>
      <td>atti_profile</td>
      <td>specifies the attitude motion profile (not supported on all IMU models)</td>
    </tr>
    <tr>
      <td>output_32bit_en</td>
      <td>enables or disables outputting sensor data in 32 or 16 bit resolution</td>
    </tr>
    <tr>
      <td>time_correction_en</td>
      <td>enables time correction function using IMU counter reset function &amp; external 1PPS connection to IMU GPIO2/EXT pin. <strong>Cannot be used when ext_trigger_en=1</strong>
</td>
    </tr>
  </tbody>
</table>

<p><strong>NOTE:</strong> The <code class="language-plaintext highlighter-rouge">.py</code> launch file passes IMU configuration settings to ROS node at runtime. Therefore, re-building with <code class="language-plaintext highlighter-rouge">colcon build --symlink-install</code> when changing the <code class="language-plaintext highlighter-rouge">.py</code> launch file is not required.
<strong>NOTE:</strong> When using this software on older ROS2 versions (Dashing or Eloquent) the <code class="language-plaintext highlighter-rouge">.py</code> launch file needs to be modified to replace <code class="language-plaintext highlighter-rouge">namespace</code> parameter from <code class="language-plaintext highlighter-rouge">executable</code> to <code class="language-plaintext highlighter-rouge">node_executable</code></p>

<ol>
  <li>Start the Epson IMU ROS2 driver use the appropriate <code class="language-plaintext highlighter-rouge">.py</code> launch file located in <code class="language-plaintext highlighter-rouge">launch/</code>. All parameters are described in the in-line comments of the <code class="language-plaintext highlighter-rouge">.py</code> launch file.</li>
</ol>

<p>For example, to launch the ROS2 node:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;colcon_workspace&gt;/ros2 launch ess_imu_driver2 launch.py

</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>Launch File</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>launch.py</td>
      <td>Publishes to <code class="language-plaintext highlighter-rouge">imu/data</code> for IMU models that support <code class="language-plaintext highlighter-rouge">gyro</code>, <code class="language-plaintext highlighter-rouge">accel</code>, and <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code> or <code class="language-plaintext highlighter-rouge">imu/data_raw</code> for IMU models that do not support <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code>
</td>
    </tr>
    <tr>
      <td>raw_launch.py</td>
      <td>Publishes to <code class="language-plaintext highlighter-rouge">imu/data_raw</code> and does not enable or update <code class="language-plaintext highlighter-rouge">quaternion (orientation)</code>
</td>
    </tr>
    <tr>
      <td>tc_launch.py</td>
      <td>Same as launch.py except time correction function is enabled (GNSS 1PPS signal must be connected to IMU EXT pin)</td>
    </tr>
  </tbody>
</table>

<h3 id="example-console-output-of-colcon-build">Example console output of <em>colcon build</em>:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@RPI4-RC:~/ros2_ws$ colcon build --symlink-install --packages-select ess_imu_driver2
Starting &gt;&gt;&gt; ess_imu_driver2
Finished &lt;&lt;&lt; ess_imu_driver2 [29.3s]

Summary: 1 package finished [30.1s]
user@RPI4-RC:~/ros2_ws$

</code></pre></div></div>

<h3 id="example-console-output-of-launching-ros-node">Example console output of launching ROS node:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@RPI4-RC:~/ros2_ws$ ros2 launch ess_imu_driver2 launch.py
[INFO] [launch]: All log files can be found below /home/user/.ros/log/2024-07-31-12-52-53-476565-VDC-RPI4-RC-853040
[INFO] [launch]: Default logging verbosity is set to INFO
[INFO] [ess_imu_driver2_node-1]: process started with pid [853041]
[ess_imu_driver2_node-1] [INFO] [1722455573.931168183] [epson_node]: frame_id:                  imu_link
[ess_imu_driver2_node-1] [INFO] [1722455573.931458588] [epson_node]: time_correction_en:        0
[ess_imu_driver2_node-1] [INFO] [1722455573.931508699] [epson_node]: burst_polling_rate:        4000.0
[ess_imu_driver2_node-1] [WARN] [1722455573.931558883] [epson_node]: Not specified param temperature_topic. Set default value:       /epson_imu/tempc
[ess_imu_driver2_node-1] [WARN] [1722455573.931592180] [epson_node]: Not specified param ext_trigger_en. Set default value:  0
[ess_imu_driver2_node-1] [INFO] [1722455573.931624976] [epson_node]: imu_dout_rate:             4
[ess_imu_driver2_node-1] [INFO] [1722455573.931657012] [epson_node]: imu_filter_sel:            5
[ess_imu_driver2_node-1] [INFO] [1722455573.931688253] [epson_node]: quaternion_output_en:      1
[ess_imu_driver2_node-1] [INFO] [1722455573.931718123] [epson_node]: output_32bit_en:           1
[ess_imu_driver2_node-1] [INFO] [1722455573.931761197] [epson_node]: atti_profile:              0
[ess_imu_driver2_node-1] [INFO] [1722455576.933310504] [epson_node]: Checking sensor power on status...
[ess_imu_driver2_node-1] [INFO] [1722455577.135333655] [epson_node]: Detecting sensor model...
[ess_imu_driver2_node-1] ...Initializing wiringPI library......done....delay for GPIO pins...
[ess_imu_driver2_node-1] Reading device model and serial number...
[ess_imu_driver2_node-1] PRODUCT ID:    G366PDG0
[ess_imu_driver2_node-1] [INFO] [1722455577.139222921] [epson_node]: Initializing Sensor...
[ess_imu_driver2_node-1] [INFO] [1722455577.146912528] [epson_node]: Epson IMU initialized.
[ess_imu_driver2_node-1] SERIAL ID:     T1000062
[ess_imu_driver2_node-1] [INFO] [1722455577.147432672] [epson_node]: Sensor started...



</code></pre></div></div>

<h2 id="what-does-this-ros-imu-node-publish-as-messages">What does this ROS IMU Node publish as messages?</h2>

<p>The Epson IMU ROS node will publish messages as convention per <a href="http://www.ros.org/reps/rep-0145.html">REP 145</a>.</p>

<ul>
  <li>For IMU models that do not support quaternion output, the <code class="language-plaintext highlighter-rouge">.py</code> launch file will remap IMU messages to <code class="language-plaintext highlighter-rouge">/imu/data_raw</code> and only update the fields for <code class="language-plaintext highlighter-rouge">angular_velocity</code> (gyro), and <code class="language-plaintext highlighter-rouge">linear_acceleration</code> (accel).</li>
  <li>For IMU models that supports and enables quaternion, the <code class="language-plaintext highlighter-rouge">.py</code> launch file will remap IMU messages to <code class="language-plaintext highlighter-rouge">/imu/data</code> and update <code class="language-plaintext highlighter-rouge">angular_velocity</code> (gyro), <code class="language-plaintext highlighter-rouge">linear_acceleration</code> (accel), and <code class="language-plaintext highlighter-rouge">orientation</code> field using the internal extended Kalman Filter.</li>
  <li>Temperature sensor data from the IMU will publish on topic <code class="language-plaintext highlighter-rouge">/epson_imu/tempc</code>
</li>
</ul>

<h3 id="ros-topic-message-imudata">ROS Topic Message /imu/data</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
header:
  stamp:
    sec: 1685644337
    nanosec: 660167310
  frame_id: imu_link
orientation:
  x: 0.9999865293502808
  y: -0.00023142248392105103
  z: 0.002697369083762169
  w: -0.004425106570124626
orientation_covariance:
- -1.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
angular_velocity:
  x: 0.00032043419196270406
  y: -0.0005722396308556199
  z: 0.0002733084256760776
angular_velocity_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
linear_acceleration:
  x: 0.04799626022577286
  y: -0.07659434527158737
  z: -9.828039169311523
linear_acceleration_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
---

</code></pre></div></div>

<h3 id="ros-topic-message-imudata_raw">ROS Topic Message /imu/data_raw</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
header:
  stamp:
    sec: 1685643703
    nanosec: 402378465
  frame_id: imu_link
orientation:
  x: 0.0
  y: 0.0
  z: 0.0
  w: 0.0
orientation_covariance:
- -1.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
angular_velocity:
  x: -0.0002180843148380518
  y: 7.883128273533657e-05
  z: 6.580488116014749e-05
angular_velocity_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
linear_acceleration:
  x: 0.07670824229717255
  y: -0.056904129683971405
  z: -9.818550109863281
linear_acceleration_covariance:
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
- 0.0
---

</code></pre></div></div>

<h2 id="why-am-i-seeing-inaccurate-ros-timestamps-high-latencies-or-slower-than-expected-imu-data-rates">Why am I seeing inaccurate ROS timestamps, high latencies, or slower than expected IMU data rates?</h2>

<h3 id="ros-timestamps">ROS timestamps</h3>

<ul>
  <li>By default, the ROS node publishes using the ROS/Unix current timestamp at the time of processing.</li>
  <li>Latencies from system overhead, system loading, and buffering will cause timestamp inaccuracies between the sensor data and this ROS/Unix timestamp.</li>
  <li>To improve timestamp accuracy, the user should consider using the time correction function with a GNSS receiver with 1PPS output to increase clock accuracy on the ROS host system:
    <ul>
      <li>Consider setting up <a href="https://chrony-project.org/examples.html">chrony</a> and <a href="https://gpsd.io/">gpsd</a> with the GNSS receiver’s 1PPS signal connected to constrain the host system clock drift</li>
      <li>Consider connecting the GNSS receiver’s 1PPS signal to the Epson IMU GPIO2/EXT with <code class="language-plaintext highlighter-rouge">time_correction</code> enabled in the <code class="language-plaintext highlighter-rouge">.py</code> launch file to improve time-stamp accuracy of the IMU sensor messages</li>
    </ul>
  </li>
</ul>

<h3 id="when-using-usb-uart-bridges">When using USB-UART bridges</h3>

<ul>
  <li>If your connection between the Epson IMU UART interface and the Linux host is by FTDI ICs, the <code class="language-plaintext highlighter-rouge">latency_timer</code> setting in the FTDI driver may be large i.e. typically 16 (msec).</li>
  <li>This may affect the UART latency and maximum IMU data rates on your host system.</li>
  <li>There are 3 methods listed below to reduce the impact of this latency.</li>
</ul>

<h4 id="modifying-latency_timer-by-udev-mechanism">Modifying <em>latency_timer</em> by udev mechanism</h4>

<ul>
  <li>
<a href="https://wiki.debian.org/udev">udev</a> is a device manager for Linux that can dynamically create and remove devices in <em>userspace</em> and run commands when new devices appear or other events</li>
  <li>Create a udev rule to automatically set the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1 when an FTDI USB-UART device is plugged in to a USB port.</li>
  <li>For example, the following text file named <code class="language-plaintext highlighter-rouge">99-ftdi_sio.rules</code> can be put in the <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d</code> directory</li>
</ul>

<p><strong>NOTE:</strong> This requires root (sudo) access to create or copy file in <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d</code>
<strong>NOTE:</strong> This is the recommended method because it is automatic when device is plugged in, but it affects ALL FTDI USB-UART devices on the system</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SUBSYSTEM=="usb-serial", DRIVER=="ftdi_sio", ATTR{latency_timer}="1"

</code></pre></div></div>

<h4 id="modifying-latency_timer-by-sysfs-mechanism">Modifying <em>latency_timer</em> by sysfs mechanism</h4>

<ul>
  <li>The example below reads the <code class="language-plaintext highlighter-rouge">latency_timer</code> setting for <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code> which returns 16msec.</li>
  <li>Then, it sets the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1msec, and confirms it by read back.</li>
</ul>

<p><strong>NOTE: This may require root (sudo su) access on your system to execute.</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
16
echo 1 &gt; /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
cat /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
1

</code></pre></div></div>

<h4 id="modifying-low_latency-flag-using-setserial-utility">Modifying <em>low_latency</em> flag using <em>setserial</em> utility</h4>

<ul>
  <li>The example below sets the <code class="language-plaintext highlighter-rouge">low_latency</code> flag for <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code>.</li>
  <li>This will have the same effect as setting the <code class="language-plaintext highlighter-rouge">latency_timer</code> to 1msec.</li>
  <li>This can be confirmed by running the <code class="language-plaintext highlighter-rouge">setserial</code> command again.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@user:~$ setserial /dev/ttyUSB0
/dev/ttyUSB0, UART: unknown, Port: 0x0000, IRQ: 0

user@user:~$ setserial /dev/ttyUSB0 low_latency

user@user:~$ setserial /dev/ttyUSB0
/dev/ttyUSB0, UART: unknown, Port: 0x0000, IRQ: 0, Flags: low_latency

</code></pre></div></div>

<h3 id="when-using-the-spi-interface">When using the SPI interface</h3>

<ul>
  <li>latency issues with SPI interface will largely depend on your host system’s processing load and capabilities.</li>
  <li>If your ROS platform is running too many ROS node packages or too slow, it may not react fast enough to detect the rising edge of the IMU DRDY signal and
process the IMU sampling data.</li>
  <li>Try modifying the <code class="language-plaintext highlighter-rouge">dout_rate</code> and <code class="language-plaintext highlighter-rouge">filter_sel</code> setting in the <code class="language-plaintext highlighter-rouge">.py</code> launch file to the slowest setting that can meet your system requirements.</li>
  <li>Try monitoring the DRDY signal on the IMU with a oscilloscope to verify the stability of the IMU DRDY signal and seeing that it matches the expected <code class="language-plaintext highlighter-rouge">dout_rate</code> frequency.</li>
  <li>Try to set the SPI clock rate to maximum of 1MHz (1000000) in the <code class="language-plaintext highlighter-rouge">_node.cpp</code> for the <code class="language-plaintext highlighter-rouge">spiInit()</code> function call:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...

    while (rclcpp::ok() &amp;&amp; !spiInit(SPI_MODE3, 1000000)) {
      RCLCPP_WARN(this-&gt;get_logger(),
                  "Retry to initialize the SPI layer in 1 second period...");
      one_sec.sleep();
    }

...

</code></pre></div></div>

<h2 id="package-contents">Package Contents</h2>

<p>The Epson IMU ROS2 driver-related sub-folders &amp; root files are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>launch/        &lt;== various example launch files
src/           &lt;== source code for ROS2 node C++ wrapper, IMU Linux C driver, and additional README_src.md (specifically for building and using the IMU Linux C driver as stand-alone without ROS support)
CMakeLists.txt &lt;== cmake build script used by colcon
LICENSE.txt    &lt;== description of the applicable licenses
package.xml    &lt;== colcon package description
README.md      &lt;== general README

</code></pre></div></div>

<h2 id="references">References</h2>

<ol>
  <li>https://index.ros.org/doc/ros2/</li>
</ol>
</div>
            
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">CONTRIBUTING</h3></div>
          <div class="panel-body">
            
              <em>No CONTRIBUTING.md found.</em>
            
          </div>
        </div>

        
        
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      <div class="well well-sm">
  <div>
    
  </div>
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px;" src="/assets/repo.png">
      </td>
      <td>
        <h3><a style="text-decoration:none;" href="/r/ess_imu_driver2">ess_imu_driver2</a> <small>repository</small></h3>
        
        

      </td>
    </tr>
  </table>
  <div class="top-buffer">
    
    
<table class="table table-condensed instance-switch">
  <tr>
    <td>
      <div id="repo-switch" class="btn-group btn-group-justified" role="group">
        <div class="btn-group" style="width: 90%" role="group">
          <div class="dropdown">
            <!-- TODO: add disabled when only 1 version is known? -->
            <button class="btn btn-xs btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" title="Select Instance">
              <span class="pull-left" style="width: 100%; text-align: left">
                <span class="pull-right"><span class="caret"></span></span> 
              <span class="glyphicon glyphicon-star"></span>
                  github-cubicleguy-ess_imu_driver2
              </span>
            </button>
            <ul class="dropdown-menu" role="menu">
              
                <li role="presentation">
                  <a id="github-cubicleguy-ess_imu_driver2" role="menuitem" tabindex="-1" href="/r/ess_imu_driver2/github-cubicleguy-ess_imu_driver2" data="github-cubicleguy-ess_imu_driver2">
                    <span class="glyphicon glyphicon-star"></span>
                    github-cubicleguy-ess_imu_driver2
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    </td>
  </tr>
</table>

  </div>
  <div class="top-buffer">
  </div>
</div>

      
        <div class="alert alert-warning" role="alert">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>


<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
  $(function() {
    setupContributeListTabLinks();
  });
  $(document).ready(function() {
    setupDistroSwitch("humble");
    setupContributeLists("https://github.com/cubicleguy/ess_imu_driver2.git");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
