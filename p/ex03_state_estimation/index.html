<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Package: ex03_state_estimation</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/p/ex03_state_estimation/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top: 20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/?search_packages=true">Packages</a></li>
        <li class="active">ex03_state_estimation</li>
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-default" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-primary" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>jazzy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/ex03_state_estimation">ex03_state_estimation</a> <small>package from <a style="text-decoration:none" href="/r/ros2_tutorial/github-uos-ros2_tutorial">ros2_tutorial</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex01_first_package">

ex01_first_package
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex02_gazebo_simulation">

ex02_gazebo_simulation
</a>
            
          
            
            
              <span class="label label-default pkg-label">

ex03_state_estimation
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex04_actions">

ex04_actions
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex04_msgs">

ex04_msgs
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex04_nav2_client">

ex04_nav2_client
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex05_behavior_trees">

ex05_behavior_trees
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/ex05_bt_plugins">

ex05_bt_plugins
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/github/p/ex03_state_estimation"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/uos/ros2_tutorial/tree/main/ex03_state_estimation"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="github-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#github-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#github-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#github-deps" data-toggle="tab"><span class="label label-primary">6</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#github-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#github-questions" data-toggle="tab"><span id="github-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="github-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>0.0.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>BSD</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Tutorials for the KBS robotics labs</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/uos/ros2_tutorial.git">https://github.com/uos/ros2_tutorial.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-03-12
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNKNOWN
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/ros2_tutorial/#github-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ros2_tutorial/#github-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/ros2_tutorial/#github-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            State estimation of ceres robot
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>Alexander Mock</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>Alexander Mock</li>
                
              </ul>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/uos/ros2_tutorial/tree/main/ex03_state_estimation/README.md" title="Open in git repository">ex03_state_estimation/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="ex03_state_estimation">ex03_state_estimation</h1>

<p>Theory Lesson: state estimation</p>

<p>(TODO write it down here)</p>

<h2 id="sensors-for-state-estimation">Sensors for State Estimation</h2>

<h3 id="wheel-odometry">Wheel Odometry</h3>

<p>How far did my robot travel based on the number of revolutions my motor did? Calculate it for the simplest case by hand: Only driving forwards.
Think about what changes if the robot has a linear and an angular velocity.</p>

<p>What to know about wheel odometry:</p>
<ul>
  <li>Depends on motion model. Equations are different for Ackermann and differential steering.</li>
  <li>Normally depends on the ground surface, but this is ignored in most software
    <ol>
      <li>assumption: The ground is flat</li>
      <li>assumption: Wheels have infinite friction. They do not slip over the ground</li>
    </ol>
  </li>
</ul>

<p>Task: Find, print and understand the wheel odometry data. What message of which package is used?</p>

<h3 id="imu">IMU</h3>

<p>Why is it hard to use linear accelerations for translational changes?</p>

<ul>
  <li>Integration problems.</li>
</ul>

<p>Task: Find, print and understand the IMU data. What message of which package is used?</p>

<h3 id="lidar">LiDAR</h3>

<p>Start Gazebo open RViz and visualize the <code class="language-plaintext highlighter-rouge">scan</code> topic in fixed frame <code class="language-plaintext highlighter-rouge">base_link</code>. Now drive the robot forward. Can you estimate how far the robot has moved? Hint: The default size of a grid cell in RViz is 1x1 m.</p>

<p>What you have done by intuition is exactly what the task of point cloud registration is trying to solve. Search the internet for “ICP”. Small overview:</p>

<ul>
  <li>Find correspondences between a data set and a model by finding the closest points</li>
  <li>Estimate the transformation parameters by Umeyama or non-linear optimization</li>
  <li>Static environment</li>
</ul>

<p>Locally registering scans is sometimes referred to as LiDAR odometry. It is a core concept of modern SLAM solutions. We do that later.</p>

<h3 id="camera">Camera</h3>

<p>It is also possible to use cameras to completely estimate the state of the robot in 3D. A good overview is given by <a href="https://en.wikipedia.org/wiki/Visual_odometry">Wikipedia</a> in the Egomotion estimation GIF:</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/Egomotion-odometry.gif" alt="visual-slam"></p>

<h2 id="fusion">Fusion</h2>

<p>If we have different sensors that all can measure the state of the robot we need to fuse them appropriately. In this case “appropriately” means that we want some measurements to influence parts of our state estimation more than others.
For example: We can estimate the translational speed by using the linear acceleration of the IMU or the linear velocity of the wheel odometry.
Since we already know linear accelerations are not very reliable when it comes to integrating them to positions, we don’t want them to have much influence during fusion.
And do not forget: All measurements are noisy.
For this, the so-called “Kalman Filter” was invented.
It is a simple filter that is a special case of a Bayes-Filter.</p>

<p>This page gives a good overview of how a linear Kalman-Filter works in 1D: https://www.kalmanfilter.net/kalman1d.html :</p>

<p><img src="https://www.kalmanfilter.net/img/OneD/HighKalmanGain.png" alt="kalman1"></p>

<p><img src="https://www.kalmanfilter.net/img/OneD/LowKalmanGain.png" alt="kalman2"></p>

<p>Linear Kalman-Filters have optimal filtering properties given that</p>
<ul>
  <li>all the sensors are pefectly modelled</li>
  <li>the system can be modelled by linear transitions</li>
  <li>sensor noise is normal distributed</li>
  <li>the belief state is normal distributed and unimodal</li>
</ul>

<p>But this is rarely the case in reality. At some point, linear Kalman-Filters are becoming inaccurate because we cannot model the reality well enough. Then one usually switches to Extended Kalman Filters (EKF) or Unscented Kalman Filters (UKF).</p>

<p>On mobile robots, there are most probably running at least one EKF as well. It is oftentimes used to fuse internal sensors, such as IMU and wheel odometry. A Kalman-Filter in general is not something that is the same for every robot. It has to be configured properly to fit the robot’s sensors. For example, the ceres robot can be modelled as:</p>

<ul>
  <li>Use the <code class="language-plaintext highlighter-rouge">cmd_vel</code> topic as action / as prior</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">odom</code> topic as measurement / as posterior. Linear velocity is less noisy than the rotational velocity</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">imu/data_raw</code> as measurement / as posterior. Rotational velocity is far less noisy compared to linear acceleration</li>
</ul>

<p>Oftentimes the linear acceleration is completely ignored to estimate translational state components.
Instead, the linear acceleration is used to improve the angular velocities using e.g. a Madgwick Filter.</p>

<p>With the simulation, we already started a pre-configured EKF from the package <a href="http://docs.ros.org/en/melodic/api/robot_localization/html/index.html"><code class="language-plaintext highlighter-rouge">robot_localization</code></a></p>

<p>The result is the state of the robot given as <code class="language-plaintext highlighter-rouge">odometry/filtered</code> topic or as tf-transform <code class="language-plaintext highlighter-rouge">odom</code> -&gt; <code class="language-plaintext highlighter-rouge">base_footprint</code>.</p>

<p>Task: Open RViz. Switch to fixed frame <code class="language-plaintext highlighter-rouge">odom</code> and enable the laser scan. Drive around and see that the robot is localizing well in RViz.</p>

<p>Make yourself familiar with the way the EKF was started and parameterized. New things that you should see:</p>

<ul>
  <li>Launch files, written in Python</li>
  <li>Parameters defined in YAML files</li>
</ul>

<p>Task 1: Try to change those parameters a little. For example: Try to enable the linear acceleration of the IMU as an additional measurement</p>

<p>Task 2: Try to integrate such a robot_localization launch and configuration files into this package</p>

<h2 id="real-robot">Real Robot</h2>

<p>Caution !!!: To continue you will be required to press the red emergency stop button at least once.</p>

<p>Now it’s time to go to the real robot. You will need at least one laptop, with everything installed, and registered in the same WiFi as the robot (RoboNet).</p>

<p>First try to ping the robot in the network:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ping flamara.informatik.uos.de

</span></code></pre></div></div>

<p>Then connect via SSH</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh robot@flamara.informatik.uos.de

</code></pre></div></div>

<p>Figure out the <code class="language-plaintext highlighter-rouge">ROS_DOMAIN_ID</code> of the robot and set your laptop to the same.</p>

<h3 id="tmux">TMUX</h3>

<p>Next, you need to learn a tool called <code class="language-plaintext highlighter-rouge">tmux</code>. It should be already installed on the robot. You do not necessarily need to install it on your own system. But I recommend installing it anyway in case you want to learn the commands on your own machine first.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">sudo apt-get install tmux

</span></code></pre></div></div>

<p>Why tmux? Accessing the robot via SSH alone has a few drawbacks:</p>
<ul>
  <li>If your SSH connection dies so is all you have started</li>
  <li>If you start some nodes, only you can kill or restart them easily</li>
</ul>

<p>Fortunately, <code class="language-plaintext highlighter-rouge">tmux</code> has you covered:</p>

<ul>
  <li>Start tmux session by calling <code class="language-plaintext highlighter-rouge">tmux new -s mysession</code>
    <ul>
      <li>You will enter the tmux environment: You can recognize it via a green line at the bottom of the terminal</li>
    </ul>
  </li>
  <li>Leave a session and keep it alive: <code class="language-plaintext highlighter-rouge">[CTRL+b]</code> to enter the command mode. Then press <code class="language-plaintext highlighter-rouge">[d]</code> (d for detach).</li>
  <li>To enter it again use <code class="language-plaintext highlighter-rouge">tmux a</code> (a for attach) and press enter.</li>
  <li>Leave it again and try to create a second session</li>
  <li>Enter it and switch sessions via <code class="language-plaintext highlighter-rouge">[CTRL+b]</code> to enter the command mode. Then press <code class="language-plaintext highlighter-rouge">[s]</code>. To open a list of available sessions. Select one via the arrow keys and press enter to enter it.</li>
</ul>

<p>There are more commands but these are the most essential you will need. Such tmux sessions keep alive even after you have lost your SSH connections. Furthermore, its possible to enter one session with more than one user.</p>

<p>Task: One person is creating a tmux session the other person is accessing it. Try to edit a file together.</p>

<h3 id="bringup">Bringup</h3>

<p>To start everything on the real robot, start a tmux session and call</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ros2 launch ceres_bringup ceres_launch.py

</span></code></pre></div></div>

<p>This launch file starts all the sensor drivers and an EKF for state estimation. The created topics have the same name and message types as the Gazebo simulation was creating.
So all of your already written nodes should work without changing the code.</p>

<p>Task: Test some of your nodes. First, start them on your laptop. Second, transfer the source code to the robot (scp), build it on the robot, and run it on the robot. What is better?</p>

<p>Control the robot via <code class="language-plaintext highlighter-rouge">ros2 launch uos_diffdrive_teleop key.launch</code>. One person always(!) has to be ready to push the red button.</p>

<h3 id="rviz-with-real-robot">RViz with real robot</h3>

<p>Start RViz to visualize the real robot’s sensor data. Check if the localization via EKF works.</p>

<h3 id="simulation-and-reality">Simulation and Reality</h3>

<p>Because of the available ROS2 abstractions, it becomes possible to implement every piece of software just by using the simulation. So home office is possible, isn’t it? No. simulated worlds are usually very much simplified and sensor data includes way less noise than reality. Most of the robotics algorithms have to be tested in reality! However, experienced robotics engineers can write software so that it is almost always working in reality.</p>

<h2 id="preview-mapping">Preview Mapping</h2>

<p>Using either simulated or real robot. Try the following:</p>

<p>Open RViz, set the fixed frame to <code class="language-plaintext highlighter-rouge">odom</code>. Visualize a laser scan or a point cloud. Increase the “decay time” to 100. Move around.</p>

<p>Although no active matching of the scans is done, it looks as if the scans match very well. After a time it looks like we are building some kind of a floor plan: a 2D map.</p>

<h2 id="maps">Maps</h2>

<p>A map is useful for a robot. It uses it for more robust localization and efficient navigation planning. Maps can exist in various forms. Most of the robots in the world use so-called 2D grid maps, including your vacuum cleaners. More interesting for research, however, are the 3D map formats such as:</p>

<ul>
  <li>point cloud maps</li>
  <li>voxel maps</li>
  <li>tsdf maps</li>
  <li>mesh maps</li>
  <li>NERFs, NDFs</li>
</ul>

<p>Try to figure out what is behind those map formats.</p>

<p>For simplicity, we stay in a 2D world. What message is used for a 2D grid map?</p>

<h2 id="slam">SLAM</h2>

<p>Simultaneous localization and mapping (SLAM) deal with localizing the robot and at the same time creating a globally consistent map. A quick overview of what has worked out pretty well so far:</p>

<ol>
  <li>Using some kind of intrinsic state estimation as prior (Wheel &amp; IMU - EKF)</li>
  <li>Using scan registration as posterior</li>
  <li>1 &amp; 2 tend to drift: Try to detect loops and correct the drift afterward using e.g. pose graph optimization</li>
</ol>

<p>Assumptions of (most) SLAM:</p>
<ul>
  <li>Belief state must be unimodal -&gt; first pose has to be known</li>
  <li>What if not? We come back to that later (see MCL)</li>
</ul>

<p>Ceres robot has implemented a SLAM. Task: Start it by executing:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ros2 launch ceres_localization slam_toolbox_launch.py

</span></code></pre></div></div>

<p>Open the tf tree</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ros2 run rqt_tf_tree rqt_tf_tree

</span></code></pre></div></div>

<p>and explain what has been added. Then run RViz and visualize the map while driving the robot around. Try to save the map.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <em>No CHANGELOG found.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/ex03_state_estimation/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake#github">ament_cmake  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclcpp#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclcpp#github">rclcpp  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/std_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/std_msgs#github">std_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/sensor_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/sensor_msgs#github">sensor_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/geometry_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/geometry_msgs#github">geometry_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/tf2_ros#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/tf2_ros#github">tf2_ros  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <em>No known dependants.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>ex03_state_estimation</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="github-question-list" class="panel-body" style="display: none;"></div>
      <div id="github-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/ex03_state_estimation+github">here</a>.</p>
      </div>
      <div id="github-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/uos/ros2_tutorial.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/github/p/ex03_state_estimation"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/uos/ros2_tutorial/tree/main/ex03_state_estimation"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>



<script id="question-list-template" type="text/html">
  <p>
    Browse <a href="https://robotics.stackexchange.com/questions/tagged/ex03_state_estimation?tab=Newest">recent questions</a>
    or see the <a href="https://robotics.stackexchange.com/questions/tagged/ex03_state_estimation?tab=Votes">highest voted ones</a>.
  </p>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Title</th>
        <th scope="col">Answered?</th>
        <th scope="col">Created</th>
        <th scope="col">Active</th>
      </tr>
    </thead>
    <tbody>
      {{#questions}}
      <tr>
        <th scope="row"><a href="{{link}}">{{title}}</a><br><small>Tags: {{strtags}}</small></th>
        <th>{{answered}}</th>
        <th>{{created}}</th>
        <th>{{active}}</th>
      </tr>
      {{/questions}}
    </tbody>
  </table>
  {{#has_more}}
  <hr>
  <h4>Additional questions are available at
    <a href="https://robotics.stackexchange.com/questions/tagged/{{name}}?tab=Newest">Robotics Stack Exchange</a>
  </h4>
  {{/has_more}}
  
</script>

<script type="text/javascript" src="/js/mustache.js"></script>
<script type="text/javascript">
  jQuery(function() {
    jQuery.getJSON(url="https://api.stackexchange.com/2.3/questions?order=desc&site=robotics" +
                       "&tagged=ex03_state_estimation&pagesize=50&sort=activity")
    .done(function(feed) {
      if (feed.items.length > 0) {
        var question_count_str = (feed.has_more ? '>' : '') + String(feed.items.length)
        const questions = feed.items.map(
          function(question) {
            question.id = Math.round(Math.random() * 99999.0);
            question.created = (new Date(question.creation_date * 1000)).toDateString()
            question.active = (new Date(question.last_activity_date * 1000)).toDateString()
            question.answered = question.is_answered ? "Yes" : "No"
            question.strtags = question.tags.join(' ')
            return question;
          });
        const template = jQuery("#question-list-template").text();
        Mustache.parse(template);
        var rendered = Mustache.render(
          template, 
          { questions: questions,
            has_more: feed.has_more,
            name: "ex03_state_estimation"
          }
        );
      }
      //   TODO(tfoote) Resolve images
      //   jQuery("#-question-list img").each(function() {
      //     if (jQuery(this).attr("src").startsWith("/upfiles")) {
      //        jQuery(this).attr("src", "https://answers.ros.org" + jQuery(this).attr("src"));
      //     }
      //   });
      
      if (feed.items.length > 0) {
        jQuery("#humble-question-list").html(rendered);
        jQuery("#humble-question-list").show();
      } else {
        jQuery("#humble-no-question-list").show();
      }
      jQuery("#humble-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#jazzy-question-list").html(rendered);
        jQuery("#jazzy-question-list").show();
      } else {
        jQuery("#jazzy-no-question-list").show();
      }
      jQuery("#jazzy-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#kilted-question-list").html(rendered);
        jQuery("#kilted-question-list").show();
      } else {
        jQuery("#kilted-no-question-list").show();
      }
      jQuery("#kilted-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#rolling-question-list").html(rendered);
        jQuery("#rolling-question-list").show();
      } else {
        jQuery("#rolling-no-question-list").show();
      }
      jQuery("#rolling-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#github-question-list").html(rendered);
        jQuery("#github-question-list").show();
      } else {
        jQuery("#github-no-question-list").show();
      }
      jQuery("#github-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#noetic-question-list").html(rendered);
        jQuery("#noetic-question-list").show();
      } else {
        jQuery("#noetic-no-question-list").show();
      }
      jQuery("#noetic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#galactic-question-list").html(rendered);
        jQuery("#galactic-question-list").show();
      } else {
        jQuery("#galactic-no-question-list").show();
      }
      jQuery("#galactic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#iron-question-list").html(rendered);
        jQuery("#iron-question-list").show();
      } else {
        jQuery("#iron-no-question-list").show();
      }
      jQuery("#iron-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#melodic-question-list").html(rendered);
        jQuery("#melodic-question-list").show();
      } else {
        jQuery("#melodic-no-question-list").show();
      }
      jQuery("#melodic-questions-count").text(question_count_str);
      
    })
    .fail(function(jqxhr, textStatus, error) {
      console.error("Failed to get question data: " + jqxhr.responseText);
      
      jQuery("#humble-get-question-fail").show();
      
      jQuery("#jazzy-get-question-fail").show();
      
      jQuery("#kilted-get-question-fail").show();
      
      jQuery("#rolling-get-question-fail").show();
      
      jQuery("#github-get-question-fail").show();
      
      jQuery("#noetic-get-question-fail").show();
      
      jQuery("#galactic-get-question-fail").show();
      
      jQuery("#iron-get-question-fail").show();
      
      jQuery("#melodic-get-question-fail").show();
      
    });
  });
</script>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("humble");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
