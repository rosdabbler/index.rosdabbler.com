<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Package: rmf_fleet_adapter_python</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/p/rmf_fleet_adapter_python/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top: 20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/?search_packages=true">Packages</a></li>
        <li class="active">rmf_fleet_adapter_python</li>
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-primary" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-primary" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-primary" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-primary" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-default" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-primary" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class=" older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class=" older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_websocket">

rmf_websocket
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/humble/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/humble/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="humble-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#humble-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#humble-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#humble-deps" data-toggle="tab"><span class="label label-primary">5</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#humble-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#humble-questions" data-toggle="tab"><span id="humble-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="humble-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>2.1.8</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">humble</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-06-14
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#humble-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#humble-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#humble-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
                  <li>Yadunund</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/humble/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/humble/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h1>

<h2 id="218-2023-12-19">2.1.8 (2023-12-19)</h2>

<h2 id="217-2023-08-10">2.1.7 (2023-08-10)</h2>

<ul>
  <li>Adding initiator and request time to booking
(<a href="https://github.com/open-rmf/rmf_ros2/pull/284">#284</a>)</li>
  <li>Contributors: Aaron Chong</li>
</ul>

<h2 id="216-2023-06-02">2.1.6 (2023-06-02)</h2>

<ul>
  <li>Switch to rst changelogs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/276">#276</a>)</li>
  <li>Contributors: Yadunund</li>
</ul>

<h2 id="215-2023-05-20">2.1.5 (2023-05-20)</h2>

<h2 id="214-2023-04-27">2.1.4 (2023-04-27)</h2>

<h2 id="213-2023-04-26">2.1.3 (2023-04-26)</h2>

<h2 id="212-2022-10-10">2.1.2 (2022-10-10)</h2>

<h2 id="210-2022-10-03">2.1.0 (2022-10-03)</h2>

<ul>
  <li>Make async behaviors more robust:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/228">#228</a>)</li>
  <li>Allow fleet adapters to change schedule participant profiles:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/229">#229</a>)</li>
  <li>Allow robots to be decommissioned from the task dispatch system:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/233">#233</a>)</li>
  <li>Allow manual toggling of stubborn negotiation:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/196">#196</a>)</li>
  <li>Allow users to specify a custom update listener:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/198">#198</a>)</li>
  <li>Fix various segfaults related to pybind:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/205">#205</a>)</li>
  <li>Allow [ResponsiveWait]{.title-ref} to be enabled and disabled:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/209">#209</a>)</li>
  <li>Allow robot status to be overridden by the user:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/191">#191</a>)</li>
  <li>Add API to report status for `perform_action`:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/190">#190</a>)</li>
  <li>Changes for humble compatibility:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/215">#215</a>)</li>
</ul>

<h2 id="200-2022-03-18">2.0.0 (2022-03-18)</h2>

<p>No changes yet</p>

<h2 id="150-2022-02-14">1.5.0 (2022-02-14)</h2>

<ul>
  <li>Support flexible task definitions
(<a href="https://github.com/open-rmf/rmf_ros2/pull/168">#168</a>)</li>
  <li>Add lane speed limit to graph parsing function
(<a href="https://github.com/open-rmf/rmf_ros2/pull/124">#124</a>)</li>
</ul>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>

<ul>
  <li>Modifications to support refactor of rmf_task
(<a href="https://github.com/open-rmf/rmf_ros2/pull/51">#51</a>)</li>
  <li>Fix symlink-install compilation
(<a href="https://github.com/open-rmf/rmf_ros2/pull/32">#32</a>)</li>
  <li>Updated package.xml
(<a href="https://github.com/open-rmf/rmf_ros2/pull/26">#26</a>)</li>
  <li>Fix/rmf task ros2 cleanup
(<a href="https://github.com/open-rmf/rmf_ros2/pull/21">#21</a>)</li>
  <li>Feature/python binding planner
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Adding reference_internal tag to function bindings that return raw
pointers (<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Feature/add unstable participant api
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Feature/add simple docs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/9">#9</a>)</li>
  <li>Support apis for task dispatcher
(<a href="https://github.com/open-rmf/rmf_ros2/pull/10">#10</a>)</li>
  <li>differentiate functions to prevent overloading
(<a href="https://github.com/open-rmf/rmf_ros2/pull/8">#8</a>)</li>
  <li>support ez traffic light
(<a href="https://github.com/open-rmf/rmf_ros2/pull/7">#7</a>)</li>
  <li>Update/release 1.1
(<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter
(<a href="https://github.com/open-rmf/rmf_ros2/pull/1">#1</a>)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey
Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="humble-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="humble-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#humble-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#humble">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#humble-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#humble">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_json_vendor#humble-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_json_vendor#humble">pybind11_json_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#humble-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#humble">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#humble-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#humble">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th>Name</th>
                  <th class="text-center">Deps</th>
                </thead>
                <tbody>
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_demos_fleet_adapter#humble">rmf_demos_fleet_adapter</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_demos_fleet_adapter#humble-deps" >
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_dev#humble">rmf_dev</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_dev#humble-deps" class="endoftree">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="humble-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="humble-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="humble-question-list" class="panel-body" style="display: none;"></div>
      <div id="humble-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+humble">here</a>.</p>
      </div>
      <div id="humble-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/humble/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/humble/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_charging_schedule">

rmf_charging_schedule
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_websocket">

rmf_websocket
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/jazzy/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/jazzy/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="jazzy-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#jazzy-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#jazzy-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#jazzy-deps" data-toggle="tab"><span class="label label-primary">5</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#jazzy-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#jazzy-questions" data-toggle="tab"><span id="jazzy-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="jazzy-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>2.7.2</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">jazzy</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-06-17
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#jazzy-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#jazzy-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#jazzy-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
                  <li>Yadunund</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/jazzy/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/jazzy/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h1>

<h2 id="272-2024-06-18">2.7.2 (2024-06-18)</h2>

<h2 id="271-2024-06-11">2.7.1 (2024-06-11)</h2>

<h2 id="270-2024-06-01">2.7.0 (2024-06-01)</h2>

<ul>
  <li>Add fleet-level reassign dispatched tasks API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/348">#348</a>)</li>
  <li>Disable automatic retreat
(<a href="https://github.com/open-rmf/rmf_ros2/pull/330">#330</a>)</li>
  <li>Stabilize commissioning feature
(<a href="https://github.com/open-rmf/rmf_ros2/pull/338">#338</a>)</li>
  <li>Add all_known_lifts in Graph binding
(<a href="https://github.com/open-rmf/rmf_ros2/pull/336">#336</a>)</li>
  <li>Add Speed Limit Requests
(<a href="https://github.com/open-rmf/rmf_ros2/pull/335">#335</a>)</li>
  <li>Contributors: cwrx777, Grey, Pranay Shirodkar, Xiyu, Yadunund</li>
</ul>

<h2 id="260-2024-03-13">2.6.0 (2024-03-13)</h2>

<ul>
  <li>add in_lift readonly property in &lt;Graph::Waypoint&gt; binding.
(<a href="https://github.com/open-rmf/rmf_ros2/pull/326">#326</a>)</li>
  <li>Contributors: cwrx777</li>
</ul>

<h2 id="250-2023-12-22">2.5.0 (2023-12-22)</h2>

<h2 id="240-2023-12-15">2.4.0 (2023-12-15)</h2>

<h2 id="232-2023-08-28">2.3.2 (2023-08-28)</h2>

<ul>
  <li>EasyFullControl API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/235">#235</a>)</li>
  <li>Contributors: Grey, Luca Della Vedova, Xiyu, Yadunund</li>
</ul>

<h2 id="231-2023-08-10">2.3.1 (2023-08-10)</h2>

<ul>
  <li>Adding initiator and request time to booking
(<a href="https://github.com/open-rmf/rmf_ros2/pull/267">#267</a>)</li>
  <li>Contributors: Aaron Chong</li>
</ul>

<h2 id="230-2023-06-08">2.3.0 (2023-06-08)</h2>

<h2 id="220-2023-06-06">2.2.0 (2023-06-06)</h2>

<ul>
  <li>Switch to rst changelogs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/276">#276</a>)</li>
  <li>Contributors: Yadunund</li>
</ul>

<h2 id="215-2023-05-20">2.1.5 (2023-05-20)</h2>

<h2 id="214-2023-04-27">2.1.4 (2023-04-27)</h2>

<h2 id="213-2023-04-26">2.1.3 (2023-04-26)</h2>

<h2 id="212-2022-10-10">2.1.2 (2022-10-10)</h2>

<h2 id="210-2022-10-03">2.1.0 (2022-10-03)</h2>

<ul>
  <li>Make async behaviors more robust:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/228">#228</a>)</li>
  <li>Allow fleet adapters to change schedule participant profiles:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/229">#229</a>)</li>
  <li>Allow robots to be decommissioned from the task dispatch system:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/233">#233</a>)</li>
  <li>Allow manual toggling of stubborn negotiation:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/196">#196</a>)</li>
  <li>Allow users to specify a custom update listener:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/198">#198</a>)</li>
  <li>Fix various segfaults related to pybind:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/205">#205</a>)</li>
  <li>Allow [ResponsiveWait]{.title-ref} to be enabled and disabled:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/209">#209</a>)</li>
  <li>Allow robot status to be overridden by the user:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/191">#191</a>)</li>
  <li>Add API to report status for `perform_action`:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/190">#190</a>)</li>
  <li>Changes for humble compatibility:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/215">#215</a>)</li>
</ul>

<h2 id="200-2022-03-18">2.0.0 (2022-03-18)</h2>

<p>No changes yet</p>

<h2 id="150-2022-02-14">1.5.0 (2022-02-14)</h2>

<ul>
  <li>Support flexible task definitions
(<a href="https://github.com/open-rmf/rmf_ros2/pull/168">#168</a>)</li>
  <li>Add lane speed limit to graph parsing function
(<a href="https://github.com/open-rmf/rmf_ros2/pull/124">#124</a>)</li>
</ul>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>

<ul>
  <li>Modifications to support refactor of rmf_task
(<a href="https://github.com/open-rmf/rmf_ros2/pull/51">#51</a>)</li>
  <li>Fix symlink-install compilation
(<a href="https://github.com/open-rmf/rmf_ros2/pull/32">#32</a>)</li>
  <li>Updated package.xml
(<a href="https://github.com/open-rmf/rmf_ros2/pull/26">#26</a>)</li>
  <li>Fix/rmf task ros2 cleanup
(<a href="https://github.com/open-rmf/rmf_ros2/pull/21">#21</a>)</li>
  <li>Feature/python binding planner
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Adding reference_internal tag to function bindings that return raw
pointers (<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Feature/add unstable participant api
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Feature/add simple docs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/9">#9</a>)</li>
  <li>Support apis for task dispatcher
(<a href="https://github.com/open-rmf/rmf_ros2/pull/10">#10</a>)</li>
  <li>differentiate functions to prevent overloading
(<a href="https://github.com/open-rmf/rmf_ros2/pull/8">#8</a>)</li>
  <li>support ez traffic light
(<a href="https://github.com/open-rmf/rmf_ros2/pull/7">#7</a>)</li>
  <li>Update/release 1.1
(<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter
(<a href="https://github.com/open-rmf/rmf_ros2/pull/1">#1</a>)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey
Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="jazzy-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="jazzy-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#jazzy-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#jazzy">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#jazzy-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#jazzy">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_json_vendor#jazzy-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_json_vendor#jazzy">pybind11_json_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#jazzy-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#jazzy">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#jazzy-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#jazzy">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th>Name</th>
                  <th class="text-center">Deps</th>
                </thead>
                <tbody>
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_demos_fleet_adapter#jazzy">rmf_demos_fleet_adapter</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_demos_fleet_adapter#jazzy-deps" >
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_dev#jazzy">rmf_dev</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_dev#jazzy-deps" class="endoftree">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="jazzy-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="jazzy-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="jazzy-question-list" class="panel-body" style="display: none;"></div>
      <div id="jazzy-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+jazzy">here</a>.</p>
      </div>
      <div id="jazzy-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/jazzy/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/jazzy/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_charging_schedule">

rmf_charging_schedule
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_reservation_node">

rmf_reservation_node
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_websocket">

rmf_websocket
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/kilted/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="kilted-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#kilted-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#kilted-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#kilted-deps" data-toggle="tab"><span class="label label-primary">5</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#kilted-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#kilted-questions" data-toggle="tab"><span id="kilted-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="kilted-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>2.9.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-05
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#kilted-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#kilted-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#kilted-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
                  <li>Yadunund</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h1>

<h2 id="290-2024-11-27">2.9.0 (2024-11-27)</h2>

<ul>
  <li>Allow automatic action cancellation to be toggled
(<a href="https://github.com/open-rmf/rmf_ros2/issues/392">#392</a>)</li>
  <li>Adds a simple parking spot management system.
(<a href="https://github.com/open-rmf/rmf_ros2/issues/325">#325</a>)</li>
  <li>Allow robot-specific finishing request and specify parking spots
(<a href="https://github.com/open-rmf/rmf_ros2/issues/379">#379</a>)</li>
  <li>Provide an API that says the robot's lift destination
(<a href="https://github.com/open-rmf/rmf_ros2/issues/376">#376</a>)</li>
  <li>Quiet cancel API
(<a href="https://github.com/open-rmf/rmf_ros2/issues/357">#357</a>)</li>
  <li>Contributors: Arjo Chakravarty, Grey, Xiyu</li>
</ul>

<h2 id="280-2024-06-12">2.8.0 (2024-06-12)</h2>

<h2 id="271-2024-06-11">2.7.1 (2024-06-11)</h2>

<h2 id="270-2024-06-01">2.7.0 (2024-06-01)</h2>

<ul>
  <li>Add fleet-level reassign dispatched tasks API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/348">#348</a>)</li>
  <li>Disable automatic retreat
(<a href="https://github.com/open-rmf/rmf_ros2/pull/330">#330</a>)</li>
  <li>Stabilize commissioning feature
(<a href="https://github.com/open-rmf/rmf_ros2/pull/338">#338</a>)</li>
  <li>Add all_known_lifts in Graph binding
(<a href="https://github.com/open-rmf/rmf_ros2/pull/336">#336</a>)</li>
  <li>Add Speed Limit Requests
(<a href="https://github.com/open-rmf/rmf_ros2/pull/335">#335</a>)</li>
  <li>Contributors: cwrx777, Grey, Pranay Shirodkar, Xiyu, Yadunund</li>
</ul>

<h2 id="260-2024-03-13">2.6.0 (2024-03-13)</h2>

<ul>
  <li>add in_lift readonly property in &lt;Graph::Waypoint&gt; binding.
(<a href="https://github.com/open-rmf/rmf_ros2/pull/326">#326</a>)</li>
  <li>Contributors: cwrx777</li>
</ul>

<h2 id="250-2023-12-22">2.5.0 (2023-12-22)</h2>

<h2 id="240-2023-12-15">2.4.0 (2023-12-15)</h2>

<h2 id="232-2023-08-28">2.3.2 (2023-08-28)</h2>

<ul>
  <li>EasyFullControl API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/235">#235</a>)</li>
  <li>Contributors: Grey, Luca Della Vedova, Xiyu, Yadunund</li>
</ul>

<h2 id="231-2023-08-10">2.3.1 (2023-08-10)</h2>

<ul>
  <li>Adding initiator and request time to booking
(<a href="https://github.com/open-rmf/rmf_ros2/pull/267">#267</a>)</li>
  <li>Contributors: Aaron Chong</li>
</ul>

<h2 id="230-2023-06-08">2.3.0 (2023-06-08)</h2>

<h2 id="220-2023-06-06">2.2.0 (2023-06-06)</h2>

<ul>
  <li>Switch to rst changelogs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/276">#276</a>)</li>
  <li>Contributors: Yadunund</li>
</ul>

<h2 id="215-2023-05-20">2.1.5 (2023-05-20)</h2>

<h2 id="214-2023-04-27">2.1.4 (2023-04-27)</h2>

<h2 id="213-2023-04-26">2.1.3 (2023-04-26)</h2>

<h2 id="212-2022-10-10">2.1.2 (2022-10-10)</h2>

<h2 id="210-2022-10-03">2.1.0 (2022-10-03)</h2>

<ul>
  <li>Make async behaviors more robust:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/228">#228</a>)</li>
  <li>Allow fleet adapters to change schedule participant profiles:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/229">#229</a>)</li>
  <li>Allow robots to be decommissioned from the task dispatch system:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/233">#233</a>)</li>
  <li>Allow manual toggling of stubborn negotiation:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/196">#196</a>)</li>
  <li>Allow users to specify a custom update listener:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/198">#198</a>)</li>
  <li>Fix various segfaults related to pybind:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/205">#205</a>)</li>
  <li>Allow [ResponsiveWait]{.title-ref} to be enabled and disabled:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/209">#209</a>)</li>
  <li>Allow robot status to be overridden by the user:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/191">#191</a>)</li>
  <li>Add API to report status for `perform_action`:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/190">#190</a>)</li>
  <li>Changes for humble compatibility:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/215">#215</a>)</li>
</ul>

<h2 id="200-2022-03-18">2.0.0 (2022-03-18)</h2>

<p>No changes yet</p>

<h2 id="150-2022-02-14">1.5.0 (2022-02-14)</h2>

<ul>
  <li>Support flexible task definitions
(<a href="https://github.com/open-rmf/rmf_ros2/pull/168">#168</a>)</li>
  <li>Add lane speed limit to graph parsing function
(<a href="https://github.com/open-rmf/rmf_ros2/pull/124">#124</a>)</li>
</ul>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>

<ul>
  <li>Modifications to support refactor of rmf_task
(<a href="https://github.com/open-rmf/rmf_ros2/pull/51">#51</a>)</li>
  <li>Fix symlink-install compilation
(<a href="https://github.com/open-rmf/rmf_ros2/pull/32">#32</a>)</li>
  <li>Updated package.xml
(<a href="https://github.com/open-rmf/rmf_ros2/pull/26">#26</a>)</li>
  <li>Fix/rmf task ros2 cleanup
(<a href="https://github.com/open-rmf/rmf_ros2/pull/21">#21</a>)</li>
  <li>Feature/python binding planner
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Adding reference_internal tag to function bindings that return raw
pointers (<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Feature/add unstable participant api
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Feature/add simple docs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/9">#9</a>)</li>
  <li>Support apis for task dispatcher
(<a href="https://github.com/open-rmf/rmf_ros2/pull/10">#10</a>)</li>
  <li>differentiate functions to prevent overloading
(<a href="https://github.com/open-rmf/rmf_ros2/pull/8">#8</a>)</li>
  <li>support ez traffic light
(<a href="https://github.com/open-rmf/rmf_ros2/pull/7">#7</a>)</li>
  <li>Update/release 1.1
(<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter
(<a href="https://github.com/open-rmf/rmf_ros2/pull/1">#1</a>)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey
Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="kilted-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="kilted-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#kilted-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#kilted">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#kilted-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#kilted">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_json_vendor#kilted-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_json_vendor#kilted">pybind11_json_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#kilted-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#kilted">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#kilted-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#kilted">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th>Name</th>
                  <th class="text-center">Deps</th>
                </thead>
                <tbody>
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_demos_fleet_adapter#kilted">rmf_demos_fleet_adapter</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_demos_fleet_adapter#kilted-deps" >
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_dev#kilted">rmf_dev</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_dev#kilted-deps" class="endoftree">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="kilted-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="kilted-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="kilted-question-list" class="panel-body" style="display: none;"></div>
      <div id="kilted-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+kilted">here</a>.</p>
      </div>
      <div id="kilted-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/kilted/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_charging_schedule">

rmf_charging_schedule
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_reservation_node">

rmf_reservation_node
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_websocket">

rmf_websocket
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/rolling/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="rolling-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#rolling-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#rolling-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#rolling-deps" data-toggle="tab"><span class="label label-primary">5</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#rolling-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#rolling-questions" data-toggle="tab"><span id="rolling-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="rolling-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>2.9.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-05-05
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#rolling-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#rolling-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#rolling-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
                  <li>Yadunund</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h1>

<h2 id="290-2024-11-27">2.9.0 (2024-11-27)</h2>

<ul>
  <li>Allow automatic action cancellation to be toggled
(<a href="https://github.com/open-rmf/rmf_ros2/issues/392">#392</a>)</li>
  <li>Adds a simple parking spot management system.
(<a href="https://github.com/open-rmf/rmf_ros2/issues/325">#325</a>)</li>
  <li>Allow robot-specific finishing request and specify parking spots
(<a href="https://github.com/open-rmf/rmf_ros2/issues/379">#379</a>)</li>
  <li>Provide an API that says the robot's lift destination
(<a href="https://github.com/open-rmf/rmf_ros2/issues/376">#376</a>)</li>
  <li>Quiet cancel API
(<a href="https://github.com/open-rmf/rmf_ros2/issues/357">#357</a>)</li>
  <li>Contributors: Arjo Chakravarty, Grey, Xiyu</li>
</ul>

<h2 id="280-2024-06-12">2.8.0 (2024-06-12)</h2>

<h2 id="271-2024-06-11">2.7.1 (2024-06-11)</h2>

<h2 id="270-2024-06-01">2.7.0 (2024-06-01)</h2>

<ul>
  <li>Add fleet-level reassign dispatched tasks API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/348">#348</a>)</li>
  <li>Disable automatic retreat
(<a href="https://github.com/open-rmf/rmf_ros2/pull/330">#330</a>)</li>
  <li>Stabilize commissioning feature
(<a href="https://github.com/open-rmf/rmf_ros2/pull/338">#338</a>)</li>
  <li>Add all_known_lifts in Graph binding
(<a href="https://github.com/open-rmf/rmf_ros2/pull/336">#336</a>)</li>
  <li>Add Speed Limit Requests
(<a href="https://github.com/open-rmf/rmf_ros2/pull/335">#335</a>)</li>
  <li>Contributors: cwrx777, Grey, Pranay Shirodkar, Xiyu, Yadunund</li>
</ul>

<h2 id="260-2024-03-13">2.6.0 (2024-03-13)</h2>

<ul>
  <li>add in_lift readonly property in &lt;Graph::Waypoint&gt; binding.
(<a href="https://github.com/open-rmf/rmf_ros2/pull/326">#326</a>)</li>
  <li>Contributors: cwrx777</li>
</ul>

<h2 id="250-2023-12-22">2.5.0 (2023-12-22)</h2>

<h2 id="240-2023-12-15">2.4.0 (2023-12-15)</h2>

<h2 id="232-2023-08-28">2.3.2 (2023-08-28)</h2>

<ul>
  <li>EasyFullControl API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/235">#235</a>)</li>
  <li>Contributors: Grey, Luca Della Vedova, Xiyu, Yadunund</li>
</ul>

<h2 id="231-2023-08-10">2.3.1 (2023-08-10)</h2>

<ul>
  <li>Adding initiator and request time to booking
(<a href="https://github.com/open-rmf/rmf_ros2/pull/267">#267</a>)</li>
  <li>Contributors: Aaron Chong</li>
</ul>

<h2 id="230-2023-06-08">2.3.0 (2023-06-08)</h2>

<h2 id="220-2023-06-06">2.2.0 (2023-06-06)</h2>

<ul>
  <li>Switch to rst changelogs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/276">#276</a>)</li>
  <li>Contributors: Yadunund</li>
</ul>

<h2 id="215-2023-05-20">2.1.5 (2023-05-20)</h2>

<h2 id="214-2023-04-27">2.1.4 (2023-04-27)</h2>

<h2 id="213-2023-04-26">2.1.3 (2023-04-26)</h2>

<h2 id="212-2022-10-10">2.1.2 (2022-10-10)</h2>

<h2 id="210-2022-10-03">2.1.0 (2022-10-03)</h2>

<ul>
  <li>Make async behaviors more robust:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/228">#228</a>)</li>
  <li>Allow fleet adapters to change schedule participant profiles:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/229">#229</a>)</li>
  <li>Allow robots to be decommissioned from the task dispatch system:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/233">#233</a>)</li>
  <li>Allow manual toggling of stubborn negotiation:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/196">#196</a>)</li>
  <li>Allow users to specify a custom update listener:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/198">#198</a>)</li>
  <li>Fix various segfaults related to pybind:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/205">#205</a>)</li>
  <li>Allow [ResponsiveWait]{.title-ref} to be enabled and disabled:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/209">#209</a>)</li>
  <li>Allow robot status to be overridden by the user:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/191">#191</a>)</li>
  <li>Add API to report status for `perform_action`:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/190">#190</a>)</li>
  <li>Changes for humble compatibility:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/215">#215</a>)</li>
</ul>

<h2 id="200-2022-03-18">2.0.0 (2022-03-18)</h2>

<p>No changes yet</p>

<h2 id="150-2022-02-14">1.5.0 (2022-02-14)</h2>

<ul>
  <li>Support flexible task definitions
(<a href="https://github.com/open-rmf/rmf_ros2/pull/168">#168</a>)</li>
  <li>Add lane speed limit to graph parsing function
(<a href="https://github.com/open-rmf/rmf_ros2/pull/124">#124</a>)</li>
</ul>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>

<ul>
  <li>Modifications to support refactor of rmf_task
(<a href="https://github.com/open-rmf/rmf_ros2/pull/51">#51</a>)</li>
  <li>Fix symlink-install compilation
(<a href="https://github.com/open-rmf/rmf_ros2/pull/32">#32</a>)</li>
  <li>Updated package.xml
(<a href="https://github.com/open-rmf/rmf_ros2/pull/26">#26</a>)</li>
  <li>Fix/rmf task ros2 cleanup
(<a href="https://github.com/open-rmf/rmf_ros2/pull/21">#21</a>)</li>
  <li>Feature/python binding planner
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Adding reference_internal tag to function bindings that return raw
pointers (<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Feature/add unstable participant api
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Feature/add simple docs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/9">#9</a>)</li>
  <li>Support apis for task dispatcher
(<a href="https://github.com/open-rmf/rmf_ros2/pull/10">#10</a>)</li>
  <li>differentiate functions to prevent overloading
(<a href="https://github.com/open-rmf/rmf_ros2/pull/8">#8</a>)</li>
  <li>support ez traffic light
(<a href="https://github.com/open-rmf/rmf_ros2/pull/7">#7</a>)</li>
  <li>Update/release 1.1
(<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter
(<a href="https://github.com/open-rmf/rmf_ros2/pull/1">#1</a>)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey
Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="rolling-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="rolling-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#rolling-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#rolling">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#rolling-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#rolling">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_json_vendor#rolling-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_json_vendor#rolling">pybind11_json_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#rolling-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#rolling">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#rolling-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#rolling">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th>Name</th>
                  <th class="text-center">Deps</th>
                </thead>
                <tbody>
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_demos_fleet_adapter#rolling">rmf_demos_fleet_adapter</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_demos_fleet_adapter#rolling-deps" >
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_dev#rolling">rmf_dev</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_dev#rolling-deps" class="endoftree">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="rolling-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="rolling-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="rolling-question-list" class="panel-body" style="display: none;"></div>
      <div id="rolling-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+rolling">here</a>.</p>
      </div>
      <div id="rolling-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/rolling/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/main/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>github</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/galactic/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/galactic/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="galactic-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#galactic-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#galactic-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#galactic-deps" data-toggle="tab"><span class="label label-primary">4</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#galactic-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#galactic-questions" data-toggle="tab"><span id="galactic-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="galactic-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>1.4.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">galactic</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2021-09-02
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#galactic-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#galactic-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#galactic-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/galactic/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/galactic/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h2 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h2>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>
<ul>
  <li>Modifications to support refactor of rmf_task (<code class="language-plaintext highlighter-rouge">#51 &lt;https://github.com/open-rmf/rmf_ros2/issues/51&gt;</code>_)</li>
  <li>Fix symlink-install compilation (<code class="language-plaintext highlighter-rouge">#32 &lt;https://github.com/open-rmf/rmf_ros2/issues/32&gt;</code>_)</li>
  <li>Updated package.xml (<code class="language-plaintext highlighter-rouge">#26 &lt;https://github.com/open-rmf/rmf_ros2/issues/26&gt;</code>_)</li>
  <li>Fix/rmf task ros2 cleanup (<code class="language-plaintext highlighter-rouge">#21 &lt;https://github.com/open-rmf/rmf_ros2/issues/21&gt;</code>_)</li>
  <li>Feature/python binding planner (<code class="language-plaintext highlighter-rouge">#11 &lt;https://github.com/open-rmf/rmf_ros2/issues/11&gt;</code>_)</li>
  <li>Adding reference_internal tag to function bindings that return raw pointers (<code class="language-plaintext highlighter-rouge">#6 &lt;https://github.com/open-rmf/rmf_ros2/issues/6&gt;</code>_)</li>
  <li>Feature/add unstable participant api (<code class="language-plaintext highlighter-rouge">#11 &lt;https://github.com/open-rmf/rmf_ros2/issues/11&gt;</code>_)</li>
  <li>Feature/add simple docs (<code class="language-plaintext highlighter-rouge">#9 &lt;https://github.com/open-rmf/rmf_ros2/issues/9&gt;</code>_)</li>
  <li>Support apis for task dispatcher (<code class="language-plaintext highlighter-rouge">#10 &lt;https://github.com/open-rmf/rmf_ros2/issues/10&gt;</code>_)</li>
  <li>differentiate functions to prevent overloading (<code class="language-plaintext highlighter-rouge">#8 &lt;https://github.com/open-rmf/rmf_ros2/issues/8&gt;</code>_)</li>
  <li>support ez traffic light (<code class="language-plaintext highlighter-rouge">#7 &lt;https://github.com/open-rmf/rmf_ros2/issues/7&gt;</code>_)</li>
  <li>Update/release 1.1 (<code class="language-plaintext highlighter-rouge">#6 &lt;https://github.com/open-rmf/rmf_ros2/issues/6&gt;</code>_)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter (<code class="language-plaintext highlighter-rouge">#1 &lt;https://github.com/open-rmf/rmf_ros2/issues/1&gt;</code>_)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="galactic-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="galactic-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#galactic-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#galactic">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#galactic-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#galactic">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#galactic-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#galactic">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#galactic-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#galactic">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <em>No known dependants.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="galactic-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="galactic-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="galactic-question-list" class="panel-body" style="display: none;"></div>
      <div id="galactic-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+galactic">here</a>.</p>
      </div>
      <div id="galactic-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/galactic/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/galactic/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/rmf_fleet_adapter_python">rmf_fleet_adapter_python</a> <small>package from <a style="text-decoration:none" href="/r/rmf_ros2/github-open-rmf-rmf_ros2">rmf_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_charging_schedule">

rmf_charging_schedule
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_fleet_adapter">

rmf_fleet_adapter
</a>
            
          
            
            
              <span class="label label-default pkg-label">

rmf_fleet_adapter_python
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_task_ros2">

rmf_task_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_traffic_ros2">

rmf_traffic_ros2
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/rmf_websocket">

rmf_websocket
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/iron/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/iron/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="iron-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#iron-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#iron-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#iron-deps" data-toggle="tab"><span class="label label-primary">5</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#iron-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#iron-questions" data-toggle="tab"><span id="iron-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="iron-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>2.2.7</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>Apache License 2.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">Internal ROS infrastructure for RMF</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/open-rmf/rmf_ros2.git">https://github.com/open-rmf/rmf_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">iron</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2024-11-14
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          
            <span class="label label-success">
          
          DEVELOPED
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-primary"><span class="glyphicon glyphicon-flash"></span> RELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/rmf_ros2/#iron-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#iron-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/rmf_ros2/#iron-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            Python bindings for the rmf_fleet_adapter
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>methylDragon</li>
                
                  <li>Marco A. Gutiérrez</li>
                
                  <li>Yadunund</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/open-rmf/rmf_ros2/tree/iron/rmf_fleet_adapter_python/README.md" title="Open in git repository">rmf_fleet_adapter_python/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="rmf_fleet_adapter_python">rmf_fleet_adapter_python</h1>
<p>Python bindings for <a href="https://github.com/open-rmf/rmf_ros2/tree/master/rmf_fleet_adapter">rmf_fleet_adapter</a></p>

<h2 id="introduction">Introduction</h2>

<p>The <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> package defines C++ classes that can interact with <code class="language-plaintext highlighter-rouge">rmf_core</code>. Specifically an <code class="language-plaintext highlighter-rouge">Adapter</code> and a <code class="language-plaintext highlighter-rouge">MockAdapter</code> class. This package provides bindings for both and most of their dependencies.</p>

<p>The main difference between <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> and <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> is the fact that <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter</code> objects <strong>can interact with the ROS2 graph</strong>.</p>

<p>The <code class="language-plaintext highlighter-rouge">MockAdapter</code> and <code class="language-plaintext highlighter-rouge">Adapter</code> both do this. But the difference is that <code class="language-plaintext highlighter-rouge">MockAdapter</code> can be instantiated with no issues, whereas <code class="language-plaintext highlighter-rouge">Adapter</code> will block to wait for a scheduler node from <code class="language-plaintext highlighter-rouge">rmf_core</code> to make its presence known.</p>

<h2 id="installation">Installation</h2>

<ul>
  <li>Place the <code class="language-plaintext highlighter-rouge">pybind_ament</code> and <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter_python</code> packages in your ROS2 workspace, and run <code class="language-plaintext highlighter-rouge">colcon build</code> as per normal.</li>
</ul>

<h2 id="running-examples">Running Examples</h2>

<p>Integration test script for rmf loop and delivery task:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run rmf_fleet_adapter_python test_adapter.py

</code></pre></div></div>

<p>You may then probe the effects on the ROS2 graph by subscribing to the following topics with <code class="language-plaintext highlighter-rouge">ros2 topic echo &lt;TOPIC_NAME&gt;</code>:</p>
<ul>
  <li>
    <topic_name>: `/dispenser_requests`, `/dispenser_results`, `ingestor_requests`, `ingestor_results`, `/task_summaries`

</topic_name>
  </li>
</ul>
<h3 id="traffic-light-example">Traffic Light Example</h3>
<p>This will showcase an example of having 2 “traffic light” robots using RMF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First Terminal</span>
ros2 run rmf_fleet_adapter_python schedule_blockade_nodes

<span class="c"># Second Terminal</span>
ros2 run rmf_fleet_adapter_python traffic_light

</code></pre></div></div>

<p>For more details, please read <a href="https://github.com/open-rmf/rmf_ros2/tree/iron/rmf_fleet_adapter_python//rmf_fleet_adapter_python/README.md">this README</a>.</p>

<h2 id="notes">Notes</h2>
<ul>
  <li>The py api bindings are mainly experimental. Use with caution.</li>
  <li>Current CI and docs gen are using rolling release of RMF</li>
  <li>More bindings, tests, and examples are welcome!</li>
</ul>

<h2 id="using-the-bindings">Using the Bindings</h2>

<p>Ensure that you have built this package and sourced its environment. Then it is as simple as importing the module containing the Python bindings!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="c1"># You may then check the available bindings
</span><span class="nf">print</span><span class="p">(</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="description">Description</h2>

<blockquote>
  <p>Fleet adapters allow for interactions between <code class="language-plaintext highlighter-rouge">rmf_core</code> and robot fleets.</p>

  <p>High level pathing or task assignments can be issued to robots from <code class="language-plaintext highlighter-rouge">rmf_core</code>, and a fleet adapter will take those assignments and handle it in an implementation specific manner to direct individual robots to execute certain actions while monitoring and updating <code class="language-plaintext highlighter-rouge">rmf_core</code> on their high-level states via <code class="language-plaintext highlighter-rouge">rmf_core</code> robot update handles.</p>

  <p>For more information it is helpful to look at the docs for <a href="https://github.com/osrf/rmf_core">rmf_core</a></p>
</blockquote>

<h3 id="usage">Usage</h3>

<p>The bound APIs are almost identical to the <code class="language-plaintext highlighter-rouge">rmf_core</code> ones as well, so if the written documentation for these packages, and the Python usage examples in the scripts or tests are insufficient, you can also look into the relevant C++ implementations as a last resort.</p>

<p>Alternatively, you may also explore any interfaces with:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># To list any available members or methods
</span><span class="nf">dir</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c1"># To see function signatures
</span><span class="nf">help</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="o">&lt;</span><span class="n">WHATEVER_CLASS_YOU_WANT_TO_INSPECT</span><span class="o">&gt;</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="binding-details">Binding Details</h3>

<p>This package contains Python bindings to C++ code that is found in <code class="language-plaintext highlighter-rouge">rmf_core</code> and its associated packages. It was implemented using <a href="https://pybind11.readthedocs.io/">Pybind11</a>.</p>

<p>Do note that as a result of that, if one needs to inspect the source, there are no Python implementations of any of the bound code, and it would be advisable to look directly into the appropriate <a href="https://github.com/osrf/rmf_core/tree/develop/rmf_fleet_adapter">rmf_fleet_adapter</a> package, that contains the C++ code.. Additionally, C++ objects will get instantiated (generally) as references that can be used or called using the appropriate bound methods on the Python side.</p>

<p>Some of these bindings allow you to <strong>override virtual methods that would normally be called in the C++ side with Python code</strong> that you write in your Python scripts!</p>

<h3 id="features">Features</h3>

<p>There are enough functionalities bound to implement your own fleet adapters to communicate with the rest of the <code class="language-plaintext highlighter-rouge">rmf_core</code> systems in the ROS2 graph. Allowing you to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>: <strong>Communicate with rmf_core by adding fleets or requesting deliveries</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">RobotCommandHandle</code>: <strong>Specify custom robot command handles</strong> that can take commands from the <code class="language-plaintext highlighter-rouge">rmf_core</code> packages and implement or execute the following robot behaviors:
    <ul>
      <li>Docking</li>
      <li>Path assignment</li>
      <li>Starting</li>
      <li>Stopping</li>
      <li>RobotUpdateHandle: <strong>Update robot statuses</strong>
</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Executor</code>: <strong>Implement new event handlers</strong> for:
    <ul>
      <li>Docking</li>
      <li>Door operation</li>
      <li>Lift door operation</li>
      <li>Lift moving</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">Graph</code>: <strong>Specify map geometries as they relate to waypoints and lanes</strong>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">VehicleTraits</code>: <strong>Specify robot vehicle traits</strong>, including:
    <ul>
      <li>Footprint</li>
      <li>Kinematic limits</li>
    </ul>
  </li>
</ul>

<p>Additionally, when you pair this with <code class="language-plaintext highlighter-rouge">rclpy</code>, you can interact with the other ROS2 message interfaces provided by <code class="language-plaintext highlighter-rouge">rmf_core</code>, and essentially write your own fleet adapter in Python!</p>

<hr>

<h2 id="creating-your-own-robotcommandhandle">Creating your own RobotCommandHandle</h2>

<h3 id="introduction-1">Introduction</h3>

<p>A RobotCommandHandle allows you to define routines that should be executed when <code class="language-plaintext highlighter-rouge">rmf_core</code> issues a command to the robot the RobotCommandHandle is responsible for to:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">dock()</code>: Dock</li>
  <li>
<code class="language-plaintext highlighter-rouge">follow_new_path()</code>: Follow a new path</li>
  <li>
<code class="language-plaintext highlighter-rouge">stop()</code> Stop</li>
</ul>

<p>Python bindings have been written for the <code class="language-plaintext highlighter-rouge">rmf_fleet_adapter::RobotCommandHandle</code> abstract class that allows you to implement it in Python and have it communicate with the C++ code, as well as other Python bound <code class="language-plaintext highlighter-rouge">rmf_mock_adapter</code> classes and methods.</p>

<p>That is, <strong>you can write Python code as overrides to C++ RobotCommandHandle methods and have <code class="language-plaintext highlighter-rouge">rmf_core</code> execute it in the C++ side</strong>! This allows you to effectively write robot routines in Python that are callable from <code class="language-plaintext highlighter-rouge">rmf_core</code>!</p>

<p>All the standard functionalities for Python classes are open to you. You <strong>may define new attributes or members</strong> as you wish.</p>

<h3 id="caveats">Caveats</h3>

<ul>
  <li>The class methods <code class="language-plaintext highlighter-rouge">follow_new_path</code>, <code class="language-plaintext highlighter-rouge">dock</code>, and <code class="language-plaintext highlighter-rouge">stop</code> methods must be implemented if you want to use them, since the underlying C++ definitions are pure <code class="language-plaintext highlighter-rouge">virtual</code> method which <strong>requires</strong> an override
    <ul>
      <li>These methods will be called in from the C++ side by <code class="language-plaintext highlighter-rouge">rmf_core</code>! <code class="language-plaintext highlighter-rouge">rmf_core</code> will call the methods with the relevant arguments, so it is <strong>absolutely essential that you ensure that the same number of arguments are exposed in any of the core methods that you define</strong>.</li>
    </ul>
  </li>
  <li>You <strong>must not</strong> declare an <code class="language-plaintext highlighter-rouge">__init__</code> method, as that will override the binding
    <ul>
      <li>If you still need to, look at the <strong>Using <code class="language-plaintext highlighter-rouge">__init__</code></strong> section</li>
    </ul>
  </li>
</ul>

<p>Also:</p>

<ul>
  <li>You may pass instances of your implemented RobotCommandHandles into bound C++ methods that take in <code class="language-plaintext highlighter-rouge">std::shared_ptr&lt;rmf_mock_adapter::RobotCommandHandle&gt;</code> arguments. This is because the bound class inherits from that type! It’s very convenient.</li>
</ul>

<h3 id="very-minimal-template">Very Minimal Template</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter</span> <span class="k">as</span> <span class="n">adpt</span>

<span class="k">class</span> <span class="nc">RobotCommandHandle</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="c1"># If you want to declare class attributes you do it here or in an init
</span>    <span class="n">new_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rawr</span><span class="sh">"</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>
        
<span class="c1"># Then you may simply instantiate it like any other Python class!
</span><span class="n">command_handler</span> <span class="o">=</span> <span class="nc">RobotCommandHandle</span><span class="p">()</span>

<span class="c1">## Testing Instance Attributes
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># Directly
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">follow_new_path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span>  <span class="c1"># Via class method
</span>
<span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Rer</span><span class="sh">"</span>  <span class="c1"># A new one!
</span><span class="nf">print</span><span class="p">(</span><span class="n">command_handler</span><span class="p">.</span><span class="n">newer_member</span><span class="p">)</span>

<span class="c1">## Testing Class Methods
# And the methods can get called from the Python side
</span><span class="n">command_handler</span><span class="p">.</span><span class="nf">dock</span><span class="p">(</span>
    <span class="sh">""</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Dock callback works!</span><span class="sh">"</span><span class="p">)</span>
<span class="p">)</span> 

<span class="c1"># But also to a C++ method that takes in a std::shared_ptr argument!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">,</span>
                     <span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>
<span class="c1"># With default args!
</span><span class="n">adpt</span><span class="p">.</span><span class="nf">test_shared_ptr</span><span class="p">(</span><span class="n">command_handler</span><span class="p">,</span>
                     <span class="n">docking_finish_callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">wow</span><span class="sh">"</span><span class="p">))</span>

</code></pre></div></div>

<h2 id="using-__init__">Using <code class="language-plaintext highlighter-rouge">__init__</code>
</h2>

<p>If, however, you still want to define an <code class="language-plaintext highlighter-rouge">__init__</code> magic method, ensure that you <strong>explicitly</strong> call the required bound C++ constructor.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RobotCommandHandleInit</span><span class="p">(</span><span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_member</span><span class="o">=</span><span class="sh">"</span><span class="s">rawr</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">adpt</span><span class="p">.</span><span class="n">RobotCommandHandle</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">new_member</span> <span class="o">=</span> <span class="n">new_member</span>
    
    <span class="c1"># The argument names do not need to be the same
</span>    <span class="c1"># But they are declared here to match the C++ interface for consistency
</span>    <span class="k">def</span> <span class="nf">follow_new_path</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">waypoints</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">path_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Your implementation goes here.
</span>        <span class="c1"># You may replace the following lines!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">new_member</span><span class="p">)</span>  <span class="c1"># We use the instance variable here!
</span>        <span class="nf">path_finished_callback</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">dock</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
             <span class="n">dock_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">docking_finished_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Implementation here too!
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">dock_name</span><span class="p">)</span>
        <span class="nf">docking_finished_callback</span><span class="p">()</span>

</code></pre></div></div>

<h2 id="creating-your-own-event-executor">Creating Your Own Event Executor</h2>

<p>An event executor simply executes some routing upon receipt of an event.</p>

<p>In this case, the <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code> binding class allows you to override the various execution routines for the following event types (defined and used by <code class="language-plaintext highlighter-rouge">rmf_core</code> on the C++ side):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Dock</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">DoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorOpen</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftDoorClose</code></li>
  <li><code class="language-plaintext highlighter-rouge">LiftMove</code></li>
</ul>

<p>The corresponding bound event objects in Python can be found defined in <code class="language-plaintext highlighter-rouge">graph.lane</code>. You can print information about them out using <code class="language-plaintext highlighter-rouge">dir</code> and <code class="language-plaintext highlighter-rouge">help</code> as usual.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">rmf_adapter.graph</span> <span class="k">as</span> <span class="n">graph</span>

<span class="k">class</span> <span class="nc">EventListener</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">lane</span><span class="p">.</span><span class="n">Executor</span><span class="p">.</span><span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_open_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_open</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_door_close_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_door_close</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">lift_move_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lift_move</span><span class="p">):</span>
        <span class="k">return</span>


</code></pre></div></div>

<h3 id="using-executors">Using Executors</h3>

<p>Simply pass it into the <code class="language-plaintext highlighter-rouge">execute()</code> method for a given <code class="language-plaintext highlighter-rouge">Entry</code> object, which you can find attached to either the <code class="language-plaintext highlighter-rouge">entry</code> or <code class="language-plaintext highlighter-rouge">exit</code> members of a given graph <code class="language-plaintext highlighter-rouge">Lane</code> object.</p>

<p>The appropriate event execute method from the executor will be called, with the event being passed in, allowing you to access the relevant event attributes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">executor</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nc">EventListener</span><span class="p">()</span>

<span class="c1"># Where lane_obj is a lane from graph.get_lane()
</span><span class="n">lane_obj</span><span class="p">.</span><span class="n">entry</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>

</code></pre></div></div>

<p>So, for example, if the event in the lane_obj’s entry node was docking event, and our executor had this <code class="language-plaintext highlighter-rouge">dock_execute</code> defined:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dock_execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dock</span><span class="p">):</span>
    <span class="n">self</span><span class="p">.</span><span class="n">dock_to_wp</span><span class="p">[</span><span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">wp</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">DOCK EVENT EXECUTED FOR DOCK:</span><span class="sh">"</span><span class="p">,</span> <span class="n">dock</span><span class="p">.</span><span class="n">dock_name</span><span class="p">)</span>

</code></pre></div></div>

<p>Then it will get called! (Notice how the passed in dock’s <code class="language-plaintext highlighter-rouge">dock_name</code> attribute is accessible.)</p>

<h2 id="interacting-with-rmf_core">Interacting with <code class="language-plaintext highlighter-rouge">rmf_core</code>
</h2>

<p>Check out the <code class="language-plaintext highlighter-rouge">test_adapter.py</code> script in <code class="language-plaintext highlighter-rouge">scripts</code> for an integration example with <code class="language-plaintext highlighter-rouge">rmf_core</code>! These steps are <strong>much easier understood in context</strong>.</p>

<p>However, if you have already done that, relevant points are to:</p>

<ol>
  <li>Init <code class="language-plaintext highlighter-rouge">rclpy</code> if needed (<code class="language-plaintext highlighter-rouge">rclpy.init()</code>), and init <code class="language-plaintext highlighter-rouge">rclcpp</code> (<code class="language-plaintext highlighter-rouge">adpt.init_rclcpp()</code>)</li>
  <li>Define your own <code class="language-plaintext highlighter-rouge">ChildRobotCommandHandle</code> subclass of <code class="language-plaintext highlighter-rouge">adpt.RobotCommandHandle</code>
    <ul>
      <li>Making sure to define any of the core methods you intend for the <code class="language-plaintext highlighter-rouge">rmf_core</code>  to be able to call</li>
      <li>
<strong>Ensure that the method argument signatures are the same as the template though</strong>!</li>
      <li>If you want the ability to update <code class="language-plaintext highlighter-rouge">rmf_core</code> on the robot’s status, also be sure to expose a class member for a bound <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> instance, that can be used to notify <code class="language-plaintext highlighter-rouge">rmf_core</code> of any <strong>updates to robot position</strong> (<code class="language-plaintext highlighter-rouge">update_position()</code>), <strong>interruptions</strong> (<code class="language-plaintext highlighter-rouge">interrupted()</code>), or additional <strong>delays</strong> (<code class="language-plaintext highlighter-rouge">add_delay()</code>)</li>
    </ul>
  </li>
  <li>Optionally define custom <code class="language-plaintext highlighter-rouge">graph.lane.Executor</code>executor objects to handle events</li>
  <li>Define your map’s graph with <code class="language-plaintext highlighter-rouge">graph.Graph()</code>
</li>
  <li>Adding <strong>map waypoints</strong>: <code class="language-plaintext highlighter-rouge">add_waypoint()</code>
    <ul>
      <li>You can also specify if the waypoints are holding_points (<code class="language-plaintext highlighter-rouge">set_holding_point()</code>) or passthrough_points (<code class="language-plaintext highlighter-rouge">set_passthrough_point()</code>)</li>
    </ul>
  </li>
  <li>And <strong>map lanes</strong>: <code class="language-plaintext highlighter-rouge">add_lane()</code>, <code class="language-plaintext highlighter-rouge">add_bidir_lane()</code>, `add_dock_lane()</li>
  <li>Add keys to the graph waypoints, which gives the waypoints names that are relevant when requests are sent via the <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> to <code class="language-plaintext highlighter-rouge">rmf_core</code>
</li>
  <li>Define your robot
    <ul>
      <li>By defining its profile: <code class="language-plaintext highlighter-rouge">traits.Profile()</code>
</li>
      <li>And instantiating its traits: <code class="language-plaintext highlighter-rouge">traits.VehicleTraits()</code>
</li>
    </ul>
  </li>
  <li>Create an adapter: <code class="language-plaintext highlighter-rouge">adpt.Adapter()</code> or <code class="language-plaintext highlighter-rouge">adpt.MockAdapter()</code>
</li>
  <li>Attach a new fleet: <code class="language-plaintext highlighter-rouge">add_fleet()</code>
</li>
  <li>Define a callback function for task acceptance: <code class="language-plaintext highlighter-rouge">accept_task_requests()</code>
</li>
  <li>Set task planner parameters: <code class="language-plaintext highlighter-rouge">set_task_planner_params()</code>
</li>
  <li>Create a list of Plan Starts: <code class="language-plaintext highlighter-rouge">[plan.Start()]</code>
    <ul>
      <li>You will need to pass in a C++ starting time object, which you can obtain using the <code class="language-plaintext highlighter-rouge">now()</code> method from your instantiated <code class="language-plaintext highlighter-rouge">Adapter/MockAdapter</code>
</li>
    </ul>
  </li>
  <li>And add your robots to your fleet: <code class="language-plaintext highlighter-rouge">add_robot()</code>
</li>
  <li>Then simply request your deliveries!: <code class="language-plaintext highlighter-rouge">request_delivery()</code>
</li>
  <li>Then spin your <code class="language-plaintext highlighter-rouge">rclpy</code> nodes if you have any!: <code class="language-plaintext highlighter-rouge">spin()</code>, <code class="language-plaintext highlighter-rouge">spin_once()</code>
</li>
</ol>

<p>T​hen you’re done! :tada:</p>

<p><img src="https://media.giphy.com/media/woDjSSLgqys8yLiJaP/giphy.gif" alt=""></p>

<h2 id="running-tests">Running tests</h2>

<p>Unit tests have been written for the individual components.</p>

<p>You may invoke <code class="language-plaintext highlighter-rouge">pytest</code> directly in the appropriate directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;rmf_fleet_adapter_python_dir&gt;/tests

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>pytest <span class="nt">-v</span>

</code></pre></div></div>

<p>Or use <code class="language-plaintext highlighter-rouge">colcon test</code> with console output redirection.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensure environment is sourced and you are in the right directory</span>
<span class="nv">$ </span><span class="nb">source</span> &lt;workspace_dir&gt;/install/setup.bash
<span class="nv">$ </span><span class="nb">cd</span> &lt;workspace_dir&gt;

<span class="c"># Invoke the tests</span>
<span class="nv">$ </span>colcon <span class="nb">test</span> <span class="nt">--packages-select</span> rmf_fleet_adapter_python <span class="nt">--event-handlers</span> console_direct+

</code></pre></div></div>

<h2 id="gotchas">Gotchas</h2>

<h3 id="pointer-indirection-gotchas">Pointer Indirection Gotchas</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">clone_ptr</code> indirection does not seem to work correctly currently! Be <strong>very careful</strong>!</li>
  <li>The only way surefire way to do pointer indirection is to do it via the objects that manage them. Unfortunately there isn’t much of a workaround given that most of the pointers point to abstract classes.</li>
  <li>For most of the other pointers, you must make them using the various factory functions. Do not instantiate them directly since you will not be able to configure their internal members, even if those members are public.
    <ul>
      <li>No explicit bound methods exist for them as they are meant to be pointers to implementations that might vary widely.</li>
    </ul>
  </li>
</ul>

<h3 id="update-handles-should-not-be-directly-instantiated-segfault-risk">Update Handles Should NOT be Directly Instantiated (Segfault risk!)</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> and <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> classes must <strong>only be instantiated via their factory methods</strong>! (Their init members have been disabled as a result.)
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">TestScenario</code> (via <code class="language-plaintext highlighter-rouge">add_fleet</code>)</li>
      <li>
<code class="language-plaintext highlighter-rouge">RobotUpdateHandle</code> should be instantiated via <code class="language-plaintext highlighter-rouge">FleetUpdateHandle</code> (via <code class="language-plaintext highlighter-rouge">add_robot</code>)</li>
      <li>Doing otherwise will cause their members to contain null values which will <strong>lead to segmentation faults</strong>!!!</li>
    </ul>
  </li>
</ul>

<h3 id="different-kinds-of-waypoints">Different Kinds of Waypoints</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">graph</code> and <code class="language-plaintext highlighter-rouge">plan</code> submodules have their own internal <code class="language-plaintext highlighter-rouge">Waypoint</code> classes with different, but related interfaces!</li>
</ul>

<h3 id="two-kinds-of-ros2-nodes">Two Kinds of ROS2 Nodes</h3>

<p>Seeing how we are binding C++ objects and methods from <code class="language-plaintext highlighter-rouge">rmf_core</code>, we inevitably will end up binding an <code class="language-plaintext highlighter-rouge">rclcpp</code> <code class="language-plaintext highlighter-rouge">Node</code> object. (This will normally come from the <code class="language-plaintext highlighter-rouge">Adapter</code> or <code class="language-plaintext highlighter-rouge">MockAdapter</code> node members.)</p>

<p>However, if we wanted to, for instance, use <code class="language-plaintext highlighter-rouge">rclpy</code> and define our own pub-sub functionalities in our Python script, we’ll have an <code class="language-plaintext highlighter-rouge">rclpy</code> <code class="language-plaintext highlighter-rouge">Node</code> object that we can play around with as well.</p>

<p><strong>The two node types are NOT interchangeable</strong>! Keep a VERY strong handle on which nodes are which, and treat them with respect.</p>

<p>The reason why the <code class="language-plaintext highlighter-rouge">rclcpp</code> Node has been exposed for you to use, is for an interface to access <code class="language-plaintext highlighter-rouge">rmf_core</code>’s <code class="language-plaintext highlighter-rouge">MockAdapter/Adapter</code> time, as it pertains to the <code class="language-plaintext highlighter-rouge">rclcpp</code> ROS2 clock, which is helpfully converted into a Python manipulatable <code class="language-plaintext highlighter-rouge">datetime</code> object.</p>

<h3 id="time-shenanigans">Time Shenanigans</h3>

<p>There are <strong>three kinds of time</strong> that you should be concerned with, owing to different types of time used on the C++ side.</p>

<p>However, confusing things can happen due to how <code class="language-plaintext highlighter-rouge">pybind11</code> provides conversions between those C++ types and Python <code class="language-plaintext highlighter-rouge">datetime</code> types. Let me explain…</p>

<p>The three kinds of time that the C++ side uses are:</p>

<ul>
  <li>Steady clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, where the timedelta represents the time elapsed since the start of the <code class="language-plaintext highlighter-rouge">steady_clock</code>’s time (that is, since its epoch)</li>
    </ul>
  </li>
  <li>System clock timepoint: <code class="language-plaintext highlighter-rouge">std::chrono::time_point</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.datetime</code>, simple.</li>
    </ul>
  </li>
  <li>Duration: <code class="language-plaintext highlighter-rouge">std::chrono::Duration</code>
    <ul>
      <li>This gets converted into a <code class="language-plaintext highlighter-rouge">datetime.timedelta</code>, which represents the quantity of time that the <code class="language-plaintext highlighter-rouge">Duration</code> represents.</li>
    </ul>
  </li>
</ul>

<p>Caught the confusion? Three types of C++ time are being converted into <strong>TWO</strong> types of Python time, with no way to distinguish between the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects that represent <code class="language-plaintext highlighter-rouge">Duration</code> objects as opposed to <code class="language-plaintext highlighter-rouge">std::chrono::steady_clock::time_point</code> objects.</p>

<p>The conversions back and forth work fine. But you <strong>must</strong> be very aware of which <code class="language-plaintext highlighter-rouge">timedelta</code> objects refer to which.</p>

<p>In an effort to make it simpler, the bindings automatically convert <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> objects to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects. So that what is meant by the <code class="language-plaintext highlighter-rouge">datetime.timedelta</code> objects is clearer.</p>

<h4 id="caveats-1"><strong>Caveats</strong></h4>

<p>There is also an additional caveat though. The <code class="language-plaintext highlighter-rouge">steady_clock::time_point</code> values are <strong>relative</strong> to the ROS2 clock. That is, it uses the ROS2 epoch.</p>

<p>So when we convert them to system_clock <code class="language-plaintext highlighter-rouge">time_point</code> objects, just note that that relative time be used to construct the <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object.</p>

<p>So, for example, if the steady_clock <code class="language-plaintext highlighter-rouge">time_point</code> was relative to a ROS2 clock with epoch start on 1 Jan 2020 00:00:00, and represented 1 second, and it gets converted automatically by the bindings, the returned <code class="language-plaintext highlighter-rouge">datetime.datetime</code> object will actually represent… 1 Jan 1970 00:00:01! Because system clocks are relative to the UNIX epoch!</p>

<p>All that is important is the relative time values. If you keep that as a constant, and pass the <code class="language-plaintext highlighter-rouge">datetime</code> objects back into bound methods that use them, there are no additional implications on the correct functioning of the C++ calls that those bound methods will invoke.</p>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <div class="rendered-markdown">
<h1 id="changelog-for-package-rmf_fleet_adapter_python">Changelog for package rmf_fleet_adapter_python</h1>

<h2 id="227-2024-11-15">2.2.7 (2024-11-15)</h2>

<h2 id="226-2024-07-12">2.2.6 (2024-07-12)</h2>

<h2 id="225-2023-12-22">2.2.5 (2023-12-22)</h2>

<h2 id="224-2023-12-15">2.2.4 (2023-12-15)</h2>

<h2 id="223-2023-09-20">2.2.3 (2023-09-20)</h2>

<ul>
  <li>EasyFullControl API
(<a href="https://github.com/open-rmf/rmf_ros2/pull/302">#302</a>)</li>
  <li>Contributors: Luca Della Vedova, Michael X. Grey, Xiyu, Yadunund</li>
</ul>

<h2 id="222-2023-09-11">2.2.2 (2023-09-11)</h2>

<h2 id="221-2023-08-10">2.2.1 (2023-08-10)</h2>

<ul>
  <li>Adding initiator and request time to booking
(<a href="https://github.com/open-rmf/rmf_ros2/pull/285">#285</a>)</li>
  <li>Contributors: Aaron Chong, Yadunund</li>
</ul>

<h2 id="220-2023-06-06">2.2.0 (2023-06-06)</h2>

<ul>
  <li>Switch to rst changelogs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/276">#276</a>)</li>
  <li>Contributors: Yadunund</li>
</ul>

<h2 id="215-2023-05-20">2.1.5 (2023-05-20)</h2>

<h2 id="214-2023-04-27">2.1.4 (2023-04-27)</h2>

<h2 id="213-2023-04-26">2.1.3 (2023-04-26)</h2>

<h2 id="212-2022-10-10">2.1.2 (2022-10-10)</h2>

<h2 id="210-2022-10-03">2.1.0 (2022-10-03)</h2>

<ul>
  <li>Make async behaviors more robust:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/228">#228</a>)</li>
  <li>Allow fleet adapters to change schedule participant profiles:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/229">#229</a>)</li>
  <li>Allow robots to be decommissioned from the task dispatch system:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/233">#233</a>)</li>
  <li>Allow manual toggling of stubborn negotiation:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/196">#196</a>)</li>
  <li>Allow users to specify a custom update listener:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/198">#198</a>)</li>
  <li>Fix various segfaults related to pybind:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/205">#205</a>)</li>
  <li>Allow [ResponsiveWait]{.title-ref} to be enabled and disabled:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/209">#209</a>)</li>
  <li>Allow robot status to be overridden by the user:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/191">#191</a>)</li>
  <li>Add API to report status for `perform_action`:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/190">#190</a>)</li>
  <li>Changes for humble compatibility:
(<a href="https://github.com/open-rmf/rmf_ros2/pull/215">#215</a>)</li>
</ul>

<h2 id="200-2022-03-18">2.0.0 (2022-03-18)</h2>

<p>No changes yet</p>

<h2 id="150-2022-02-14">1.5.0 (2022-02-14)</h2>

<ul>
  <li>Support flexible task definitions
(<a href="https://github.com/open-rmf/rmf_ros2/pull/168">#168</a>)</li>
  <li>Add lane speed limit to graph parsing function
(<a href="https://github.com/open-rmf/rmf_ros2/pull/124">#124</a>)</li>
</ul>

<h2 id="130-2021-06-07">1.3.0 (2021-06-07)</h2>

<ul>
  <li>Modifications to support refactor of rmf_task
(<a href="https://github.com/open-rmf/rmf_ros2/pull/51">#51</a>)</li>
  <li>Fix symlink-install compilation
(<a href="https://github.com/open-rmf/rmf_ros2/pull/32">#32</a>)</li>
  <li>Updated package.xml
(<a href="https://github.com/open-rmf/rmf_ros2/pull/26">#26</a>)</li>
  <li>Fix/rmf task ros2 cleanup
(<a href="https://github.com/open-rmf/rmf_ros2/pull/21">#21</a>)</li>
  <li>Feature/python binding planner
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Adding reference_internal tag to function bindings that return raw
pointers (<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Feature/add unstable participant api
(<a href="https://github.com/open-rmf/rmf_ros2/pull/11">#11</a>)</li>
  <li>Feature/add simple docs
(<a href="https://github.com/open-rmf/rmf_ros2/pull/9">#9</a>)</li>
  <li>Support apis for task dispatcher
(<a href="https://github.com/open-rmf/rmf_ros2/pull/10">#10</a>)</li>
  <li>differentiate functions to prevent overloading
(<a href="https://github.com/open-rmf/rmf_ros2/pull/8">#8</a>)</li>
  <li>support ez traffic light
(<a href="https://github.com/open-rmf/rmf_ros2/pull/7">#7</a>)</li>
  <li>Update/release 1.1
(<a href="https://github.com/open-rmf/rmf_ros2/pull/6">#6</a>)</li>
  <li>Implement binding for Duration optional</li>
  <li>Make integration test even stricter</li>
  <li>Add reference capture for posterity</li>
  <li>Add clarifying printouts and fix multi-timer bug</li>
  <li>Integrate compute_plan_starts into integration test</li>
  <li>Implement type tests</li>
  <li>Bind optional constructors and delivery msg interfaces</li>
  <li>Bind compute_plan_starts</li>
  <li>Add update_position overload</li>
  <li>Implement Python Bindings for rmf_fleet_adapter
(<a href="https://github.com/open-rmf/rmf_ros2/pull/1">#1</a>)</li>
  <li>Contributors: Aaron Chong, Charayaphan Nakorn Boon Han, Geoffrey
Biggs, Grey, Marco A. Gutiérrez, Yadu, methylDragon, youliang</li>
</ul>
</div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="iron-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/rmf_fleet_adapter_python/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="iron-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_pytest#iron-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_pytest#iron">ament_cmake_pytest  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_vendor#iron-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_vendor#iron">pybind11_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/pybind11_json_vendor#iron-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/pybind11_json_vendor#iron">pybind11_json_vendor  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#iron-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#iron">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rmf_fleet_adapter#iron-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rmf_fleet_adapter#iron">rmf_fleet_adapter  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th>Name</th>
                  <th class="text-center">Deps</th>
                </thead>
                <tbody>
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_demos_fleet_adapter#iron">rmf_demos_fleet_adapter</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_demos_fleet_adapter#iron-deps" >
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                    
                    
                    <tr>
                      <td><a href="/p/rmf_dev#iron">rmf_dev</a></td>
                      <td class="text-center">
                        
                        <a href="/p/rmf_dev#iron-deps" class="endoftree">
                          <span class="glyphicon glyphicon-arrow-right"></span>
                        </a>
                      </td>
                    </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="iron-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="iron-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>rmf_fleet_adapter_python</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="iron-question-list" class="panel-body" style="display: none;"></div>
      <div id="iron-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python+iron">here</a>.</p>
      </div>
      <div id="iron-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/open-rmf/rmf_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/iron/p/rmf_fleet_adapter_python"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/open-rmf/rmf_ros2/tree/iron/rmf_fleet_adapter_python"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>



<script id="question-list-template" type="text/html">
  <p>
    Browse <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python?tab=Newest">recent questions</a>
    or see the <a href="https://robotics.stackexchange.com/questions/tagged/rmf_fleet_adapter_python?tab=Votes">highest voted ones</a>.
  </p>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Title</th>
        <th scope="col">Answered?</th>
        <th scope="col">Created</th>
        <th scope="col">Active</th>
      </tr>
    </thead>
    <tbody>
      {{#questions}}
      <tr>
        <th scope="row"><a href="{{link}}">{{title}}</a><br><small>Tags: {{strtags}}</small></th>
        <th>{{answered}}</th>
        <th>{{created}}</th>
        <th>{{active}}</th>
      </tr>
      {{/questions}}
    </tbody>
  </table>
  {{#has_more}}
  <hr>
  <h4>Additional questions are available at
    <a href="https://robotics.stackexchange.com/questions/tagged/{{name}}?tab=Newest">Robotics Stack Exchange</a>
  </h4>
  {{/has_more}}
  
</script>

<script type="text/javascript" src="/js/mustache.js"></script>
<script type="text/javascript">
  jQuery(function() {
    jQuery.getJSON(url="https://api.stackexchange.com/2.3/questions?order=desc&site=robotics" +
                       "&tagged=rmf_fleet_adapter_python&pagesize=50&sort=activity")
    .done(function(feed) {
      if (feed.items.length > 0) {
        var question_count_str = (feed.has_more ? '>' : '') + String(feed.items.length)
        const questions = feed.items.map(
          function(question) {
            question.id = Math.round(Math.random() * 99999.0);
            question.created = (new Date(question.creation_date * 1000)).toDateString()
            question.active = (new Date(question.last_activity_date * 1000)).toDateString()
            question.answered = question.is_answered ? "Yes" : "No"
            question.strtags = question.tags.join(' ')
            return question;
          });
        const template = jQuery("#question-list-template").text();
        Mustache.parse(template);
        var rendered = Mustache.render(
          template, 
          { questions: questions,
            has_more: feed.has_more,
            name: "rmf_fleet_adapter_python"
          }
        );
      }
      //   TODO(tfoote) Resolve images
      //   jQuery("#-question-list img").each(function() {
      //     if (jQuery(this).attr("src").startsWith("/upfiles")) {
      //        jQuery(this).attr("src", "https://answers.ros.org" + jQuery(this).attr("src"));
      //     }
      //   });
      
      if (feed.items.length > 0) {
        jQuery("#humble-question-list").html(rendered);
        jQuery("#humble-question-list").show();
      } else {
        jQuery("#humble-no-question-list").show();
      }
      jQuery("#humble-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#jazzy-question-list").html(rendered);
        jQuery("#jazzy-question-list").show();
      } else {
        jQuery("#jazzy-no-question-list").show();
      }
      jQuery("#jazzy-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#kilted-question-list").html(rendered);
        jQuery("#kilted-question-list").show();
      } else {
        jQuery("#kilted-no-question-list").show();
      }
      jQuery("#kilted-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#rolling-question-list").html(rendered);
        jQuery("#rolling-question-list").show();
      } else {
        jQuery("#rolling-no-question-list").show();
      }
      jQuery("#rolling-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#github-question-list").html(rendered);
        jQuery("#github-question-list").show();
      } else {
        jQuery("#github-no-question-list").show();
      }
      jQuery("#github-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#noetic-question-list").html(rendered);
        jQuery("#noetic-question-list").show();
      } else {
        jQuery("#noetic-no-question-list").show();
      }
      jQuery("#noetic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#galactic-question-list").html(rendered);
        jQuery("#galactic-question-list").show();
      } else {
        jQuery("#galactic-no-question-list").show();
      }
      jQuery("#galactic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#iron-question-list").html(rendered);
        jQuery("#iron-question-list").show();
      } else {
        jQuery("#iron-no-question-list").show();
      }
      jQuery("#iron-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#melodic-question-list").html(rendered);
        jQuery("#melodic-question-list").show();
      } else {
        jQuery("#melodic-no-question-list").show();
      }
      jQuery("#melodic-questions-count").text(question_count_str);
      
    })
    .fail(function(jqxhr, textStatus, error) {
      console.error("Failed to get question data: " + jqxhr.responseText);
      
      jQuery("#humble-get-question-fail").show();
      
      jQuery("#jazzy-get-question-fail").show();
      
      jQuery("#kilted-get-question-fail").show();
      
      jQuery("#rolling-get-question-fail").show();
      
      jQuery("#github-get-question-fail").show();
      
      jQuery("#noetic-get-question-fail").show();
      
      jQuery("#galactic-get-question-fail").show();
      
      jQuery("#iron-get-question-fail").show();
      
      jQuery("#melodic-get-question-fail").show();
      
    });
  });
</script>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("humble");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
