<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Package: robovision_rgbd</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/p/robovision_rgbd/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top: 20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/?search_packages=true">Packages</a></li>
        <li class="active">robovision_rgbd</li>
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-default" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-primary" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>jazzy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/robovision_rgbd">robovision_rgbd</a> <small>package from <a style="text-decoration:none" href="/r/robovision_ros2/github-artenshi-robovision_ros2">robovision_ros2</a> repo</small>
        </h3>
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_images">

robovision_images
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_processing">

robovision_processing
</a>
            
          
            
            
              <span class="label label-default pkg-label">

robovision_rgbd
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_services">

robovision_services
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_interfaces">

robovision_interfaces
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/github/p/robovision_rgbd"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_3"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="github-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#github-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#github-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#github-deps" data-toggle="tab"><span class="label label-primary">13</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#github-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#github-questions" data-toggle="tab"><span id="github-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="github-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>0.0.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>TODO: License declaration</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">RoboVision ROS2</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/artenshi/robovision_ros2.git">https://github.com/artenshi/robovision_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-01-27
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNKNOWN
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            TODO: Package description
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>roboworks</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_3/README.md" title="Open in git repository">robovision_3/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="point-cloud-processing-with-ros">Point Cloud processing with ROS</h1>

<p>We present an introduction to Point Cloud data in ROS and propose a simple task where the students should track a person moving in front of an RGBD camera mounted on a mobile robot.</p>

<h1 id="0-get-the-additional-data">0. Get the additional data</h1>

<h2 id="01-rosbag-data">0.1 Rosbag data</h2>

<p>Be sure that you have downloaded our additional data available <a href="https://bit.ly/3WjWnI2">here (Google Drive)</a>.</p>

<p>Those folders should be in the <code class="language-plaintext highlighter-rouge">~/robovision_ros2_ws/src/robovision_ros2/data/rosbags/</code> folder.</p>

<p>To be sure, let’s test it. In one terminal run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 bag play ~/robovision_ros2_ws/src/robovision_ros2/data/rosbags/person_static <span class="nt">--loop</span>

</code></pre></div></div>

<p>In a second terminal, run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>You should be able to see several topics!</p>

<h1 id="1-getting-to-know-your-rgbd-image">1. Getting to know your RGBD image</h1>

<p>In this lesson, we will apply all that we have learnt in the past two units. First, let’s inspect our code in the <code class="language-plaintext highlighter-rouge">rgbd_reader.py</code> file.</p>

<p>In the main function we can see that, as we have done before, we first initialise our node</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">"</span><span class="s">point_cloud_centroid</span><span class="sh">"</span><span class="p">)</span>

</code></pre></div></div>

<p>and then, we subscribe to the topics we are going to use:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">rgb_subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
    <span class="n">Image</span><span class="p">,</span> <span class="sh">"</span><span class="s">/camera/rgb/image_rect_color</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">callback_rgb_rect</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">self</span><span class="p">.</span><span class="n">depth_subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
    <span class="n">Image</span><span class="p">,</span> <span class="sh">"</span><span class="s">/camera/depth_registered/image</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">callback_depth_rect</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">self</span><span class="p">.</span><span class="n">point_cloud_subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
    <span class="n">PointCloud2</span><span class="p">,</span> <span class="sh">"</span><span class="s">/camera/depth_registered/points</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">callback_point_cloud</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

</code></pre></div></div>

<p>Here, you can notice the relevance of having our subscribers’ callback functions to update our variables at different rates and a different timer function to process that information. In this case, we subscribe to three topics: an <strong>RGB</strong> and <strong>Depth</strong> images and a <strong>Point Cloud</strong> of 3D points, all of them come from the same RGBD sensor</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/rgbd_view.jpg" width="800">
</p>

<p>The RGB image is a color image with three channels (Red, Green, and Blue), and the Depth image corresponds to the metric distance of each pixel of the objects in the image to an orthogonal plane that passes through the center of the camera; you can visualise it as the horizontal distance of a given point to the camera seen from above, regardless of the height, as in the Figure</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/point_depth.jpg" width="500">
</p>

<p>We have used an <code class="language-plaintext highlighter-rouge">Image</code> topic for RGB images before. The Depth image is a matrix of floats corresponding to the metric distance in milimeters. Therefore, in the callback function <code class="language-plaintext highlighter-rouge">callback_depth_rect</code> we read it as</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">depth_</span><span class="o">=</span><span class="n">bridge_depth</span><span class="p">.</span><span class="nf">imgmsg_to_cv2</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="sh">"</span><span class="s">32FC1</span><span class="sh">"</span><span class="p">).</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">self</span><span class="p">.</span><span class="n">depth_mat_</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">depth_</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>

</code></pre></div></div>
<p>As the values range from 400 (40 centimeters) to 10000 (10 meters), we normalize it to valid image values and save it in an image array to be able to display it</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v2</span><span class="p">.</span><span class="nf">normalize</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">depth_mat_</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">depth_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>

</code></pre></div></div>

<p><strong>Important:</strong> the Depth information comes from a structured infrared light sensor and therefore very reflective or transparent surfaces tend to distort the depth information; those points appear as black (zero values) pixels in our depth image. The minimum distance our RGBD sensor is able to read is 40 cm, anything closer to that will be a zero value, as well.</p>

<p>Furthermore, from the RGB and Depth images, for every pixel in the image, we can obtain the metric XYZ position in the space – we will not go further on this because, luckily, we see that ROS has already calculated it and the <code class="language-plaintext highlighter-rouge">/camera/depth_registered/points</code> of type <code class="language-plaintext highlighter-rouge">PointCloud2</code> provides this information. If you type</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 interface show sensor_msgs/msg/PointCloud2

</code></pre></div></div>

<p>in a terminal, you can see the composition of this type of message.</p>

<p>The point cloud message is a list of tuples (x, y, z, …) in milimeters of the type <code class="language-plaintext highlighter-rouge">PointCloud2</code>. Therefore, in the callback function <code class="language-plaintext highlighter-rouge">callback_point_cloud</code> we read it as</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">pc2</span><span class="p">.</span><span class="nf">read_points</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">field_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">skip_nans</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>

</code></pre></div></div>

<p>This reads the point cloud as a list, so we reshape it as a matrix form aligned to our RGB image</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">msg</span><span class="p">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">.</span><span class="nf">reshape</span><span class="p">((</span><span class="n">msg</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">.</span><span class="n">shape</span>
    <span class="nf">print </span><span class="p">(</span><span class="sh">'</span><span class="s">new message has arrived; point cloud size: rows: {}, cols: {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

</code></pre></div></div>

<p>Back to our code, we see that we have a ROS publisher where we want to publish the 3D position of an object in front of our camera; remember that a topic should have a unique name – in this case, we called it <code class="language-plaintext highlighter-rouge">/object_centroid</code> and is of the type <code class="language-plaintext highlighter-rouge">Pose</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">centroid_publisher_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_publisher</span><span class="p">(</span>
    <span class="n">Pose</span><span class="p">,</span> <span class="sh">"</span><span class="s">/object_centroid</span><span class="sh">"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

</code></pre></div></div>

<p>A Pose message is a geometry_msgs type that consists of a 3D position in meters and a 4D orientation in quaternion form of every point in the space with respect to the center of the camera:</p>

<ul>
  <li>object_centroid.position.x</li>
  <li>object_centroid.position.y</li>
  <li>object_centroid.position.z</li>
  <li>object_centroid.orientation.x = quaternion[0]</li>
  <li>object_centroid.orientation.y = quaternion[1]</li>
  <li>object_centroid.orientation.z = quaternion[2]</li>
  <li>object_centroid.orientation.w = quaternion[3]</li>
</ul>

<p>In the PointCloud2 message, the axes are as follows:</p>

<ul>
  <li>x: positive from the center of the camera to the right</li>
  <li>y: positive from the center of the camera to the bottom</li>
  <li>z: positive from the center of the camera to the front</li>
</ul>

<p>With the origin at the center of the camera, the XY axes (front view) and the <code class="language-plaintext highlighter-rouge">ROLL</code> angle of a point <code class="language-plaintext highlighter-rouge">p</code> on the plane are:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/xy_view.jpg" width="500">
</p>

<p>the YZ axes (side view) and the <code class="language-plaintext highlighter-rouge">PITCH</code> angle of a point <code class="language-plaintext highlighter-rouge">p</code> on the plane are</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/yz_view.jpg" width="500">
</p>

<p>and the XZ axes (top view) and the <code class="language-plaintext highlighter-rouge">YAW</code> angle of a point <code class="language-plaintext highlighter-rouge">p</code> on the plane are:</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/xz_view.jpg" width="500">
</p>

<h3 id="homework-11">Homework 1.1</h3>

<p>Please, inspect the <code class="language-plaintext highlighter-rouge">rgbd_reader.cpp</code> implementation. The structure is very similar in C++ and Python, so you can use any of them, depending on your requirements.</p>

<h1 id="2-point-clouds-manipulation">2. Point Cloud’s manipulation</h1>

<h2 id="21-single-element-access">2.1 Single element access</h2>

<p>Now, we will process this information in a timer function <code class="language-plaintext highlighter-rouge">point_cloud_processing</code>, in Python</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">processing_timer_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_timer</span><span class="p">(</span><span class="mf">0.030</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">point_cloud_processing</span><span class="p">)</span>

</code></pre></div></div>

<p>and in C++</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">processing_timer_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span>
    <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PointCloudCentroidNode</span><span class="o">::</span><span class="n">point_cloud_processing</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

</code></pre></div></div>

<p>We access a single element in our array just as any array in Python <code class="language-plaintext highlighter-rouge">self.point_cloud_[row_id, col_id, 0]</code>. To access a single dimension X, Y, or Z, we can indicate it directly <code class="language-plaintext highlighter-rouge">self.point_cloud_[row_id, col_id, 0][XYZ]</code>, where XYZ=0 for the dimension X, XYZ=1 for the dimension Y, and XYZ=2 for the dimension Z. In our example, to access the 3D information in the central point of our image we enter</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">.</span><span class="n">shape</span>
<span class="n">row_id</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">rows</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">col_id</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">cols</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">[</span><span class="n">row_id</span><span class="p">,</span> <span class="n">col_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> 
     <span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">[</span><span class="n">row_id</span><span class="p">,</span> <span class="n">col_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> 
     <span class="nf">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">point_cloud_</span><span class="p">[</span><span class="n">row_id</span><span class="p">,</span> <span class="n">col_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])]</span>

</code></pre></div></div>

<p>In C++, we access an element in out matrix as <code class="language-plaintext highlighter-rouge">point_cloud_.at&lt;cv::Vec4f&gt;(row_id, col_id)</code>, and each component as <code class="language-plaintext highlighter-rouge">point_cloud_.at&lt;cv::Vec4f&gt;(row_id, col_id)[XYZ]</code>, where XYZ=0 for the dimension X, XYZ=1 for the dimension Y, and XYZ=2 for the dimension Z</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">point_cloud_</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">point_cloud_</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">row_id</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">col_id</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

<span class="n">cv</span><span class="o">::</span><span class="n">Vec4f</span> <span class="n">point</span> <span class="o">=</span> <span class="n">point_cloud_</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4f</span><span class="o">&gt;</span><span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">col_id</span><span class="p">);</span>

</code></pre></div></div>

<p>Finally, we store it in our global variable to be published later in the program’s main loop by our ROS publisher. In Python</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="o">=</span><span class="nc">Pose</span><span class="p">()</span>

<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="o">=</span><span class="mf">1.0</span>

<span class="c1">#Publish centroid pose
</span><span class="n">self</span><span class="p">.</span><span class="n">centroid_publisher_</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">centroid_</span><span class="p">)</span>

</code></pre></div></div>

<p>and in C++</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Pose</span> <span class="n">centroid</span><span class="p">;</span>

<span class="n">centroid</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// x</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// y</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// z</span>

<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

<span class="c1">// Publish the centroid pose</span>
<span class="n">centroid_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">centroid</span><span class="p">);</span>

</code></pre></div></div>

<h2 id="22-run-your-code">2.2 Run your code</h2>

<p>Now, let’s try our code. So, run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/robovision_ros2_ws
colcon build

</code></pre></div></div>

<p>If you don’t have an RGBD camera, don’t worry, we provide you with a ROS bag with some data collected using an XTion Pro mounted at the top of a Turtlebot 2, at a height 1.0 meter from the floor. In a different terminal, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 bag play ~/robovision_ros2_ws/src/robovision_ros2/data/rosbags/person_static <span class="nt">--loop</span>

</code></pre></div></div>

<p>Then, in a different terminal enter</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>Can you see all the different topics you can work with!?</p>

<p>Now enter, for a Python implementation</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_rgbd rgbd_reader.py

</code></pre></div></div>

<p>or, for C++ implementation</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_rgbd rgbd_reader

</code></pre></div></div>

<p>Can you see the 3D information of our middle point in the image?</p>

<p>Finally, in a new terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic info /object_centroid

</code></pre></div></div>

<p>and, then</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic <span class="nb">echo</span> /object_centroid

</code></pre></div></div>

<p>You should be able to see the same information being published in our ROS topic!</p>

<h3 id="homework-21">Homework 2.1</h3>

<ul>
  <li>
    <p>Provide the 3D position of five different points in our image (enter different row_id, and col_id). Can you see how the X, Y, and Z values change with respect to the central point? X is positive to the right of our middle point and Y is positive below the middle point.</p>
  </li>
  <li>
    <p>What’s the 3D information for point (row_id=0, col_id=0)? Please note that, when the information is not available for a given point due to the structured light reflection properties, the system returns ‘nan’ values. In Python you can check if a variable is <code class="language-plaintext highlighter-rouge">nan</code> with the <code class="language-plaintext highlighter-rouge">math.isnan()</code> function in the <code class="language-plaintext highlighter-rouge">math</code> library – this function returns a <code class="language-plaintext highlighter-rouge">True</code> or <code class="language-plaintext highlighter-rouge">False</code> value. You can validate your data using the <code class="language-plaintext highlighter-rouge">if ( not math.isnan(( self.point_cloud_[row_id, col_id, 0][0] ) ):</code> structure, for example. Similarly, in C++ we have <code class="language-plaintext highlighter-rouge">std::isnan()</code>.</p>
  </li>
</ul>

<h1 id="3-final-project">3. Final project</h1>

<p>Now you have all the tools to program a nice robot vision project.</p>

<p>The problem is this: We have a robot facing towards a moving person and <strong>we want to find the relative position of this person to the center of the robot (represented here as the camera position).</strong></p>

<p>In other words, we want to find the 3D position of person_1</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/scene_full.jpg" width="500">
</p>

<p>How can you do it?</p>

<p>You can use the <code class="language-plaintext highlighter-rouge">person_static</code> and the <code class="language-plaintext highlighter-rouge">person_dynamic</code> ROS bags in the <code class="language-plaintext highlighter-rouge">~/robovision_ros2_ws/src/robovision_ros2/data/rosbags/</code> folder if you don’t have an RGBD camera.</p>

<p><strong>Hint</strong> Remember that the Point Cloud returns all the 3D information of all points visible by the camera, so why not limit it? You can create a valid zone where you can track your person better without any extra information</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/scene_box.jpg" width="500">
</p>

<p>You can use a structure where you compare if every image 3D point is inside this box (first check if your point is not <code class="language-plaintext highlighter-rouge">nan</code>)</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/scene_crop.jpg" width="500">
</p>

<p>Don’t forget to use the appropriate signs, especially in the Y-axis, if the camera is 1.0 meter above the floor, what condition should any point different than the floor meet? Again, pay special attention to the Y-axis direction.</p>

<p><strong>Hint</strong> Remember the <code class="language-plaintext highlighter-rouge">ROLL</code>, <code class="language-plaintext highlighter-rouge">PITCH</code> and <code class="language-plaintext highlighter-rouge">YAW</code> definitions</p>

<p align="center">
  <img src="https://raw.githubusercontent.com/artenshi/robovision_ros2/main/robovision_3/images/scene_person.jpg" width="500">
</p>

<p>You can convert those values to quaternion form by using the Python function</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">tf_transformations</span> <span class="kn">import</span> <span class="n">quaternion_from_euler</span>
<span class="n">quaternion</span> <span class="o">=</span> <span class="nf">quaternion_from_euler</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">)</span>

</code></pre></div></div>

<p>and then store it in our variable</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">object_centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">object_centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">object_centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">object_centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

</code></pre></div></div>

<p>Similarly, in C++</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf2</span><span class="o">::</span><span class="n">Quaternion</span> <span class="n">quaternion</span><span class="p">;</span>
<span class="n">quaternion</span><span class="p">.</span><span class="n">setRPY</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">);</span>

</code></pre></div></div>

<p>and</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">.</span><span class="n">y</span><span class="p">();</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">.</span><span class="n">z</span><span class="p">();</span>
<span class="n">centroid</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">quaternion</span><span class="p">.</span><span class="n">w</span><span class="p">();</span>

</code></pre></div></div>

<p>Now, try implementing it in Python and C++. Good luck!</p>

<h3 id="challenge-31">Challenge 3.1</h3>

<p>How can you improve the performance? <strong>Important: Remember that each 2D image point has its corresponding 3D point in the Point Cloud, you can use this information!</strong> Maybe you can try detecting the person’s face first and then take the 3D points average inside that region. OpenCV provides a series of functions that might help you with that, e.g.</p>

<blockquote>
  <p>https://docs.opencv.org/3.4/db/d28/tutorial_cascade_classifier.html</p>
</blockquote>

<p>What about detecting the whole person’s body and getting the 3D points average inside the person’s bounding box? In the example above, you can add an extra classifier of the form:</p>

<blockquote>
  <p>bodydetection = cv2.CascadeClassifier(‘cascades/haarcascade_fullbody.xml’)</p>
</blockquote>

<p>Would you accept the challenge?</p>

<h2 id="authors">Authors</h2>

<ul>
  <li>
<strong>Luis Contreras</strong> - <a href="https://artenshi.github.io/">ARTenshi</a>
</li>
  <li>
<strong>Hiroyuki Okada</strong> - <a href="http://aibot.jp/">AIBot</a>
</li>
</ul>
</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <em>No CHANGELOG found.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/robovision_rgbd/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake#github">ament_cmake  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_python#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_python#github">ament_cmake_python  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_lint_auto#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_lint_auto#github">ament_lint_auto  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_lint_common#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_lint_common#github">ament_lint_common  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclcpp#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclcpp#github">rclcpp  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#github">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/cv_bridge#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/cv_bridge#github">cv_bridge  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/std_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/std_msgs#github">std_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/sensor_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/sensor_msgs#github">sensor_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/sensor_msgs_py#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/sensor_msgs_py#github">sensor_msgs_py  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/geometry_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/geometry_msgs#github">geometry_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/tf2#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/tf2#github">tf2  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/tf2_geometry_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/tf2_geometry_msgs#github">tf2_geometry_msgs  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <em>No known dependants.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>robovision_rgbd</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="github-question-list" class="panel-body" style="display: none;"></div>
      <div id="github-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/robovision_rgbd+github">here</a>.</p>
      </div>
      <div id="github-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/artenshi/robovision_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/github/p/robovision_rgbd"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_3"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>



<script id="question-list-template" type="text/html">
  <p>
    Browse <a href="https://robotics.stackexchange.com/questions/tagged/robovision_rgbd?tab=Newest">recent questions</a>
    or see the <a href="https://robotics.stackexchange.com/questions/tagged/robovision_rgbd?tab=Votes">highest voted ones</a>.
  </p>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Title</th>
        <th scope="col">Answered?</th>
        <th scope="col">Created</th>
        <th scope="col">Active</th>
      </tr>
    </thead>
    <tbody>
      {{#questions}}
      <tr>
        <th scope="row"><a href="{{link}}">{{title}}</a><br><small>Tags: {{strtags}}</small></th>
        <th>{{answered}}</th>
        <th>{{created}}</th>
        <th>{{active}}</th>
      </tr>
      {{/questions}}
    </tbody>
  </table>
  {{#has_more}}
  <hr>
  <h4>Additional questions are available at
    <a href="https://robotics.stackexchange.com/questions/tagged/{{name}}?tab=Newest">Robotics Stack Exchange</a>
  </h4>
  {{/has_more}}
  
</script>

<script type="text/javascript" src="/js/mustache.js"></script>
<script type="text/javascript">
  jQuery(function() {
    jQuery.getJSON(url="https://api.stackexchange.com/2.3/questions?order=desc&site=robotics" +
                       "&tagged=robovision_rgbd&pagesize=50&sort=activity")
    .done(function(feed) {
      if (feed.items.length > 0) {
        var question_count_str = (feed.has_more ? '>' : '') + String(feed.items.length)
        const questions = feed.items.map(
          function(question) {
            question.id = Math.round(Math.random() * 99999.0);
            question.created = (new Date(question.creation_date * 1000)).toDateString()
            question.active = (new Date(question.last_activity_date * 1000)).toDateString()
            question.answered = question.is_answered ? "Yes" : "No"
            question.strtags = question.tags.join(' ')
            return question;
          });
        const template = jQuery("#question-list-template").text();
        Mustache.parse(template);
        var rendered = Mustache.render(
          template, 
          { questions: questions,
            has_more: feed.has_more,
            name: "robovision_rgbd"
          }
        );
      }
      //   TODO(tfoote) Resolve images
      //   jQuery("#-question-list img").each(function() {
      //     if (jQuery(this).attr("src").startsWith("/upfiles")) {
      //        jQuery(this).attr("src", "https://answers.ros.org" + jQuery(this).attr("src"));
      //     }
      //   });
      
      if (feed.items.length > 0) {
        jQuery("#humble-question-list").html(rendered);
        jQuery("#humble-question-list").show();
      } else {
        jQuery("#humble-no-question-list").show();
      }
      jQuery("#humble-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#jazzy-question-list").html(rendered);
        jQuery("#jazzy-question-list").show();
      } else {
        jQuery("#jazzy-no-question-list").show();
      }
      jQuery("#jazzy-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#kilted-question-list").html(rendered);
        jQuery("#kilted-question-list").show();
      } else {
        jQuery("#kilted-no-question-list").show();
      }
      jQuery("#kilted-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#rolling-question-list").html(rendered);
        jQuery("#rolling-question-list").show();
      } else {
        jQuery("#rolling-no-question-list").show();
      }
      jQuery("#rolling-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#github-question-list").html(rendered);
        jQuery("#github-question-list").show();
      } else {
        jQuery("#github-no-question-list").show();
      }
      jQuery("#github-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#noetic-question-list").html(rendered);
        jQuery("#noetic-question-list").show();
      } else {
        jQuery("#noetic-no-question-list").show();
      }
      jQuery("#noetic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#galactic-question-list").html(rendered);
        jQuery("#galactic-question-list").show();
      } else {
        jQuery("#galactic-no-question-list").show();
      }
      jQuery("#galactic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#iron-question-list").html(rendered);
        jQuery("#iron-question-list").show();
      } else {
        jQuery("#iron-no-question-list").show();
      }
      jQuery("#iron-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#melodic-question-list").html(rendered);
        jQuery("#melodic-question-list").show();
      } else {
        jQuery("#melodic-no-question-list").show();
      }
      jQuery("#melodic-questions-count").text(question_count_str);
      
    })
    .fail(function(jqxhr, textStatus, error) {
      console.error("Failed to get question data: " + jqxhr.responseText);
      
      jQuery("#humble-get-question-fail").show();
      
      jQuery("#jazzy-get-question-fail").show();
      
      jQuery("#kilted-get-question-fail").show();
      
      jQuery("#rolling-get-question-fail").show();
      
      jQuery("#github-get-question-fail").show();
      
      jQuery("#noetic-get-question-fail").show();
      
      jQuery("#galactic-get-question-fail").show();
      
      jQuery("#iron-get-question-fail").show();
      
      jQuery("#melodic-get-question-fail").show();
      
    });
  });
</script>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("humble");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
