<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>ROS Package: robovision_images</title>
    <meta name="description" content="a community-maintained index of robotics software
">

    
    <link rel="canonical" href="http://index.rosdabbler.com/p/robovision_images/">
    
    
    <link rel="icon" sizes="any" type="image/svg+xml" href="/assets/rosindex_logo.svg">

    

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    

    

    <script type="text/javascript" src=/js/jquery.js></script>
    <script src=/bootstrap/js/bootstrap.min.js type="text/javascript"></script>
    <script src=/js/jquery-cookie.js type="text/javascript"></script>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-EVD5Z6G6NH');
</script>

    <script type="text/javascript" src=/js/toc.js></script>

    <script src=/js/distro_switch.js></script>
  </head>

  <body>

    <header class="site-header">

  <div class="wrapper">
    <div class="container-fluid" style="margin-bottom: 10px">
      <div class="row">
        <!-- title -->
        <div class="col-xs-3" style="white-space:nowrap">
          <a class="site-title" href="/">
            <img src="/assets/rosindex_logo.svg" width="26" height="26" alt="ROS index logo" style="padding-bottom: 3px"/>
            ROS Index</a>
        </div>
        <!-- main internal links -->
        <div class="col-xs-6 text-center" style="padding:0px">
          <div class="btn-group hidden-xs" role="group" aria-label="..." style="padding: 6px">
            <div class="btn-group" role="group">
              <a href="/?search_packages=true" class="btn btn-default" role="button">Package List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/?search_repos=true" class="btn btn-default" role="button">Repository List</a>
            </div>
            <div class="btn-group" role="group">
              <a href="/search_deps" class="btn btn-default" role="button">System Dependencies</a>
            </div>
          </div>
          <div class="hidden-lg hidden-md hidden-sm">
            <button id="hLabel" class="btn btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lists <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="hLabel">
              <li><a href="/?search_packages=true">Package List</a></li>
              <li><a href="/?search_repos=true">Repository List</a></li>
              <li><a href="/search_deps">System Dependencies</a></li>
            </ul>
          </div>
        </div>
        <!-- additional links -->
        <div class="col-xs-3 text-right" style="white-space:nowrap; padding:0px">
          <ul class="list-inline" style="margin-bottom:0px;">
            <li class="dropdown hidden-xs hidden-sm">
              <button id="rLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ROS Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="rLabel">
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-xs hidden-sm">
              <button id="aLabel" class="btn btn-link" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                About <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="aLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
              </ul>
            </li>
            <li class="dropdown hidden-md hidden-lg">
              <button id="qLabel" class="btn btn-link" type="button"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="qLabel">
                <li><a href="/about">About </a></li>
                <li><a href="/contribute">Contribute</a></li>
                <li><a href="/help">Help</a></li>
                <li><a href="/stats">Stats</a></li>
                <hr style="margin:7px" />
                <li><a href="http://docs.ros.org/">Documentation</a></li>
                <li><a href="http://wiki.ros.org/Support">Support</a></li>
                <li><a href="http://discourse.ros.org/">Discussion Forum</a></li>
                <li><a href="http://status.ros.org/">Service Status</a></li>
                <li><a href="https://robotics.stackexchange.com/questions/tagged/ros">ros @ Robotics Stack Exchange</a></li>
                <li><a href="https://docs.ros.org/en/ros2_packages/">Package API</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="container-fluid" style="margin-top: 20px">
  <div class="container-fluid">
    <div class="row">
      <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/?search_packages=true">Packages</a></li>
        <li class="active">robovision_images</li>
      </ol>
    </div>
    <div class="row">
      

<div id="distro-switch" class="btn-group btn-group-justified" data-toggle="buttons">
  
    <label id="humble-option" class="distro-button btn btn-xs btn-default" href="#humble" data="humble">
      <input type="radio" name="options" id="humble-radio" autocomplete="off"> humble
    </label>
  
    <label id="jazzy-option" class="distro-button btn btn-xs btn-default" href="#jazzy" data="jazzy">
      <input type="radio" name="options" id="jazzy-radio" autocomplete="off"> jazzy
    </label>
  
    <label id="kilted-option" class="distro-button btn btn-xs btn-default" href="#kilted" data="kilted">
      <input type="radio" name="options" id="kilted-radio" autocomplete="off"> kilted
    </label>
  
    <label id="rolling-option" class="distro-button btn btn-xs btn-default" href="#rolling" data="rolling">
      <input type="radio" name="options" id="rolling-radio" autocomplete="off"> rolling
    </label>
  
    <label id="github-option" class="distro-button btn btn-xs btn-primary" href="#github" data="github">
      <input type="radio" name="options" id="github-radio" autocomplete="off"> github
    </label>
  
    <label id="noetic-option" class="distro-button btn btn-xs btn-default" href="#noetic" data="noetic">
      <input type="radio" name="options" id="noetic-radio" autocomplete="off"> noetic
    </label>
  

  <!-- Older distros -->
  <div class="btn-group dropdown">
    <label type="button" class="btn btn-xs dropdown-toggle btn-default" data-toggle="dropdown" id="older-distro-button">
        <input type="radio" name="options" autocomplete="off">
      <span id="older-label">Older</span>
      <span class="caret"></span>
    </label>
    <ul class="dropdown-menu" role="menu">
      
        <li data="galactic" id="galactic-option" class="disabled older-distro-option"  href="#galactic">
          <a href="#galactic" data="galactic" id="galactic-button">galactic</a>
        </li>
      
        <li data="iron" id="iron-option" class="disabled older-distro-option"  href="#iron">
          <a href="#iron" data="iron" id="iron-button">iron</a>
        </li>
      
        <li data="melodic" id="melodic-option" class="disabled older-distro-option"  href="#melodic">
          <a href="#melodic" data="melodic" id="melodic-button">melodic</a>
        </li>
      
    </ul>
  </div>
</div>

    </div>
    <div class="row">
      &nbsp;
    </div>
  </div>
</div>


  <div class="distro distro-humble">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>humble</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-jazzy">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>jazzy</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-kilted">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>kilted</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-rolling">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>rolling</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-github">
    <div class="container-fluid">
      
        
        
        

        <div class="row">
          <div class="col-md-10">
            

<div class="well well-sm">
  
  <table class="table">
    <tr>
      <td width="100px" class="text-center">
        <img style="width: 80px" src="/assets/package.png">
      </td>
      <td>
        <h3 style="margin-top: 5px">
          <a style="text-decoration:none" href="/p/robovision_images">robovision_images</a> <small>package from <a style="text-decoration:none" href="/r/robovision_ros2/github-artenshi-robovision_ros2">robovision_ros2</a> repo</small>
        </h3>
          
            
            
              <span class="label label-default pkg-label">

robovision_images
</span>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_processing">

robovision_processing
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_rgbd">

robovision_rgbd
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_services">

robovision_services
</a>
            
          
            
            
              <a class="label label-primary pkg-label" href="/p/robovision_interfaces">

robovision_interfaces
</a>
            
          
      </td>
    </tr>
  </table>
</div>

            <div class="visible-xs visible-sm">
              
              
              



<div class="list-group list-group-sm list-group-horizontal list-group-justified">
  <a class="list-group-item text-center"
     target="_blank"
     href="http://docs.ros.org/en/github/p/robovision_images"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       <br>
       API Docs
  </a>
  <a class="list-group-item text-center"
     target="_blank"
     href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_1"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       <br>
       Browse Code
  </a>
  
  
  
  
  
  
</div>

            </div>
            



<ul class="nav nav-tabs nav-justified" id="github-tabs" style="margin-bottom:20px">
  <li class="better-tabs active">
    <a href="#github-overview" data-toggle="tab">Overview</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    
    <a href="#github-assets" data-toggle="tab"><span class="label label-default">0</span> Assets</a>
  </li>
  <li class="better-tabs">
    
    
    
    
    <a href="#github-deps" data-toggle="tab"><span class="label label-primary">9</span> Dependencies</a>
  </li>
  <li class="better-tabs">
    
    <a href="#github-tutorials" data-toggle="tab"><span class="label label-default">0</span> Tutorials</a>
  </li>
  <li class="better-tabs">
    <a href="#github-questions" data-toggle="tab"><span id="github-questions-count" class="label label-primary">0</span> Q & A</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane active" id="github-overview">
    
    <div class="row">
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h4 class="panel-title">Package Summary</h4></div>
          <div class="panel-body">
            <table class="table table-condensed">
              <tr>
                <td style="width:100px;" class="text-right"><strong>Tags</strong></td>
                <td>
                  
                  
                    <em>No category tags.</em>
                  
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Version</strong></td>
                <td>0.0.0</td>
              </tr>
              <tr>
                <td class="text-right"><strong>License</strong></td>
                <td>TODO: License declaration</td>
              </tr>
              <tr>
                <td class="text-right"><strong>Build type</strong></td>
                <td>
                  
                    <span class="label label-default">
                  
                    AMENT_CMAKE</span>
                </td>
              </tr>
              <tr>
                <td class="text-right"><strong>Use</strong></td>
                <td>
                
                  <span class="label label-success">RECOMMENDED</span>
                
                </td>
              </tr>
            </table>
          </div>
          <div class="panel-heading"><h3 class="panel-title">Repository Summary</h3></div>
          <div class="panel-body">
            
            
            
  <link rel="stylesheet" href="/css/ci-status.css">
  <table class="table table-condensed">
    <tr>
      <td class="text-right"><b>Description</b></td>
      <td><span class="label label-default">RoboVision ROS2</span></td>
    </tr>
    <tr>
      <td style="width:100px;" class="text-right"><b>Checkout URI</b></td>
      <td><a class="label label-default" href="https://github.com/artenshi/robovision_ros2.git">https://github.com/artenshi/robovision_ros2.git</a></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Type</b></td>
      <td><span class="label label-default">git</span></td>
    </tr>
    <tr>
      <td class="text-right"><b>VCS Version</b></td>
      <td><span class="label label-default">main</span></td>
    </tr>
    <tr>
      <td style="white-space: nowrap;" class="text-right"><b>Last Updated</b></div>
      <td>
        
          <span class="label label-default"><span class="glyphicon glyphicon-time"></span> 2025-01-27
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Dev Status</b></td>
      <td>
        
          <span class="label label-warning">UNKNOWN
        </span>
      </td>
    </tr>
              <tr>
                <td class="text-right"><b>CI status</b></td>
                <td class="ci-status">
                  
                  
                    <span class="label label-default" title="No CI information available for this package.">No Continuous Integration</span>
                  
                </td>
              </tr>
    <tr>
      <td class="text-right"><b>Released</b></td>
      <td>
        
          <span class="label label-default">UNRELEASED
        </span>
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Tags</b></td>
      <td>
        
        
          <em>No category tags.</em>
        
      </td>
    </tr>
    <tr>
      <td class="text-right"><b>Contributing</b></td>
      <td>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-help-wanted">
          Help Wanted (<span class="contribute-lists-help-wanted-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-good-first-issue">
          Good First Issues (<span class="contribute-lists-good-first-issue-count">0</span>)
        </a>
        <br>
        <a class="label label-primary" href="/r/robovision_ros2/#github-contribute-lists-pull-requests">
          Pull Requests to Review (<span class="contribute-lists-pull-requests-count">0</span>)
        </a>
      </td>
    </tr>
  </table>

          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading"><h3 class="panel-title">Package Description</h3></div>
          <div class="panel-body">
            TODO: Package description
          </div>
          <div class="panel-heading"><h4 class="panel-title">Additional Links</h4></div>
          <div class="panel-body">
            
            
              <em>No additional links.</em>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Maintainers</h4></div>
          <div class="panel-body">
            
            
              <ul class="list-unstyled">
                
                  <li>roboworks</li>
                
              </ul>
            
          </div>
          <div class="panel-heading"><h4 class="panel-title">Authors</h4></div>
          <div class="panel-body">
            
            
              <em>No additional authors.</em>
            
          </div>
        </div>
      </div>
    </div>
    
      
        <div class="row">
          <div class="col-xs-12">
            <div class="panel panel-default">
              <div class="panel-heading"><span class="glyphicon glyphicon-file"></span><a href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_1/README.md" title="Open in git repository">robovision_1/README.md</a></div>
              <div class="panel-body">
                    <div class="rendered-markdown">
<h1 id="image-publishers-and-subscribers-in-ros2">Image Publishers and Subscribers in ROS2</h1>

<p>The goal of this repository is to introduce students to image publishers and subscribers using ROS2 and OpenCV.</p>

<h1 id="0-cmakelisttxt-and-packagexml">0 CMakeList.txt and package.xml</h1>

<p>When we build and install a package in ROS2, we need to give the compiler some information regarding names and libraries. This guide explains how to use the <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> and <code class="language-plaintext highlighter-rouge">package.xml</code> files to configure and build a package in ROS2.</p>

<h2 id="01-packagexml">0.1 <code class="language-plaintext highlighter-rouge">package.xml</code>
</h2>
<p>The <code class="language-plaintext highlighter-rouge">package.xml</code> file contains package metadata and dependency declarations.</p>

<ul>
  <li>
<strong>Key Sections</strong>:
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;name&gt;</code>: Defines the package name (<code class="language-plaintext highlighter-rouge">robovision_images</code>).</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;version&gt;</code>: Specifies the package version.</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;maintainer&gt;</code>: Provides the maintainer and contact email.</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;license&gt;</code>: Placeholder for the license.</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;buildtool_depend&gt;</code>: Tools for building the package, such as <code class="language-plaintext highlighter-rouge">ament_cmake</code> and <code class="language-plaintext highlighter-rouge">ament_cmake_python</code>.</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;depend&gt;</code>: Runtime dependencies like <code class="language-plaintext highlighter-rouge">rclcpp</code>, <code class="language-plaintext highlighter-rouge">cv_bridge</code>, <code class="language-plaintext highlighter-rouge">sensor_msgs</code>, and <code class="language-plaintext highlighter-rouge">std_msgs</code>.</li>
      <li>
<code class="language-plaintext highlighter-rouge">&lt;test_depend&gt;</code>: Dependencies for testing, such as <code class="language-plaintext highlighter-rouge">ament_lint_auto</code>.</li>
    </ul>
  </li>
</ul>

<h2 id="02-cmakeliststxt">0.2 <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>
</h2>
<p>The <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file defines how the package is built.</p>

<ul>
  <li>
<strong>Key Components</strong>:
    <ul>
      <li>Specifies the minimum CMake version and compiler options.</li>
      <li>Locates dependencies (<code class="language-plaintext highlighter-rouge">rclcpp</code>, <code class="language-plaintext highlighter-rouge">cv_bridge</code>, <code class="language-plaintext highlighter-rouge">OpenCV</code>, etc.).</li>
      <li>Declares include directories for OpenCV and <code class="language-plaintext highlighter-rouge">cv_bridge</code>.</li>
      <li>Adds executables for C++ nodes like <code class="language-plaintext highlighter-rouge">my_publisher</code> and <code class="language-plaintext highlighter-rouge">my_camera_publisher</code> and links their dependencies.</li>
      <li>Installs Python scripts and C++ executables to the appropriate directories.</li>
      <li>Integrates the package with ROS2 using <code class="language-plaintext highlighter-rouge">ament_package()</code>.</li>
    </ul>
  </li>
</ul>

<h2 id="03-example-robovision_images">0.3 Example: <code class="language-plaintext highlighter-rouge">robovision_images</code>
</h2>

<h3 id="031-packagexml">0.3.1 <code class="language-plaintext highlighter-rouge">package.xml</code>
</h3>

<p>We declare the name of our project</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;name&gt;</span>robovision_images<span class="nt">&lt;/name&gt;</span>

</code></pre></div></div>

<p>We are using both C++ and Python code in our project, and therefore, we need to declare it:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake<span class="nt">&lt;/buildtool_depend&gt;</span>
<span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake_python<span class="nt">&lt;/buildtool_depend&gt;</span>

<span class="nt">&lt;depend&gt;</span>rclcpp<span class="nt">&lt;/depend&gt;</span>
<span class="nt">&lt;depend&gt;</span>rclpy<span class="nt">&lt;/depend&gt;</span>

</code></pre></div></div>

<p>Additionally, we need to add all the ros-based dependencies we will use in our project</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;depend&gt;</span>cv_bridge<span class="nt">&lt;/depend&gt;</span>
<span class="nt">&lt;depend&gt;</span>sensor_msgs<span class="nt">&lt;/depend&gt;</span>
<span class="nt">&lt;depend&gt;</span>std_msgs<span class="nt">&lt;/depend&gt;</span>

</code></pre></div></div>

<h3 id="032-cmakelisttxt">0.3.2 <code class="language-plaintext highlighter-rouge">CMakeList.txt</code>
</h3>

<p>First, we declare the name of our project</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">project</span><span class="p">(</span>robovision_images<span class="p">)</span>

</code></pre></div></div>

<p>Similarly, we need to declare that we are using both C++ and Python code</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">find_package</span><span class="p">(</span>ament_cmake REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>ament_cmake_python REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>rclcpp REQUIRED<span class="p">)</span>

</code></pre></div></div>
<p>and the dependencies we are using</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">find_package</span><span class="p">(</span>OpenCV REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>cv_bridge REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>sensor_msgs REQUIRED<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>std_msgs REQUIRED<span class="p">)</span>

</code></pre></div></div>

<p>To build a project, we need to specify which files we want to compile and how we are going to refer them to our package. For C++ files, we declare them as in the example here</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">add_executable</span><span class="p">(</span>my_publisher src/my_publisher.cpp<span class="p">)</span>
<span class="nf">ament_target_dependencies</span><span class="p">(</span>my_publisher 
    rclcpp 
    cv_bridge 
    sensor_msgs 
    OpenCV
<span class="p">)</span>

</code></pre></div></div>

<p>and for Python, we use</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">ament_python_install_package</span><span class="p">(</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="p">)</span>

</code></pre></div></div>

<p>Finally, we need to install them in our install folder to be able to source them later</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">install</span><span class="p">(</span>TARGETS
  my_publisher
  DESTINATION lib/<span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>
<span class="p">)</span>
<span class="nb">install</span><span class="p">(</span>PROGRAMS
  scripts/my_subscriber.py
  DESTINATION lib/<span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span>
<span class="p">)</span>

</code></pre></div></div>

<p>This is a brief introduction to how to use these files to configure your project. Please inspect those files in each section!</p>

<h1 id="1-ros-publishers-and-subcribers">1. ROS Publishers and Subcribers</h1>

<p>We assume the students have a notion of these subjects. If it is not the case, they can start here, for C++:</p>

<blockquote>
  <p>https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Cpp-Publisher-And-Subscriber.html</p>
</blockquote>

<p>and here, for Python:</p>

<blockquote>
  <p>https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html</p>
</blockquote>

<p>ROS2 is designed for object-oriented programming (OOP), and therefore we will provide solutions based on such paradigm (i.e. Class-based templates).</p>

<p>The basic <strong>C++</strong> structure is as follows:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"rclcpp/rclcpp.hpp"</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">MyCustomNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span> <span class="c1">// CHANGE CLASS NAME</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">MyCustomNode</span><span class="p">()</span> <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">"node_name"</span><span class="p">)</span> <span class="c1">// CHANGE CLASS AND NODE NAME</span>
    <span class="p">{</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">MyCustomNode</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">// CHANGE CLASS NAME</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>While the basic <strong>Python</strong> structure is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="n">rclpy</span>
<span class="kn">from</span> <span class="n">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">class</span> <span class="nc">MyCustomNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span> <span class="c1"># CHANGE CLASS NAME
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">"</span><span class="s">node_name</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># CHANGE NODE NAME
</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="nc">MyCustomNode</span><span class="p">()</span> <span class="c1"># CHANGE CLASS NAME
</span>    <span class="n">rclpy</span><span class="p">.</span><span class="nf">spin</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">rclpy</span><span class="p">.</span><span class="nf">shutdown</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>

</code></pre></div></div>

<h1 id="11-static-image-publisher">1.1 Static image publisher</h1>

<p>Have a look at the <code class="language-plaintext highlighter-rouge">my_publisher.cpp</code> file. This file presents the basic structure to construct a <strong>publisher</strong> in ROS2.</p>

<h2 id="111-create-a-publisher">1.1.1 Create a publisher</h2>

<p>The <code class="language-plaintext highlighter-rouge">main</code> section remains the same, and we use it to call our class; however, we have modified it to get some arguments. Within our <code class="language-plaintext highlighter-rouge">ImagePublisherNode</code> class, first, we need to create a node object and give it a unique name:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ImagePublisherNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">image_path</span><span class="p">)</span> <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">"image_publisher"</span><span class="p">)</span>

</code></pre></div></div>

<p>Then, we create a ROS2 publisher and give it a unique name to be shown as a ROS2 topic, so anyone else can access it without confusion. The structure is simple: create_publisher&lt;msg::Type&gt;(“topic/name”, 10). In this case, the type is <code class="language-plaintext highlighter-rouge">sensor_msgs::msg::Image</code> and the name of our output topic is <code class="language-plaintext highlighter-rouge">camera/image</code>, as follows:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image_publisher_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera/image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>


</code></pre></div></div>

<p>Now, let’s gather some data. We will open an image using OpenCV and then publish it in our topic. First, we read the image:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">cv_image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cv_image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Failed to load image from path: %s"</span><span class="p">,</span> <span class="n">image_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>and we convert it to a <strong>ROS message</strong>, the type of data that can be sent through the ROS framework:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image_msg_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">"bgr8"</span><span class="p">,</span> <span class="n">cv_image</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>

</code></pre></div></div>

<p>Now we can publish this message.</p>

<p>We can do it once (<code class="language-plaintext highlighter-rouge">image_publisher_-&gt;publish(*image_msg_)</code>), but it means that the information will be only available for a fraction of time; if you don’t access it at that very moment, you won’t be able to use it anymore. So, let’s publish it all the time! We first decide on a frame rate, which is the number of <strong>frames per second</strong> (fps). In general, we consider <strong>real-time</strong> something around 30 fps. We use a <code class="language-plaintext highlighter-rouge">while</code> loop to publish our image at 30 Hz (i.e. 30 fps). In ROS2, we need to create a <strong>tiner</strong>, that will iterate at a given frequency once the node starts to spin in the <code class="language-plaintext highlighter-rouge">main</code> section:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image_timer_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
				       <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ImagePublisherNode</span><span class="o">::</span><span class="n">publish_image</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

</code></pre></div></div>

<p>This <strong>timer</strong> will call a function (<code class="language-plaintext highlighter-rouge">ImagePublisherNode::publish_image</code>) where we can publish our image:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">publish_image</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">image_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="o">*</span><span class="n">image_msg_</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Finally, notice that we need to define our variables; in particular, in C++, our ROS2 variables are all shared pointers and we need to define them as such:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">image_msg_</span><span class="p">;</span>

<span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">image_publisher_</span><span class="p">;</span>
<span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">image_timer_</span><span class="p">;</span>

</code></pre></div></div>

<p>And that’s it, we have our first ROS2 publisher.</p>

<h2 id="112-test-your-code">1.1.2 Test your code</h2>

<p>Run the following command in a terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>You should see something like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/parameter_events
/rosout

</code></pre></div></div>

<p>Now, in the same terminal, run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_images my_publisher ~/robovision_ros2_ws/src/robovision_ros2/data/images/baboon.png

</code></pre></div></div>

<p>Then, in a new terminal, run this command again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>Do you remember this line <code class="language-plaintext highlighter-rouge">image_publisher_ = this-&gt;create_publisher&lt;sensor_msgs::msg::Image&gt;("camera/image", 10);</code>? Well, now we can see our topic <code class="language-plaintext highlighter-rouge">/camera/image</code>! Furthermore, we can get the details of it. If we enter the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic info /camera/image

</code></pre></div></div>

<p>we can see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Type: sensor_msgs/msg/Image
Publisher count: 1
Subscription count: 0


</code></pre></div></div>

<p>Finally, enter:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node list

</code></pre></div></div>

<p>and</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node info /image_publisher

</code></pre></div></div>

<p>we see:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>image_publisher
  Publishers:
    /camera/image: sensor_msgs/msg/Image

</code></pre></div></div>

<p>So, we can see that our topic is a <em>sensor_msgs/msg/Image</em> data and that the <em>Publisher</em> corresponds to the name we gave it when we defined the node class a few lines above <code class="language-plaintext highlighter-rouge">ImagePublisherNode(const std::string &amp; image_path) : Node("image_publisher")</code>. However, we don’t have any <em>Subscriber</em> yet. Let’s solve it in Section 1.3.</p>

<h2 id="113-homework-11">1.1.3 Homework 1.1</h2>

<ul>
  <li>Add a new publisher in your code that publishes a scaled version by half of the original image.</li>
</ul>

<p>To give you an idea of how ROS2 works, we will help you to solve this task this time, but you are expected to solve it all by yourself.</p>

<p>Do you remember our ROS2 publisher? We need one publisher per topic, so let’s add a new one (don’t forget to give a different and unique name to each topic, in this case, we named it <code class="language-plaintext highlighter-rouge">camera/scaled_image</code>):</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scaled_image_publisher_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera/scaled_image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

</code></pre></div></div>

<p>Don’t forget to define it:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">scaled_image_publisher_</span><span class="p">;</span>

</code></pre></div></div>

<p>After a short search on the internet, we found that, to scale an image in OpenCV, we can use the following command:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">scaled_image</span><span class="p">;</span>
<span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">cv_image</span><span class="p">,</span> <span class="n">scaled_image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">CV_INTER_AREA</span><span class="p">);</span>

</code></pre></div></div>

<p>Now, we need to create a new image message:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scaled_image_msg_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">"bgr8"</span><span class="p">,</span> <span class="n">scaled_image</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>

</code></pre></div></div>

<p>and publish our scaled image:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scaled_image_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="o">*</span><span class="n">scaled_image_msg_</span><span class="p">);</span>

</code></pre></div></div>

<p>Your code should look something like:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"rclcpp/rclcpp.hpp"</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sensor_msgs/msg/image.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cv_bridge/cv_bridge.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">ImagePublisherNode</span> <span class="o">:</span> <span class="k">public</span> <span class="n">rclcpp</span><span class="o">::</span><span class="n">Node</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="n">ImagePublisherNode</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">image_path</span><span class="p">)</span> <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">"image_publisher"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">image_publisher_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera/image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="n">scaled_image_publisher_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera/scaled_image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

        <span class="c1">// Load the image from file</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">cv_image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">IMREAD_COLOR</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cv_image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Failed to load image from path: %s"</span><span class="p">,</span> <span class="n">image_path</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//Resize your image</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">scaled_image</span><span class="p">;</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">resize</span><span class="p">(</span><span class="n">cv_image</span><span class="p">,</span> <span class="n">scaled_image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">CV_INTER_AREA</span><span class="p">);</span>

        <span class="c1">//Convert the output data into a ROS message format</span>
        <span class="n">image_msg_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">"bgr8"</span><span class="p">,</span> <span class="n">cv_image</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>
        <span class="n">scaled_image_msg_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">"bgr8"</span><span class="p">,</span> <span class="n">scaled_image</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>

        <span class="n">image_timer_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_wall_timer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
                                               <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ImagePublisherNode</span><span class="o">::</span><span class="n">publish_image</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
        
        <span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Starting image_publisher application in cpp..."</span><span class="p">);</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    
    <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">image_msg_</span><span class="p">,</span> <span class="n">scaled_image_msg_</span><span class="p">;</span>

    <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">image_publisher_</span><span class="p">;</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">Publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;::</span><span class="n">SharedPtr</span> <span class="n">scaled_image_publisher_</span><span class="p">;</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">TimerBase</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">image_timer_</span><span class="p">;</span>

    <span class="kt">void</span> <span class="nf">publish_image</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">image_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="o">*</span><span class="n">image_msg_</span><span class="p">);</span>
        <span class="n">scaled_image_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="o">*</span><span class="n">scaled_image_msg_</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span> <span class="s">"Usage: my_publisher &lt;image_path&gt;"</span><span class="p">);</span>
        <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">image_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="k">auto</span> <span class="n">node</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">ImagePublisherNode</span><span class="o">&gt;</span><span class="p">(</span><span class="n">image_path</span><span class="p">);</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">spin</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>

    <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Now let’s test it!</p>

<p>First, we need to compile our code, in a new terminal run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/robovision_ros2_ws
colcon build

</code></pre></div></div>

<p>Now, run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_images my_publisher ~/robovision_ros2_ws/src/robovision_ros2/data/images/baboon.png

</code></pre></div></div>

<p>Finally, in a new terminal, run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>and</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node info /image_publisher

</code></pre></div></div>

<p>What can you see? Please, explain.</p>

<h1 id="12-camera-publisher">1.2 Camera publisher</h1>

<p>Have a look at the <code class="language-plaintext highlighter-rouge">my_camera_publisher.cpp</code> file. This file presents the basic structure to open a camera and create a <strong>publisher</strong> in ROS2. Can you note the similarities and differences between static image and camera publishers?</p>

<h2 id="121-create-a-publisher">1.2.1 Create a publisher</h2>

<p>First, we started our node as before:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image_publisher_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_publisher</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera/image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

</code></pre></div></div>

<p>Please note that we use the same topic name for the static image and the camera publishers, so you can only use one of them at a time.</p>

<p>Let’s open our camera! Every camera connected to your computer has an ID number, starting from 0. If you have a laptop with an extra USB camera attached to it, the laptop’s camera will have ID 0 and the USC camera ID 1, and so on. In any case, provided you have at least one camera connected to your computer, there will be a device with ID 0 and, therefore, the default value is zero. We may have a hardcoded ID value, or receive it as a dynamic argument when running our node; the latter case is preferred so, let’s do it.</p>

<p>Now, remember how we enter the image path in our previous code, in the <code class="language-plaintext highlighter-rouge">main</code> function:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="n">rclcpp</span><span class="o">::</span><span class="n">get_logger</span><span class="p">(</span><span class="s">"rclcpp"</span><span class="p">),</span> <span class="s">"Usage: my_publisher &lt;image_path&gt;"</span><span class="p">);</span>
    <span class="n">rclcpp</span><span class="o">::</span><span class="n">shutdown</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">image_path</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

</code></pre></div></div>

<p>However, ROS has a built-in option to enter dynamic arguments, and we will use it from now on – this will be useful when creating launch files. To do this, in our class definition, for a camera_index variable, we declare:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Declare and get the camera index parameter (default is 0)</span>
<span class="k">this</span><span class="o">-&gt;</span><span class="n">declare_parameter</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"camera_index"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">camera_index</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="s">"camera_index"</span><span class="p">).</span><span class="n">as_int</span><span class="p">();</span>

</code></pre></div></div>

<p>Then, the following lines should open a camera with ID camera_index:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Open the camera</span>
<span class="n">capture_</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">camera_index</span><span class="p">);</span>

<span class="c1">// Check if the camera opened successfully</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capture_</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">RCLCPP_ERROR</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Failed to open camera"</span><span class="p">);</span>
    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"Camera not available"</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Now, we should notice that, unlike static images, video sequences change in time and therefore we should update our frame at a desired frame rate (depending on your device specifications). Therefore, we need to get a new frame in our timer callback function (<code class="language-plaintext highlighter-rouge">capture_ &gt;&gt; cv_image;</code>) and publish it. In general, a camera takes some time to start after you call it, so we need to wait until our program starts receiving a video stream (we use the <code class="language-plaintext highlighter-rouge">!capture_.isOpened()</code> to do that). Then, our code to read and publish camera images is:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">publish_image</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">cv_image</span><span class="p">;</span>
    <span class="n">capture_</span> <span class="o">&gt;&gt;</span> <span class="n">cv_image</span><span class="p">;</span> <span class="c1">// Capture an image frame</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">cv_image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">RCLCPP_WARN</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span> <span class="s">"Empty frame captured"</span><span class="p">);</span>
        <span class="n">retu0rn</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Convert the output data into a ROS message format</span>
    <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">image_msg_</span><span class="p">;</span>
    <span class="n">image_msg_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">CvImage</span><span class="p">(</span><span class="n">std_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Header</span><span class="p">(),</span> <span class="s">"bgr8"</span><span class="p">,</span> <span class="n">cv_image</span><span class="p">).</span><span class="n">toImageMsg</span><span class="p">();</span>
    <span class="n">image_publisher_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="o">*</span><span class="n">image_msg_</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="122-test-your-code">1.2.2 Test your code</h2>

<p>First, we need to compile our code, in a new terminal run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/robovision_ros2_ws
colcon build

</code></pre></div></div>

<p>Now, run the next command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>You should see something like this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/parameter_events
/rosout

</code></pre></div></div>

<p>Now, in the same terminal, run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_images my_camera_publisher

</code></pre></div></div>

<p>Then, again, in a new terminal, run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 topic list

</code></pre></div></div>

<p>Can you explain the output? How do you get extra information from your topic?</p>

<p>If you want to test more than one camera, you can specify using the <code class="language-plaintext highlighter-rouge">--ros-args</code> and, for a parameter declaration, <code class="language-plaintext highlighter-rouge">-p param_name:=param_value</code>; in this case, we set the <code class="language-plaintext highlighter-rouge">camera_index</code> variable with your camera index (as an example, we declare it as 0):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 run robovision_images my_camera_publisher <span class="nt">--ros-args</span> <span class="nt">-p</span> camera_index:<span class="o">=</span>0

</code></pre></div></div>

<h2 id="123-homework-12">1.2.3 Homework 1.2</h2>

<ul>
  <li>Add a new publisher in your code that publishes a scaled version by half of the original video frame.</li>
</ul>

<p><strong>Hint</strong> You should start your new publisher outside the timer function <code class="language-plaintext highlighter-rouge">publish_image()</code> but process the scaled image inside it.</p>

<h1 id="13-image-subscriber">1.3 Image subscriber</h1>

<p>Now that we have a stream of images being published in ROS, let’s do something with them. Have a look at the <code class="language-plaintext highlighter-rouge">my_subscriber.cpp</code> and <code class="language-plaintext highlighter-rouge">my_subscriber.py</code> files. The important part here is the <strong>callback function</strong>. Again, review your concepts on ROS publishers and subscribers using the links provided before.</p>

<h2 id="131-create-a-subscriber">1.3.1 Create a subscriber</h2>

<h3 id="c">C++</h3>

<p>As with any node in ROS, we need to start it and give it a unique name:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ImageSubscriberNode</span><span class="p">()</span> <span class="o">:</span> <span class="n">Node</span><span class="p">(</span><span class="s">"image_subscriber"</span><span class="p">)</span>

</code></pre></div></div>

<p>Now, again, we need to create a ROS subscriber. The basic structure is: <code class="language-plaintext highlighter-rouge">create_subscription&lt;msg::Type&gt;("topic/name", queue_size, callback_function)</code>; the <code class="language-plaintext highlighter-rouge">msg::Type</code> is of the same type as the topic we want to get. Also, we tell ROS which function will be called every time a new image arrives. In our example, our <code class="language-plaintext highlighter-rouge">camera/image</code> topic is of type <code class="language-plaintext highlighter-rouge">sensor_msgs::msg::Image</code> and we call a <code class="language-plaintext highlighter-rouge">callback_image</code>, we declare it with a std::bind (don’t worry about it, just use this structure every time you subscribe to a topic!). Then we have:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image_subscriber_</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="s">"camera/image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ImageSubscriberNode</span><span class="o">::</span><span class="n">callback_image</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>

</code></pre></div></div>

<p>That was easy… but now we need to create the callback function. The basic structure consists of a function’s name and, as a parameter, the variable with the data type that will be entered. In this case, our <code class="language-plaintext highlighter-rouge">msg</code> variable is of type <code class="language-plaintext highlighter-rouge">sensor_msgs::msg::Image::SharedPtr</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">callback_image</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span>

</code></pre></div></div>

<p>Inside this function, we can process our data. However, we prefer to use our subscribers callback functions to update our variables and process them in a custom function (e.g. our timer function); this is because, in compĺex programs, we might be required to process the information from several topics at a time.</p>

<p>Therefore, first, let’s focus on our callback function. We first need to transform our <code class="language-plaintext highlighter-rouge">sensor_msgs::msg::Image::SharedPtr</code> data in the <code class="language-plaintext highlighter-rouge">msg</code> variable to <code class="language-plaintext highlighter-rouge">cv::Mat</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">callback_image</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">image_</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">::</span><span class="n">toCvCopy</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">"bgr8"</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">image</span><span class="p">;</span>
    <span class="n">is_image_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>And then, we can use it in our timer function <code class="language-plaintext highlighter-rouge">image_processing()</code>; in this case, we will only display it with OpenCV (don’t forget the <code class="language-plaintext highlighter-rouge">cv::waitKey(1);</code> function to tell OpenCV to stop and show your images):</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">image_processing</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is_image_</span><span class="p">){</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">"view"</span><span class="p">,</span> <span class="n">image_</span><span class="p">);</span>
        <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="python">Python</h3>

<p>Similarly, in Python we first start our node and name it:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="sh">"</span><span class="s">image_subscriber</span><span class="sh">"</span><span class="p">)</span>

</code></pre></div></div>

<p>Then, we have to create a subscriber to tell ROS which function we will use when a new message comes as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
    <span class="n">Image</span><span class="p">,</span> <span class="sh">"</span><span class="s">camera/image</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">callback_camera_image</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

</code></pre></div></div>

<p>As in the C++ example, we can process our new data inside the callback function. However, we will use the callback functions to update our variables and process them later in a custom function (e.g. our timer function). So, in Python, we declare our callback function only with the name of our message but we let the data type as an implicit value:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">callback_camera_image</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

</code></pre></div></div>

<p>We then transform our ROS message to an OpenCV array:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Transform the new message to an OpenCV matrix
</span><span class="n">bridge_rgb</span><span class="o">=</span><span class="nc">CvBridge</span><span class="p">()</span>
<span class="n">self</span><span class="p">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">bridge_rgb</span><span class="p">.</span><span class="nf">imgmsg_to_cv2</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">msg</span><span class="p">.</span><span class="n">encoding</span><span class="p">).</span><span class="nf">copy</span><span class="p">()</span>

</code></pre></div></div>

<p>and we let know Python that we have received our first message:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">is_img</span> <span class="o">=</span> <span class="bp">True</span>

</code></pre></div></div>

<p>Finally, we declare our timer using a basic structure <code class="language-plaintext highlighter-rouge">create_timer(time_in_seconds, callback_function)</code> as:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">processing_timer_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_timer</span><span class="p">(</span><span class="mf">0.030</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">image_processing</span><span class="p">)</span> <span class="c1">#update image each 30 miliseconds
</span>
</code></pre></div></div>

<p>We, then, can process our data in the callback function; in our example, we are going to display our image:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">image_processing</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">is_img</span><span class="p">:</span>
        <span class="c1">#Show your images
</span>        <span class="nf">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">display</span><span class="p">):</span>
            <span class="n">cv2</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">img</span><span class="p">)</span>
            <span class="n">cv2</span><span class="p">.</span><span class="nf">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div></div>

<p>As you can see, our object-oriented programming (OOP) classes are similar in C++ and Python; however, we prefer C++ for performance but we also use Python for simplicity whenever high performance is not required.</p>

<h2 id="132-test-your-code">1.3.2 Test your code</h2>

<p>Run the following command in a terminal to compile your code:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/robovision_ros2_ws
colcon build

</code></pre></div></div>

<p>Then, run the next command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_images my_publisher ~/robovision_ros2_ws/src/robovision_ros2/data/images/baboon.png

</code></pre></div></div>

<p>Now, in a different terminal, run the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/robovision_ros2_ws/install/setup.bash
ros2 run robovision_images my_subscriber

</code></pre></div></div>

<p>What did happen?</p>

<p>In a new terminal run this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node list

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 node info /image_subscriber

</code></pre></div></div>

<p>Can you get what is happening?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/image_subscriber
  Subscribers:
    /camera/image: sensor_msgs/msg/Image

</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ros2 node info</code> let us know that our <em>Image</em> topic <code class="language-plaintext highlighter-rouge">/camera/image</code> is being accessed by the node with name <code class="language-plaintext highlighter-rouge">/image_subscriber</code>. Remember that we named our image publisher as <code class="language-plaintext highlighter-rouge">create_publisher&lt;sensor_msgs::msg::Image&gt;("camera/image", 10)</code> and that we subscribed to the <code class="language-plaintext highlighter-rouge">/camera/image</code> topic using the declaration <code class="language-plaintext highlighter-rouge">create_subscription&lt;sensor_msgs::msg::Image&gt;("camera/image", 10, std::bind(&amp;ImageSubscriberNode::callback_image, this, std::placeholders::_1))</code>.</p>

<h2 id="133-homework-13">1.3.3 Homework 1.3</h2>

<ul>
  <li>Create a second subscriber to subscribe to our second topic, the scaled input image, in the <code class="language-plaintext highlighter-rouge">/camera/scaled_image</code> topic, and display it.</li>
</ul>

<p><strong>Hint</strong> In C++, you need to create a second subscriber and a corresponding callback to the selected topic:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scaled_image_subscriber_</span> <span class="o">=</span> <span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="s">"camera/scaled_image"</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ImageSubscriberNode</span><span class="o">::</span><span class="n">callback_scaled_image</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span>

</code></pre></div></div>

<p>and declare your new callback function <em>callback_scaled_image</em>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">callback_scaled_image</span><span class="p">(</span><span class="k">const</span> <span class="n">sensor_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Image</span><span class="o">::</span><span class="n">SharedPtr</span> <span class="n">msg</span><span class="p">)</span>

</code></pre></div></div>

<p>Similarly, in Python, you need to subscribe to the new topic:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">self</span><span class="p">.</span><span class="n">scaled_image_subscriber_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_subscription</span><span class="p">(</span>
    <span class="n">Image</span><span class="p">,</span> <span class="sh">"</span><span class="s">camera/scaled_image</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">callback_scaled_image</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

</code></pre></div></div>

<p>and define your new callback function <em>callback_scaled_image</em>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">callback_scaled_image</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="authors">Authors</h2>

<ul>
  <li>
<strong>Luis Contreras</strong> - <a href="https://artenshi.github.io/">ARTenshi</a>
</li>
  <li>
<strong>Hiroyuki Okada</strong> - <a href="http://aibot.jp/">AIBot</a>
</li>
</ul>

</div>
              </div>
            </div>
          </div>
        </div>
      
    
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="glyphicon glyphicon-list"></span> CHANGELOG</div>
          <div class="panel-body">
            
              <em>No CHANGELOG found.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-tutorials">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Wiki Tutorials</h3>
      </div>
      <div class="panel-body">
        
        <em>This package does not provide any links to tutorials in it's <a href="https://index.ros.org/contribute/metadata/">rosindex metadata</a>.</em>
        <em>You can check on the <a href="http://wiki.ros.org/robovision_images/Tutorials" target="_blank">ROS Wiki Tutorials</a> page for the package.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-deps">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Package Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <table class="table table-condensed table-striped">
                <thead>
                  <th class="text-center">Deps</th>
                  <th style="width: 100%">Name</th>
                </thead>
                <tbody>
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake#github">ament_cmake  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_cmake_python#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_cmake_python#github">ament_cmake_python  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_lint_auto#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_lint_auto#github">ament_lint_auto  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/ament_lint_common#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/ament_lint_common#github">ament_lint_common  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclcpp#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclcpp#github">rclcpp  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/rclpy#github-deps" class="endoftree">
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/rclpy#github">rclpy  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/cv_bridge#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/cv_bridge#github">cv_bridge  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/sensor_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/sensor_msgs#github">sensor_msgs  </a></td>
                      </tr>
                    
                  
                    
                    
                      <tr>
                        <td class="text-center">
                          
                          <a href="/p/std_msgs#github-deps" >
                            <span class="glyphicon glyphicon-arrow-left" title="Package dependencies"></span>
                          </a>
                        </td>
                        <td><a href="/p/std_msgs#github">std_msgs  </a></td>
                      </tr>
                    
                  
                </tbody>
              </table>
            
          </div>
          <div class="panel-heading">
            <h3 class="panel-title">System Dependencies</h3>
          </div>
          <div class="panel-body">
            
              <em>No direct system dependencies.</em>
            
          </div>
        </div>
      </div>

      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Dependant Packages</h3>
          </div>
          <div class="panel-body">
            
              <em>No known dependants.</em>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-assets">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Launch files</h3>
      </div>
      <div class="panel-body">
        
          <em>No launch files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Messages</h3>
      </div>
      <div class="panel-body">
        
          <em>No message files found.</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Services</h3>
      </div>
      <div class="panel-body">
        
          <em>No service files found</em>
        
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Plugins</h3>
      </div>
      <div class="panel-body">
        
          <em>No plugins found.</em>
        
      </div>
    </div>
  </div>

  <div class="tab-pane" id="github-questions">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Recent questions tagged <kbd>robovision_images</kbd> at <strong><a href="https://robotics.stackexchange.com/" target="_blank">Robotics Stack Exchange</a></strong></h3>      </div>
      <div id="github-question-list" class="panel-body" style="display: none;"></div>
      <div id="github-no-question-list" class="panel-body" style="display: none;">
        <p>No questions yet, you can ask one <a href="https://robotics.stackexchange.com/questions/tagged/robovision_images+github">here</a>.</p>
      </div>
      <div id="github-get-question-fail" class="panel-body alert alert-warning" style="display: none;">
        <p>Failed to get question list, you can ticket an issue <a href="https://github.com/ros-infrastructure/rosindex/issues/new" target="_blank" class="alert-link">here</a> </p>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="/js/package_body_tabs.js"></script>

<script src=/js/contribution_suggestions.js></script>
<script type="text/javascript">
jQuery(function() {
    // Update the count on the links to the contribution suggestions
    updateContributionSuggestionsCountOnPackage('https://github.com/artenshi/robovision_ros2.git');
});
</script>

          </div>
          <div class="col-md-2 hidden-xs hidden-sm">
            
            
            



<div class="list-group list-group-sm ">
  <a class="list-group-item"
     target="_blank"
     href="http://docs.ros.org/en/github/p/robovision_images"
     title="View API documentation on docs.ros.org"
     >
       <span style="margin-right: 5px;" class="glyphicon glyphicon-file"></span>
       
       API Docs
  </a>
  <a class="list-group-item"
     target="_blank"
     href="https://github.com/artenshi/robovision_ros2/tree/main/robovision_1"
     title="View source code on repository">
       <span class="glyphicon glyphicon-folder-open" style="margin-right:5px;"></span>
       
       Browse Code
  </a>
  
  
  
  
  
  
</div>

          </div>
        </div>
      
    </div>
  </div>

  <div class="distro distro-noetic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>noetic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-galactic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>galactic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-iron">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>iron</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>

  <div class="distro distro-melodic">
    <div class="container-fluid">
      
          <div class="alert alert-warning">No version for distro <strong>melodic</strong>. Known supported distros are highlighted in the buttons above.</div>
      
    </div>
  </div>



<script id="question-list-template" type="text/html">
  <p>
    Browse <a href="https://robotics.stackexchange.com/questions/tagged/robovision_images?tab=Newest">recent questions</a>
    or see the <a href="https://robotics.stackexchange.com/questions/tagged/robovision_images?tab=Votes">highest voted ones</a>.
  </p>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">Title</th>
        <th scope="col">Answered?</th>
        <th scope="col">Created</th>
        <th scope="col">Active</th>
      </tr>
    </thead>
    <tbody>
      {{#questions}}
      <tr>
        <th scope="row"><a href="{{link}}">{{title}}</a><br><small>Tags: {{strtags}}</small></th>
        <th>{{answered}}</th>
        <th>{{created}}</th>
        <th>{{active}}</th>
      </tr>
      {{/questions}}
    </tbody>
  </table>
  {{#has_more}}
  <hr>
  <h4>Additional questions are available at
    <a href="https://robotics.stackexchange.com/questions/tagged/{{name}}?tab=Newest">Robotics Stack Exchange</a>
  </h4>
  {{/has_more}}
  
</script>

<script type="text/javascript" src="/js/mustache.js"></script>
<script type="text/javascript">
  jQuery(function() {
    jQuery.getJSON(url="https://api.stackexchange.com/2.3/questions?order=desc&site=robotics" +
                       "&tagged=robovision_images&pagesize=50&sort=activity")
    .done(function(feed) {
      if (feed.items.length > 0) {
        var question_count_str = (feed.has_more ? '>' : '') + String(feed.items.length)
        const questions = feed.items.map(
          function(question) {
            question.id = Math.round(Math.random() * 99999.0);
            question.created = (new Date(question.creation_date * 1000)).toDateString()
            question.active = (new Date(question.last_activity_date * 1000)).toDateString()
            question.answered = question.is_answered ? "Yes" : "No"
            question.strtags = question.tags.join(' ')
            return question;
          });
        const template = jQuery("#question-list-template").text();
        Mustache.parse(template);
        var rendered = Mustache.render(
          template, 
          { questions: questions,
            has_more: feed.has_more,
            name: "robovision_images"
          }
        );
      }
      //   TODO(tfoote) Resolve images
      //   jQuery("#-question-list img").each(function() {
      //     if (jQuery(this).attr("src").startsWith("/upfiles")) {
      //        jQuery(this).attr("src", "https://answers.ros.org" + jQuery(this).attr("src"));
      //     }
      //   });
      
      if (feed.items.length > 0) {
        jQuery("#humble-question-list").html(rendered);
        jQuery("#humble-question-list").show();
      } else {
        jQuery("#humble-no-question-list").show();
      }
      jQuery("#humble-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#jazzy-question-list").html(rendered);
        jQuery("#jazzy-question-list").show();
      } else {
        jQuery("#jazzy-no-question-list").show();
      }
      jQuery("#jazzy-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#kilted-question-list").html(rendered);
        jQuery("#kilted-question-list").show();
      } else {
        jQuery("#kilted-no-question-list").show();
      }
      jQuery("#kilted-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#rolling-question-list").html(rendered);
        jQuery("#rolling-question-list").show();
      } else {
        jQuery("#rolling-no-question-list").show();
      }
      jQuery("#rolling-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#github-question-list").html(rendered);
        jQuery("#github-question-list").show();
      } else {
        jQuery("#github-no-question-list").show();
      }
      jQuery("#github-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#noetic-question-list").html(rendered);
        jQuery("#noetic-question-list").show();
      } else {
        jQuery("#noetic-no-question-list").show();
      }
      jQuery("#noetic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#galactic-question-list").html(rendered);
        jQuery("#galactic-question-list").show();
      } else {
        jQuery("#galactic-no-question-list").show();
      }
      jQuery("#galactic-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#iron-question-list").html(rendered);
        jQuery("#iron-question-list").show();
      } else {
        jQuery("#iron-no-question-list").show();
      }
      jQuery("#iron-questions-count").text(question_count_str);
      
      if (feed.items.length > 0) {
        jQuery("#melodic-question-list").html(rendered);
        jQuery("#melodic-question-list").show();
      } else {
        jQuery("#melodic-no-question-list").show();
      }
      jQuery("#melodic-questions-count").text(question_count_str);
      
    })
    .fail(function(jqxhr, textStatus, error) {
      console.error("Failed to get question data: " + jqxhr.responseText);
      
      jQuery("#humble-get-question-fail").show();
      
      jQuery("#jazzy-get-question-fail").show();
      
      jQuery("#kilted-get-question-fail").show();
      
      jQuery("#rolling-get-question-fail").show();
      
      jQuery("#github-get-question-fail").show();
      
      jQuery("#noetic-get-question-fail").show();
      
      jQuery("#galactic-get-question-fail").show();
      
      jQuery("#iron-get-question-fail").show();
      
      jQuery("#melodic-get-question-fail").show();
      
    });
  });
</script>


<script type="text/javascript">
  $(document).ready(function() {
    setupDistroSwitch("humble");
  });
</script>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <div class="container-fluid">
      <div style="float:left;">
        
          <a href="https://github.com/rkent/rosindex" title="Find rosindex in Github">
          <span class="icon  icon--github">
            <svg viewBox="0 0 16 16">
              <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
            </svg>
          </span>

          <span class="username">rkent/rosindex</span>
        </a>
        <em class="hidden-xs">| generated on 2025-05-05</em>
      
      </div>
      <div style="float:right;">
        <p class="text"><span class="hidden-xs">a community-maintained index of robotics software
 | </span><a href="/privacy.txt">privacy</a></p>
      </div>
    </div>
  </div>

</footer>


  </body>

</html>
